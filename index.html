<!DOCTYPE html> <html> <meta charset="utf-8"> <title>Perchance</title> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="robots" content="noindex, nofollow"> <base href="https://perchance.org/" target="_parent"> <meta name="referrer" content="no-referrer"> <meta id="colorSchemeMetaTagToPreventWhiteFlash75847" name="color-scheme" content="light dark"> <style> html{ font-family:sans-serif; -ms-text-size-adjust:100%; -webkit-text-size-adjust:100%; } body{ margin:0;} article, aside, details, figcaption, figure, footer, header, hgroup, main, menu, nav, section{ display:block;} audio, canvas, progress, video{ display:inline-block; vertical-align:baseline; } audio:not([controls]){ display:none;height:0;} [hidden]{ display:none !important; }template{ display:none;} a{ background-color:transparent;} a:active, a:hover{ outline:0;} abbr[title]{ border-bottom:1px dotted;} b, strong{ font-weight:bold;} dfn{ font-style:italic;} h1{ font-size:2em;margin:0.67em 0;} mark{ background:#ff0;color:#000;} small{ font-size:80%;} sub, sup{ font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sup{ top:-0.5em;}sub{ bottom:-0.25em;} img{ border:0;} svg:not(:root){ overflow:hidden;} figure{ margin:1em 40px;} hr{ box-sizing:content-box;height:0;} pre{ overflow:auto;} code, kbd, pre, samp{ font-family:monospace, monospace;font-size:1em;} button:not([disabled]), input:not([disabled]), optgroup:not([disabled]), select:not([disabled]), textarea:not([disabled]){ color:inherit;}button, input, optgroup, select, textarea{ font:inherit; margin:0; } button{ overflow:visible;} button, select{ text-transform:none;} button, html input[type="button"], input[type="reset"], input[type="submit"]{ -webkit-appearance:button; cursor:pointer; } button[disabled], html input[disabled]{ cursor:default;} button::-moz-focus-inner, input::-moz-focus-inner{ border:0;padding:0;} input{ line-height:normal;} input[type="checkbox"], input[type="radio"]{ box-sizing:border-box; padding:0; } input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button{ height:auto;} input[type="search"]{ -webkit-appearance:textfield; box-sizing:content-box; } input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration{ -webkit-appearance:none;} fieldset{ border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em;} legend{ border:0; padding:0; } textarea{ overflow:auto;} optgroup{ font-weight:bold;} table{ border-collapse:collapse;border-spacing:0;}td, th{ padding:0;}</style> <script>window.PERCH={},document.__perchanceInternal={},document.__perchanceInternal.perchanceErrorString="";</script> <script>PERCH.withExportDebug83748=!0,window.location.hash.includes("__withExportDebug83748")&&(PERCH.withExportDebug83748=!1);</script> <script>const PERCH=window.PERCH;window.addEventListener("load",function(){PERCH.windowOnLoadAlreadyFired=!0}),PERCH.ignorePerchanceErrors=!1,window.generatorName="loody",window.generatorPublicId="167772e8444433370585b18a279e2d33",window.generatorLastEditTime=Number("1770259821607"),PERCH.parentWindow=window.parent,PERCH.parentWindow||(PERCH.parentWindow={postMessage:function(){}});</script> <script>if('serviceWorker' in navigator && (window.location.href.includes("?_serviceWorkerDebug=1") || window.location.href.includes("&_serviceWorkerDebug=1"))) {
      navigator.serviceWorker.register(`https://${window.generatorPublicId}.perchance.org/lib/serviceWorker.js`) // note: served from this subdomain, not perchance.org
        .then(registration => {
          console.log('Service Worker registered:', registration); 
        })
        .catch(error => {
          console.error('Service Worker registration failed:', error);
        });
    }</script> <script>try{window.localStorage.testIfWeCanReadLocalStorageWithoutDOMError}catch(err){console.debug("localStorage is disallowed. Adding a 'dummy' polyfill.");Object.defineProperty(window,"localStorage",{value:new Proxy({},{set:(t,k,v)=>t[k]=String(v)})})}</script> <script>{
      let localToken = "LOCAL"; // downloader changes this to "LOCAL"
      if(navigator.webdriver && window.location.href.includes("allow_direct_iframe_view")) localToken = "LOCAL"; // for browser automation/testing stuff
      function inIframe () {
        try {
          return window.self !== window.top;
        } catch (e) {
          return true;
        }
      }
      // to prevent *direct* null.perchance.org / <publicId>.perchance.org access (but let it run however if it's a local copy):
      if(!inIframe() && localToken !== "LOCAL"){window.location.href="https://perchance.org/loody"+window.location.search;} // not to self: don't change this without changing generator downloader script
    }</script> <script>// POLYFILLS:
    if(!Array.prototype.at) { // For Safari 14 
      Array.prototype.at = function(relativeIndex) {
        let i = relativeIndex >= 0 ? relativeIndex : this.length + relativeIndex;
        return this[i];
      };
    }</script> <script>// Fix bug/incompat where Safari stringifies objects that it logs:
    if(true) {
      let needsFix = false;
      let a = {toString:function(){ needsFix=true; return ""; }};
      console.debug(a);
      if(needsFix) {
        const methods = ['log', 'warn', 'debug', 'error'];
        function createProtectiveProxy(obj) {
          if (typeof obj !== 'object' || obj === null) return obj;
          return new Proxy(obj, {
            get: function(target, prop) {
              if (prop === 'toString' || prop === Symbol.toPrimitive) return undefined;
              else return target[prop];
            }
          });
        }
        methods.forEach(function(method) {
          const original = console[method].bind(console); 
          console[method] = function(...args) {
            // Protect each argument
            for (let i = 0; i < args.length; i++) {
              args[i] = createProtectiveProxy(args[i]);
            }
            original(...args);
          };
        });
        console.debug("Fixed safari log/toString bug.");
      }
    }</script> <script>if(window.location.host.endsWith(".perchance.org")) {
      // const fetch = window.fetch;
      const enableBlocking = Date.now()-window.generatorLastEditTime > 1000*60*5;
      let spamHostnames = [];
      setTimeout(async () => {
        spamHostnames = await fetch("https://perchance.org/api/securityData").then(r => r.json()).then(data => data.spamHostnames);
      }, 1000*5);
      document.addEventListener('click', function(e) {
        if(!enableBlocking) return;
        try {
          const anchor = e.target.closest('a');
          if(anchor) {
            const clickedHostname = new URL(anchor.getAttribute('href')).hostname;
            if(spamHostnames.some(h => clickedHostname === h || clickedHostname.endsWith('.'+h))) {
              e.preventDefault();
            }
          }
        } catch(e) {}
      });
    }</script> <style> html{ margin:0;padding:0;width:100%;height:100%;box-sizing:border-box;}*, *:before, *:after{ box-sizing:inherit;}body{ margin:0;padding:0;text-align:center;}hidden{ position:fixed;top:-14000px;left:-14000px;}body ul, body ol{ text-align:left;}</style> <script id="preloaded-generator-data" type="notjs">%7B%22name%22:%22loody%22,%22modelText%22:%22//%20You%20are%20welcome%20to%20review%20the%20code.%20No%20secrets%20or%20hidden%20elements.%20If%20you%20wish%20to%20make%20changes,%20ensure%20you%20keep%20the%20original%20site%20link%20for%20feedback%20or%20questions.%20Feel%20free%20to%20ask%20anything.%5Cn%5Cn//%E2%9A%A0%EF%B8%8F%20Warning:%20Unauthorized%20alterations%20may%20lead%20to%20unintended%20consequences.%20Use%20caution%20and%20make%20modifications%20responsibly.%5Cn%5Cn//Original%20site%20link:%20%5C%22https://perchance.org/loody%5C%22%20or%20%5C%22bit.ly/ldy%5C%22%5Cn%5Cn%5CngenerateHTML%20=%20%7Bimport:t2i-framework-plugin-v2%7D%5CnrandomInteger%20=%20%7Bimport:random-integer-plugin%7D%5Cn$meta%20%5Cn%20%20title%20=%20LOODY%5Cn%20%20description%20=%20(Image-Generator%20+%20Songs%20+%20Minigame)%5Cnsettings%20%5Cn%20%20pageTitle%20=%20%F0%9D%94%84%F0%9D%94%A6%20%E2%84%91%F0%9D%94%AA%F0%9D%94%9E%F0%9D%94%A4%F0%9D%94%A2%20%F0%9D%94%8A%F0%9D%94%A2%F0%9D%94%AB%F0%9D%94%A2%F0%9D%94%AF%F0%9D%94%9E%F0%9D%94%B1%F0%9D%94%AC%F0%9D%94%AF%5Cn%20%20introMessage%20=%20%E2%9A%9D%20%E2%98%BD%20%E2%86%91%20Click%20generate%20to%20begin%20%E2%86%91%20%E2%98%BE%20%E2%9A%9D%5Cn%20%20numImages%20=%20%5BNumber(input.numImages)%5D%5Cn%20%20imageOptions%20%5Cn%20%20%20%20saveTitle%20=%20(%5Binput.artStyle.getName%5D)%20%5Binput.description%5D%20%5Cn%20%20%20%20prompt%20=%20%5Binput.artStyle.prompt%5D%5Cn%20%20%20%20negativePrompt%20=%20%5Binput.artStyle.negative%5D%5Cn%20%20%20%20resolution%20=%20%5Binput.shape%5D%5Cn%20%20%20%20guidanceScale%20=%20%5Binput.guidance%5D%5Cn%20%20%20%20width%20=%20%5Binput.width%5D%5Cn%20%20userInputs%20%5Cn%20%20%20%20width%5Cn%20%20%20%20%20%20label%20=%20%E2%86%95%EF%B8%8F%20Size%5Cn%20%20%20%20%20%20type%20=%20select%5Cn%20%20%20%20%20%20remember%20=%20true%5Cn%20%20%20%20%20%20options%5Cn%20%20%20%20%20%20%20%20Default%20=%20300%5Cn%20%20%20%20%20%20%20%2010%25%20=%20100%5Cn%20%20%20%20%20%20%20%2020%25%20=%20200%5Cn%20%20%20%20%20%20%20%2030%25%20=%20300%5Cn%20%20%20%20%20%20%20%2040%25%20=%20400%5Cn%20%20%20%20%20%20%20%2050%25%20=%20500%5Cn%20%20%20%20%20%20%20%2060%25%20=%20600%5Cn%20%20%20%20%20%20%20%2070%25%20=%20700%5Cn%20%20%20%20%20%20%20%2080%25%20=%20800%5Cn%20%20%20%20%20%20%20%2090%25%20=%20900%5Cn%20%20%20%20%20%20%20%20100%25%20=%201000%5Cn%20%20%20%20shape%5Cn%20%20%20%20%20%20label%20=%20%F0%9F%94%84%20Orientation%5Cn%20%20%20%20%20%20type%20=%20select%5Cn%20%20%20%20%20%20remember%20=%20true%5Cn%20%20%20%20%20%20options%5Cn%20%20%20%20%20%20%20%20Portrait%20=%20512x768%5Cn%20%20%20%20%20%20%20%20Square%20=%20512x512%5Cn%20%20%20%20%20%20%20%20Landscape%20=%20768x512%5Cn%20%20%20%20guidance%5Cn%20%20%20%20%20%20label%20=%20%F0%9F%94%8D%20Focus%5Cn%20%20%20%20%20%20type%20=%20select%5Cn%20%20%20%20%20%20remember%20=%20true%5Cn%20%20%20%20%20%20options%5Cn%20%20%20%20%20%20%20%20Default%20=%205%5Cn%20%20%20%20%20%20%20%20Soft%20=%202%5Cn%20%20%20%20%20%20%20%20s1%20=%203%5Cn%20%20%20%20%20%20%20%20s2%20=%204%5Cn%20%20%20%20%20%20%20%20Medium%20=%205%5Cn%20%20%20%20%20%20%20%20m1%20=%206%5Cn%20%20%20%20%20%20%20%20m2%20=%207%5Cn%20%20%20%20%20%20%20%20Sharp%20=%208%5Cn%20%20%20%20numImages%5Cn%20%20%20%20%20%20label%20=%20%F0%9F%94%A2%20Amount%5Cn%20%20%20%20%20%20type%20=%20select%5Cn%20%20%20%20%20%20remember%20=%20true%20%5Cn%20%20%20%20%20%20options%5Cn%20%20%20%20%20%20%20%201%5Cn%20%20%20%20%20%20%20%202%5Cn%20%20%20%20%20%20%20%203%5Cn%20%20%20%20%20%20%20%204%5Cn%20%20%20%20%20%20%20%205%5Cn%20%20%20%20%20%20%20%2010%5Cn%20%20%20%20%20%20%20%2015%5Cn%20%20%20%20%20%20%20%2020%5Cn%20%20%20%20%20%20%20%2030%5Cn%20%20%20%20artStyle%5Cn%20%20%20%20%20%20label%20=%20%F0%9F%92%83%20Presets%20(%F0%9D%93%A2%F0%9D%93%BD%F0%9D%94%82%F0%9D%93%B5%F0%9D%93%AE)%5Cn%20%20%20%20%20%20type%20=%20select%5Cn%20%20%20%20%20%20takesUpFullRow%20=%20false%5Cn%20%20%20%20%20%20remember%20=%20true%5Cn%20%20%20%20%20%20width%20=%20min(750px,%20100%25)%5Cn%20%20%20%20%20%20options%5Cn%20%20%20%20%20%20%20%20%F0%9F%93%B7%20Realistic%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20%5Binput.description%5D,%20sharp%20focus,%20professional%20photography,%20ultra%20detailed%20photograph,%20high%20quality,%208k,%20fine%20details,%20RAW%20photo%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20fake,%20blurry,%20(worst%20quality,%20masterpiece,%20bad%20quality,%20low%20quality:1.1),%20glitch,%20blur,%20noise,%20text,%20watermark,%20ugly,%20bad,%20gross,%20(highly-saturated)%20(cropped-collage)%5Cn%20%20%20%20%20%20%20%20%F0%9F%8F%A2%20Maquette%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20(%5Binput.description%5D)%20Maquette%20design,%20Miniature%20model,%20Sculptural%20maquette,%20Architectural%20prototype,%20Artistic%20maquette,%20Scale%20modeling,%20Crafting%20maquettes,%20Display%20models,%20Maquette%20materials,%20Model%20photography%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20text%5Cn%20%20%20%20%20%20%20%20%F0%9F%8E%86%20Photoshop%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20((%5Binput.description%5D)),%20%7BMasterpiece,%20best%20quality,%20incredible%20detail,%208k%7Ctelephoto%20shot,%20low-angle%20shot,%20(creepy%20and%20cursed:1.2),%20absolutely%20cursed%20photo,%20nope%20nope%20nope%20nope,%20what%20the%20actual%20f,%20(unsettling%20photo:1.2),%20cursed_thing,%20cursedimages,%20no%20context,%20cursed%20image,%20bad%20photo,%20weird%20photo,%20very%20strange,%20color%20photo,%20creepy%20photo,%20(nightmare%20fuel)%7C90s%20home%20video,%20nostalgic%2090s%20photo,%20taken%20with%20kodak%20disposable%20camera%7Cgrainy%20photograph,%2080s%20photo%20with%20film%20grain,%20Kodacolor%20II%2080s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%2080s%20photo%20with%20wear%20and%20tear%20and%20minor%20creasing%20and%20scratches,%20vintage%20color%20photo%7Cphotorealistic%20oil%20painting,%20by%20charlie%20bowater,%20fine%20details,%20by%20wlop,%20trending%20on%20artstation,%20very%20detailed%7C(illustration:1.3),%20masterpiece,%20breathtaking%20illustration%7Cvery%20cute%20shape,%20stylized%20octane%20render,%208k,%20masterpiece,%20soooo%20cute,%20beautiful%20cute%20perfection,%20beautiful%20soft%20lighting,%20soft%20colors,%20centered,%20high%20resolution,%20undefined,%20soft%20gradient%20background%7Cvery%20cute%20shape,%20stylized%20octane%20render,%208k,%20masterpiece,%20soooo%20cute,%20beautiful%20cute%20perfection,%20beautiful%20soft%20lighting,%20soft%20colors,%20centered,%20high%20resolution%7Cwaifu%20character%20portrait,%20art%20by%20Kazenoko,%20featured%20on%20pixiv,%201%20girl,%20by%20Ilya%20Kuvshinov,%20Kantoku%20art,%20very%20detailed%20anime%20art%20by%20Redjuice%7C((neon%20vintage%20anime))%20style,%2090's%20anime%20style,%20hajime%20sorayama,%20greg%20tocchini,%20neon%20vintage%20anime%20masterpiece,%20anime%20art,%204k,%20high%20quality%7Cvintage%20anime,%2090's%20anime%20style,%20by%20hajime%20sorayama,%20by%20greg%20tocchini,%20anime%20masterpiece,%20pixiv,%20akira-style%20art,%20akira%20anime%20art,%204k,%20high%20quality%7Cillustration,%20flat,%202D,%20vector%20art,%20masterpiece,%20made%20with%20adobe%20illustrator,%20behance%20competition%20winner,%20trending%20on%20dribble,%204k,%20high%20resolution,%20crisp%20lines%7Cbest%20pixel%20art,%20neo-geo%20graphical%20style,%20retro%20nostalgic%20masterpiece,%20128px,%2016-bit%20pixel%20art%20,%202D%20pixel%20art%20style,%20adventure%20game%20pixel%20art,%20inspired%20by%20the%20art%20style%20of%20hyper%20light%20drifter,%20masterful%20dithering,%20superb%20composition,%20beautiful%20palette,%20exquisite%20pixel%20detail%7C(studio%20ghibli%20style%20art:1.3),%20sharp,%20very%20detailed,%20high%20resolution,%20inspired%20by%20hayao%20miyazaki,%20anime,%20art%20from%20ghibli%20movie%7Csoft%20focus,%20depth%20of%20field,%208k%20photo,%20HDR,%20professional%20lighting,%20taken%20with%20Canon%20EOS%20R5,%2075mm%20lens%7Cdigital%20painting%20by%20Ilya%20Kuvshinov%20with%20painterly%20brush%20strokes,%20by%20Ilya%20Kuvshinov,%20painterly%20masterpiece%7Cbokeh,%204k,%20highly%20detailed,%20Pixar%20render,%20CGI%20Animation,%20Disney,%20cute%20big%20circular%20reflective%20eyes,%20dof,%20(cinematic%20film),%20Disney%20realism,%20subtle%20details,%20breathtaking%20Pixar%20short,%20fine%20details,%20close%20up,%20sharp%20focus,%20HDR,%20Disney-style%20octane%20render,%20incredible%20composition,%20superb%20lighting%20and%20detail%7Cconcept%20art,%20digital%20art,%20illustration,%20inspired%20by%20wlop%20style,%208k,%20fine%20details,%20sharp,%20very%20detailed,%20high%20resolution,%20masterpiece%7Ccinematic%20shot,%20dynamic%20lighting,%2075mm,%20Technicolor,%20Panavision,%20cinemascope,%20sharp%20focus,%20fine%20details,%208k,%20HDR,%20realism,%20realistic,%20key%20visual,%20film%20still,%20cinematic%20color%20grading,%20depth%20of%20field%7B%7C,%20adventure%7C,%20b-horror%20film%20screencap%7C,%20epic%20fantasy%7C,%20sci-fi%7C,%20film%20noir%7C,%20horror%7C,%20indie%20film%7C%20screencap%7C,%20western%7C,%20wild%20west%7C,%20thriller%7D%7D%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%5Cn%20%20%20%20%20%20%20%20%F0%9F%98%8F%20Amateur%20Photos%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20(%5Binput.description%5D),%20(real%20photos),%20(private%20photos),%20(personal%20images),%20private%20amateur%20photo,%20casual%20photo,%20(candid%20selfie),%20impromptu,%20Snapchat%20selfie,%20private,%20amateur%20photo%20found%20on%20very%20old%20phone,%20(realistic%20finely%20detailed%20face),%20occasional%20freckle,%20realistic%20hair,%20%7Blong%20hair%7Cshort%20hair%7Cshoulder-length%20hair%7Cshaggy%20hair%7D,%20%7Bhair%20bangs%7Cno%20hair%20bangs%7D,%20realistic%20body,%20realistic%20image,%20((natural%20imperfections)),%20(petite%20physique),%20homely%20person,%20not%20a%20model,%20shy%20poses,%20minimal%20makeup,%20(((((Innocent))))),%20sultry%20eyes,%20(((often%20clothed))),%20((extremely%20coy)),%20((very%20modest)),%20((very%20prim)),%20((very%20humble)),%20((incredibly%20shy)),%20(((demure))),%20classy,%20elegant,%20casual,%20desirable,%20sensual,%20alluring,%20((smouldering%20looks)),%20sultry,%20(((((teasing%20poses))))),%20playful,%20touching%20hair,%20poor%20quality%20phone%20pictures,%20poor%20quality%20camera,%20(natural%20lighting),%20very%20amateur%20quality,%20unprofessional%20photo,%20no%20depth%20of%20fiel%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20professional%20photo,%20((blurry)),%20((blurred%20image)),%20(anatomically%20incorrect%20body),%20(((soft%20focus))),%20studio%20photo,%20Snapchat%20filter,%20high%20quality,%20depth%20of%20field,%20fake-looking%20image,%20tattoos,%20artwork,%20painting,%20anime,%20drawing,%20cartoon,%20badly%20rendered%20hands,%20badly%20rendered%20feet,%20badly%20rendered%20legs,%20%20missing%20arms,%20bad%20proportions,%20missing%20legs,%20poorly%20rendered%20feet,%20cloned%20face,%20((extra%20limbs)),%20(mutated%20hands),%20(disfigured),%20((bad%20anatomy)),%20(poorly%20rendered%20face),%20duplicated,%20(extra%20arms),%20(too%20many%20fingers),%20(extra%20legs)%20(extra%20limbs),%20(fused%20fingers),%20distorted%20face%5Cn%20%20%20%20%20%20%20%20%E2%9C%8D%EF%B8%8F%20%F0%9D%96%98%F0%9D%96%90%F0%9D%96%8A%F0%9D%96%99%F0%9D%96%88%F0%9D%96%8D%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20%5Binput.description%5D%20Simple%20lines,%20Easy%20strokes,%20Minimalist%20style,%20Basic%20details,%20Relaxed%20sketch,%20Uncomplicated%20vibe,%20Beginner-friendly,%20Casual%20strokes,%20Light%20touch,%20Quick%20sketch,%20Plain%20lines,%20Effortless%20composition,%20Basic%20shapes,%20Easy%20perspective,%20Straightforward%20drawing,%20Architecture,%20Human%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20text,%20watermark,%20fake%5Cn%20%20%20%20%20%20%20%20%F0%9F%8E%A8%20Pastel%20Colors%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20%5Binput.description%5D,%20crayon%20drawing%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20%20%20%20%20%20%20%E2%9C%8F%EF%B8%8F%20Pencil%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20((black%20and%20white%20pencil%20drawing)),%20%5Binput.description%5D,%20black%20and%20white,%20breathtaking%20pencil%20illustration,%20(highly%20detailed),%204k,%20(textured%20paper),%20pencil%20texture,%20(sketch)%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20stationary,%20holding%20pen,%20holding%20paper,%20low-quality,%20deformed,%20photo,%203D%20render,%20text,%20poorly%20drawn%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bdrawing:45%7D)%5D%5Cn%20%20%20%20%20%20%20%20%F0%9F%8C%8C%20Concept%20Art%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20%5Binput.description%5D,%20concept%20art,%20digital%20art,%20illustration,%20inspired%20by%20wlop%20style,%208k,%20fine%20details,%20sharp,%20very%20detailed,%20high%20resolution,%20masterpiece%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20worst%20quality,%20blurry%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:50,%20landscape:70%7D)%5D%5Cn%20%20%20%20%20%20%20%20%F0%9F%92%A0%20Pixel%20Art%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20(%5Binput.description%5D),%20(Pixel%20Art%20Style:1.3),%20(Vibrant%20Color%20Grading:1.3)%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20(%5Binput.negative%5D),%20%5Binapp%5D,%20low-quality,%20deformed,%20blurry,%20bad%20art%5Cn%20%20%20%20%20%20%20%20%F0%9F%91%BB%20Anime%20Art%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20%5Binput.description%5D,%20painterly%20anime%20artwork,%20masterpiece,%20fine%20details,%20breathtaking%20artwork,%20painterly%20art%20style,%20high%20quality,%208k,%20very%20detailed,%20high%20resolution,%20exquisite%20composition%20and%20lighting%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20fake,%20blurry,%20(worst%20quality,%20masterpiece,%20bad%20quality,%20low%20quality:1.1),%20glitch,%20blur,%20noise,%20text,%20watermark,%20ugly,%20bad,%20gross,%20(highly-saturated)%20(cropped-collage)%5Cn%20%20%20%20%20%20%20%20%F0%9F%92%A5%20Disney%20Sketch%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20Glen%20Keane%20character%20concept%20art%20(black%20and%20white)%20pencil%20sketch%20of%20%5Binput.description%5D.%20(rough%20pencil%20sketch%20by%20Glen%20Keane:1.2),%20rough%20pencil%20sketch,%20close%20up,%20loose%20Disney-style%20character%20concept%20art%20sketch,%20(nice%20sketchy%20pencil%20strokes),%20Disney%20character%20design%20sketch,%20pencil%20texture,%20a%20concept%20art%20pencil%20sketch%20of%20%5Binput.description%5D,%20(by%20Glen%20Keane:1.3)%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20a%20photo,%20photorealistic%20style,%20with%20color,%20(a%20bad%20photo),%20bad%20digital%20art,%20bad%203D%20render,%20gradient,%20overly%20detailed,%20high%20contrast,%20bloom,%20a%20color%20photo,%20smooth%20shading,%20hilariously%20bad%20drawings,%20bad%20anatomy,%20bad%20art,%203D,%20a%20photo,%20soft%20shadows,%20lot%20of%20color%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bdisney:90,%20cartoon:85,%20sketch:80,%20comic:80,%20drawing:80%7D)%5D%5Cn%20%20%20%20%20%20%20%20%F0%9F%94%A7%20Digital%20Painting%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20%5Binput.description%5D,%20breathtaking%20digital%20art,%20trending%20on%20artstation,%20by%20atey%20ghailan,%20by%20greg%20rutkowski,%20by%20greg%20tocchini,%20by%20james%20gilleard,%208k,%20high%20resolution,%20best%20quality%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20low-quality,%20deformed,%20signature%20watermark%20text,%20poorly%20drawn%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:90,%20landscape:70,%20digitalPainting:100,%20drawing:60%7D)%5D%5Cn%20%20%20%20%20%20%20%20%F0%9F%93%94%2090s%20Comic%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20%5Binput.description%5D,%20(90s%20comic%20book%20artwork),%20colored%20comic%20book%20panel,%20classic%2090s%20style,%20masterpiece%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20bad%20photo,%20greyscale,%20blurry,%20bad%203D%20render,%20crappy%203D%20art,%20barcode,%20logo,%20bad%20photo%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bvintage:80,%20comic:80%7D)%5D%5Cn%20%20%20%20%20%20%20%20%E2%98%A3%EF%B8%8F%20Graphic%20Character%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20(%5Binput.description%5D),%20(hyperrealism:0.8),%20natural%20skintones,%20dynamic%20lighting,%2075mm,%20Technicolor,%20Panavision,%20cinemascope,%20sharp%20focus,%20fine%20details,%208k,%20HDR,%20realism,%20realistic,%20key%20visual,%20superb%20cinematic%20color%20grading,%20(anthro:0.1)%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20Furry,%20animal%20face,%20animal%20ears,%20animal%20tail,%20pointy%20ears,%20animal%20nose,%20animal%20features,%20futa,%20futanari,%20low-quality,%20deformed,%20blurry,%20bad%20art,%20animal,%20bird,%20feathers,%20(cartoon:1),%20(comic:1),%20(painting:1),%20paint,%20fur,%20ugly,%20bad%20lighting,%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20holding%20camera,%20bad%20art,%20bad%20angle,%20boring,%20low-resolution,%20worst%20quality,%20bad%20composition,%20disfigured,%20deformed,%20wide,%20fat%5Cn%20%20%20%20%20%20%20%20%F0%9F%8C%88%20Backgrounds%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20((%5Binput.description%5D)),%20%5BrandomDescription5%5D%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20fake,%20blurry,%20worst%20quality,%20glitch,%20blur,%20noise,%20low%20quality,%20text,%20watermark,%20ugly,%20bad,%20gross%5Cn%20%20%20%20%20%20%20%20%F0%9F%94%AE%20Video%20game%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20close-up%20of%20(%5Binput.description%5D),%202D%20game%20texture%20asset%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20(%5Binput.negative%5D),%20%5Binapp%5D,%20backgrounds%5Cn%20%20%20%20%20%20%20%20%F0%9F%8E%B2%20Lego%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20(%5Binput.description%5D),%20(legos%20art%20style:1.3),%20(lego%20video%20game%20art%20style:1.3)%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20(%5Binput.negative%5D),%20%5Binapp%5D,%20low-quality,%20deformed,%20blurry,%20bad%20art%5Cn%20%20%20%20%20%20%20%20%F0%9F%98%8A%203D%20Emoji%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20masterpiece%20((%5Binput.description%5D))%20cartoon%20emoji%20concept%20render,%20(close-up:1.3),%20facing%20forward,%20(matte),%20emoji%20render%20trending%20on%20artstation,%20noto%20color%20emoji,%20app%20icon,%20joypixels,%20simple%20design,%20new%20iOS%2016.4%20(((%5Binput.description%5D)))%20emoji%20render,%20(simple%20background:1.2),%20(centered:1.2),%20masterpiece,%20telegram%20sticker,%20clash%20of%20clans%20character%20concept,%20(looking%20at%20camera),%20crisp%20render,%20sharp%20focus,%20simple%20cartoon%20design,%204k,%20sharp%20focus,%20an%20emoji%20with%20cartoon%20proportions,%20masterpiece%20emoji-style%20figurine%20render,%20transparent%20background%20png%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20framed,%20inset,%20border,%20glare,%20blurry,%20out%20of%20focus,%20shiny,%20(on%20pedestal:1.2),%20on%20platform,%20with%20base,%20gradient%20background,%20off-center,%20casting%20shadow,%20((deformed,%20disfigured)),%20glitchy,%20vector%20art,%20text,%20signature,%20bad%20anatomy,%20messed%20up,%20bad%20art,%20gradient%20background,%20complex%20background,%20blurry,%20worst%20quality,%20low%20resolution,%20messy,%20complex,%20gradient%20background,%20bad%20lighting%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bemoji:90%7D)%5D%5Cn%20%20%20%20%20%20%20%20%F0%9F%91%B0%203D%20Disney%20Character%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%203D%20cartoon%20Disney%20character%20portrait%20render.%20%5Binput.description%5D,%20bokeh,%204k,%20highly%20detailed,%20Pixar%20render,%20CGI%20Animation,%20Disney,%20cute%20big%20circular%20reflective%20eyes,%20dof,%20(cinematic%20film),%20Disney%20realism,%20subtle%20details,%20breathtaking%20Pixar%20short,%20fine%20details,%20close%20up,%20sharp%20focus,%20HDR,%20Disney-style%20octane%20render,%20incredible%20composition,%20superb%20lighting%20and%20detail,%20%5Binput.description%5D%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20worst%20quality,%20poorly%20drawn,%20bad%20art,%20boring,%20deformed,%20bad%20composition,%20crappy%20artwork,%20watermark%20,text,%20bad%20lighting%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bdisney:95,%20render:80,%20portrait:75,%20cartoon:90%7D)%5D%5Cn%20%20%20%20%20%20%20%20%F0%9F%92%82%202D%20Disney%20Character%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%202D%20cartoon%20Disney%20character%20digital%20art%20of%20%5Binput.description%5D.%20superb%20linework,%20classic%202D%20Disney%20style%20art,%20close-up,%20inspired%20by%20the%20art%20styles%20of%20Glen%20Keane%20and%20Aaron%20Blaise,%20Disney-style%20character%20concept%20with%20a%20Disney-style%20face,%20(trending%20on%20artstation),%20Disney-style%20version%20of%20%5Binput.description%5D%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20bad%203D%20render,%20bad%203D%20shadowing,%20worst%20quality,%20poorly%20drawn,%20low-resolution%20render,%20bad%20colors,%20a%20photo,%20terrible%20art,%20text,%20logo,%20bad%20composition,%20bad%20lighting,%20disfigured,%20deformed,%20bad%20anatomy,%20crappy%20educational%20infographic%20cartoon,%20bad%203D%20render,%20black%20and%20white%20photo%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bdisney:90,%20portrait:75,%20cartoon:100,%20comic:80%7D)%5D%5Cn%20%20%20%20%20%20%20%20%F0%9F%91%BB%20Cartoon%5Cn%20%20%20%20%20%20%20%20%20%20prompt%20=%20%5Binput.description%5D,%20cartoon-style%20art,%20superb%20linework,%20nice%20colors%20and%20composition,%20bold%20linework,%20close-up,%20(masterpiece),%20cute%20art%20by%20Dana%20Terrace,%20by%20Rebecca%20Sugar,%20by%20ry-spirit,%20amazing%20and%20wholesome%20cartoon-style%20art,%20cute%20art%20style,%20(trending%20on%20artstation)%5Cn%20%20%20%20%20%20%20%20%20%20negative%20=%20%5Binput.negative%5D,%20%5Binapp%5D,%20bad%20art,%20boring%20art,%20hilariously%20bad%20drawings,%20bad%203D%20render,%20bad%20photo,%20blurry,%20blur,%20worst%20quality,%20boring%20colors,%20logo%20vector%20image,%20monotone,%20lifeless,%20expressionless,%20faded,%20horror,%20creepy%5Cn%20%20%20%20%20%20%20%20%20%20meta:tags%20=%20%5B(%7Bcartoon:95%7D)%5D%5Cn%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20scratchpad%5Cn%20%20%20%20%20%20label%20=%20%F0%9F%93%9D%20Notepad%5Cn%20%20%20%20%20%20type%20=%20paragraph%5Cn%20%20%20%20%20%20remember%20=%20true%5Cn%20%20%20%20%20%20width%20=%20min(600px,%20100%25)%5Cn%20%20%20%20%20%20height%20=%2040vh%5Cn%20%20%20%20%20%20takesUpFullRow%20=%20true%5Cn%20%20%20%20%20%20foldToggleState%20=%20hidden%5Cn%20%20%20%20description%5Cn%20%20%20%20%20%20label%20=%20%F0%9F%93%9C%20Description%5Cn%20%20%20%20%20%20tip%20=%20%5Bt2i.defaultText.promptTip%5D%5Cn%20%20%20%20%20%20type%20=%20paragraph%5Cn%20%20%20%20%20%20width%20=%20min(600px,%20100%25)%5Cn%20%20%20%20%20%20height%20=%2030vh%5Cn%20%20%20%20%20%20takesUpFullRow%20=%20true%5Cn%20%20%20%20%20%20modifiers%20=%20%5Binput.artStyle?.modifiers%20%7C%7C%20null%5D%5Cn%20%20%20%20%20%20modifierUpdates%20=%20event:description.input,%20event:artStyle.change%5Cn%20%20%20%20%20%20enterKeyTriggersGeneration%20=%20true%20%5Cn%20%20%20%20%20%20examples%20=%20%5Binput.artStyle?.randomPrompt%20%7C%7C%20randomDescription%5D%5Cn%20%20%20%20%20%20random%20=%20%5Binput.artStyle?.randomPrompt%20%7C%7C%20randomDescription%5D%20%5Cn%20%20%20%20negative%5Cn%20%20%20%20%20%20label%20=%20%F0%9F%9A%AB%20Negative%5Cn%20%20%20%20%20%20tip%20=%20%5Bt2i.defaultText.negativePromptTip%5D%3Cfont%20size=1%20face=roboto%3E%5Cn%20%20%20%20%20%20type%20=%20paragraph%5Cn%20%20%20%20%20%20width%20=%20min(600px,%20100%25)%5Cn%20%20%20%20%20%20height%20=%2030vh%5Cn%20%20%20%20%20%20takesUpFullRow%20=%20true%5Cn%20%20%20%20%20%20modifiers%20=%20%5Binput.artStyle?.modifiers%20%7C%7C%20null%5D%20%5Cn%20%20%20%20%20%20modifierUpdates%20=%20event:description.input,%20event:artStyle.change%5Cn%20%20%20%20%20%20examples%20=%20%5Binput.artStyle?.randomPrompt%20%7C%7C%20randomDescription2%5D%20%5Cn%20%20%20%20%20%20random%20=%20%5Binput.artStyle?.randomPrompt%20%7C%7C%20randomDescription2%5D%20%5Cn%20%20%20%20%20%20%5CnrandomDescription%5Cn%20%20%5BrandomDescription5%5D%5Cn%20%20art%20by%20atey%20ghailan,%20painterly%20anime%20style%20at%20pixiv,%20art%20by%20kantoku,%20in%20art%20style%20of%20redjuice/nec%C3%B6mi/rella/tiv%20pixiv%20collab,%20anime%20art%20style,%20masterpiece%20digital%20painting,%20exquisite%20lighting%20and%20composition,%20inspired%20by%20wlop%20art%20style,%208k,%20sharp,%20very%20detailed,%20high%20resolution,%20illustration%5Cn%20%20casual%20photo%5Cn%20%20cinematic%20shot,%20dynamic%20lighting,%2075mm,%20Technicolor,%20Panavision,%20cinemascope,%20sharp%20focus,%20fine%20details,%208k,%20HDR,%20realism,%20realistic,%20key%20visual,%20film%20still,%20cinematic%20color%20grading,%20depth%20of%20field%5Cn%20%20breathtaking%20digital%20art,%20trending%20on%20artstation,%20by%20atey%20ghailan,%20by%20greg%20rutkowski,%20by%20greg%20tocchini,%20by%20james%20gilleard,%208k,%20high%20resolution,%20best%20quality%5Cn%20%203D%20cartoon%20Disney%20character%20portrait%20render%20of%20%5BrandomDescription6%5D%20bokeh,%204k,%20highly%20detailed,%20Pixar%20render,%20CGI%20Animation,%20Disney,%20cute%20big%20circular%20reflective%20eyes,%20dof,%20(cinematic%20film),%20Disney%20realism,%20subtle%20details,%20breathtaking%20Pixar%20short,%20fine%20details,%20close%20up,%20sharp%20focus,%20HDR,%20Disney-style%20octane%20render,%20incredible%20composition,%20superb%20lighting%20and%20detail%20%5Cn%20%203D%20cartoon%20Disney%20character%20portrait%20render%20of%20%5BrandomDescription3%5D%20bokeh,%204k,%20highly%20detailed,%20Pixar%20render,%20CGI%20Animation,%20Disney,%20cute%20big%20circular%20reflective%20eyes,%20dof,%20(cinematic%20film),%20Disney%20realism,%20subtle%20details,%20breathtaking%20Pixar%20short,%20fine%20details,%20close%20up,%20sharp%20focus,%20HDR,%20Disney-style%20octane%20render,%20incredible%20composition,%20superb%20lighting%20and%20detail%20%5Cn%20%202D%20cartoon%20Disney%20character%20digital%20art%20of%20%5BrandomDescription4%5D%20superb%20linework,%20classic%202D%20Disney%20style%20art,%20close-up,%20inspired%20by%20the%20art%20styles%20of%20Glen%20Keane%20and%20Aaron%20Blaise,%20Disney-style%20character%20concept%20with%20a%20Disney-style%20face,%20(trending%20on%20artstation)%5Cn%20%202D%20cartoon%20Disney%20character%20digital%20art%20of%20%5BrandomDescription6%5D%20superb%20linework,%20classic%202D%20Disney%20style%20art,%20close-up,%20inspired%20by%20the%20art%20styles%20of%20Glen%20Keane%20and%20Aaron%20Blaise,%20Disney-style%20character%20concept%20with%20a%20Disney-style%20face,%20(trending%20on%20artstation)%5Cn%20%20Glen%20Keane%20character%20concept%20art%20(black%20and%20white)%20pencil%20sketch%20of%20%5BrandomDescription3%5D.%20(rough%20pencil%20sketch%20by%20Glen%20Keane:1.2),%20rough%20pencil%20sketch,%20close%20up,%20loose%20Disney-style%20character%20concept%20art%20sketch,%20(nice%20sketchy%20pencil%20strokes),%20Disney%20character%20design%20sketch,%20pencil%20texture,%20a%20concept%20art%20pencil%20sketch%20of%20%5BrandomDescription3%5D,%20(by%20Glen%20Keane:1.3)%5Cn%20%20black%20and%20white%20technical%20drawing%20showcasing%20a%20%5BrandomDescription5%5D,%20annotation%20details,%20masterpiece%20black%20and%20white,%20pencil%20strokes,%20annotated%20technical%20concept%20art%20sketch,%20pencil%20texture%5Cn%20%20painterly%20digital%20painting,%20digital%20painting%20by%20Ilya%20Kuvshinov%20with%20painterly%20brush%20strokes,%20by%20Ilya%20Kuvshinov,%20painterly%20masterpiece%5Cn%20%20breathtaking%20alla%20prima%20oil%20painting,%20close%20up,%20(alla%20prima%20style:1.3),%20oil%20on%20linen,%20painterly%20oil%20on%20canvas,%20(painterly%20style:1.3),%20exquisite%20composition%20and%20lighting,%20modern%20painterly%20masterpiece,%20by%20alexi%20zaitsev,%20award-winning%20painterly%20alla%20prima%20oil%20painting%5Cn%20%20breathtaking%20oil%20painting,%20photorealistic%20oil%20painting,%20by%20charlie%20bowater,%20fine%20details,%20by%20wlop,%20trending%20on%20artstation,%20very%20detailed%5Cn%20%20(Oil%20painting)%20(by%20Jean-Fran%C3%A7ois%20Millet),%20(by%20Gustave%20Courbet),%20(by%20Jules%20Breton),%20close%20up%5Cn%20%20soft%20focus,%20depth%20of%20field,%208k%20photo,%20HDR,%20professional%20lighting,%20taken%20with%20Canon%20EOS%20R5,%2075mm%20lens%5Cn%20%20(anime%20art%20of%20%5BrandomDescription4%5D:1.2),%20masterpiece,%204k,%20best%20quality,%20anime%20art%5Cn%20%20digital%20art%20drawing,%20illustration%20of%20(%5BrandomDescription3%5D),%20anime%20drawing/art,%20bold%20linework,%20illustration,%20cel%20shaded,%20painterly%20style,%20digital%20art,%20masterpiece%5Cn%20%20(((adorable,%20cute,%20kawaii)),%20cute%20moe%20anime%20character%20portrait,%20adorable,%20featured%20on%20pixiv,%20kawaii%20mo%C3%A9%20masterpiece,%20cuteness%20overload,%20very%20detailed,%20sooooo%20adorable!!!,%20absolute%20masterpiece%5Cn%20%20anime%20masterpiece,%20soft%20lighting,%20intricate,%20highly%20detailed,%20pixiv,%20anime%20art,%204k,%20art%20from%20your%20name%20anime,%20garden%20of%20words%20style%20art,%20high%20quality%5Cn%20%20D&D,%20Dungeons%20and%20Dragons,%20fantasy,%20highly%20detailed,%20digital%20painting,%20artstation,%20sharp%20focus,%20fantasy%20art,%20illustration,%208k,%20in%20the%20style%20of%20greg%20rutkowski%5Cn%20%20fantasy%20matte%20painting,%20absolute%20masterpiece,%20detailed%20matte%20painting%20by%20andreas%20rocha%20and%20greg%20rutkowski,%20by%20Brothers%20Hildebrandt,%20superb%20composition,%20vivid%20fantasy%20art,%20breathtaking%20fantasy%20masterpiece%5Cn%20%20d&d,%20fantasy,%20highly%20detailed,%20digital%20painting,%20artstation,%20sharp%20focus,%20fantasy%20art,%20character%20art,%20illustration,%208k,%20art%20by%20artgerm%20and%20greg%20rutkowski%5Cn%20%20(studio%20ghibli%20style%20art:1.3),%20sharp,%20very%20detailed,%20high%20resolution,%20inspired%20by%20hayao%20miyazaki,%20anime,%20art%20from%20ghibli%20movie%5Cn%20%2050s%20enamel%20sign%20of%20%5BrandomDescription3%5D,%2050's%20advert%20enamel%20sign,%20masterpiece,%20authentic%20vintage%20enamel%20sign%5Cn%20%20comic%20book%20style%20art,%20(drawing,%20by%20Dave%20Stevens,%20by%20Adam%20Hughes,%201940's,%201950's:1.2),%20hand-drawn,%20color,%20high%20resolution,%20best%20quality,%20closeup%5Cn%20%20franco-belgian%20color%20comic%20about%20%5BrandomDescription4%5D,%20bande%20dessin%C3%A9e,%20franco-belgian%20comic%20panel,%20masterpiece,%20breathtaking%20composition,%20intricate,%20detailed,%20best%20quality,%20close-up%5Cn%20%20color%20comic%20panel%20in%20the%20style%20of%20Herg%C3%A9%20about,%20by%20Herg%C3%A9,%20tintin%20style,%20french%20comic%20panel,%20franco-belgian%20style,%20close-up,%20masterpiece,%20high-resolution%20Herg%C3%A9%20style%5Cn%20%20medieval%20illuminated%20manuscript%20picture%20of%20%5BrandomDescription3%5D,%20medieval%20illuminated%20manuscript%20art,%20masterpiece%20medieval%20color%20illustration,%2016th%20century,%208k%20high-resolution%20scan%20of%2016th%20century%20illuminated%20manuscript%20painting,%20detailed%20medieval%20masterpiece,%20close-up%5Cn%20%20best%20pixel%20art,%20neo-geo%20graphical%20style,%20retro%20nostalgic%20masterpiece,%20128px,%2016-bit%20pixel%20art%20of%20,%202D%20pixel%20art%20style,%20adventure%20game%20pixel%20art,%20inspired%20by%20the%20art%20style%20of%20hyper%20light%20drifter,%20masterful%20dithering,%20superb%20composition,%20beautiful%20palette,%20exquisite%20pixel%20detail%5Cn%20%20figurine,%20modern%20Disney%20style,%20octane%20render,%20chibi%5Cn%20%20masterpiece,%20cartoon%20emoji%20concept%20render,%20(close-up:1.3),%20facing%20forward,%20(matte),%20emoji%20render%20trending%20on%20artstation,%20noto%20color%20emoji,%20app%20icon,%20joypixels,%20simple%20design,%20new%20iOS%2016.4%20emoji%20render,%20(simple%20background:1.2),%20(centered:1.2),%20masterpiece,%20telegram%20sticker,%20clash%20of%20clans%20character%20concept,%20(looking%20at%20camera),%20crisp%20render,%20sharp%20focus,%20simple%20cartoon%20design,%204k,%20sharp%20focus,%20an%20emoji%20with%20cartoon%20proportions,%20masterpiece%20emoji-style%20figurine%20render,%20transparent%20background%20png%5Cn%20%20breathtaking%20illustration%20of%20%5BrandomDescription4%5D,%20(illustration:1.3),%20masterpiece,%20breathtaking%20illustration%5Cn%20%20illustration,%20flat,%202D,%20vector%20art,%20masterpiece,%20made%20with%20adobe%20illustrator,%20behance%20competition%20winner,%20trending%20on%20dribble,%204k,%20high%20resolution,%20crisp%20lines%5Cn%20%20(watercolor),%20high%20resolution,%20intricate%20details,%204k,%20wallpaper,%20concept%20art,%20watercolor%20on%20textured%20paper%5Cn%20%2090s%20home%20video,%20nostalgic%2090's%20photo,%20taken%20with%20kodak%20disposable%20camera%5Cn%20%20famous%20vintage%2080's%20photo,%20grainy%20photograph,%2080s%20photo%20with%20film%20grain,%20Kodacolor%20II%2080s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%2080s%20photo%20with%20wear%20and%20tear%20and%20minor%20creasing%20and%20scratches,%20vintage%20color%20photo%5Cn%20%20famous%20vintage%2070's%20photo,%20grainy%20photograph,%201970s%20photo%20with%20film%20grain,%2070s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%201970's%20photo,%20vintage%20photo%5Cn%20%20famous%20vintage%2060's%20photo,%20grainy%20photograph,%201960s%20photo%20with%20film%20grain,%2060s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%201960's%20photo,%20vintage%20photo%5Cn%20%20famous%20vintage%2050's%20photo,%20grainy%20photograph,%201950s%20photo%20with%20film%20grain,%201950s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%201950's%20photo,%20vintage%20photo%5Cn%20%20famous%20vintage%2040's%20photo,%20grainy%20photograph,%201940s%20photo%20with%20film%20grain,%201940s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%201940's%20photo,%20vintage%20photo%5Cn%20%20famous%20vintage%2030's%20photo,%20grainy%20photograph,%201930s%20photo%20with%20film%20grain,%201930s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%201930's%20photo,%20vintage%20photo%5Cn%20%20famous%20vintage%201920's%20photo,%201920's%20photo,%20restored%20photograph,%20sepia,%20historical%20archive%20photo%5Cn%20%20(((1970s%20vintage%20pulp%20art))),%20vintage%20pulp%20art,%20by%20Earle%20K.%20Bergey,%20by%20Kelly%20Freas,%20by%20Alex%20Schomburg,%20by%20H.%20J.%20Ward,%20glossy%20pulp%20art,%20Amazing%20Stories,%20Weird%20Tales,%208k,%20high%20resolution,%20best%20quality%5Cn%20%201950's%20infomercial%20style,%20(delicate%20linework:1.1),%20paprika%20anime%20art%20style,%20close-up,%20(chromatic%20aberration%20glow:1.2),%202d%20painted%20cel%20animation,%20close-up,%20soft%20focus,%202D%20pixiv%201950's%5Cn%20%20a%20Pok%C3%A9mon%20creature,%204k%20render,%20beautiful%20pokemon%20digital%20art,%20fakemon,%20pokemon%20creature,%20cryptid,%20fakemon,%20masterpiece,%20sharp%20focus,%20(best%20quality,%20high%20quality:1.3)%5Cn%20%204k%20digital%20painting%20of%20a%20Pok%C3%A9mon,%20amazing%20pokemon%20art%20by%20piperdraws,%20cryptid%20creations%20by%20Piper%20Thibodeau,%20by%20Naoki%20Saito%20and%20Tokiya,%20incredible%20composition%5Cn%20%20Pok%C3%A9mon%20creature%20concept,%20superb%20line%20art,%20beautiful%20pokemon%20digital%20art,%20fakemon,%20by%20Sowsow,%20pokemon%20creature,%20cryptid,%20fakemon,%20masterpiece,%20by%20Yuu%20Nishida,%204k%5Cn%20%20vintage%20anime,%2090's%20anime%20style,%20by%20hajime%20sorayama,%20by%20greg%20tocchini,%20anime%20masterpiece,%20pixiv,%20akira-style%20art,%20akira%20anime%20art,%204k,%20high%20quality%5Cn%20%20((neon%20vintage%20anime))%20style,%2090's%20anime%20style,%20hajime%20sorayama,%20greg%20tocchini,%20neon%20vintage%20anime%20masterpiece,%20anime%20art,%204k,%20high%20quality%5Cn%20%20incredible%20hand-drawn%20manga,%20black%20and%20white,%20by%20Takehiko%20Inoue,%20by%20Katsuhiro%20Otomo%20and%20akira%20toriyama%20manga,%20hand-drawn%20art%20by%20rumiko%20takahashi%20and%20Inio%20Asano,%20Ken%20Akamatsu%20manga%20art%5Cn%20%20beautiful%20fantasy%20map%20of%20of%20%5BrandomDescription5%5D,%20beautiful%20fantasy%20map%20inspired%20by%20middle%20earth%20and%20azeroth%20and%20discworld%20and%20westeros%20and%20essos%20and%20the%20witcher%20world%20and%20tamriel%20and%20faer%C3%BBn%20and%20thedas,%204k,%20beautiful%20colors,%20crisp,%20high-resolution%20artistic%20map,%20topographic%203D%20terrain,%20artistic%20map%5Cn%20%20an%20aerial%20view%20of%20a%20city,%20%5BrandomDescription5%5D,%20TTRPG%20city%20map%20showing%20the%20full%20city,%20fantasy%20art,%20by%20senior%20environment%20artist,%20beautiful%20fantasy%20map%5Cn%20%20fantasy%20world%20map%20of%20%5BrandomDescription5%5D,%20fantasy%20world%20map,%20highly%20detailed%20digital%20painting,%20fantasy%20art,%20map%20illustration,%208k%5Cn%20%203D%20isometric%20render%20of%20cute%203D%20app%20icon,%20clean%20isometric%20design,%20beautiful%20design,%20soft%20gradient%20background,%20soft%20colors,%20centered,%203D%20blender%20render,%20masterpiece,%20best%20quality,%20high%20resolution,%208k%20octane%20render,%20beautiful%20color%20scheme,%20soft%20smooth%20lighting,%20physically%20based%20rendering,%20square%20image,%20high%20polycount%5Cn%20%20creative%20icon,%20flat%20style%20icon,%20masterpiece,%20high%20resolution,%20crisp,%20beautiful%20composition%20and%20color%20choice,%20beautiful%20flat%20painted%20style,%20behance%20contest-winner,%20award%20winning%20icon%20illustration,%208k,%20best%20quality%5Cn%20%20beautiful%20flat-style%20logo%20design%20depicting,%20creative%20flat-style%20logo%20design,%20trending%20on%20dribbble,%20featured%20on%20behance,%20portfolio%20piece,%20minimal%20flat%20design,%20breathtaking%20graphic%20design,%208k,%20high%20resolution%20vector%20logo,%20plain%20background,%20amazingly%20beautiful%20logo%20design,%20winner%20of%20best%20logo%20award%5Cn%20%20a%20concept%20art%20icon%20for%20league%20of%20legends,%20a%20digital%20art%20logo,%20illustration,%20league%20of%20legends%20style%20icon,%20inspired%20by%20wlop%20style,%208k,%20DOTA%202%20style%20icon,%20fine%20details,%20sharp,%20very%20detailed%20icon,%20high%20resolution%20rpg%20ability/spell/item%20icon%5Cn%20%20app%20logo%20icon,%20digital%20art%20pictogram%20icon,%20trending%20on%20artstation,%20app%20icon%20by%20atey%20ghailan,%20app%20icon%20by%20greg%20rutkowski,%20app%20icon%20by%20greg%20tocchini,%20app%20icon%20by%20james%20gilleard,%208k,%20high%20resolution,%20best%20quality%5Cn%20%20a%20concept%20art%20icon,%20a%20digital%20art%20logo,%20illustration,%20league%20of%20legends%20style%20concept%20art%20logo%20icon,%20inspired%20by%20wlop%20style,%208k,%20fine%20details,%20sharp,%20very%20detailed,%20high%20resolution%20logo%20icon%5Cn%20%20a%20cute%203D%20icon,%20cartoon%203D%20icon,%20very%20cute%20shape,%20stylized%20octane%20render,%208k,%20masterpiece,%20soooo%20cute,%20beautiful%20cute%20perfection,%20beautiful%20soft%20lighting,%20soft%20colors,%20centered,%20high%20resolution,%20soft%20gradient%20background%5Cn%20%20a%20set%20of%20lovely%20little%203D%20icons,%20cute%203D%20icons,%20very%20cute%20shapes,%20stylized%20octane%20render,%208k,%20masterpiece,%20soooo%20cute,%20beautiful%20cute%20perfection,%20beautiful%20soft%20lighting,%20soft%20colors,%20centered,%20high%20resolution,%20cute%20icon%20set%5Cn%20%20((black%20and%20white%20pencil%20drawing)),%20black%20and%20white,%20breathtaking%20pencil%20illustration,%20highly%20detailed,%204k,%20(textured%20paper),%20pencil%20texture,%20sketch%5Cn%20%20amazing%20tattoo%20design,%20breathtaking%20tattoo%20design,%20incredible%20tattoo%20design%5Cn%20%20waifu%20character%20portrait,%20art%20by%20Kazenoko,%20featured%20on%20pixiv,%201%20girl,%20by%20Ilya%20Kuvshinov,%20Kantoku%20art,%20very%20detailed%20anime%20art%20by%20Redjuice%5Cn%20%20yugioh%20card%20art,%20art%20by%20genzoman,%20by%20Akina%20Fujiwara,%20by%20rossdraws,%20yugioh%20monster,%20close%20up,%20painterly%20details,%20breathtaking%20art,%20centered,%20masterpiece,%20amazing%20composition%5Cn%20%20Pok%C3%A9mon%20card%20art,%20Pok%C3%A9mon%20monster,%20close%20up,%20painterly%20details,%20breathtaking%20art,%20centered,%20masterpiece,%20amazing%20composition%5Cn%20%20In%20ukiyo-e%20art%20style,%20traditional%20japanese%20masterpiece%5Cn%20%20japanese%20nihonga%20painting%20about,%20Nihonga,%20ancient%20japanese%20painting,%20intricate,%20detailed%5Cn%20%20claymation,%20incredible%20claymation%20style,%20kubo%20and%20the%20two%20strings%20style%20art,%20Missing%20Link%202019%20art%20style,%20clay%20texture,%20clay%20animation,%20stop-motion%20clay%5Cn%20%20anthro%20digital%20art,%20masterpiece,%204k,%20fine%20details%5Cn%20%20anthro%20illustration,%20hand-drawn,%20bold%20linework,%20anthro%20illustration,%20cel%20shaded,%204k,%20fine%20details,%20masterpiece%5Cn%20%20cinematic%20shot,%20dynamic%20lighting,%2075mm,%20Technicolor,%20Panavision,%20cinemascope,%20sharp%20focus,%20fine%20details,%208k,%20HDR,%20realism,%20realistic,%20key%20visual,%20film%20still,%20cinematic%20color%20grading,%20depth%20of%20field,%20(anthro:0.1)%5Cn%20%20cartoon-style%20art,%20superb%20linework,%20nice%20colors%20and%20composition,%20bold%20linework,%20close-up,%20(masterpiece),%20cute%20art%20by%20Dana%20Terrace,%20by%20Rebecca%20Sugar,%20by%20ry-spirit,%20amazing%20and%20wholesome%20cartoon-style%20art,%20cute%20art%20style,%20(trending%20on%20artstation)%5CnrandomDescription2%5Cn%20%20bad%20art,%20boring%20art,%20hilariously%20bad%20drawings,%20bad%203D%20render,%20bad%20photo,%20blurry,%20blur,%20worst%20quality,%20boring%20colors,%20logo%20vector%20image,%20monotone,%20lifeless,%20expressionless,%20faded,%20horror,%20creepy%5Cn%20%20bad%20lighting,%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20holding%20camera,%20bad%20art,%20bad%20angle,%20boring,%20low-resolution,%20worst%20quality,%20bad%20composition,%20disfigured%5Cn%20%20bad%20photo,%20terrible%203D%20render,%20bad%20anatomy,%20worst%20quality,%20greyscale,%20black%20and%20white,%20disfigured,%20deformed,%20glitch,%20cross-eyed,%20lazy%20eye,%20ugly,%20deformed,%20distorted,%20glitched,%20lifeless,%20low%20quality,%20bad%20proportions%5Cn%20%20bad%20photo,%20worst%20quality,%20bad%20composition,%20bad%20lighting,%20bad%20colors,%20small%20eyes,%20low%20quality,%20bad%20art,%20poorly%20drawn,%20deformed,%20bad%203D%20render,%20boring,%20lifeless,%20deformed,%20ugly,%20low%20resolution%5Cn%20%20glossy,%20creepy,%20dead%20eyes,%20lifeless%20eyes,%20blurry,%20scary,%20boring,%20tiling,%20cropped,%20terrifying,%20horror,%20out%20of%20focus%5Cn%20%20framed%20blurry%20crappy%20photo,%20overly%20faded%5Cn%20%20blurry,%20low%20resolution,%20worst%20quality,%20fuzzy%5Cn%20%20Yugi%20Mutou,%20low-quality,%20blurry,%20crappy%203D%20render,%20worst%20quality,%20messy,%20noisy,%20framed,%20with%20border,%20cropped,%20confusing,%20stacked%20characters%20poster,%20low%20resolution,%20bad%203D%20render,%20fuzzy%5Cn%20%20(worst%20quality,%20low%20quality:1.3),%20bad%20photo,%20bad%20art,%20boring,%20bad%203D%20render,%20worst%20quality,%20ugly,%20blurry,%20low%20quality,%20poorly%20drawn,%20bad%20composition,%20deformed,%20bad%203D%20render,%20disfigured,%20bad%20anatomy,%20compression%20artifacts,%20dead,%20soulless,%20photorealistic%5Cn%20%20low-quality,%20poorly%20drawn,%20blurry,%20faded,%20terrible%20design,%20worst%20quality,%20deformed,%20amputee,%20disfigured,%20ugly,%20bad,%20shitty,%20boring%5Cn%20%20stationary,%20holding%20pen,%20holding%20paper,%20low-quality,%20deformed,%20photo,%203D%20render,%20text,%20poorly%20drawn%5Cn%20%20low%20quality,%20text,%20ugly,%20gross%5Cn%20%20photo,%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20multiple%5Cn%20%20photo,%20hilariously%20bad%20design,%20bad%20composition,%20bad%20colors,%20blurry,%20worst%20quality,%20low%20quality,%20shadow,%20boring,%20bad%20design,%20worst%20design%20ever,%20hilariously%20bad%20design,%20drop-shadow,%20gradient,%20messy,%20chaotic%5Cn%20%20gradient,%20bad%20design,%20blurry,%20jpeg%20compression%20artefacts,%20grainy,%20gradient,%20text,%20messy%20and%20inconsistent%5Cn%20%20low%20quality,%20terrible%20design,%20glitchy%20compression%20artefacts,%20deformed,%20blurry%20compression%20artefacts,%20text%5Cn%20%20low%20quality,%20blurry,%20worst%20quality,%20childrens%20drawing,%20boring,%20logo,%20scratchy%20and%20grainy,%20messy,%20washed%20out%20colors,%20sepia,%20hazy%5Cn%20%20(worst%20quality,%20low%20quality:1.3),%20bad%20photo,%20bad%203D%20render,%20distorted,%20deformed,%20fuzzy,%20noisy,%20blurry,%20smudge%5Cn%20%20blurry,%20(worst%20quality,%20low%20quality:1.3),%20bad%20art,%20distorted,%20deformed%5Cn%20%20(worst%20quality,%20low%20quality:1.3),%20bad%20art,%20distorted,%20deformed%5Cn%20%20distorted,%20deformed,%20bad%20art,%20low%20quality,%20crappy%203D%20render,%20text%20watermark%20symbols%20logo%5Cn%20%20crappy%203D%20render,%20distorted,%20deformed,%20bad%20art,%20low%20quality,%20text,%20signature%5Cn%20%20distorted,%20deformed,%20bad%20art,%20low%20quality,%20over%20saturated,%20extreme%20contrast,%20(worst%20quality,%20low%20quality:1.3)%5Cn%20%20(worst%20quality,%20low%20quality,%20blurry:1.3),%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20bad%20photo,%20bad%20lighting,%20high%20production%20value,%20unnatural%20studio%20lighting,%20commercial%20photoshoot,%20photoshopped,%20terrible%20photo,%20disfigured%5Cn%20%20bad%20lighting,%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20holding%20camera,%20bad%20art,%20bad%20angle,%20boring,%20low-resolution,%20worst%20quality,%20bad%20composition,%20disfigured%5Cn%20%20low-quality,%20deformed,%20signature%20watermark%20text,%20poorly%20drawn%5Cn%20%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20worst%20quality,%20blurry%5Cn%20%20worst%20quality,%20poorly%20drawn,%20bad%20art,%20boring,%20deformed,%20bad%20composition,%20crappy%20artwork,%20bad%20lighting%5Cn%20%20bad%203D%20render,%20bad%203D%20shadowing,%20worst%20quality,%20poorly%20drawn,%20low-resolution%20render,%20bad%20colors,%20a%20photo,%20terrible%20art,%20text,%20logo,%20bad%20composition,%20bad%20lighting,%20disfigured,%20deformed,%20bad%20anatomy,%20crappy%20educational%20infographic%20cartoon,%20bad%203D%20render,%20black%20and%20white%20photo%5Cn%20%20a%20photo,%20photorealistic%20style,%20with%20color,%20(a%20bad%20photo),%20bad%20digital%20art,%20bad%203D%20render,%20gradient,%20overly%20detailed,%20high%20contrast,%20bloom,%20a%20color%20photo,%20smooth%20shading,%20hilariously%20bad%20drawings,%20bad%20anatomy,%20bad%20art,%203D,%20a%20photo,%20soft%20shadows,%20lot%20of%20color%5Cn%20%20brush,%20bad%203D%20render,%20(holding%20paintbrush),%20easel,%20bad%20photo,%20bad%20art,%20boring,%20bad%203D%20render%5Cn%20%20framed,%20faded%20colors,%20terrible%20photo,%20bad%20composition,%20hilariously%20bad%20drawing,%20bad%20photo,%20bad%20anatomy,%20extremely%20high%20contrast,%20worst%20quality,%20watermarked%20signature,%20bad%20colors,%20deformed,%20amputee,%20washed%20out,%20glare,%20boring%20colors,%20bad%20crayon%20drawing%5Cn%20%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20worst%20quality%5Cn%20%20(badly%20drawn%20hands),%20extra%20limbs,%20extra%20fingers,%20bad%20anatomy%5Cn%20%20worst%20quality,%20bad%20lighting,%20cropped,%20blurry,%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20bad%20art,%20bad%20angle,%20boring,%20low-resolution,%20worst%20quality,%20bad%20composition,%20terrible%20lighting,%20bad%20anatomy%5Cn%20%20(worst%20quality,%20low%20quality:1.3),%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20hilariously%20bad%20drawing,%20bad%203D%20render%5Cn%20%20boring%20flat%20infographic,%20oversaturated,%20bad%20photo,%20terrible%203D%20render,%20bad%20anatomy,%20worst%20quality,%20greyscale,%20black%20and%20white,%20disfigured,%20deformed,%20glitch,%20cross-eyed,%20lazy%20eye,%20ugly,%20deformed,%20distorted,%20glitched,%20lifeless,%20low%20quality,%20bad%20proportions%5Cn%20%20(worst%20quality,%20low%20quality:1.3),%20worst%20quality,%20ugly,%203D,%20photograph,%20bad%20art,%20blurry,%20boring%5Cn%20%20(worst%20quality,%20low%20quality:1.3),%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20faded,%20blurry,%20bad%20art,%20boring%5Cn%20%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20(worst%20quality,%20low%20quality:1.3),%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20terrible%20photoshop,%20low%20contrast,%20disfigured,%20poorly%20drawn,%20deformed,%20tiled,%20cropped,%20framed%5Cn%20%20framed%20blurry%20crappy%20photo,%20overexposed,%20worst%20quality,%20border,%20deformed%20horror,%20overly%20faded%5Cn%20%20blurry,%20framed%20edge%20border,%20text,%20overexposed,%20bad%20anatomy,%20deformed,%20disfigured,%20blur,%20horror,%20dead%20eyes,%20boring,%20faded,%20(worst%20quality,%20low%20quality:1.2)%5Cn%20%20worst%20quality,%20blurry%5Cn%20%20glitched,%20deep%20fried,%20jpeg%20artifacts,%20out%20of%20focus,%20gradient,%20soft%20focus,%20low%20quality,%20poorly%20drawn,%20blur,%20grainy%20fabric%20texture,%20text,%20bad%20art,%20boring%20colors,%20blurry%20platformer%20screenshot%5Cn%20%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20framed,%20inset,%20border,%20glare,%20blurry,%20out%20of%20focus,%20shiny,%20(on%20pedestal:1.2),%20on%20platform,%20with%20base,%20gradient%20background,%20off-center,%20casting%20shadow,%20((deformed,%20disfigured)),%20glitchy,%20vector%20art,%20text,%20signature,%20bad%20anatomy,%20messed%20up,%20bad%20art,%20gradient%20background,%20complex%20background,%20blurry,%20worst%20quality,%20low%20resolution,%20messy,%20complex,%20gradient%20background,%20bad%20lighting%5Cn%20%20low-quality,%20deformed,%20text,%20poorly%20drawn,%20bad%203D%20render,%20bad%20composition,%20bad%20photo,%20worst%20quality%5Cn%20%20bad%20art,%20children's%20crayon%20drawing,%20worst%20quality,%20blurry,%20blur,%20jpeg%20artifacts,%20compression%20artifacts,%20text,%20worst%20quality,%20noise,%20messy,%20low%20resolution%5Cn%20%20low-quality,%20deformed,%20text,%20poorly%20drawn%5Cn%20%20blurry,%20blur,%20deformed%5Cn%20%20text,%20cropped,%20bad%20art,%20deformed,%20worst%20quality,%20watermark%5Cn%20%20worst%20quality,%20low%20quality,%20neon%20tube,%20bad%20art,%20messy,%20disfigured,%20bad%20anatomy,%20out%20of%20focus,%20grainy,%20blurry,%20jpeg%20artifact%20noise,%20deformed%5CnrandomDescription3%5Cn%20%20Amelia%20Earhart%20(historical%20figure)%5Cn%20%20Marie%20Curie%20(historical%20figure)%5Cn%20%20Meryl%20Streep%20is%20a%20%7Bversatile%7Caward-winning%7Clegendary%7D%20actress%5Cn%20%20Scarlett%20Johansson%20from%20the%20movie%20%7BLost%20in%20Translation%7CAvengers:%20Endgame%7CMarriage%20Story%7D%5Cn%20%20Angelina%20Jolie%20is%20an%20actress%20and%20humanitarian%5Cn%20%20Jennifer%20Aniston%20from%20the%20TV%20series%20Friends%20and%20movie%20%7BMarley%20&%20Me%7CThe%20Break-Up%7CHorrible%20Bosses%7D%5Cn%20%20Charlize%20Theron%20from%20the%20movie%20%7BMonster%7CMad%20Max:%20Fury%20Road%7CAtomic%20Blonde%7D%5Cn%20%20Julia%20Roberts%20from%20the%20movie%20%7BPretty%20Woman%7CErin%20Brockovich%7COcean's%20Eleven%7D%5Cn%20%20Gal%20Gadot%20as%20Wonder%20Woman%20in%20%7BWonder%20Woman%7CJustice%20League%7CWonder%20Woman%201984%7D%5Cn%20%20Emma%20Watson%20as%20Hermione%20Granger%20in%20%7BHarry%20Potter%20and%20the%20Philosopher's%20Stone%7CHarry%20Potter%20and%20the%20Chamber%20of%20Secrets%7CHarry%20Potter%20and%20the%20Deathly%20Hallows%7D%5Cn%20%20Cate%20Blanchett%20from%20the%20movie%20%7BElizabeth%7CBlue%20Jasmine%7CCarol%7D%5Cn%20%20Sandra%20Bullock%20from%20the%20movie%20%7BThe%20Blind%20Side%7CGravity%7CSpeed%7D%5Cn%20%20Oprah%20Winfrey%20is%20a%20%7Bmedia%20mogul%7Cphilanthropist%7Ctalk%20show%20host%7D%5Cn%20%20Beyonc%C3%A9%20is%20a%20%7Bsinger%7Cactress%7Centrepreneur%7D%20known%20for%20her%20%7Bmusic%7Cfilms%7Cbusiness%20ventures%7D%5Cn%20%20Taylor%20Swift%20is%20a%20%7Bsinger-songwriter%7Crecord-breaking%20artist%7Cmusician%7D%5Cn%20%20Adele%20is%20a%20%7BGrammy-winning%7Csoulful%7Cpowerhouse%7D%20singer%5Cn%20%20Rihanna%20is%20a%20%7Bchart-topping%7Cfashion-forward%7Cversatile%7D%20musician%5Cn%20%20Lady%20Gaga%20from%20the%20movie%20%7BA%20Star%20Is%20Born%7CMachete%20Kills%7CHouse%20of%20Gucci%7D%5Cn%20%20Jennifer%20Lopez%20is%20a%20singer,%20actress,%20and%20%7Bentrepreneur%7Cicon%7Cdance%7D%20sensation%5Cn%20%20Katy%20Perry%20is%20a%20%7Bpop%20sensation%7Csongstress%7Cstyle%20icon%7D%5Cn%20%20Shakira%20is%20a%20%7Bglobal%7Ccrossover%7CLatin%7D%20music%20sensation%5Cn%20%20Madonna%20is%20the%20%7BQueen%20of%20Pop%7Ciconic%7Clegendary%7D%20in%20the%20music%20industry%5Cn%20%20Michelle%20Obama%20is%20a%20former%20First%20Lady%20and%20%7Badvocate%7Cauthor%7Cinspiration%7D%5Cn%20%20Hillary%20Clinton%20is%20a%20%7Bpolitician%7Cadvocate%7Cformer%20Secretary%20of%20State%7D%5Cn%20%20Queen%20Elizabeth%20II%20is%20the%20%7Blongest-reigning%7Cmonarch%7Csymbol%7D%20of%20the%20United%20Kingdom%5Cn%20%20Angela%20Merkel%20is%20a%20former%20Chancellor%20of%20Germany%5Cn%20%20Jacinda%20Ardern%20is%20the%20Prime%20Minister%20of%20New%20Zealand,%20known%20for%20her%20%7Bprogressive%7Cinclusive%7Cleadership%7D%5Cn%20%20Kamala%20Harris%20is%20the%20Vice%20President%20of%20the%20United%20States%5Cn%20%20Ellen%20DeGeneres%20is%20a%20%7Bcomedian%7Ctalk%20show%20host%7Cactivist%7D%5Cn%20%20Gisele%20B%C3%BCndchen%20is%20a%20%7BBrazilian%7Csupermodel%7Cenvironmental%20activist%7D%5Cn%20%20Adriana%20Lima%20is%20a%20Brazilian%20model%20known%20for%20her%20%7Bcaptivating%7Crunway%7CVictoria's%20Secret%7D%20appearances%5Cn%20%20Cindy%20Crawford%20is%20an%20iconic%20%7Bsupermodel%7Cbusinesswoman%7Cactress%7D%5Cn%20%20Naomi%20Campbell%20is%20a%20British%20supermodel%20and%20%7Bphilanthropist%7Cactress%7D%5Cn%20%20Serena%20Williams%20is%20a%20%7Btennis%7Csports%7Clegendary%7D%20champion%5Cn%20%20Simone%20Biles%20is%20an%20%7BOlympic%7Cgymnastics%7Crecord-breaking%7D%20gold%20medalist%5Cn%20%20Venus%20Williams%20is%20a%20%7Btennis%7Csports%7Cchampion%7D%20icon%5Cn%20%20Billie%20Eilish%20is%20a%20%7Byoung%7CGrammy-winning%7Cinnovative%7D%20music%20sensation%5Cn%20%20Ariana%20Grande%20is%20a%20pop%20sensation%20with%20%7Bhit%7Cchart-topping%7Cpopular%7D%20tracks%5Cn%20%20Emma%20Stone%20from%20the%20movie%20%7BLa%20La%20Land%7CThe%20Help%7CThe%20Favourite%7D%5Cn%20%20Natalie%20Portman%20from%20the%20movie%20%7BBlack%20Swan%7CV%20for%20Vendetta%7CThor%7D%5Cn%20%20Priyanka%20Chopra%20is%20an%20actress%20and%20%7Bglobal%7CHollywood%7CBollywood%7D%20star%5Cn%20%20Emma%20Roberts%20from%20the%20TV%20series%20%7BScream%20Queens%7CAmerican%20Horror%20Story%7D%20and%20%7Bmovie%7Cfilm%7Cfilmography%7D%5Cn%20%20Meghan%20Markle%20is%20a%20former%20actress%20and%20member%20of%20the%20British%20royal%20family%5Cn%20%20Michelle%20Pfeiffer%20from%20the%20movie%20%7BScarface%7CBatman%20Returns%7CDangerous%20Minds%7D%5Cn%20%20J.K.%20Rowling%20is%20the%20author%20of%20the%20%7BHarry%20Potter%7CFantastic%20Beasts%7D%20series%5Cn%20%20Malala%20Yousafzai%20is%20a%20%7Bhuman%20rights%20advocate%7CNobel%20laureate%7Cauthor%7D%5Cn%20%20Amelia%20Earhart%20(historical%20figure)%20was%20a%20pioneering%20%7Baviator%7Cexplorer%7D%5Cn%20%20Marie%20Curie%20(historical%20figure)%20was%20a%20%7Bphysicist%7Cchemist%7CNobel%20laureate%7D%5Cn%20%20Billie%20Eilish%20is%20a%20%7Byoung%7CGrammy-winning%7Cinnovative%7D%20music%20sensation%5Cn%20%20Taylor%20Swift%20is%20a%20%7Bchart-topping%7Cpop%7Ccountry%7D%20music%20sensation%5Cn%20%20Britney%20Spears%20is%20a%20%7Bpop%7Ciconic%7Cdancing%7D%20sensation%5Cn%20%20Katy%20Perry%20is%20a%20%7Bpop%20sensation%7Csongstress%7Cstyle%20icon%7D%5Cn%20%20Cara%20Delevingne%20is%20a%20%7Bmodel%7Cactress%7Cstyle%20icon%7D%5Cn%20%20Daenerys%20Targaryen%20is%20a%20%7Bcharacter%7Cqueen%7CKhaleesi%7D%20from%20Game%20of%20Thrones%5Cn%20%20Selena%20Gomez%20is%20a%20%7Bsinger%7Cactress%7Cproducer%7D%5Cn%20%20Ariana%20Grande%20is%20a%20pop%20sensation%20with%20%7Bhit%7Cchart-topping%7Cpopular%7D%20tracks%5Cn%20%20Emma%20Watson%20is%20an%20actress%20known%20for%20her%20role%20as%20Belle%20in%20Beauty%20and%20the%20Beast%20(2017)%20and%20Hermione%20Granger%20in%20the%20Harry%20Potter%20series%5Cn%20%20Jennifer%20Lawrence%20from%20the%20movie%20%7BThe%20Hunger%20Games:%20Mockingjay%20-%20Part%201%7CSilver%20Linings%20Playbook%7CJoy%7D%5Cn%20%20Kristen%20Stewart%20is%20known%20for%20her%20role%20as%20Bella%20Swan%20in%20Twilight%5Cn%20%20Nina%20Dobrev%20from%20the%20TV%20series%20The%20Vampire%20Diaries%5Cn%20%20Candice%20King%20from%20the%20TV%20series%20The%20Vampire%20Diaries%5Cn%20%20Katherine%20McNamara%20from%20the%20TV%20series%20Shadowhunters:%20The%20Mortal%20Instruments%5Cn%20%20Cara%20Delevingne%20from%20the%20movie%20%7BPaper%20Towns%7CMargo%7D%20and%20Valerian%20and%20the%20City%20of%20a%20Thousand%20Planets%20(2017)%20as%20Sergeant%20Laureline%5CnrandomDescription4%5Cn%20%20Beth%20has%20chestnut-brown%20and%20blonde%20hair%20that%20falls%20in%20gentle%20waves,%20framing%20her%20heart-shaped%20face.%20Her%20hazel%20eyes%20express%20warmth%20and%20kindness,%20and%20her%20slender%20figure%20carries%20an%20air%20of%20quiet%20confidence.%20Enjoys%20playing%20the%20guitar%20and%20composing%20her%20own%20music.%5Cn%20%20Katie's%20auburn%20curls%20cascade%20down%20her%20shoulders,%20and%20her%20brown%20eyes%20radiate%20intelligence%20and%20charm.%20Her%20athletic%20build%20suggests%20an%20active%20and%20adventurous%20lifestyle.%20Passionate%20about%20skateboarding%20and%20often%20spends%20her%20weekends%20at%20the%20skatepark.%5Cn%20%20Amy's%20sleek%20black%20hair%20is%20pulled%20back%20in%20a%20neat%20ponytail,%20emphasizing%20her%20expressive%20brown%20eyes.%20Her%20petite%20and%20agile%20figure%20hints%20at%20a%20graceful%20and%20energetic%20personality.%20Enjoys%20practicing%20yoga%20and%20often%20leads%20classes%20in%20her%20community.%5Cn%20%20Katrina's%20long,%20dark%20hair%20flows%20down%20her%20back,%20and%20her%20piercing%20gray%20eyes%20convey%20a%20sense%20of%20mystery.%20With%20a%20tall%20and%20statuesque%20figure,%20she%20exudes%20elegance%20and%20poise.%20A%20skilled%20martial%20artist,%20she%20practices%20various%20forms%20of%20self-defense.%5Cn%20%20Kat%20has%20a%20bob%20of%20platinum%20blonde%20hair%20that%20frames%20her%20heart-shaped%20face.%20Her%20lively%20blue%20eyes%20and%20infectious%20smile%20add%20a%20touch%20of%20vibrancy%20to%20her%20petite%20and%20cheerful%20demeanor.%20A%20dedicated%20wildlife%20photographer%20who%20captures%20the%20beauty%20of%20nature.%5Cn%20%20Sarah's%20golden-brown%20locks%20fall%20in%20loose%20waves,%20and%20her%20hazel%20eyes%20hold%20a%20depth%20of%20wisdom.%20With%20a%20confident%20and%20athletic%20build,%20she%20carries%20herself%20with%20grace%20and%20strength.%20Enjoys%20mountain%20climbing%20and%20has%20conquered%20several%20challenging%20peaks.%5Cn%20%20Sarah%20has%20waist-length,%20jet-black%20hair%20that%20frames%20her%20heart-shaped%20face.%20Her%20piercing%20gray%20eyes%20convey%20a%20mysterious%20allure,%20and%20her%20tall,%20slender%20figure%20adds%20an%20air%20of%20sophistication.%20An%20archaeologist%20who%20travels%20the%20world%20to%20uncover%20ancient%20civilizations.%5Cn%20%20Harper%20possesses%20a%20mane%20of%20chestnut%20curls%20that%20cascades%20down%20her%20back,%20and%20her%20vibrant%20blue%20eyes%20radiate%20energy%20and%20enthusiasm.%20With%20an%20athletic%20build%20and%20a%20contagious%20smile,%20she's%20always%20ready%20for%20adventure.%20A%20passionate%20salsa%20dancer%20who%20performs%20at%20local%20events.%5Cn%20%20Natalie's%20long,%20platinum%20blonde%20hair%20complements%20her%20bubbly%20personality.%20Her%20hazel%20eyes%20sparkle%20with%20curiosity,%20and%20her%20petite%20frame%20is%20adorned%20with%20a%20collection%20of%20delicate%20silver%20jewelry.%20An%20avid%20stargazer%20who%20organizes%20community%20telescope%20nights.%5Cn%20%20Samantha%20boasts%20a%20head%20of%20fiery%20red%20curls%20that%20bounce%20with%20every%20step.%20Her%20emerald%20green%20eyes%20reflect%20her%20fiery%20spirit,%20and%20her%20freckles%20add%20a%20touch%20of%20charm%20to%20her%20fair%20complexion.%20A%20skilled%20equestrian%20who%20participates%20in%20show%20jumping%20competitions.%5Cn%20%20Victoria%20has%20long,%20wavy%20honey-brown%20hair%20and%20striking%20violet%20eyes%20that%20hint%20at%20a%20sense%20of%20mystery.%20With%20a%20statuesque%20figure%20and%20a%20confident%20demeanor,%20she%20commands%20attention%20wherever%20she%20goes.%20A%20book%20club%20enthusiast%20who%20hosts%20literary%20gatherings%20in%20her%20neighborhood.%5Cn%20%20Ellie's%20golden%20locks%20fall%20in%20loose%20waves,%20framing%20her%20heartwarming%20smile.%20Her%20bright%20green%20eyes%20radiate%20kindness,%20and%20her%20curvy%20silhouette%20exudes%20a%20warm%20and%20comforting%20presence.%20A%20culinary%20artist%20who%20experiments%20with%20fusion%20cuisine.%5Cn%20%20Jasmine's%20ebony%20hair%20is%20pulled%20back%20into%20a%20neat%20bun,%20highlighting%20her%20sharp%20hazel%20eyes.%20Her%20tailored%20attire%20accentuates%20her%20professional%20demeanor,%20and%20her%20lean%20figure%20suggests%20a%20disciplined%20lifestyle.%20A%20competitive%20rock%20climber%20who%20participates%20in%20national%20championships.%5Cn%20%20Penelope's%20silver-white%20hair%20cascades%20gracefully%20down%20her%20shoulders,%20and%20her%20intense%20blue%20eyes%20hold%20a%20depth%20of%20wisdom.%20Her%20slender%20figure%20is%20adorned%20with%20elegant,%20flowing%20dresses%20that%20reflect%20her%20timeless%20elegance.%20A%20skilled%20ballroom%20dancer%20who%20frequents%20dance%20competitions.%5Cn%20%20Stella's%20wild,%20auburn%20curls%20give%20her%20a%20carefree%20and%20adventurous%20appearance.%20Her%20mismatched%20green%20and%20brown%20eyes%20sparkle%20with%20spontaneity,%20and%20her%20athletic%20build%20suggests%20an%20active%20lifestyle.%20An%20urban%20gardener%20who%20transforms%20city%20spaces%20into%20lush%20green%20retreats.%5Cn%20%20Madeline%20has%20a%20bob%20of%20sleek,%20dark%20brown%20hair%20that%20frames%20her%20oval-shaped%20face.%20Her%20deep%20brown%20eyes%20exude%20intelligence,%20and%20her%20petite%20stature%20is%20complemented%20by%20an%20eclectic%20sense%20of%20fashion.%20An%20amateur%20astronomer%20who%20hosts%20stargazing%20parties.%5Cn%20%20Alicia%20has%20curly%20auburn%20hair%20that%20cascades%20down%20her%20shoulders,%20complementing%20her%20hazel%20eyes.%20She%20stands%20tall%20with%20an%20athletic%20build,%20her%20warm%20smile%20revealing%20a%20dimple%20on%20her%20right%20cheek.%20A%20passionate%20environmentalist%20who%20organizes%20community%20clean-up%20events.%5Cn%20%20Olivia%20boasts%20a%20mane%20of%20flowing%20platinum%20blonde%20hair,%20which%20contrasts%20beautifully%20with%20her%20deep%20blue%20eyes.%20Her%20slender%20figure%20and%20graceful%20posture%20exude%20elegance%20and%20poise.%20A%20self-taught%20painter%20who%20showcases%20her%20artwork%20in%20local%20galleries.%5Cn%20%20Sophie's%20raven-black%20hair%20falls%20in%20loose%20waves%20around%20her%20shoulders,%20framing%20her%20striking%20emerald%20green%20eyes.%20She%20has%20a%20petite%20and%20delicate%20frame,%20giving%20her%20an%20ethereal%20appearance.%20An%20amateur%20botanist%20who%20cultivates%20rare%20plants%20in%20her%20home%20garden.%5Cn%20%20Emily%20is%20a%20redhead%20with%20fiery%20curls%20that%20bounce%20with%20each%20step.%20Her%20freckles%20dance%20across%20her%20fair%20skin,%20and%20her%20hazel%20eyes%20convey%20a%20mix%20of%20curiosity%20and%20kindness.%20A%20talented%20graffiti%20artist%20who%20contributes%20to%20local%20street%20art%20projects.%5Cn%20%20Mia%20possesses%20a%20sun-coated%20complexion%20and%20wavy%20chestnut%20hair%20that%20falls%20just%20below%20her%20shoulders.%20Her%20infectious%20laughter%20complements%20her%20cheerful%20demeanor,%20and%20her%20hazel%20eyes%20sparkle%20with%20warmth.%20An%20aspiring%20stand-up%20comedian%20who%20performs%20at%20open%20mic%20nights.%5Cn%20%20Isabella's%20golden-brown%20locks%20frame%20her%20heart-shaped%20face,%20and%20her%20hazel%20eyes%20reflect%20a%20mix%20of%20intelligence%20and%20playfulness.%20She%20has%20a%20tall%20and%20athletic%20build,%20often%20seen%20with%20a%20determined%20expression.%20An%20amateur%20archaeologist%20who%20explores%20local%20historical%20sites.%5Cn%20%20Zoe%20has%20a%20bob%20of%20jet-black%20hair%20that%20frames%20her%20round,%20expressive%20hazel%20eyes.%20Her%20petite%20stature%20and%20infectious%20energy%20make%20her%20a%20standout%20in%20any%20crowd.%20An%20avid%20skateboarder%20who%20practices%20tricks%20at%20the%20local%20skate%20park.%5Cn%20%20Eva's%20long,%20straight%20strawberry%20blonde%20hair%20flows%20down%20her%20back,%20and%20her%20blue%20eyes%20shimmer%20with%20a%20sense%20of%20adventure.%20With%20a%20slender%20figure%20and%20a%20constant%20air%20of%20grace,%20she%20moves%20effortlessly%20through%20life.%20An%20animal%20rights%20activist%20who%20volunteers%20at%20local%20shelters.%5Cn%20%20Grace%20has%20a%20classic%20beauty%20with%20her%20chestnut-brown%20hair%20and%20hazel%20eyes.%20Her%20porcelain%20skin%20is%20complemented%20by%20a%20smattering%20of%20freckles,%20and%20her%20slender%20figure%20exudes%20an%20air%20of%20timeless%20elegance.%20A%20chess%20prodigy%20who%20participates%20in%20national%20tournaments.%5Cn%20%20Lily%20sports%20a%20pixie%20cut%20of%20sandy%20blonde%20hair,%20and%20her%20green%20eyes%20sparkle%20mischievously.%20With%20a%20bubbly%20personality%20and%20a%20penchant%20for%20bold%20fashion%20choices,%20she%20stands%20out%20in%20any%20crowd.%20An%20urban%20explorer%20who%20documents%20abandoned%20places%20through%20photography.%5CnrandomDescription5%5Cn%20%20Eiffel%20Tower%20%7Bat%20sunrise%7Cunder%20a%20starlit%20sky%7D%5Cn%20%20Great%20Wall%20of%20China%20%7Bin%20the%20misty%20morning%7Cbathed%20in%20golden%20sunset%20hues%7D%5Cn%20%20Statue%20of%20Liberty%20%7Bunder%20a%20clear%20blue%20sky%7Cwith%20the%20city%20lights%20as%20a%20backdrop%7D%5Cn%20%20Machu%20Picchu%20%7Bshrouded%20in%20dawn's%20light%7Cunder%20the%20moon's%20ethereal%20glow%7D%5Cn%20%20Sydney%20Opera%20House%20%7Bbasking%20in%20the%20afternoon%20sun%7Cilluminated%20by%20colorful%20lights%20at%20night%7D%5Cn%20%20Taj%20Mahal%20%7Bat%20dawn's%20first%20light%7Cunder%20the%20soft%20hues%20of%20twilight%7D%5Cn%20%20Grand%20Canyon%20%7Bbathed%20in%20the%20warm%20glow%20of%20sunrise%7Cunder%20a%20blanket%20of%20stars%7D%5Cn%20%20Colosseum%20in%20Rome%20%7Bunder%20the%20midday%20sun%7Cunder%20the%20enchanting%20glow%20of%20the%20full%20moon%7D%5Cn%20%20The%20Acropolis%20%7Bat%20noon's%20brilliance%7Cas%20ancient%20pillars%20cast%20long%20shadows%20at%20dusk%7D%5Cn%20%20Mount%20Fuji%20%7Bwith%20cherry%20blossoms%20in%20spring%7Cunder%20a%20blanket%20of%20snow%20in%20winter%7D%5Cn%20%20Great%20Pyramid%20of%20Giza%20%7Bat%20sunset%7Cunder%20the%20shimmering%20light%20of%20a%20full%20moon%7D%5Cn%20%20Christ%20the%20Redeemer%20%7Boverlooking%20the%20city%20at%20dawn%7Cunder%20the%20vibrant%20hues%20of%20a%20sunset%7D%5Cn%20%20Petra,%20Jordan%20%7Bemerging%20from%20the%20morning%20mist%7Cilluminated%20by%20lanterns%20at%20night%7D%5Cn%20%20Angkor%20Wat%20%7Breflected%20in%20the%20tranquil%20waters%20at%20sunrise%7Cunder%20a%20tapestry%20of%20stars%7D%5Cn%20%20Milky%20Way%20over%20Yellowstone%20National%20Park%20creating%20a%20celestial%20spectacle%5Cn%20%20The%20Parthenon%20%7Bbathed%20in%20golden%20light%20at%20sunrise%7Cunder%20a%20canopy%20of%20twinkling%20stars%7D%5Cn%20%20Burj%20Khalifa%20%7Btouching%20the%20sky%20in%20the%20afternoon%7Clit%20up%20against%20the%20city%20lights%20at%20night%7D%5Cn%20%20The%20Amazon%20Rainforest%20Canopy%20teeming%20with%20life%20and%20vibrant%20greenery%5Cn%20%20Victoria%20Falls%20with%20a%20rainbow%20arching%20across%20the%20misty%20gorge%5Cn%20%20Niagara%20Falls%20%7Broaring%20in%20the%20daylight%7Cilluminated%20by%20colorful%20lights%20at%20night%7D%5Cn%20%20Mount%20Everest%20%7Bshrouded%20in%20clouds%7Cglistening%20in%20the%20moonlight%7D%5Cn%20%20The%20Louvre%20Pyramid%20%7Bcapturing%20the%20sunlight%20in%20the%20morning%7Caglow%20with%20artistic%20lighting%20at%20night%7D%5Cn%20%20The%20Great%20Barrier%20Reef%20with%20colorful%20coral%20gardens%20and%20marine%20life%5Cn%20%20Milford%20Sound%20Fjord,%20New%20Zealand%20towering%20cliffs%20and%20cascading%20waterfalls%5Cn%20%20The%20Kremlin%20%7Bdominating%20the%20skyline%20in%20Moscow%7Cilluminated%20against%20the%20night%20sky%7D%5Cn%20%20The%20Alhambra%20%7Bwith%20intricate%20Islamic%20architecture%7Cglowing%20in%20the%20evening%7D%5Cn%20%20Antelope%20Canyon%20with%20sunbeams%20streaming%20through%20the%20narrow%20sandstone%20walls%5Cn%20%20The%20Palace%20of%20Versailles%20surrounded%20by%20meticulously%20manicured%20gardens%5Cn%20%20Sagrada%20Familia%20%7Bunder%20the%20warm%20hues%20of%20sunset%7Clit%20up%20with%20dazzling%20lights%20at%20night%7D%5Cn%20%20The%20Serengeti%20Plains%20stretching%20to%20the%20horizon%20with%20abundant%20wildlife%5Cn%20%20The%20Maldives%20with%20overwater%20bungalows%20and%20turquoise%20lagoons%5Cn%20%20Chichen%20Itza%20with%20shadows%20aligning%20during%20the%20equinox%5Cn%20%20The%20Vatican%20City%20St.%20Peter's%20Basilica%20illuminated%20at%20night%20against%20the%20starry%20sky%5Cn%20%20The%20Blue%20Lagoon,%20Iceland%20steaming%20in%20the%20cold%20air%20with%20a%20backdrop%20of%20snowy%20landscapes%5Cn%20%20The%20Sydney%20Harbour%20Bridge%20%7Bwith%20the%20city%20skyline%20in%20the%20background%7Clit%20up%20at%20night%7D%5Cn%20%20The%20Leaning%20Tower%20of%20Pisa%20leaning%20gracefully%20under%20the%20Italian%20sun%5Cn%20%20The%20Forbidden%20City,%20Beijing%20%7Bamidst%20the%20bustling%20crowds%7Csilhouetted%20against%20the%20sunset%7D%5Cn%20%20Stonehenge%20%7Bmystically%20surrounded%20by%20morning%20fog%7Cunder%20the%20starry%20night%20sky%7D%5Cn%20%20The%20Burj%20Al%20Arab,%20Dubai%20%7Bgleaming%20in%20the%20desert%20sun%7Cilluminated%20with%20vibrant%20colors%20at%20night%7D%5Cn%20%20The%20Matterhorn%20%7Btowering%20over%20the%20Swiss%20Alps%7Cglowing%20with%20alpenglow%20during%20sunset%7D%5Cn%20%20The%20Palace%20of%20Westminster%20and%20Big%20Ben,%20London%20%7Bwith%20double-decker%20buses%20passing%20by%7Clit%20up%20against%20the%20dark%20city%20skyline%7D%5Cn%20%20The%20White%20House,%20Washington%20D.C.%20%7Bwith%20a%20clear%20blue%20sky%20in%20the%20background%7Cunder%20the%20soft%20glow%20of%20streetlights%7D%5Cn%20%20The%20Amazon%20River%20%7Bsnaking%20through%20the%20lush%20rainforest%7Creflecting%20the%20colors%20of%20a%20tropical%20sunset%7D%5Cn%20%20The%20Spanish%20Steps,%20Rome%20%7Blined%20with%20flowers%20in%20the%20spring%7Cquiet%20and%20illuminated%20in%20the%20evening%7D%5Cn%20%20The%20Hollywood%20Sign,%20Los%20Angeles%20%7Bperched%20on%20the%20hills%20overlooking%20the%20city%7Clit%20up%20against%20the%20night%20sky%7D%5Cn%20%20The%20Dead%20Sea%20%7Bwith%20salt%20crystals%20glistening%20in%20the%20sunlight%7Cunder%20a%20blanket%20of%20stars%7D%5Cn%20%20The%20Pyramids%20of%20Teotihuacan%20%7Bbathed%20in%20warm%20sunlight%7Csilhouetted%20against%20the%20fiery%20hues%20of%20sunset%7D%5Cn%20%20The%20Victoria%20and%20Albert%20Waterfront,%20Cape%20Town%20%7Bwith%20Table%20Mountain%20in%20the%20background%7Clit%20up%20by%20waterfront%20lights%7D%5Cn%20%20The%20Great%20Ocean%20Road,%20Australia%20%7Bwinding%20along%20dramatic%20coastal%20cliffs%7Cunder%20the%20Milky%20Way%20in%20the%20night%20sky%7D%5Cn%20%20The%20Potala%20Palace,%20Lhasa%20%7Bmajestically%20standing%20against%20a%20clear%20blue%20sky%7Cilluminated%20during%20a%20festival%20at%20night%7D%5Cn%20%20The%20Sydney%20Harbour%20Opera%20House%20%7Bwith%20sailboats%20dotting%20the%20harbor%7Cilluminated%20in%20various%20colors%20at%20night%7D%5Cn%20%20The%20Pantheon,%20Rome%20%7Bwith%20beams%20of%20sunlight%20streaming%20through%20the%20oculus%7Cunder%20the%20soft%20glow%20of%20streetlights%7D%5Cn%20%20The%20Tower%20Bridge,%20London%20%7Bwith%20red%20double-decker%20buses%20crossing%7Cilluminated%20against%20the%20Thames%20at%20night%7D%5Cn%20%20The%20Cliffs%20of%20Moher,%20Ireland%20%7Bsoaring%20above%20the%20Atlantic%20Ocean%7Cunder%20the%20moonlit%20sky%7D%5Cn%20%20The%20Bagan%20Temples,%20Myanmar%20%7Bwith%20hot%20air%20balloons%20rising%20at%20dawn%7Csilhouetted%20against%20a%20colorful%20sunset%7D%5Cn%20%20The%20Red%20Square,%20Moscow%20%7Bsurrounded%20by%20historic%20buildings%7Cunder%20the%20city%20lights%20in%20the%20evening%7D%5Cn%20%20The%20Neuschwanstein%20Castle,%20Germany%20%7Bperched%20on%20a%20hill%20with%20a%20snow-covered%20landscape%7Clit%20up%20during%20a%20winter%20night%7D%5Cn%20%20The%20Victoria%20Falls%20Bridge%20%7Bconnecting%20Zambia%20and%20Zimbabwe%7Cunder%20a%20spectacular%20moonlit%20night%7D%5Cn%20%20The%20Table%20Mountain,%20Cape%20Town%20%7Bwith%20the%20city%20sprawling%20below%7Cunder%20the%20vibrant%20hues%20of%20a%20sunset%7D%5Cn%20%20The%20Torres%20del%20Paine%20National%20Park,%20Chile%20%7Bwith%20the%20iconic%20peaks%20rising%20above%7Cunder%20a%20starry%20Patagonian%20sky%7D%5Cn%20%20The%20Mont%20Saint-Michel,%20France%20%7Bemerging%20from%20the%20morning%20mist%7Clit%20up%20against%20the%20night%20sky%7D%5Cn%20%20The%20Brandenburg%20Gate,%20Berlin%20%7Bsurrounded%20by%20historical%20significance%7Cunder%20a%20canopy%20of%20streetlights%7D%5Cn%20%20The%20Gal%C3%A1pagos%20Islands%20%7Bwith%20unique%20wildlife%20and%20pristine%20landscapes%7Csurrounded%20by%20crystal-clear%20waters%7D%5Cn%20%20The%20Palace%20Museum,%20Taipei%20%7Bshowcasing%20ancient%20artifacts%20and%20architecture%7Cadorned%20with%20traditional%20Chinese%20gardens%7D%5Cn%20%20The%20Colosseum%20at%20night,%20Rome%20%7Billuminated%20in%20a%20warm%20golden%20glow%7Cunder%20a%20canopy%20of%20stars%7D%5Cn%20%20The%20Tower%20of%20London%20%7Bwith%20ravens%20perched%20on%20medieval%20walls%7Cunder%20the%20glow%20of%20lamplights%7D%5CnrandomDescription6%5Cn%20%20Tom%20Hanks%20from%20the%20movie%20%7BForrest%20Gump%7CCast%20Away%7CSaving%20Private%20Ryan%7D%5Cn%20%20Robert%20Downey%20Jr.%20as%20Iron%20Man%20in%20%7BThe%20Avengers%7CIron%20Man%7CAvengers:%20Endgame%7D%5Cn%20%20Brad%20Pitt%20from%20the%20movie%20%7BFight%20Club%7CInglourious%20Basterds%7COcean's%20Eleven%7D%5Cn%20%20Johnny%20Depp%20in%20%7BPirates%20of%20the%20Caribbean%7CEdward%20Scissorhands%7CSweeney%20Todd%7D%5Cn%20%20Chris%20Hemsworth%20as%20Thor%20in%20%7BThor%7CRagnarok%7CAvengers:%20Infinity%20War%7D%20%20%20%20%5Cn%20%20Leonardo%20DiCaprio%20from%20the%20movie%20%7BInception%7CThe%20Wolf%20of%20Wall%20Street%7CTitanic%7D%5Cn%20%20Will%20Smith%20in%20%7BMen%20in%20Black%7CIndependence%20Day%7CThe%20Pursuit%20of%20Happyness%7D%5Cn%20%20Hugh%20Jackman%20as%20Wolverine%20in%20%7BX-Men%7CLogan%7CThe%20Greatest%20Showman%7D%5Cn%20%20Keanu%20Reeves%20from%20the%20movie%20%7BThe%20Matrix%7CJohn%20Wick%7CSpeed%7D%5Cn%20%20Matt%20Damon%20in%20%7BGood%20Will%20Hunting%7CJason%20Bourne%7CThe%20Martian%7D%5Cn%20%20Elon%20Musk%20is%20%7Binnovating%7Crevolutionizing%7Ctransforming%7D%20space%20travel%20at%20SpaceX%5Cn%20%20Jeff%20Bezos%20is%20%7Bpioneering%7Cleading%7Ctransforming%7D%20e-commerce%20with%20Amazon%5Cn%20%20Bill%20Gates%20co-founded%20Microsoft%20and%20is%20a%20%7Bphilanthropist%7Cinnovator%7Cvisionary%7D%5Cn%20%20Mark%20Zuckerberg%20created%20Facebook,%20a%20%7Bsocial%20media%7Ctech%7Conline%7D%20giant%5Cn%20%20Warren%20Buffett%20is%20a%20%7Bsuccessful%7Cwise%7Clegendary%7D%20investor%20and%20business%20tycoon%5Cn%20%20Richard%20Branson,%20a%20%7Bdiverse%7Cinnovative%7Cglobal%7D%20conglomerate%5Cn%20%20Tim%20Cook%20is%20the%20CEO%20of%20Apple,%20a%20%7Btech%7Cinnovative%7Cleading%7D%20company%5Cn%20%20Larry%20Page%20co-founded%20Google,%20a%20%7Bsearch%7Ctech%7Cinternet%7D%20giant%5Cn%20%20Sergey%20Brin%20co-founded%20Google,%20a%20%7Bsearch%7Ctech%7Cinternet%7D%20giant%5Cn%20%20Jack%20Ma%20founded%20Alibaba,%20a%20%7Bglobal%7Ce-commerce%7Ctech%7D%20giant%5Cn%20%20Barack%20Obama%20served%20as%20the%2044th%20President%20of%20the%20United%20States%5Cn%20%20Donald%20Trump%20served%20as%20the%2045th%20President%20of%20the%20United%20States%5Cn%20%20Joe%20Biden%20is%20the%2046th%20President%20of%20the%20United%20States%5Cn%20%20Justin%20Trudeau%20is%20the%20Prime%20Minister%20of%20Canada,%20known%20for%20his%20%7Bprogressive%7Cinclusive%7Cleadership%7D%5Cn%20%20Emmanuel%20Macron%20is%20the%20President%20of%20France,%20known%20for%20his%20%7Breformative%7Cprogressive%7Cmodern%7D%20policies%5Cn%20%20Boris%20Johnson%20is%20the%20Prime%20Minister%20of%20the%20United%20Kingdom%5Cn%20%20Narendra%20Modi%20is%20the%20Prime%20Minister%20of%20India,%20leading%20with%20a%20%7Bstrong%7Cvisionary%7Cnationalistic%7D%20approach%5Cn%20%20Xi%20Jinping%20is%20the%20General%20Secretary%20of%20the%20Communist%20Party%20of%20China%5Cn%20%20Shinzo%20Abe%20is%20a%20former%20Prime%20Minister%20of%20Japan%5Cn%20%20Angela%20Merkel%20is%20a%20former%20Chancellor%20of%20Germany%5Cn%20%20David%20Gandy%20is%20a%20%7BBritish%7Crenowned%7Ctop%7D%20male%20model%5Cn%20%20Sean%20O'Pry%20is%20an%20American%20model%20known%20for%20his%20%7Bstriking%7Ccaptivating%7Csharp%7D%20features%5Cn%20%20Jon%20Kortajarena%20is%20a%20Spanish%20model%20with%20%7Bdistinctive%7Calluring%7Cmesmerizing%7D%20looks%5Cn%20%20Lucky%20Blue%20Smith%20is%20a%20%7Byoung%7Cdynamic%7Cpopular%7D%20American%20model%5Cn%20%20Tyson%20Beckford%20is%20an%20American%20model%20and%20actor%5Cn%20%20Noah%20Mills%20is%20a%20Canadian%20model%20and%20actor%5Cn%20%20Matthew%20Noszka%20is%20an%20American%20model%20and%20actor%5Cn%20%20Tobias%20Sorensen%20is%20a%20Danish%20model%20known%20for%20his%20%7Bstrong%7Cchiseled%7Cstriking%7D%20physique%5Cn%20%20River%20Viiperi%20is%20a%20Spanish%20model%20with%20a%20%7Bcharming%7Celegant%7Cmodern%7D%20style%5Cn%20%20Francisco%20Lachowski%20is%20a%20Brazilian%20model%20with%20%7Byouthful%7Cvibrant%7Cstriking%7D%20appeal%5Cn%20%20Justin%20Bieber%20is%20a%20Canadian%20singer%20and%20pop%20sensation%5Cn%20%20Ed%20Sheeran%20is%20an%20English%20singer-songwriter%20with%20%7Bmelodic%7Csoulful%7Ccaptivating%7D%20tunes%5Cn%20%20Drake%20is%20a%20Canadian%20rapper%20and%20artist%20with%20%7Bchart-topping%7Chit%7Cpopular%7D%20tracks%5Cn%20%20Bruno%20Mars%20is%20a%20versatile%20artist%20known%20for%20his%20%7Benergetic%7Csoulful%7Cupbeat%7D%20performances%5Cn%20%20Harry%20Styles%20is%20a%20singer%20and%20former%20member%20of%20One%20Direction%5Cn%20%20Kanye%20West%20is%20a%20%7Bcontroversial%7Cinnovative%7Ciconic%7D%20rapper%20and%20fashion%20designer%5Cn%20%20Shawn%20Mendes%20is%20a%20Canadian%20singer%20and%20songwriter%5Cn%20%20The%20Weeknd%20is%20a%20Canadian%20singer%20with%20%7Bunique%7Csoulful%7Ccaptivating%7D%20vocal%20style%5Cn%20%20John%20Legend%20is%20a%20%7Btalented%7Csoulful%7Cversatile%7D%20singer%20and%20pianist%5Cn%20%20Pharrell%20Williams%20is%20a%20musician%20and%20producer%20with%20a%20%7Bcreative%7Cinnovative%7Cfunky%7D%20style%5Cn%20%20Cristiano%20Ronaldo%20is%20a%20%7Bworld-renowned%7Cathletic%7Crecord-breaking%7D%20footballer%5Cn%20%20Lionel%20Messi%20is%20a%20%7Blegendary%7Cskillful%7Crecord-breaking%7D%20footballer%5Cn%20%20LeBron%20James%20is%20an%20iconic%20%7Bbasketball%7CNBA%7Csports%7D%20player%5Cn%20%20Usain%20Bolt%20is%20a%20retired%20Jamaican%20sprinter,%20the%20%7Bfastest%7Crecord-breaking%7D%20man%5Cn%20%20Tom%20Brady%20is%20a%20%7Bsuccessful%7Clegendary%7Crecord-breaking%7D%20American%20football%20quarterback%5Cn%20%20Neymar%20Jr.%20is%20a%20Brazilian%20%7Bfootball%7Csoccer%7Csports%7D%20star%5Cn%20%20Roger%20Federer%20is%20a%20Swiss%20tennis%20%7Blegend%7Cicon%7Cchampion%7D%5Cn%20%20Michael%20Phelps%20is%20an%20%7BOlympic%7Crecord-breaking%7Cswimming%7D%20gold%20medalist%5Cn%20%20Kobe%20Bryant%20(late)%20was%20an%20%7Binspirational%7Ciconic%7Clegendary%7D%20basketball%20player%5Cn%20%20Novak%20Djokovic%20is%20a%20Serbian%20tennis%20%7Bchampion%7Clegend%7Cicon%7D%5CnrandomDescription7%5Cn%20%20Benjamin%20has%20tousled%20brown%20hair%20and%20deep%20blue%20eyes%20that%20reflect%20a%20sense%20of%20curiosity.%20With%20a%20lean%20physique,%20he%20enjoys%20practicing%20parkour%20in%20urban%20environments.%5Cn%20%20Nathan's%20jet-black%20hair%20is%20styled%20in%20a%20messy%20quiff,%20and%20his%20hazel%20eyes%20exude%20a%20mix%20of%20charm%20and%20determination.%20A%20talented%20graphic%20designer,%20he%20spends%20his%20weekends%20creating%20digital%20art.%5Cn%20%20Ethan%20sports%20a%20beard%20with%20his%20short,%20dark%20brown%20hair,%20giving%20him%20a%20rugged%20appearance.%20His%20piercing%20green%20eyes%20hint%20at%20an%20adventurous%20spirit.%20A%20rock%20climber,%20he%20tackles%20challenging%20cliffs%20for%20fun.%5Cn%20%20Sebastian%20has%20wavy%20blond%20hair%20that%20falls%20just%20above%20his%20shoulders,%20complementing%20his%20hazel%20eyes.%20With%20a%20tall%20and%20athletic%20build,%20he's%20a%20competitive%20surfer%20who%20catches%20waves%20on%20the%20weekends.%5Cn%20%20Connor's%20short%20red%20hair%20contrasts%20with%20his%20freckled%20face,%20and%20his%20bright%20green%20eyes%20convey%20a%20mischievous%20charm.%20An%20avid%20skateboarder,%20he%20practices%20tricks%20at%20the%20local%20skate%20park.%5Cn%20%20Daniel's%20curly%20black%20hair%20and%20deep%20brown%20eyes%20give%20him%20a%20laid-back%20and%20approachable%20vibe.%20He's%20a%20skilled%20chef%20who%20enjoys%20experimenting%20with%20exotic%20cuisines%20in%20his%20free%20time.%5Cn%20%20Lucas%20has%20a%20shaved%20head,%20revealing%20intricate%20tattoos,%20and%20his%20piercing%20blue%20eyes%20exude%20a%20sense%20of%20intensity.%20An%20accomplished%20MMA%20fighter,%20he%20participates%20in%20local%20and%20national%20competitions.%5Cn%20%20Jackson's%20light%20brown%20hair%20is%20neatly%20combed,%20and%20his%20gray%20eyes%20radiate%20intelligence.%20With%20a%20stocky%20build,%20he's%20a%20passionate%20wildlife%20photographer%20who%20explores%20nature%20reserves.%5Cn%20%20Aiden%20has%20sandy%20blonde%20hair%20that%20falls%20casually%20over%20his%20forehead,%20and%20his%20light%20blue%20eyes%20reflect%20a%20calm%20demeanor.%20An%20aspiring%20actor,%20he%20practices%20monologues%20and%20performs%20in%20local%20theater%20productions.%5Cn%20%20Oliver's%20dark%20brown%20hair%20is%20neatly%20styled,%20and%20his%20brown%20eyes%20convey%20a%20mix%20of%20warmth%20and%20humor.%20He's%20an%20enthusiastic%20swing%20dancer%20who%20frequents%20dance%20events%20in%20the%20city.%5Cn%20%20William%20has%20a%20buzz%20cut%20and%20piercing%20gray%20eyes%20that%20hint%20at%20a%20disciplined%20nature.%20With%20a%20muscular%20build,%20he's%20a%20dedicated%20CrossFit%20enthusiast%20who%20organizes%20fitness%20challenges.%5Cn%20%20Isaac's%20long,%20chestnut-brown%20hair%20is%20tied%20in%20a%20loose%20bun,%20and%20his%20green%20eyes%20radiate%20a%20sense%20of%20tranquility.%20A%20passionate%20environmentalist,%20he%20organizes%20community%20clean-up%20initiatives.%5Cn%20%20Leo%20sports%20a%20well-groomed%20beard%20with%20his%20salt-and-pepper%20hair,%20and%20his%20dark%20eyes%20reflect%20wisdom.%20An%20amateur%20astronomer,%20he%20sets%20up%20his%20telescope%20for%20stargazing%20sessions%20in%20local%20parks.%5Cn%20%20Henry%20has%20tousled%20dark%20brown%20hair%20and%20expressive%20hazel%20eyes.%20With%20a%20lean%20and%20agile%20figure,%20he's%20a%20competitive%20rock%20climber%20who%20conquers%20challenging%20cliffs.%5Cn%20%20Charlie's%20messy%20blonde%20hair%20and%20playful%20blue%20eyes%20give%20him%20a%20carefree%20appearance.%20An%20urban%20explorer,%20he%20documents%20abandoned%20places%20through%20photography.%5Cn%20%20Gabriel's%20curly%20black%20hair%20frames%20his%20face,%20and%20his%20brown%20eyes%20convey%20a%20friendly%20demeanor.%20A%20talented%20pianist,%20he%20performs%20classical%20and%20contemporary%20pieces%20at%20local%20venues.%5Cn%20%20Michael's%20short,%20spiky%20hair%20complements%20his%20hazel%20eyes%20that%20hold%20a%20spark%20of%20mischief.%20An%20avid%20gamer,%20he%20competes%20in%20online%20tournaments%20and%20streams%20his%20gameplay.%5Cn%20%20Jacob%20sports%20a%20beard%20with%20his%20chestnut-brown%20hair,%20and%20his%20blue%20eyes%20hold%20a%20sense%20of%20determination.%20A%20skilled%20martial%20artist,%20he%20practices%20various%20forms%20of%20self-defense.%5Cn%20%20Noah's%20tousled%20blonde%20hair%20falls%20over%20his%20forehead,%20and%20his%20green%20eyes%20sparkle%20with%20enthusiasm.%20A%20passionate%20surfer,%20he%20chases%20waves%20along%20the%20coast%20during%20weekends.%5Cn%20%20Adam%20has%20a%20shaved%20head%20and%20a%20well-groomed%20beard,%20and%20his%20gray%20eyes%20convey%20a%20sense%20of%20introspection.%20A%20motorcycle%20enthusiast,%20he%20enjoys%20long%20rides%20through%20scenic%20routes.%5Cn%20%20Christopher's%20light%20brown%20hair%20is%20neatly%20styled,%20and%20his%20brown%20eyes%20reflect%20a%20mix%20of%20kindness%20and%20intelligence.%20An%20amateur%20botanist,%20he%20cultivates%20rare%20plants%20in%20his%20home%20garden.%5Cn%20%20Ryan's%20messy%20black%20hair%20complements%20his%20vibrant%20blue%20eyes.%20With%20a%20slim%20build,%20he's%20an%20aspiring%20stand-up%20comedian%20who%20performs%20at%20open%20mic%20nights.%5Cn%20%20Dylan%20has%20shoulder-length,%20dark%20brown%20hair%20and%20intense%20green%20eyes.%20A%20professional%20photographer,%20he%20captures%20captivating%20moments%20in%20urban%20and%20natural%20landscapes.%5Cn%20%20Andrew's%20short,%20curly%20hair%20and%20warm%20brown%20eyes%20give%20him%20an%20approachable%20appearance.%20A%20dedicated%20marathon%20runner,%20he%20participates%20in%20long-distance%20races.%5Cn%20%20Maxwell's%20slicked-back%20dark%20hair%20and%20blue%20eyes%20convey%20a%20sense%20of%20sophistication.%20With%20a%20muscular%20build,%20he's%20a%20competitive%20ballroom%20dancer%20who%20excels%20in%20various%20dance%20styles.%5Cn%20%20Isaiah%20sports%20a%20buzz%20cut%20and%20deep%20brown%20eyes%20that%20reflect%20a%20calm%20and%20collected%20demeanor.%20An%20enthusiastic%20rollerblader,%20he%20practices%20tricks%20in%20skate%20parks.%5Cn%20%20Elijah's%20auburn%20hair%20falls%20over%20his%20forehead,%20and%20his%20hazel%20eyes%20express%20a%20mix%20of%20passion%20and%20determination.%20A%20talented%20graffiti%20artist,%20he%20contributes%20to%20vibrant%20street%20art%20projects.%5Cn%20%20Brandon%20has%20tousled%20blonde%20hair%20and%20striking%20green%20eyes%20that%20hint%20at%20a%20playful%20nature.%20A%20charismatic%20salsa%20dancer,%20he%20leads%20dance%20classes%20in%20his%20community.%5Cn%20%20David's%20short,%20dark%20brown%20hair%20is%20neatly%20combed,%20and%20his%20brown%20eyes%20convey%20a%20sense%20of%20reliability.%20An%20amateur%20astronomer,%20he%20sets%20up%20his%20telescope%20for%20celestial%20observations.%5Cn%20%20John%20sports%20a%20crew%20cut%20and%20piercing%20blue%20eyes%20that%20reflect%20determination.%20With%20a%20stocky%20build,%20he's%20an%20avid%20CrossFit%20enthusiast%20who%20organizes%20fitness%20challenges.%5Cn%20%20Austin's%20messy%20dark%20brown%20hair%20and%20hazel%20eyes%20give%20him%20a%20laid-back%20appearance.%20A%20passionate%20surfer,%20he%20embraces%20the%20thrill%20of%20riding%20waves%20along%20the%20coastline.%5Cn%20%20Justin%20has%20a%20shaved%20head%20and%20intense%20brown%20eyes%20that%20convey%20a%20sense%20of%20focus.%20A%20competitive%20rock%20climber,%20he%20tackles%20challenging%20cliffs%20and%20participates%20in%20national%20competitions.%5Cn%20%20Samuel's%20short%20black%20hair%20is%20neatly%20styled,%20and%20his%20brown%20eyes%20radiate%20intelligence.%20A%20skilled%20archer,%20he%20participates%20in%20archery%20competitions%20and%20teaches%20classes.%5Cn%20%20Anthony%20sports%20a%20beard%20with%20his%20salt-and-pepper%20hair,%20and%20his%20dark%20eyes%20convey%20a%20sense%20of%20wisdom.%20An%20accomplished%20chef,%20he%20experiments%20with%20innovative%5Cn%5Cninapp%5Cn%20%20//%20NEGATIVES%20FOR%20PRESETS%20EDITING:%5Cn%20%20//%20masterpiece%5Cn%20%20//%20furrowed%5Cn%20%20//%20furrowed%20brow%5Cn%20%20//%20mutated%20hands%20and%20fingers%5Cn%20%20//%20deformed%5Cn%20%20//%20deformed%20iris%5Cn%20%20//%20deformed%20pupils%5Cn%20%20//%20distorted%5Cn%20%20//%20disfigured%5Cn%20%20//%20poorly%20drawn%5Cn%20%20//%20bad%20anatomy%5Cn%20%20//%20wrong%20anatomy%5Cn%20%20//%20extra%20limb%5Cn%20%20//%20missing%20limb%5Cn%20%20//%20floating%20limbs%5Cn%20%20//%20disconnected%20limbs%5Cn%20%20//%20mutation%5Cn%20%20//%20mutated%5Cn%20%20//%20disgusting%5Cn%20%20//%20amputation%5Cn%20%20//%20(worst%20quality%5Cn%20%20//%20bad%20quality%5Cn%20%20//%20low%20quality:1.1)%5CnbannedUsersList%22,%22outputTemplate%22:%22%3C!DOCTYPE%20html%3E%5Cn%3Chtml%20lang=%5C%22en%5C%22%3E%5Cn%3Chead%3E%5Cn%20%20%3Cmeta%20charset=%5C%22UTF-8%5C%22%3E%5Cn%20%20%3Cmeta%20name=%5C%22viewport%5C%22%20content=%5C%22width=device-width,%20initial-scale=1.0,%20maximum-scale=1.0,%20user-scalable=no%5C%22%3E%5Cn%20%20%3Ctitle%3EWorkspace%3C/title%3E%5Cn%20%20%3Clink%20href=%5C%22https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap%5C%22%20rel=%5C%22stylesheet%5C%22%3E%5Cn%20%20%3Cstyle%3E%5Cn%20%20%20%20:root%20%7B%5Cn%20%20%20%20%20%20/*%20Palette:%20Premium%20Dark%20SaaS%20Style%20*/%5Cn%20%20%20%20%20%20--bg-color:%20#0f1115;%5Cn%20%20%20%20%20%20--surface-1:%20#161b22;%5Cn%20%20%20%20%20%20--surface-2:%20#21262d;%5Cn%20%20%20%20%20%20--border:%20#30363d;%5Cn%20%20%20%20%20%20--border-highlight:%20#484f58;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20/*%20Accents%20*/%5Cn%20%20%20%20%20%20--primary:%20#58a6ff;%5Cn%20%20%20%20%20%20--primary-dim:%20rgba(88,%20166,%20255,%200.15);%5Cn%20%20%20%20%20%20--success:%20#3fb950;%5Cn%20%20%20%20%20%20--danger:%20#f85149;%5Cn%20%20%20%20%20%20--text-main:%20#f0f6fc;%5Cn%20%20%20%20%20%20--text-muted:%20#8b949e;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20--radius:%2012px;%5Cn%20%20%20%20%20%20--shadow-sm:%200%201px%202px%20rgba(0,0,0,0.3);%5Cn%20%20%20%20%20%20--shadow-lg:%200%2010px%2030px%20rgba(0,0,0,0.5);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20*%20%7B%20box-sizing:%20border-box;%20-webkit-tap-highlight-color:%20transparent;%20%7D%5Cn%5Cn%20%20%20%20body%20%7B%5Cn%20%20%20%20%20%20margin:%200;%5Cn%20%20%20%20%20%20font-family:%20'Inter',%20sans-serif;%5Cn%20%20%20%20%20%20background-color:%20var(--bg-color);%5Cn%20%20%20%20%20%20color:%20var(--text-main);%5Cn%20%20%20%20%20%20min-height:%20100vh;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20flex-direction:%20column;%5Cn%20%20%20%20%20%20background-image:%20radial-gradient(circle%20at%20top%20center,%20#1b1f27%200%25,%20#0f1115%2060%25);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Header%20---%20*/%5Cn%20%20%20%20header%20%7B%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20padding:%2016px%2024px;%5Cn%20%20%20%20%20%20border-bottom:%201px%20solid%20var(--border);%5Cn%20%20%20%20%20%20background:%20rgba(15,%2017,%2021,%200.8);%5Cn%20%20%20%20%20%20backdrop-filter:%20blur(10px);%5Cn%20%20%20%20%20%20position:%20sticky;%5Cn%20%20%20%20%20%20top:%200;%5Cn%20%20%20%20%20%20z-index:%20100;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.nav-content%20%7B%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20max-width:%20800px;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20justify-content:%20space-between;%5Cn%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.brand%20%7B%5Cn%20%20%20%20%20%20font-weight:%20700;%5Cn%20%20%20%20%20%20font-size:%201.1rem;%5Cn%20%20%20%20%20%20color:%20var(--text-main);%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%20%20gap:%208px;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.brand::before%20%7B%5Cn%20%20%20%20%20%20content:%20'';%5Cn%20%20%20%20%20%20display:%20block;%5Cn%20%20%20%20%20%20width:%2012px;%5Cn%20%20%20%20%20%20height:%2012px;%5Cn%20%20%20%20%20%20background:%20var(--primary);%5Cn%20%20%20%20%20%20border-radius:%2050%25;%5Cn%20%20%20%20%20%20box-shadow:%200%200%2010px%20var(--primary);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Main%20Layout%20---%20*/%5Cn%20%20%20%20main%20%7B%5Cn%20%20%20%20%20%20flex:%201;%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20max-width:%20800px;%5Cn%20%20%20%20%20%20margin:%200%20auto;%5Cn%20%20%20%20%20%20padding:%2024px%2016px;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20flex-direction:%20column;%5Cn%20%20%20%20%20%20gap:%2024px;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Cards%20---%20*/%5Cn%20%20%20%20.card%20%7B%5Cn%20%20%20%20%20%20background:%20var(--surface-1);%5Cn%20%20%20%20%20%20border:%201px%20solid%20var(--border);%5Cn%20%20%20%20%20%20border-radius:%20var(--radius);%5Cn%20%20%20%20%20%20padding:%2020px;%5Cn%20%20%20%20%20%20box-shadow:%20var(--shadow-sm);%5Cn%20%20%20%20%20%20position:%20relative;%5Cn%20%20%20%20%20%20overflow:%20hidden;%5Cn%20%20%20%20%20%20transition:%20transform%200.2s%20ease,%20box-shadow%200.2s%20ease;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.card::before%20%7B%5Cn%20%20%20%20%20%20content:%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20position:%20absolute;%5Cn%20%20%20%20%20%20top:%200;%20left:%200;%20right:%200;%5Cn%20%20%20%20%20%20height:%201px;%5Cn%20%20%20%20%20%20background:%20linear-gradient(90deg,%20transparent,%20var(--border-highlight),%20transparent);%5Cn%20%20%20%20%20%20opacity:%200.5;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.card-header%20%7B%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20justify-content:%20space-between;%5Cn%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%20%20margin-bottom:%2016px;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.label%20%7B%5Cn%20%20%20%20%20%20font-size:%200.75rem;%5Cn%20%20%20%20%20%20text-transform:%20uppercase;%5Cn%20%20%20%20%20%20letter-spacing:%201.2px;%5Cn%20%20%20%20%20%20font-weight:%20600;%5Cn%20%20%20%20%20%20color:%20var(--text-muted);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Music%20Player%20---%20*/%5Cn%20%20%20%20.btn-sm%20%7B%5Cn%20%20%20%20%20%20background:%20var(--surface-2);%5Cn%20%20%20%20%20%20border:%201px%20solid%20var(--border);%5Cn%20%20%20%20%20%20color:%20var(--text-main);%5Cn%20%20%20%20%20%20font-size:%200.75rem;%5Cn%20%20%20%20%20%20padding:%206px%2012px;%5Cn%20%20%20%20%20%20border-radius:%206px;%5Cn%20%20%20%20%20%20cursor:%20pointer;%5Cn%20%20%20%20%20%20font-weight:%20500;%5Cn%20%20%20%20%20%20transition:%20all%200.2s;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.btn-sm:hover%20%7B%5Cn%20%20%20%20%20%20border-color:%20var(--primary);%5Cn%20%20%20%20%20%20color:%20var(--primary);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20iframe%20%7B%20border-radius:%208px;%20background:%20#000;%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Generator%20Output%20---%20*/%5Cn%20%20%20%20.generator-output%20%7B%5Cn%20%20%20%20%20%20min-height:%20180px;%5Cn%20%20%20%20%20%20background:%20var(--surface-1);%5Cn%20%20%20%20%20%20/*%20Subtle%20grid%20pattern%20for%20%5C%22technical%5C%22%20feel%20*/%5Cn%20%20%20%20%20%20background-image:%20linear-gradient(var(--border)%201px,%20transparent%201px),%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20linear-gradient(90deg,%20var(--border)%201px,%20transparent%201px);%5Cn%20%20%20%20%20%20background-size:%2040px%2040px;%5Cn%20%20%20%20%20%20background-position:%20center;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20flex-direction:%20column;%5Cn%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Form%20Elements%20Overrides%20---%20*/%5Cn%20%20%20%20/*%20This%20targets%20elements%20Perchance%20might%20generate%20*/%5Cn%20%20%20%20input,%20select,%20button%20%7B%5Cn%20%20%20%20%20%20font-family:%20'Inter',%20sans-serif%20!important;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20button%20%7B%5Cn%20%20%20%20%20%20cursor:%20pointer;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Game%20Toggle%20---%20*/%5Cn%20%20%20%20.toggle-wrapper%20%7B%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%20%20margin:%2010px%200;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.toggle-btn%20%7B%5Cn%20%20%20%20%20%20background:%20transparent;%5Cn%20%20%20%20%20%20color:%20var(--text-muted);%5Cn%20%20%20%20%20%20border:%201px%20dashed%20var(--border);%5Cn%20%20%20%20%20%20padding:%2012px%2024px;%5Cn%20%20%20%20%20%20border-radius:%2030px;%5Cn%20%20%20%20%20%20font-size:%200.9rem;%5Cn%20%20%20%20%20%20cursor:%20pointer;%5Cn%20%20%20%20%20%20transition:%20all%200.2s;%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20max-width:%20300px;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.toggle-btn:hover%20%7B%5Cn%20%20%20%20%20%20color:%20var(--primary);%5Cn%20%20%20%20%20%20border-color:%20var(--primary);%5Cn%20%20%20%20%20%20background:%20var(--primary-dim);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Game%20UI%20---%20*/%5Cn%20%20%20%20#minigame-container%20%7B%5Cn%20%20%20%20%20%20display:%20none;%5Cn%20%20%20%20%20%20border-color:%20var(--primary);%5Cn%20%20%20%20%20%20box-shadow:%200%200%2020px%20rgba(88,%20166,%20255,%200.05);%5Cn%20%20%20%20%20%20animation:%20slideDown%200.3s%20ease-out;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20@keyframes%20slideDown%20%7B%5Cn%20%20%20%20%20%20from%20%7B%20opacity:%200;%20transform:%20translateY(-10px);%20%7D%5Cn%20%20%20%20%20%20to%20%7B%20opacity:%201;%20transform:%20translateY(0);%20%7D%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.stats-row%20%7B%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20justify-content:%20space-between;%5Cn%20%20%20%20%20%20background:%20var(--surface-2);%5Cn%20%20%20%20%20%20padding:%2010px%2016px;%5Cn%20%20%20%20%20%20border-radius:%208px;%5Cn%20%20%20%20%20%20margin-bottom:%2020px;%5Cn%20%20%20%20%20%20font-size:%200.9rem;%5Cn%20%20%20%20%20%20font-variant-numeric:%20tabular-nums;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20Responsive%20Board%20*/%5Cn%20%20%20%20.board-container%20%7B%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20max-width:%20320px;%5Cn%20%20%20%20%20%20margin:%200%20auto%2020px%20auto;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.board%20%7B%5Cn%20%20%20%20%20%20display:%20grid;%5Cn%20%20%20%20%20%20grid-template-columns:%20repeat(3,%201fr);%5Cn%20%20%20%20%20%20gap:%208px;%5Cn%20%20%20%20%20%20aspect-ratio:%201%20/%201;%20/*%20Keeps%20it%20perfectly%20square%20*/%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.cell%20%7B%5Cn%20%20%20%20%20%20background:%20var(--surface-2);%5Cn%20%20%20%20%20%20border-radius:%208px;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%20%20font-size:%20clamp(24px,%208vw,%2048px);%20/*%20Responsive%20font%20size%20*/%5Cn%20%20%20%20%20%20font-weight:%20600;%5Cn%20%20%20%20%20%20cursor:%20pointer;%5Cn%20%20%20%20%20%20user-select:%20none;%5Cn%20%20%20%20%20%20transition:%20background%200.15s;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.cell:active%20%7B%20background:%20#2a3038;%20%7D%5Cn%20%20%20%20.cell.X%20%7B%20color:%20var(--primary);%20%7D%5Cn%20%20%20%20.cell.O%20%7B%20color:%20var(--danger);%20%7D%5Cn%20%20%20%20.cell.win%20%7B%20background:%20rgba(63,%20185,%2080,%200.2);%20border:%201px%20solid%20var(--success);%20%7D%5Cn%5Cn%20%20%20%20.game-controls%20%7B%5Cn%20%20%20%20%20%20display:%20grid;%5Cn%20%20%20%20%20%20grid-template-columns:%201fr%201fr;%5Cn%20%20%20%20%20%20gap:%2010px;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20@media%20(min-width:%20600px)%20%7B%5Cn%20%20%20%20%20%20.game-controls%20%7B%20grid-template-columns:%202fr%201fr%201fr;%20%7D%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.control-select%20%7B%5Cn%20%20%20%20%20%20background:%20var(--surface-2);%5Cn%20%20%20%20%20%20color:%20var(--text-main);%5Cn%20%20%20%20%20%20border:%201px%20solid%20var(--border);%5Cn%20%20%20%20%20%20padding:%2010px;%5Cn%20%20%20%20%20%20border-radius:%206px;%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.control-btn%20%7B%5Cn%20%20%20%20%20%20background:%20var(--surface-2);%5Cn%20%20%20%20%20%20color:%20var(--text-main);%5Cn%20%20%20%20%20%20border:%201px%20solid%20var(--border);%5Cn%20%20%20%20%20%20padding:%2010px;%5Cn%20%20%20%20%20%20border-radius:%206px;%5Cn%20%20%20%20%20%20font-weight:%20500;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20.control-btn:hover%20%7B%20background:%20#2a3038;%20%7D%5Cn%5Cn%20%20%20%20/*%20---%20Footer%20---%20*/%5Cn%20%20%20%20footer%20%7B%5Cn%20%20%20%20%20%20text-align:%20center;%5Cn%20%20%20%20%20%20padding:%2030px%2020px;%5Cn%20%20%20%20%20%20border-top:%201px%20solid%20var(--border);%5Cn%20%20%20%20%20%20margin-top:%20auto;%5Cn%20%20%20%20%20%20color:%20var(--text-muted);%5Cn%20%20%20%20%20%20font-size:%200.8rem;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20footer%20a%20%7B%20color:%20var(--text-main);%20text-decoration:%20none;%20opacity:%200.8;%20%7D%5Cn%20%20%20%20footer%20a:hover%20%7B%20opacity:%201;%20text-decoration:%20underline;%20%7D%5Cn%5Cn%20%20%3C/style%3E%5Cn%3C/head%3E%5Cn%3Cbody%3E%5Cn%5Cn%20%20%3Cheader%3E%5Cn%20%20%20%20%3Cdiv%20class=%5C%22nav-content%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22brand%5C%22%3EViperZed%20Workspace%3C/div%3E%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22label%5C%22%20id=%5C%22clock%5C%22%3E00:00%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%3C/header%3E%5Cn%5Cn%20%20%3Cmain%3E%5Cn%20%20%20%20%5Cn%20%20%20%20%3Csection%20class=%5C%22card%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22card-header%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cspan%20class=%5C%22label%5C%22%3EAudio%20Stream%3C/span%3E%5Cn%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22btn-sm%5C%22%20onclick=%5C%22playNext()%5C%22%3ESkip%20Track%3C/button%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%3Ciframe%20id=%5C%22soundcloud-widget%5C%22%20width=%5C%22100%25%5C%22%20height=%5C%2280%5C%22%20scrolling=%5C%22no%5C%22%20frameborder=%5C%22no%5C%22%20allow=%5C%22autoplay%5C%22%20style=%5C%22opacity:%200.8;%5C%22%3E%3C/iframe%3E%5Cn%20%20%20%20%3C/section%3E%5Cn%5Cn%20%20%20%20%3Csection%20class=%5C%22card%20generator-output%5C%22%3E%5Cn%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22card-header%5C%22%20style=%5C%22position:absolute;%20top:20px;%20left:20px;%20right:20px;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class=%5C%22label%5C%22%3EGenerator%20Output%3C/span%3E%5Cn%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22padding:%2030px%2010px;%20text-align:%20center;%20width:%20100%25;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%5BgenerateHTML(settings)%5D%5Cn%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/section%3E%5Cn%5Cn%20%20%20%20%3Cdiv%20class=%5C%22toggle-wrapper%5C%22%3E%5Cn%20%20%20%20%20%20%3Cbutton%20id=%5C%22toggleButton%5C%22%20class=%5C%22toggle-btn%5C%22%20onclick=%5C%22toggleGame()%5C%22%3EOpen%20Tic-Tac-Toe%3C/button%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%5Cn%20%20%20%20%3Csection%20id=%5C%22minigame-container%5C%22%20class=%5C%22card%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22card-header%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cspan%20class=%5C%22label%5C%22%20style=%5C%22color:%20var(--primary);%5C%22%3ESystem%20Game%3C/span%3E%5Cn%20%20%20%20%20%20%20%20%3Cspan%20id=%5C%22result%5C%22%20style=%5C%22font-weight:600;%20color:%20var(--text-main);%5C%22%3E%3C/span%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22stats-row%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cspan%3EPlayer%20(X):%20%3Cstrong%20id=%5C%22player-score%5C%22%20style=%5C%22color:var(--text-main)%5C%22%3E0%3C/strong%3E%3C/span%3E%5Cn%20%20%20%20%20%20%20%20%3Cspan%3EBot%20(O):%20%3Cstrong%20id=%5C%22bot-score%5C%22%20style=%5C%22color:var(--text-main)%5C%22%3E0%3C/strong%3E%3C/span%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22board-container%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22board%5C%22%20onclick=%5C%22handleCellClick(event)%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%220%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%221%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%222%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%223%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%224%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%225%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%226%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%227%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22cell%5C%22%20data-index=%5C%228%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22game-controls%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cselect%20id=%5C%22difficulty%5C%22%20class=%5C%22control-select%5C%22%20onchange=%5C%22changeDifficulty()%5C%22%20style=%5C%22grid-column:%20span%202;%20@media(min-width:600px)%7Bgrid-column:%20auto;%7D%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Coption%20value=%5C%22easy%5C%22%3EDifficulty:%20Easy%3C/option%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Coption%20value=%5C%22medium%5C%22%3EDifficulty:%20Balanced%3C/option%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Coption%20value=%5C%22unbeatable%5C%22%3EDifficulty:%20Impossible%3C/option%3E%5Cn%20%20%20%20%20%20%20%20%3C/select%3E%5Cn%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22control-btn%5C%22%20onclick=%5C%22PA()%5C%22%3EReset%20Board%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22control-btn%5C%22%20onclick=%5C%22RB()%5C%22%3EReset%20Stats%3C/button%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/section%3E%5Cn%5Cn%20%20%3C/main%3E%5Cn%5Cn%20%20%3Cfooter%3E%5Cn%20%20%20%20%3Cdiv%20style=%5C%22margin-bottom:%208px;%5C%22%3ECreated%20by%20%3Ca%20href=%5C%22https://perchance.org/loody%5C%22%20target=%5C%22_blank%5C%22%3ELoody%3C/a%3E%3C/div%3E%5Cn%20%20%20%20%3Cdiv%20style=%5C%22opacity:%200.5;%5C%22%3E&copy;%202024%20All%20Rights%20Reserved%3C/div%3E%5Cn%20%20%3C/footer%3E%5Cn%5Cn%3Cscript%3E%5Cn//%20---%20Clock%20---%5Cnfunction%20updateClock()%20%7B%5Cn%20%20%20%20const%20now%20=%20new%20Date();%5Cn%20%20%20%20document.getElementById('clock').textContent%20=%20now.toLocaleTimeString(%5B%5D,%20%7B%20hour:%20'2-digit',%20minute:%20'2-digit'%20%7D);%5Cn%7D%5CnsetInterval(updateClock,%201000);%5CnupdateClock();%5Cn%5Cn//%20---%20Music%20Player%20Logic%20---%5Cnconst%20trackUrls%20=%20%5B%5Cn%20%20'https://soundcloud.com/danyal-ali-226531257/ya-lalali-kawtar',%5Cn%20%20'https://soundcloud.com/rdgjuicewrld/like-a-drug-feat-xxxtentacion',%5Cn%20%20'https://soundcloud.com/w44ljy8m33xg/idea-22-gibran-alcocer-slowed',%5Cn%20%20'https://soundcloud.com/user-584205287/dark-snowy-night-daniel-mp3',%5Cn%20%20'https://soundcloud.com/nocopyrightsounds/clarx-laney-forever-finally-ends-ncs-release',%5Cn%20%20'https://soundcloud.com/corpse_husband/e-girls-are-ruining-my-life-w-savage-gap',%5Cn%20%20'https://soundcloud.com/darklabmusics/teya-dora-dzanum'%5Cn%5D;%5Cnlet%20currentTrackIndex%20=%20-1;%5Cn%5Cnfunction%20playNext()%20%7B%5Cn%20%20currentTrackIndex%20=%20(currentTrackIndex%20+%201)%20%25%20trackUrls.length;%5Cn%20%20const%20widget%20=%20document.getElementById('soundcloud-widget');%5Cn%20%20//%20Visual=false%20makes%20the%20player%20shorter%20and%20cleaner%5Cn%20%20widget.src%20=%20%60https://w.soundcloud.com/player/?url=$%7BencodeURIComponent(trackUrls%5BcurrentTrackIndex%5D)%7D&auto_play=true&visual=false&show_artwork=true&color=%252358a6ff%60;%5Cn%7D%5Cn%5Cn//%20---%20Toggle%20Minigame%20---%5Cnfunction%20toggleGame()%20%7B%5Cn%20%20const%20container%20=%20document.getElementById(%5C%22minigame-container%5C%22);%5Cn%20%20const%20btn%20=%20document.getElementById(%5C%22toggleButton%5C%22);%5Cn%20%20if%20(container.style.display%20===%20%5C%22block%5C%22)%20%7B%5Cn%20%20%20%20container.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20btn.textContent%20=%20%5C%22Open%20Tic-Tac-Toe%5C%22;%5Cn%20%20%20%20btn.style.borderStyle%20=%20%5C%22dashed%5C%22;%5Cn%20%20%20%20btn.style.background%20=%20%5C%22transparent%5C%22;%5Cn%20%20%20%20btn.style.color%20=%20%5C%22var(--text-muted)%5C%22;%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20container.style.display%20=%20%5C%22block%5C%22;%5Cn%20%20%20%20btn.textContent%20=%20%5C%22Close%20Game%5C%22;%5Cn%20%20%20%20btn.style.borderStyle%20=%20%5C%22solid%5C%22;%5Cn%20%20%20%20btn.style.background%20=%20%5C%22var(--surface-2)%5C%22;%5Cn%20%20%20%20btn.style.color%20=%20%5C%22var(--text-main)%5C%22;%5Cn%20%20%20%20%5Cn%20%20%20%20//%20Auto%20scroll%20to%20game%5Cn%20%20%20%20setTimeout(()%20=%3E%20container.scrollIntoView(%7B%20behavior:%20'smooth',%20block:%20'center'%20%7D),%20100);%5Cn%20%20%7D%5Cn%7D%5Cn%5Cn//%20---%20Tic%20Tac%20Toe%20Logic%20---%5Cnlet%20board%20=%20%5B%5C%22%5C%22,%20%5C%22%5C%22,%20%5C%22%5C%22,%20%5C%22%5C%22,%20%5C%22%5C%22,%20%5C%22%5C%22,%20%5C%22%5C%22,%20%5C%22%5C%22,%20%5C%22%5C%22%5D;%5Cnlet%20currentPlayer%20=%20%5C%22X%5C%22;%5Cnlet%20gameActive%20=%20true;%5Cnlet%20playerScore%20=%200;%5Cnlet%20botScore%20=%200;%5Cnlet%20difficulty%20=%20%5C%22easy%5C%22;%5Cnconst%20resultElement%20=%20document.getElementById(%5C%22result%5C%22);%5Cn%5Cnfunction%20handleCellClick(event)%20%7B%5Cn%20%20if%20(!gameActive)%20return;%5Cn%20%20const%20cell%20=%20event.target;%5Cn%20%20const%20index%20=%20parseInt(cell.dataset.index);%5Cn%20%20if%20(board%5Bindex%5D%20===%20%5C%22%5C%22%20&&%20!isNaN(index))%20%7B%5Cn%20%20%20%20makeMove(index,%20currentPlayer);%5Cn%20%20%7D%5Cn%7D%5Cn%5Cnfunction%20makeMove(index,%20player)%20%7B%5Cn%20%20%20%20board%5Bindex%5D%20=%20player;%5Cn%20%20%20%20const%20cell%20=%20document.querySelector(%60.cell%5Bdata-index=%5C%22$%7Bindex%7D%5C%22%5D%60);%5Cn%20%20%20%20cell.textContent%20=%20player;%5Cn%20%20%20%20cell.classList.add(player);%5Cn%20%20%20%20%5Cn%20%20%20%20if%20(checkWinner(board,%20player))%20%7B%5Cn%20%20%20%20%20%20%20%20resultElement.textContent%20=%20player%20===%20%5C%22X%5C%22%20?%20%5C%22Victory%5C%22%20:%20%5C%22Defeat%5C%22;%5Cn%20%20%20%20%20%20%20%20resultElement.style.color%20=%20player%20===%20%5C%22X%5C%22%20?%20%5C%22var(--success)%5C%22%20:%20%5C%22var(--danger)%5C%22;%5Cn%20%20%20%20%20%20%20%20highlightWin(player);%5Cn%20%20%20%20%20%20%20%20updateScores(player);%5Cn%20%20%20%20%20%20%20%20gameActive%20=%20false;%5Cn%20%20%20%20%7D%20else%20if%20(board.every(c%20=%3E%20c%20!==%20%5C%22%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20resultElement.textContent%20=%20%5C%22Draw%5C%22;%5Cn%20%20%20%20%20%20%20%20resultElement.style.color%20=%20%5C%22var(--text-muted)%5C%22;%5Cn%20%20%20%20%20%20%20%20gameActive%20=%20false;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20currentPlayer%20=%20(currentPlayer%20===%20%5C%22X%5C%22)%20?%20%5C%22O%5C%22%20:%20%5C%22X%5C%22;%5Cn%20%20%20%20%20%20%20%20if%20(currentPlayer%20===%20%5C%22O%5C%22)%20setTimeout(makeBotMove,%20200);%20%5Cn%20%20%20%20%7D%5Cn%7D%5Cn%5Cnfunction%20makeBotMove()%20%7B%5Cn%20%20%20%20let%20move;%5Cn%20%20%20%20if%20(difficulty%20===%20%5C%22easy%5C%22)%20move%20=%20getRandomMove();%5Cn%20%20%20%20else%20if%20(difficulty%20===%20%5C%22medium%5C%22)%20move%20=%20getMediumMove();%5Cn%20%20%20%20else%20move%20=%20getUnbeatableMove();%5Cn%20%20%20%20%5Cn%20%20%20%20if%20(move%20!==%20null)%20makeMove(move,%20%5C%22O%5C%22);%5Cn%7D%5Cn%5Cnfunction%20getRandomMove()%20%7B%5Cn%20%20%20%20let%20empty%20=%20board.map((v,%20i)%20=%3E%20v%20===%20%5C%22%5C%22%20?%20i%20:%20null).filter(v%20=%3E%20v%20!==%20null);%5Cn%20%20%20%20return%20empty%5BMath.floor(Math.random()%20*%20empty.length)%5D;%5Cn%7D%5Cn%5Cnfunction%20getMediumMove()%20%7B%5Cn%20%20%20%20//%20Try%20to%20win%5Cn%20%20%20%20for%20(let%20i%20=%200;%20i%20%3C%209;%20i++)%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(board%5Bi%5D%20==%20%5C%22%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22O%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(checkWinner(board,%20%5C%22O%5C%22))%20%7B%20board%5Bi%5D%20=%20%5C%22%5C%22;%20return%20i;%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20//%20Block%20player%5Cn%20%20%20%20for%20(let%20i%20=%200;%20i%20%3C%209;%20i++)%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(board%5Bi%5D%20==%20%5C%22%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22X%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(checkWinner(board,%20%5C%22X%5C%22))%20%7B%20board%5Bi%5D%20=%20%5C%22%5C%22;%20return%20i;%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20return%20getRandomMove();%5Cn%7D%5Cn%5Cnfunction%20getUnbeatableMove()%20%7B%5Cn%20%20%20%20let%20bestScore%20=%20-Infinity;%5Cn%20%20%20%20let%20move%20=%20null;%5Cn%20%20%20%20for(let%20i=0;%20i%3C9;%20i++)%7B%5Cn%20%20%20%20%20%20%20%20if(board%5Bi%5D%20===%20%5C%22%5C%22)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22O%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20score%20=%20minimax(board,%200,%20false);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(score%20%3E%20bestScore)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bestScore%20=%20score;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20move%20=%20i;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20return%20move;%5Cn%7D%5Cn%5Cnfunction%20minimax(board,%20depth,%20isMaximizing)%20%7B%5Cn%20%20%20%20if(checkWinner(board,%20%5C%22O%5C%22))%20return%201;%5Cn%20%20%20%20if(checkWinner(board,%20%5C%22X%5C%22))%20return%20-1;%5Cn%20%20%20%20if(board.every(c%20=%3E%20c%20!==%20%5C%22%5C%22))%20return%200;%5Cn%20%20%20%20%5Cn%20%20%20%20if(isMaximizing)%7B%5Cn%20%20%20%20%20%20%20%20let%20bestScore%20=%20-Infinity;%5Cn%20%20%20%20%20%20%20%20for(let%20i=0;%20i%3C9;%20i++)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(board%5Bi%5D%20===%20%5C%22%5C%22)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22O%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bestScore%20=%20Math.max(bestScore,%20minimax(board,%20depth+1,%20false));%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20return%20bestScore;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20let%20bestScore%20=%20Infinity;%5Cn%20%20%20%20%20%20%20%20for(let%20i=0;%20i%3C9;%20i++)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(board%5Bi%5D%20===%20%5C%22%5C%22)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22X%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20bestScore%20=%20Math.min(bestScore,%20minimax(board,%20depth+1,%20true));%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bi%5D%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20return%20bestScore;%5Cn%20%20%20%20%7D%5Cn%7D%5Cn%5Cnfunction%20checkWinner(b,%20p)%20%7B%5Cn%20%20%20%20const%20wins%20=%20%5B%5B0,1,2%5D,%5B3,4,5%5D,%5B6,7,8%5D,%5B0,3,6%5D,%5B1,4,7%5D,%5B2,5,8%5D,%5B0,4,8%5D,%5B2,4,6%5D%5D;%5Cn%20%20%20%20return%20wins.some(w%20=%3E%20b%5Bw%5B0%5D%5D%20===%20p%20&&%20b%5Bw%5B1%5D%5D%20===%20p%20&&%20b%5Bw%5B2%5D%5D%20===%20p);%5Cn%7D%5Cn%5Cnfunction%20highlightWin(player)%20%7B%5Cn%20%20%20%20const%20wins%20=%20%5B%5B0,1,2%5D,%5B3,4,5%5D,%5B6,7,8%5D,%5B0,3,6%5D,%5B1,4,7%5D,%5B2,5,8%5D,%5B0,4,8%5D,%5B2,4,6%5D%5D;%5Cn%20%20%20%20wins.forEach(w%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if(board%5Bw%5B0%5D%5D%20===%20player%20&&%20board%5Bw%5B1%5D%5D%20===%20player%20&&%20board%5Bw%5B2%5D%5D%20===%20player)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20w.forEach(i%20=%3E%20document.querySelector(%60.cell%5Bdata-index=%5C%22$%7Bi%7D%5C%22%5D%60).classList.add('win'));%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%7D%5Cn%5Cnfunction%20updateScores(winner)%20%7B%5Cn%20%20%20%20if(winner%20===%20%5C%22X%5C%22)%20playerScore++;%20else%20botScore++;%5Cn%20%20%20%20document.getElementById(%5C%22player-score%5C%22).textContent%20=%20playerScore;%5Cn%20%20%20%20document.getElementById(%5C%22bot-score%5C%22).textContent%20=%20botScore;%5Cn%7D%5Cn%5Cnfunction%20PA()%20%7B%5Cn%20%20%20%20board.fill(%5C%22%5C%22);%5Cn%20%20%20%20gameActive%20=%20true;%5Cn%20%20%20%20currentPlayer%20=%20%5C%22X%5C%22;%5Cn%20%20%20%20resultElement.textContent%20=%20%5C%22%5C%22;%5Cn%20%20%20%20document.querySelectorAll(%5C%22.cell%5C%22).forEach(c%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20c.textContent%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20c.className%20=%20%5C%22cell%5C%22;%5Cn%20%20%20%20%20%20%20%20c.classList.remove(%5C%22X%5C%22,%20%5C%22O%5C%22,%20%5C%22win%5C%22);%5Cn%20%20%20%20%7D);%5Cn%7D%5Cn%5Cnfunction%20RB()%20%7B%5Cn%20%20%20%20playerScore%20=%200;%5Cn%20%20%20%20botScore%20=%200;%5Cn%20%20%20%20document.getElementById(%5C%22player-score%5C%22).textContent%20=%200;%5Cn%20%20%20%20document.getElementById(%5C%22bot-score%5C%22).textContent%20=%200;%5Cn%20%20%20%20PA();%5Cn%7D%5Cnfunction%20changeDifficulty()%20%7B%20difficulty%20=%20document.getElementById(%5C%22difficulty%5C%22).value;%20PA();%20%7D%5Cn%3C/script%3E%5Cn%3C/body%3E%5Cn%3C/html%3E%22,%22imports%22:%5B%22random-integer-plugin%22,%22t2i-framework-plugin-v2%22%5D,%22isPrivate%22:false%7D</script> <script id="imported-generators" type="notjs">%5B%7B%22name%22:%22random-integer-plugin%22,%22modelText%22:%22//%20not%20that%20%60from%60%20could%20be%20larger%20than%20%60to%60%20-%20and%20that's%20fine%20-%20the%20math%20works%20out.%5Cn$output(from,%20to)%20=%3E%5Cn%5Ctlet%20start%20=%20from;%5Cn%5Ctlet%20range%20=%20to-from;%20%5Cn%20%20return%20Math.round(start)%20+%20Math.round(%20Math.random()*range%20);%5Cn%5Cn//%20these%20are%20just%20used%20for%20the%20examples%20in%20the%20HTML%20panel%5Cnsmall%20=%20%7B10-20%7D%5Cnbig%20=%20%7B50-100%7D%22,%22imports%22:%5B%5D,%22lastEditTime%22:1613508215458,%22found%22:true%7D,%7B%22name%22:%22t2i-framework-plugin-v2%22,%22modelText%22:%22//%20overall,%20this%20version%20(v2)%20moves%20toward%20the%20approach%20of%20constructing%20prompts%20within%20the%20artStyle%20list,%20such%20that%20you%20can%20e.g.%20place%20user%20inputs%20within%20a%20prompt%20multiple%20times,%20and%20have%20prompt%20construction%20completely%20depend%20on%20the%20art%20style%5Cn%5Cn//%20NOTE:%20the%20notes%20below%20are%20old/outdated.%20lots%20of%20other%20changes%20that%20aren't%20listed%20here.%5Cn%5Cn//%20changes%20(note%20that%20some%20of%20the%20non-breaking%20ones%20were%20back-ported%20to%20v1):%5Cn//%20%20-%20%5Bbreaking%5D%20all%20userInputs%20are%20now%20under%20a%20single%20%60input%60%20global%20variable%20-%20so%20%5Binput.description%5D%20instead%20of%20polluting%20global%20namespace%20with%20%5Bdescription%5D%5Cn//%20%20-%20%5Bbreaking%5D%20no%20more%20_optionName%20for%20%3Cselect%3E%20inputs%20-%20use%20%5Binput.artStyle.getName%5D%20instead%20of%20%5BartStyle_optionName%5D%5Cn//%20%20-%20%5Bbreaking%5D%20no%20more%20'append'/'prepend'%20options%20-%20not%20necessary%20now%20that%20we%20move%20to%20constructing%20prompts%20within%20the%20artStyle%20list%5Cn//%20%20-%20%60remember=true%60%20for%20user%20input%20specs,%20which%20remembers%20values%20even%20after%20page%20reload%5Cn//%20%20-%20multiple%20chat%20channels%5Cn//%20%20-%20html%20select/input%20element%20value%20is%20exposed%20on%20on%20the%20settings.userInputs.foo%20object%5Cn//%20%20-%20%60takesUpFullRow=true%60%20to%20make%20an%20input%20take%20up%20a%20full%20row%5Cn//%20%20-%20%60visible%60%20function%20property%20for%20each%20user%20input%20which%20is%20called%20after%20every%20input%20event%20and%20'generate'%20button%20click%20to%20determine%20whether%20that%20input%20should%20be%20visible%5Cn//%20%20-%20%60localStorage.generateClickCount%60%20tracks%20how%20many%20times%20the%20user%20has%20clicked%20the%20generate%20button%20%5Cn//%20%20-%20a%20lot%20of%20other%20stuff%5Cn%5Cn//%20todo,%20maybe:%5Cn//%20%20-%20%60autoSuggest=true%60%20for%20a%20text%20area%20input%20to%20get%20AI-generated%20completions%20a%20full%20prompt%20suggestions/ideas%20based%20on%20what%20the%20user%20has%20typed%20so%20far%5Cn//%20%20-%20new%20'visual'%20mode%20for%20select%20type%20-%20just%20add%20_image%20sub%20property%20(with%20url)%20to%20your%20options.%20for%20the%20artStyle%20list,%20each%20image%20could%20be%20a%20row%20of%20several%20images%20made%20with%20that%20style%5Cn//%20%20-%20add%20onChange,%20onInput,%20etc.%20to%20the%20user%20input%20objects/nodes%20-%20this%20allows%20e.g.%20changing%20a%20%3Cselect%3E%20option%20based%20on%20what%20the%20user%20types%20into%20an%20%3Cinput%3E%20option%5Cn%5Cn//%20notes:%5Cn//%20%20-%20default%20styles:%20https://perchance.org/t2i-styles#edit%5Cn//%20%20-%20image%20grid%20maker:%20https://perchance.org/image-grid-maker#edit%5Cn//%20%20%5Cn%5CntextToImagePlugin%20=%20%7Bimport:text-to-image-plugin%7D%5CncommentsPlugin%20=%20%7Bimport:comments-plugin%7D%5CnselectLeaf%20=%20%7Bimport:select-leaf-plugin%7D%5CnfullscreenButton%20=%20%7Bimport:fullscreen-button-plugin%7D%5CnaiText%20=%20%7Bimport:ai-text-plugin%7D%5Cnupload%20=%20%7Bimport:upload-plugin%7D%5Cnprompt2%20=%20%7Bimport:prompt2-plugin%7D%5Cnt2iStyles%20=%20%7Bimport:t2i-styles%7D%20//%20this%20wasn't%20originally%20an%20%5C%22official%5C%22%20part%20of%20this%20framework,%20but%20it%20is%20now%20because%20i'm%20using%20it%20for%20the%20character%20chat%20feature%20under%20the%20condition%20that%20there's%20an%20artStyle%20user%20input%20specified%5CntabbedCommentsPlugin%20=%20%7Bimport:tabbed-comments-plugin-v1%7D%5CncreateMediaGalleryPlugin%20=%20%7Bimport:create-media-gallery-plugin%7D%5Cn%5Cn//%20This%20$output%20function%20simply%20takes%20a%20%60settings%60%20list/hierarchy%20as%20an%20input,%20and%20returns%20the%20full%20HTML%20for%20the%20page%5Cn%5Cn$output(settings)%20=%3E%5Cn%20%20if(!window.input)%20window.input%20=%20%7B%7D;%5Cn%20%20if(!window.t2i)%20%7B%5Cn%20%20%20%20window.t2i%20=%20%7B%7D;%5Cn%20%20%20%20window.t2i.defaultText%20=%20%7B%5Cn%20%20%20%20%20%20promptTip:%20%60Tip:%20You%20can%20write%20text%20like%20&lcub;blue%7Cred%7Cgreen&rcub;%20and%20a%20random%20one%20will%20be%20chosen%20for%20each%20image.%5C%5Cn%5C%5CnClick%20the%20info%20icon%20on%20an%20image%20to%20see%20the%20prompt%20that%20was%20used.%5C%5Cn%5C%5CnAdd%20brackets%20around%20text%20(like%20this)%20or%20((even%20more))%20to%20get%20the%20AI%20to%20pay%20more%20attention%20to%20it.%60,%5Cn%20%20%20%20%20%20negativePromptTip:%20%60Important:%20If,%20for%20example,%20you%20don't%20want%20the%20image%20to%20have%20blue%20in%20it,%20just%20write%20%5C%22blue%5C%22%20in%20this%20box.%20Don't%20write%20%5C%22no%20blue%5C%22!%20In%20other%20words,%20you%20should%20write%20a%20description%20of%20a%20hypothetical%20%5C%22opposite%20image%5C%22%20of%20what%20you%20want.%60,%5Cn%20%20%20%20%20%20scratchpadTip:%20%60A%20little%20notepad%20for%20you%20to%20keep%20good%20prompts%20and%20stuff.%20It%20'remembers'%20the%20text%20that%20you%20put%20in%20it%20even%20after%20you%20refresh/close%20this%20page.%5C%5Cn%5C%5CnThe%20text%20will%20only%20be%20forgotten%20if%20you%20clear%20your%20browser's%20%5C%22site%20data%5C%22%20(cookies,%20localStorage,%20etc.)%20for%20perchance.org%60,%5Cn%20%20%20%20%20%20scratchpadPlaceholder:%20%60Use%20this%20box%20to%20store%20prompts%20and%20notes.%20They'll%20be%20remembered%20even%20if%20you%20refresh%20this%20page%20(unless%20you%20are%20in%20private%20browsing%20mode).%20Also,%20you%20can%20write:%5C%5Cn%5C%5CnANIMAL%20=%20&lcub;dog%7Cmouse%7Cfrog&rcub;%5C%5Cn%5C%5Cnin%20this%20box,%20and%20then%20write%20'&lsqb;ANIMAL&rsqb;'%20within%20your%20description%20(including%20the%20square%20brackets)%20to%20get%20a%20random%20one%20of%20those%20animals%20for%20each%20generated%20image.%20And%20you%20can%20replace%20the%20%F0%9F%8E%B2%20button's%20outputs%20by%20adding%20a%20DESCRIPTION%20line%20to%20this%20text%20box,%20like%20this:%5C%5Cn%5C%5CnDESCRIPTION%20=%20a%20very%20&lcub;silly%7Ccurious&rcub;%20&lsqb;ANIMAL&rsqb;%60,%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20window.t2i.handyText%20=%20window.t2i.defaultText;%20//%20'handyText'%20was%20the%20old%20name%5Cn%20%20%7D%5Cn%5Cn%20%20//%20Add%20some%20default%20settings%20(it's%20okay%20to%20write%20directly%20to%20the%20input%20parameter,%20because%20it's%20only%20used%20once%20-%20i.e.%20this%20function%20is%20only%20called%20once)%5Cn%20%20if(!settings.imageOptions.style)%20%7B%5Cn%20%20%20%20settings.imageOptions.style%20=%20%5C%22border-radius:3px;%5C%22;%5Cn%20%20%7D%5Cn%5Cn%20%20//%20We%20need%20to%20make%20these%20global%20since%20we%20wnat%20to%20reference%20them%20from%20the%20HTML%20of%20the%20*importing*%20generator%20(e.g.%20in%20click%20handlers,%20etc.)%5Cn%20%20window.___textToImagePlugin746291937%20=%20textToImagePlugin;%5Cn%20%20window.___commentsPlugin746291937%20=%20commentsPlugin;%5Cn%20%20window.___userSettings746291937%20=%20settings;%5Cn%20%20window.___fullscreenButton893479%20=%20fullscreenButton;%5Cn%5Cn//%20%20%20let%20appState;%5Cn//%20%20%20try%20%7B%5Cn//%20%20%20%20%20appState%20=%20JSON.parse(localStorage.appState_nif983gh4tkshdf79834hi);%5Cn//%20%20%20%7D%20catch(e)%20%7B%5Cn//%20%20%20%20%20appState%20=%20%7B%7D;%5Cn//%20%20%20%7D%5Cn%20%20%5Cn//%20%20%20function%20saveAppState()%20%7B%5Cn//%20%20%20%20%20localStorage.appState_nif983gh4tkshdf79834hi%20=%20JSON.stringify(appState);%5Cn//%20%20%20%7D%5Cn%5Cn%5Cn%20%20if(!window.alreadyAddedT2IStuff83927492374)%20%7B%20//%20this%20$output%20function%20will%20only%20get%20called%20once,%20*except*%20when%20author%20is%20editing%20their%20generator,%20so%20this%20if%20statement/wrapper%20thing%20is%20just%20to%20prevent%20weird%20stuff%20for%20generator%20authors%5Cn%20%20%20%20//%20hide%20some%20clutter%20when%20in%20fullscreen:%5Cn%20%20%20%20document.addEventListener(%5C%22fullscreenchange%5C%22,%20function(e)%20%7B%5Cn%20%20%20%20%20%20let%20fbBtn%20=%20feedbackBtn893745ykfuhd;%5Cn%20%20%20%20%20%20let%20dmBtn%20=%20darkModeBtn_875979f948;%5Cn%20%20%20%20%20%20if(document.fullscreenElement)%20%7B%5Cn%20%20%20%20%20%20%20%20//%20we%20just%20entered%20fullscreen%5Cn%20%20%20%20%20%20%20%20dmBtn.dataset.preFullscreenDisplayValue%20=%20dmBtn.style.display;%5Cn%20%20%20%20%20%20%20%20dmBtn.dataset.duringFullscreenDisplayValue%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20dmBtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20fbBtn.dataset.preFullscreenDisplayValue%20=%20fbBtn.style.display;%5Cn%20%20%20%20%20%20%20%20fbBtn.dataset.duringFullscreenDisplayValue%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20fbBtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20//%20we%20just%20exited%20fullscreen,%20so%20we%20revert%20the%20display%20values%20*if*%20they're%20the%20same%20as%20what%20we%20set%20them%20to%20when%20we%20entered%20fullscreen%20(so%20we%20don't%20interfere%20with%20other%20code%20that%20may%20have%20since%20changed%20the%20display%20values)%5Cn%20%20%20%20%20%20%20%20if(dmBtn.style.display%20===%20dmBtn.dataset.duringFullscreenDisplayValue)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20dmBtn.style.display%20=%20dmBtn.dataset.preFullscreenDisplayValue;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20delete%20dmBtn.dataset.preFullscreenDisplayValue;%5Cn%20%20%20%20%20%20%20%20delete%20dmBtn.dataset.duringFullscreenDisplayValue;%5Cn%20%20%20%20%20%20%20%20if(fbBtn.style.display%20===%20fbBtn.dataset.duringFullscreenDisplayValue)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20fbBtn.style.display%20=%20fbBtn.dataset.preFullscreenDisplayValue;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20delete%20fbBtn.dataset.preFullscreenDisplayValue;%5Cn%20%20%20%20%20%20%20%20delete%20fbBtn.dataset.duringFullscreenDisplayValue;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20window.alreadyAddedT2IStuff83927492374%20=%20true;%5Cn%20%20%7D%5Cn%5Cn%20%20window.__createSelectorModal_56974639274%20=%20async%20function(options)%20%7B%20//%20use%20it%20like%20this:%20await%20createSelectorModal(%5B%7Bhtml:%5C%22foo%5C%22,%20value:%5C%22foo%5C%22%7D,%20%7Bhtml:%5C%22bar%5C%22,%20value:%5C%22bar%5C%22%7D%5D)%5Cn%20%20%20%20let%20resolve;%5Cn%20%20%20%20let%20promise%20=%20new%20Promise(r%20=%3E%20resolve%20=%20r);%5Cn%5Cn%20%20%20%20let%20ctn%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20let%20modal%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20ctn.style.cssText%20=%20%60position:fixed;%20top:0;%20left:0;%20width:100%25;%20height:100%25;%20background:rgba(0,0,0,0.3);%20backdrop-filter:%20blur(5px);%20display:flex;%20align-items:center;%20justify-content:center;%60;%5Cn%20%20%20%20modal.style.cssText%20=%20%60max-width:900px;%20width:95%25;%20max-height:95%25;%20background:var(--box-color);%20box-shadow:0%200%2010px%20rgba(0,0,0,0.5);%20overflow:auto;%60;%5Cn%5Cn%20%20%20%20options.forEach(opt%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20item%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20item.innerHTML%20=%20opt.html;%5Cn%20%20%20%20%20%20item.style.cssText%20=%20%60margin:0.5rem;%20border:3px%20solid%20$%7Bopt.selected%20?%20%5C%22#565656%5C%22%20:%20%5C%22rgba(0,0,0,0)%5C%22%7D;%20cursor:pointer;%60;%5Cn%20%20%20%20%20%20if(!opt.disabled)%20%7B%5Cn%20%20%20%20%20%20%20%20item.onmouseover%20=%20()%20=%3E%20item.style.border%20=%20%5C%223px%20dashed%20#8a8a8a%5C%22;%5Cn%20%20%20%20%20%20%20%20item.onmouseout%20=%20()%20=%3E%20item.style.border%20=%20opt.selected%20?%20%5C%223px%20solid%20#565656%5C%22%20:%20%5C%223px%20solid%20rgba(0,0,0,0)%5C%22;%5Cn%20%20%20%20%20%20%20%20item.onclick%20=%20()%20=%3E%20resolve(opt.value);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20modal.appendChild(item);%5Cn%20%20%20%20%7D);%5Cn%5Cn%20%20%20%20ctn.onclick%20=%20(e)%20=%3E%20%7B%5Cn%20%20%20%20%20%20if(e.target%20===%20ctn)%20resolve(null);%20//%20returns%20null%20if%20the%20user%20didn't%20select%20an%20option%20(i.e.%20they%20clicked%20somewhere%20outside%20the%20popup)%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20ctn.appendChild(modal);%5Cn%20%20%20%20document.body.append(ctn);%5Cn%5Cn%20%20%20%20let%20value%20=%20await%20promise;%5Cn%20%20%20%20ctn.remove();%5Cn%20%20%20%20return%20value;%5Cn%20%20%7D%5Cn%5Cn%20%20function%20saveRememberedInput(inputName,%20inputValue)%20%7B%5Cn%20%20%20%20localStorage%5B%60rememberedInput_P9hkcjnv92hfO2bf9hiu_$%7BinputName%7D%60%5D%20=%20inputValue;%5Cn%20%20%7D%5Cn%20%20function%20getRememberedInput(inputName)%20%7B%5Cn%20%20%20%20return%20localStorage%5B%60rememberedInput_P9hkcjnv92hfO2bf9hiu_$%7BinputName%7D%60%5D;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20function%20updateInputVisibilities()%20%7B%5Cn%20%20%20%20let%20userInputs%20=%20window.___userSettings746291937.userInputs;%5Cn%20%20%20%20for(let%20name%20of%20userInputs.getChildNames)%20%7B%5Cn%20%20%20%20%20%20if(userInputs%5Bname%5D.visible%20!==%20undefined)%20%7B%5Cn%20%20%20%20%20%20%20%20userInputs%5Bname%5D._element.closest('.input-ctn').style.display%20=%20userInputs%5Bname%5D.visible()%20?%20%5C%22%5C%22%20:%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%5Cn%20%20/////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20handler%20for%20%3Cselect%3E%20element%20changes%20%20%20%20//%5Cn%20%20/////////////////////////////////////////////////%5Cn%20%20window.___selectElChangeEvent746291937%20=%20function(event)%20%7B%5Cn%20%20%20%20let%20userInputSpec%20=%20window.___userSettings746291937.userInputs%5Bthis.dataset.name%5D;%20%20%20%20%5Cn%20%20%20%20let%20optionsList%20=%20userInputSpec.compiledOptions;%5Cn%20%20%20%20%5Cn%20%20%20%20let%20displayName;%5Cn%20%20%20%20if(this.value.startsWith(%5C%22ref:optionKeyName:%5C%22))%20%7B%5Cn%20%20%20%20%20%20//%20this%20option%20wasn't%20just%20a%20simple%20key=value,%20it%20was%20a%20node%20with%20child%20properties,%20so%20we%20expose%20the%20whole%20option%20object/node%20as%20a%20global%20variable%20called%20%60this.dataset.name%60%20%5Cn%20%20%20%20%20%20let%20key%20=%20this.value.split(%5C%22:%5C%22)%5B2%5D;%5Cn%20%20%20%20%20%20window.input%5Bthis.dataset.name%5D%20=%20optionsList%5Bkey%5D;%5Cn%20%20%20%20%20%20userInputSpec.value%20=%20optionsList%5Bkey%5D;%5Cn%20%20%20%20%20%20displayName%20=%20key;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20window.input%5Bthis.dataset.name%5D%20=%20this.value;%5Cn%20%20%20%20%20%20userInputSpec.value%20=%20this.value;%5Cn%20%20%20%20%20%20displayName%20=%20this.value;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20let%20visualSelectBtn%20=%20this.parentElement.querySelector(%5C%22.visual-select-btn%5C%22);%5Cn%20%20%20%20if(visualSelectBtn)%20%7B%5Cn%20%20%20%20%20%20visualSelectBtn.textContent%20=%20displayName;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(!event._isInitCall)%20%7B%5Cn%20%20%20%20%20%20if(userInputSpec.remember)%20%7B%5Cn%20%20%20%20%20%20%20%20saveRememberedInput(this.dataset.name,%20this.value);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(!event._isInitCall)%20%7B%5Cn%20%20%20%20%20%20updateInputVisibilities();%5Cn%20%20%20%20%7D%5Cn%20%20%7D;%5Cn%20%20%5Cn%20%20////////////////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20handler%20for%20%3Cinput%3E/%3Ctextarea%3E%20element%20changes%20%20%20%20%20//%5Cn%20%20////////////////////////////////////////////////////////////%5Cn%20%20let%20parseVariablesRateLimitTimeout%20=%20null;%5Cn%20%20let%20allPreviouslyParsedVariableNames%20=%20new%20Set();%5Cn%20%20function%20parseAllVariables()%20%7B%5Cn%20%20%20%20let%20variableSourceTextareas%20=%20Object.values(window.___userSettings746291937.userInputs).filter(o%20=%3E%20o.parseVariables%20&&%20o._element.tagName.toLowerCase()%20===%20%5C%22textarea%5C%22).map(o%20=%3E%20o._element);%5Cn%20%20%20%20for(let%20name%20of%20allPreviouslyParsedVariableNames)%20%7B%5Cn%20%20%20%20%20%20delete%20window%5Bname%5D;%20//%20clear%20old%20variables%20first%20(if%20they%20e.g.%20delete%20their%20scratchpad%20text,%20the%20variables%20should%20go%20away)%5Cn%20%20%20%20%7D%5Cn%20%20%20%20allPreviouslyParsedVariableNames.clear();%5Cn%20%20%20%20for(let%20el%20of%20variableSourceTextareas)%20%7B%5Cn%20%20%20%20%20%20let%20varLines%20=%20el.value.split(%5C%22%5C%5Cn%5C%22).filter(line%20=%3E%20/%5E%5BA-Z0-9_%5D+?%20*=.+$/.test(line));%5Cn%20%20%20%20%20%20for(let%20line%20of%20varLines)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20name%20=%20line.split(%5C%22=%5C%22)%5B0%5D.trim();%5Cn%20%20%20%20%20%20%20%20let%20value%20=%20line.split(%5C%22=%5C%22).slice(1).join(%5C%22=%5C%22);%5Cn%20%20%20%20%20%20%20%20window%5Bname%5D%20=%20value.trim();%5Cn%20%20%20%20%20%20%20%20allPreviouslyParsedVariableNames.add(name);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20window.___inputElInputEvent746291937%20=%20function(event)%20%7B%5Cn%20%20%20%20let%20userInputSpec%20=%20window.___userSettings746291937.userInputs%5Bthis.dataset.name%5D;%20%5Cn%20%20%20%20%5Cn%20%20%20%20let%20value%20=%20this.value;%5Cn%20%20%20%20%5Cn%20%20%20%20if(value%20===%20%5C%22%5C%22%20&&%20userInputSpec.defaultValue%20!==%20undefined)%20value%20=%20userInputSpec.defaultValue;%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20if(userInputSpec.parseVariables)%20%7B%5Cn%20%20%20%20%20%20clearTimeout(parseVariablesRateLimitTimeout);%5Cn%20%20%20%20%20%20parseVariablesRateLimitTimeout%20=%20setTimeout(parseAllVariables,%201000);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20window.input%5Bthis.dataset.name%5D%20=%20value;%5Cn%20%20%20%20userInputSpec.value%20=%20value;%5Cn%20%20%20%20%5Cn%20%20%20%20if(!event._isInitCall)%20%7B%5Cn%20%20%20%20%20%20if(userInputSpec.remember)%20%7B%5Cn%20%20%20%20%20%20%20%20saveRememberedInput(this.dataset.name,%20value);%5Cn%20%20%20%20%20%20%7D%20else%20if(this.tagName%20===%20%5C%22TEXTAREA%5C%22%20%7C%7C%20(this.tagName%20===%20%5C%22INPUT%5C%22%20&&%20this.type%20===%20%5C%22text%5C%22))%20%7B%20//%20%3C--%20just%20to%20be%20sure%5Cn%20%20%20%20%20%20%20%20//%20localStorage%5B%5C%22t2i_tempRememberedInput_fisuyr9hf_%5C%22+this.dataset.name%5D%20=%20value;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(!event._isInitCall)%20%7B%5Cn%20%20%20%20%20%20updateInputVisibilities();%5Cn%20%20%20%20%7D%5Cn%20%20%7D;%5Cn%20%20(async%20function()%20%7B%5Cn%20%20%20%20while(!Object.values(window.___userSettings746291937.userInputs)%5B0%5D._element)%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%5Cn%20%20%20%20parseAllVariables();%5Cn%20%20%7D)();%5Cn%20%20%5Cn%20%20let%20socialFeatures%20=%20settings.socialFeatures;%5Cn%20%20if(socialFeatures%20===%20undefined)%20socialFeatures%20=%20%5C%22enabled%5C%22;%5Cn%20%20socialFeatures%20=%20socialFeatures.evaluateItem;%5Cn%20%20%5Cn%20%20let%20thisGeneratorIsUsingClickCountBasedSocialDisplay%20=%20false;%5Cn%20%20%7B%5Cn%20%20%20%20let%20n%20=%20(socialFeatures.match(/button%20after%20(%5B0-9%5D+)%20clicks/)%20%7C%7C%20%5B%5D)%5B1%5D;%5Cn%20%20%20%20if(n)%20%7B%5Cn%20%20%20%20%20%20thisGeneratorIsUsingClickCountBasedSocialDisplay%20=%20true;%5Cn%20%20%20%20%20%20n%20=%20Number(n);%5Cn%20%20%20%20%20%20if(Number(localStorage.generateClickCount%20%7C%7C%200)%20%3E=%20n)%20%7B%5Cn%20%20%20%20%20%20%20%20socialFeatures%20=%20%5C%22button%5C%22;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20socialFeatures%20=%20%5C%22disabled%5C%22;%5Cn%20%20%20%20%20%20%20%20window.showSocialFeaturesButtonAfterThisManyClicks%20=%20n;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20////////////////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20%20%20%20%20%20%20%20copy%20share%20link%20button%20handler%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%5Cn%20%20////////////////////////////////////////////////////////////%5Cn%20%20window.__generateSettingsShareLink084722%20=%20async%20function%20generateShareLink()%20%7B%20%5Cn%20%20%20%20%5Cn%20%20%20%20//%20EDIT:%20decided%20to%20show%20this%20on%20every%20click%20now,%20since%20it's%20obviously%20not%20super%20commonly%20clicked%20(so%20an%20extra%20tap%20is%20not%20a%20big%20burden),%20and%20i%20think%20it%20being%20close%20to%20the%20generate%20button%20means%20people%20were%20clicking%20it%20accidentally%20sometimes.%5Cn%20%20%20%20//%20if(!localStorage.knowsHowShareLinksWork)%20%7B%5Cn%20%20%20%20//%20heuristic%20to%20try%20to%20warn%20about%20their%20scratchpad%20being%20shared%20too:%5Cn%20%20%20%20let%20includingScratchpadWarning%20=%20%5C%22%5C%22;%5Cn%20%20%20%20let%20sharableScratchpadExists%20=%20Object.values(window.___userSettings746291937.userInputs).find(o%20=%3E%20(o.getName%20===%20%5C%22scratchpad%5C%22%20%7C%7C%20o.getName%20===%20%5C%22notes%5C%22%20%7C%7C%20o.getName%20===%20%5C%22notepad%5C%22)%20&&%20!o.excludeFromShareLink);%5Cn%20%20%20%20if(sharableScratchpadExists)%20includingScratchpadWarning%20=%20%60,%20%F0%9D%97%B6%F0%9D%97%BB%F0%9D%97%B0%F0%9D%97%B9%F0%9D%98%82%F0%9D%97%B1%F0%9D%97%B6%F0%9D%97%BB%F0%9D%97%B4%20the%20scratchpad/notepad%20text%60;%5Cn%5Cn%20%20%20%20let%20confirmed%20=%20confirm(%60This%20will%20create%20a%20sharable%20link%20to%20a%20snapshot%20of%20the%20settings%20you've%20specified%20above$%7BincludingScratchpadWarning%7D.%60);%5Cn%20%20%20%20if(!confirmed)%20%7B%5Cn%20%20%20%20%20%20return;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20localStorage.knowsHowShareLinksWork%20=%20%5C%221%5C%22;%5Cn%20%20%20%20//%20%7D%5Cn%20%20%5Cn%20%20%20%20if(!window.CompressionStream)%20%7B%5Cn%20%20%20%20%20%20alert(%5C%22Share%20links%20use%20a%20feature%20that's%20only%20available%20in%20modern%20browsers.%20Please%20upgrade%20your%20browser%20to%20the%20latest%20version%20to%20use%20this%20feature.%5C%22);%5Cn%20%20%20%20%20%20return;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20shareLinkCtn83927376.style.display%20=%20%5C%22none%5C%22;%5Cn%5Cn%20%20%20%20shareSettingsBtn758374.disabled%20=%20true;%5Cn%20%20%20%20shareSettingsBtn758374.innerHTML%20=%20%60%3Cspan%20style=%5C%22display:inline-block;%20animation:rotate%201.5s%20linear%20infinite;%5C%22%3E%E2%8F%B3%3C/span%3E%20uploading%20settings%20data...%60;%5Cn%5Cn%20%20%20%20let%20dataJsonStr%20=%20JSON.stringify(getAllUserInputValues());%5Cn%5Cn%20%20%20%20//%20convert%20json%20text%20to%20blob:%5Cn%20%20%20%20let%20blob%20=%20await%20fetch(%5C%22data:text/plain;charset=utf-8,%5C%22+dataJsonStr.replace(/#/g,%20%5C%22%2523%5C%22)).then(res%20=%3E%20res.blob());%5Cn%5Cn%20%20%20%20//%20compress%20blob:%5Cn%20%20%20%20let%20compressedBlob%20=%20await%20compressBlobWithGzip(blob);%5Cn%5Cn%20%20%20%20let%20%7B%20url,%20size,%20error%20%7D%20=%20await%20upload(compressedBlob);%5Cn%20%20%20%20if(error)%20%7B%5Cn%20%20%20%20%20%20shareSettingsLinkInputEl759307.value%20=%20%60error:%20$%7Berror%7D%60;%5Cn%20%20%20%20%20%20alert(%60Error:%20$%7Berror%7D$%7Berror%20===%20%5C%22disallowed_content%5C%22%20?%20%5C%22.%20If%20you%20believe%20this%20is%20incorrect,%20then%20you%20may%20need%20to%20explicitly%20state%20that%20relevant%20characters%20are%2018%20or%20older,%20since%20the%20moderation%20system%20can%20make%20mistakes%20if%20there%20is%20ambiguity.%5C%22%20:%20%5C%22%5C%22%7D%60);%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20shareSettingsLinkInputEl759307.value%20=%20%60https://perchance.org/$%7Bwindow.generatorName%7D#data=%60+url.replace(%5C%22https://user.uploads.dev/file/%5C%22,%20%5C%22uup1:%5C%22);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20shareLinkCtn83927376.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20shareSettingsBtn758374.textContent%20=%20%5C%22%F0%9F%94%97%20share%20these%20settings%5C%22;%5Cn%20%20%20%20shareSettingsBtn758374.disabled%20=%20false;%5Cn%20%20%20%20shareSettingsBtn758374.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20async%20function%20compressBlobWithGzip(blob)%20%7B%5Cn%20%20%20%20const%20cs%20=%20new%20CompressionStream('gzip');%5Cn%20%20%20%20const%20compressedStream%20=%20blob.stream().pipeThrough(cs);%5Cn%20%20%20%20let%20outputBlob%20=%20await%20new%20Response(compressedStream).blob();%5Cn%20%20%20%20return%20new%20Blob(%5BoutputBlob%5D,%20%7B%20type:%20%5C%22application/gzip%5C%22%20%7D);%20//%20%3C--%20to%20add%20the%20correct%20mime%20type%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20async%20function%20loadDataFromUrlHash()%20%7B%20%5Cn%20%20%20%20let%20success%20=%20false;%5Cn%20%20%20%20if(!window.DecompressionStream)%20%7B%5Cn%20%20%20%20%20%20alert(%5C%22Share%20links%20use%20a%20browser%20feature%20that's%20only%20available%20in%20modern%20browsers.%20Please%20upgrade%20your%20browser%20to%20the%20latest%20version%20(ideally%20Chrome%20or%20Edge)%20to%20allow%20for%20loading%20data%20from%20character%20share%20links.%5C%22);%5Cn%20%20%20%20%20%20return%20%7Bsuccess,%20error:%5C%22browser_compat%5C%22%7D;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20let%20loadingModal%20=%20document.createElement('div');%5Cn%20%20%20%20loadingModal.innerHTML%20=%20%60%3Cdiv%20style=%5C%22position:%20fixed;%20top:%200;%20left:%200;%20width:%20100%25;%20height:%20100%25;%20background-color:%20rgba(0,%200,%200,%200.5);%20z-index:%209999;%20display:%20flex;%20justify-content:%20center;%20align-items:%20center;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20style=%5C%22padding:%2020px;%20background-color:%20var(--box-color);%20border-radius:%208px;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cspan%20style=%5C%22display:inline-block;%20animation:rotate%201.5s%20linear%20infinite;%5C%22%3E%E2%8F%B3%3C/span%3E%20loading%20share%20link%20data...%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%60;%5Cn%20%20%20%20loadingModal%20=%20loadingModal.firstElementChild;%5Cn%20%20%20%20document.body.append(loadingModal);%5Cn%5Cn%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20let%20hashText%20=%20window.location.hash.slice(1);%5Cn%20%20%20%20%20%20if(!hashText.startsWith(%5C%22data=%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20throw%20new%20Error(%5C%22Invalid%20share%20URL.%5C%22);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20let%20fileUrl%20=%20hashText.replace(/%5Edata=/,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20if(fileUrl.startsWith(%5C%22uup1:%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20fileUrl%20=%20fileUrl.replace(%5C%22uup1:%5C%22,%20%5C%22https://user.uploads.dev/file/%5C%22);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20let%20fetchOptions%20=%20%7B%7D;%5Cn%20%20%20%20%20%20if(window.AbortSignal%20&&%20AbortSignal.timeout)%20fetchOptions.signal%20=%20AbortSignal.timeout(10000);%5Cn%20%20%20%20%20%20let%20blob%20=%20await%20fetch(fileUrl,%20fetchOptions).then(res%20=%3E%20res.ok%20?%20res.blob()%20:%20null).catch(console.error);%5Cn%20%20%20%20%20%20if(!blob)%20%7B%5Cn%20%20%20%20%20%20%20%20loadingModal.remove();%5Cn%20%20%20%20%20%20%20%20await%20confirmAsync(%60It%20seems%20you've%20tried%20to%20load%20a%20share%20URL,%20but%20the%20file%20specified%20by%20the%20URL%20does%20not%20exist.%20If%20you%20believe%20it%20should%20exist,%20you%20can%20ask%20for%20help%20on%20the%20community%20forum,%20or%20check%20if%20the%20file%20has%20been%20quarantined:%5C%5Cn%5C%5Cnperchance.org/quarantined-files%60,%20%7BhideCancel:true%7D);%5Cn%20%20%20%20%20%20%20%20return%20%7Bsuccess:false,%20error:%5C%22loading_cancelled_by_user%5C%22%7D;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20let%20text;%5Cn%20%20%20%20%20%20if(fileUrl.endsWith(%5C%22.gz%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20let%20decompressedBlob%20=%20await%20decompressBlobWithGzip(blob);%5Cn%20%20%20%20%20%20%20%20text%20=%20await%20decompressedBlob.text();%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20text%20=%20await%20blob.text();%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20let%20data%20=%20JSON.parse(text);%5Cn%20%20%20%20%20%20if(data.___format%20===%20%5C%22t2i-framework-format1%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20confirmed%20=%20await%20confirmAsync(%5C%22%F0%9D%97%9B%F0%9D%97%B2%F0%9D%97%AE%F0%9D%97%B1%F0%9D%98%80%20%F0%9D%98%82%F0%9D%97%BD:%20You're%20loading%20a%20share%20link.%20This%20will%20overwrite%20your%20existing%20saved%20settings/scratchpad,%20if%20any.%20%F0%9D%97%96%F0%9D%97%BC%F0%9D%97%BB%F0%9D%98%81%F0%9D%97%B6%F0%9D%97%BB%F0%9D%98%82%F0%9D%97%B2?%5C%5Cn%5C%5Cn(Note:%20You%20can%20click%20cancel%20and%20then%20load%20the%20share%20link%20in%20your%20browser's%20incognito/private%20mode%20to%20avoid%20overwriting%20any%20existing%20data,%20or%20just%20backup%20your%20existing%20data%20first.)%5C%22);%5Cn%20%20%20%20%20%20%20%20if(!confirmed)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20window.location.hash%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20loadingModal.remove();%5Cn%20%20%20%20%20%20%20%20%20%20return%20%7Bsuccess,%20error:%5C%22loading_cancelled_by_user%5C%22%7D;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20//%20let%20userHasSomeTextTheyAreTryingToRemember%20=%20Object.values(window.___userSettings746291937.userInputs).filter(o%20=%3E%20o.remember%20&&%20o._element.tagName.toLowerCase()%20===%20%5C%22textarea%5C%22).map(o%20=%3E%20o._element.value).join(%5C%22%5C%22).length%20%3E%20100;%5Cn%20%20%20%20%20%20%20%20//%20if(userHasSomeTextTheyAreTryingToRemember)%20%7B%7D%5Cn%20%20%20%20%20%20%20%20importUserInputValues(data);%5Cn%20%20%20%20%20%20%20%20success%20=%20true;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20alert(%5C%22Unknown%20share%20link%20data%20format.%5C%22);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20alert(%60Failed%20to%20load%20share%20link%20data:%20$%7Be.message%7D%60);%5Cn%20%20%20%20%20%20console.error(e);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20loadingModal.remove();%5Cn%20%20%20%20return%20%7Bsuccess%7D;%5Cn%20%20%7D%5Cn%5Cn%20%20async%20function%20decompressBlobWithGzip(blob)%20%7B%5Cn%20%20%20%20const%20ds%20=%20new%20DecompressionStream(%5C%22gzip%5C%22);%5Cn%20%20%20%20const%20decompressedStream%20=%20blob.stream().pipeThrough(ds);%5Cn%20%20%20%20return%20await%20new%20Response(decompressedStream).blob();%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20function%20getAllUserInputValues()%20%7B%5Cn%20%20%20%20let%20userInputs%20=%20%7B%7D;%5Cn%20%20%20%20for(let%20key%20in%20window.___userSettings746291937.userInputs)%20%7B%5Cn%20%20%20%20%20%20if(window.___userSettings746291937.userInputs%5Bkey%5D.excludeFromShareLink)%20continue;%5Cn%20%20%20%20%20%20let%20value%20=%20window.___userSettings746291937.userInputs%5Bkey%5D._element?.value;%5Cn%20%20%20%20%20%20if(value%20!==%20undefined)%20%7B%5Cn%20%20%20%20%20%20%20%20userInputs%5Bkey%5D%20=%20value;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20userInputs.___format%20=%20%5C%22t2i-framework-format1%5C%22;%5Cn%20%20%20%20return%20userInputs;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20function%20importUserInputValues(data)%20%7B%5Cn%20%20%20%20for(let%20key%20in%20window.___userSettings746291937.userInputs)%20%7B%5Cn%20%20%20%20%20%20if(window.___userSettings746291937.userInputs%5Bkey%5D.excludeFromShareLink)%20continue;%5Cn%20%20%20%20%20%20let%20value%20=%20window.___userSettings746291937.userInputs%5Bkey%5D._element?.value;%5Cn%20%20%20%20%20%20if(value%20!==%20undefined)%20%7B%5Cn%20%20%20%20%20%20%20%20if(data%5Bkey%5D%20!==%20undefined)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20el%20=%20window.___userSettings746291937.userInputs%5Bkey%5D._element;%5Cn%20%20%20%20%20%20%20%20%20%20el.value%20=%20data%5Bkey%5D;%5Cn%20%20%20%20%20%20%20%20%20%20if(el.onchange)%20el.onchange(%7B_isInitCall:true%7D);%5Cn%20%20%20%20%20%20%20%20%20%20if(el.oninput)%20el.oninput(%7B_isInitCall:true%7D);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20function%20animateImageIntoTarget(%7BimgEl,%20sourceEl,%20targetEl,%20durationMs,%20wiggle%7D=%7B%7D)%20%7B%5Cn%20%20%20%20const%20srcRect%20=%20sourceEl.getBoundingClientRect()%5Cn%20%20%20%20let%20tgtRect%20=%20targetEl.getBoundingClientRect();%5Cn%20%20%20%20imgEl.style.cssText%20=%20%60position:fixed;top:$%7BsrcRect.top%7Dpx;left:$%7BsrcRect.left%7Dpx;width:$%7BsrcRect.width%7Dpx;height:$%7BsrcRect.height%7Dpx;margin:0;pointer-events:none;z-index:9999;transition:top%20$%7BdurationMs%7Dms%20cubic-bezier(.4,0,.2,1),left%20$%7BdurationMs%7Dms%20cubic-bezier(.4,0,.2,1),width%20$%7BdurationMs%7Dms%20cubic-bezier(.4,0,.2,1),height%20$%7BdurationMs%7Dms%20cubic-bezier(.4,0,.2,1)%60;%5Cn%20%20%20%20if%20(!imgEl.parentNode)%20document.body.appendChild(imgEl);%5Cn%20%20%20%20imgEl.getBoundingClientRect();%20//%20force%20reflow%5Cn%20%20%20%20imgEl.style.top%20=%20tgtRect.top%20+%20tgtRect.height%20/%202%20+%20'px';%5Cn%20%20%20%20imgEl.style.left%20=%20tgtRect.left%20+%20tgtRect.width%20/%202%20+%20'px';%5Cn%20%20%20%20imgEl.style.width%20=%20imgEl.style.height%20=%20'0px';%5Cn%20%20%20%20%5Cn%20%20%20%20imgEl.addEventListener('transitionend',%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20imgEl.remove();%5Cn%20%20%20%20%20%20if%20(!wiggle)%20return;%5Cn%20%20%20%20%20%20const%20anim%20=%20'wiggle'%20+%20Math.random().toString(36).slice(2);%5Cn%20%20%20%20%20%20const%20styleEl%20=%20Object.assign(document.createElement('style'),%20%7B%5Cn%20%20%20%20%20%20%20%20id:%20anim,%5Cn%20%20%20%20%20%20%20%20textContent:%20%60@keyframes%20$%7Banim%7D%7B0%25,100%25%7Btransform:rotate(0deg)%7D20%25%7Btransform:rotate(-5deg)%7D40%25%7Btransform:rotate(5deg)%7D60%25%7Btransform:rotate(-3deg)%7D80%25%7Btransform:rotate(3deg)%7D%7D%60%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20document.head.appendChild(styleEl);%5Cn%20%20%20%20%20%20targetEl.style.animation%20=%20%60$%7Banim%7D%20400ms%20ease-in-out%60;%5Cn%20%20%20%20%20%20targetEl.addEventListener('animationend',%20()%20=%3E%20%7B%20targetEl.style.animation%20=%20'';%20styleEl.remove();%20%7D,%20%7B%20once:%20true%20%7D);%5Cn%20%20%20%20%7D,%20%7B%20once:%20true%20%7D);%5Cn%20%20%7D%5Cn%5Cn%5Cn%20%20if(settings.imageButtons?.privateSave)%20%7B%5Cn%20%20%20%20window.t2i_privateGallery%20=%20createMediaGalleryPlugin();%5Cn%20%20%20%20document.addEventListener(%5C%22keydown%5C%22,%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20if%20(e.shiftKey%20&&%20(e.ctrlKey%20%7C%7C%20e.metaKey)%20&&%20e.key.toLowerCase()%20===%20%5C%22g%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20e.preventDefault();%5Cn%20%20%20%20%20%20%20%20window.t2i_privateGallery.show();%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20window.t2i_privateGallerySave%20=%20async%20function(btn,%20imageCtn)%20%7B%5Cn%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20if(!imageCtn.querySelector(%5C%22iframe%5C%22).textToImagePluginOutput)%20return%20alert(%5C%22Please%20wait%20for%20the%20image%20to%20finish%20generating%20before%20using%20the%20'private%20save'%20feature.%5C%22);%5Cn%20%20%20%20%20%20btn.disabled%20=%20true;%5Cn%20%20%20%20%20%20let%20textToImagePluginOutput%20=%20imageCtn.querySelector(%5C%22iframe%5C%22).textToImagePluginOutput;%5Cn%20%20%20%20%20%20let%20%7B%20prompt,%20negativePrompt,%20seed,%20guidanceScale%20%7D%20=%20textToImagePluginOutput.inputs;%5Cn%20%20%20%20%20%20let%20imageBlob%20=%20await%20fetch(textToImagePluginOutput.dataUrl).then(r%20=%3E%20r.blob());%5Cn%20%20%20%20%20%20await%20window.t2i_privateGallery.add(imageBlob,%20%7Binfo:%7Bprompt,%20negativePrompt,%20seed,%20guidanceScale%7D%7D);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20privateGalleryCtn97364827.hidden%20=%20false;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20Animate%20the%20image%20into%20gallery%20button:%5Cn%20%20%20%20%20%20let%20imgEl%20=%20document.createElement(%5C%22img%5C%22);%5Cn%20%20%20%20%20%20imgEl.src%20=%20textToImagePluginOutput.dataUrl;%5Cn%20%20%20%20%20%20animateImageIntoTarget(%7BimgEl,%20sourceEl:imageCtn.querySelector(%5C%22iframe%5C%22),%20targetEl:privateGalleryCtn97364827.querySelector(%5C%22button%5C%22),%20durationMs:700,%20wiggle:true%7D);%5Cn%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20console.error(e);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20btn.disabled%20=%20false;%20//%20we%20re-enable%20since%20they%20can%20click%20the%20(within-iframe)%20'regenerate'%20button%20on%20this%20image%20and%20submit%20another%20image%5Cn%20%20%20%20%7D,%201000);%5Cn%20%20%7D;%5Cn%20%20window.t2i_openCharacterDescriptionEditor%20=%20function(imageCtn)%20%7B%5Cn%20%20%20%20imageCtn.querySelector('.personality-chat-button').style.visibility%20=%20'hidden';%5Cn%20%20%20%20if(imageCtn.querySelector('.char-description-editor-ctn'))%20%7B%5Cn%20%20%20%20%20%20//%20show%20it%20existing%20on%20if%20it%20exists:%5Cn%20%20%20%20%20%20imageCtn.querySelector('.char-description-editor-ctn').style.display%20=%20'flex';%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20//%20otherwise%20create%20it:%5Cn%20%20%20%20%20%20let%20tmp%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20tmp.innerHTML%20=%20%60%3Cdiv%20class=%5C%22char-description-editor-ctn%5C%22%20style=%5C%22color-scheme:dark;%20color:#dddddd;%20position:absolute;top:0;left:0;right:0;bottom:0;display:%20flex;flex-direction:column;%20gap:0.125rem;%20padding:0.125rem;%20padding-bottom:0;%20backdrop-filter:brightness(0.7);%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%3Cdiv%20style=%5C%22font-size:80%25;%20font-weight:bold;%20text-shadow:0px%200px%208px%20black,%200px%200px%208px%20black;%5C%22%3EInstructions:%3C/div%3E--%3E%5Cn%20%20%20%20%20%20%20%20%3Ctextarea%20class=%5C%22char-description-instruction%5C%22%20style=%5C%22backdrop-filter:blur(3px);%20background:rgba(0,%200,%200,%200.8);%20font-size:80%25;%20min-height:70px;%20border:1px%20solid%20grey;%20border-radius:2px;%20color-scheme:dark;%5C%22%20placeholder=%5C%22(Optional)%20Extra%20instructions%20for%20the%20personality,%20appearance,%20and%20backstory%20to%20be%20generated.%5C%22%3E%3C/textarea%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%20gap:0.125rem;%20justify-content:center;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22char-description-generate-button%5C%22%20style=%5C%22color-scheme:dark;%20flex-grow:1;%20font-weight:bold;%20max-width:max-content;%20box-shadow:0px%200px%2012px%202px%20black;%5C%22%20onclick=%5C%22window.t2i_generateCharacterDescription(this.closest('.t2i-image-ctn'))%5C%22%3E%E2%9C%A8%20generate%20persona%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22char-description-stop-button%5C%22%20style=%5C%22color-scheme:dark;%20min-width:4rem;%20display:none;%20box-shadow:0px%200px%2012px%202px%20black;%5C%22%20onclick=%5C%22this.closest('.t2i-image-ctn').__generateObj.stop()%5C%22%3E%F0%9F%9B%91%20stop%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%3Cdiv%20style=%5C%22font-size:80%25;%20font-weight:bold;%20text-shadow:0px%200px%208px%20black,%200px%200px%208px%20black;%5C%22%3EOutput:%3C/div%3E--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%3Cdiv%20style=%5C%22%5C%22%3E%E2%AC%87%EF%B8%8F%20%E2%AC%87%EF%B8%8F%20%E2%AC%87%EF%B8%8F%3C/div%3E--%3E%5Cn%20%20%20%20%20%20%20%20%3Cinput%20class=%5C%22character-name-output%5C%22%20style=%5C%22backdrop-filter:blur(3px);%20background:rgba(0,%200,%200,%200.8);%20border:1px%20solid%20grey;%20border-radius:2px;%20color-scheme:dark;%5C%22%20placeholder=%5C%22Character%20name%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Ctextarea%20class=%5C%22character-description-output%5C%22%20placeholder=%5C%22Click%20the%20%F0%9D%97%B4%F0%9D%97%B2%F0%9D%97%BB%F0%9D%97%B2%F0%9D%97%BF%F0%9D%97%AE%F0%9D%98%81%F0%9D%97%B2%20button%20above!%20The%20character%20description%20will%20appear%20here,%20and%20then%20you%20can%20edit%20it.%5C%22%20style=%5C%22backdrop-filter:blur(3px);%20flex-grow:1;%20background:rgba(0,0,0,0.8);%20border:1px%20solid%20grey;%20border-radius:2px;%20font-size:85%25;%20color-scheme:dark;%5C%22%3E%3C/textarea%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%20gap:0.25rem;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbutton%20style=%5C%22flex-grow:1;%20color-scheme:dark;%5C%22%20onclick=%5C%22window.t2i_generateChatLink(this.closest('.t2i-image-ctn'))%5C%22%3E%F0%9F%92%AC%20chat%20with%20them%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbutton%20style=%5C%22min-width:4rem;%20color-scheme:dark;%5C%22%20onclick=%5C%22this.closest('.char-description-editor-ctn').style.display='none';%20this.closest('.t2i-image-ctn').querySelector('.personality-chat-button').style.visibility='visible';%5C%22%3E%E2%9D%8C%20close%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%3C/div%3E%60;%5Cn%20%20%20%20%20%20imageCtn.appendChild(tmp.firstElementChild);%5Cn%20%20%20%20%7D%5Cn%20%20%7D;%5Cn%5Cn%20%20window.t2i_generateCharacterDescription%20=%20async%20function(imageCtn)%20%7B%5Cn%20%20%5Cn%20%20%20%20let%20generateBtn%20=%20imageCtn.querySelector(%5C%22.char-description-generate-button%5C%22);%5Cn%20%20%20%20let%20stopBtn%20=%20imageCtn.querySelector(%5C%22.char-description-stop-button%5C%22);%5Cn%20%20%5Cn%20%20%20%20let%20originalGenerateButtonTextContent%20=%20generateBtn.textContent;%5Cn%20%20%20%20generateBtn.innerHTML%20=%20%60%3Cspan%20style=%5C%22display:inline-block;%20animation:rotate%201.5s%20linear%20infinite;%5C%22%3E%E2%8F%B3%3C/span%3E%20loading...%60;%5Cn%20%20%20%20generateBtn.disabled%20=%20true;%5Cn%20%20%20%20stopBtn.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%5Cn%20%20%20%20while(!imageCtn.querySelector(%5C%22iframe%5C%22).textToImagePluginOutput)%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%201000));%20//%20bit%20of%20a%20hacky%20patch,%20just%20to%20cover%20edge%20case%20where%20they%20can%20click%20the%20personality%20button%20before%20image%20generation%20finishes%5Cn%20%20%5Cn%20%20%20%20let%20charDescriptionInstruction%20=%20imageCtn.querySelector(%5C%22.char-description-instruction%5C%22).value.trim();%5Cn%20%20%20%20let%20textToImagePluginOutput%20=%20imageCtn.querySelector(%5C%22iframe%5C%22).textToImagePluginOutput;%5Cn%20%20%20%20let%20nameOutputEl%20=%20imageCtn.querySelector(%5C%22.character-name-output%5C%22);%5Cn%20%20%20%20let%20descriptionOutputEl%20=%20imageCtn.querySelector(%5C%22.character-description-output%5C%22);%5Cn%5Cn%20%20%20%20nameOutputEl.value%20=%20%5C%22%5C%22;%5Cn%20%20%20%20descriptionOutputEl.value%20=%20%5C%22%5C%22;%5Cn%5Cn%20%20%20%20let%20generateObj;%5Cn%20%20%20%20if(true)%20%7B%5Cn%20%20%20%20%20%20generateObj%20=%20aiText(%7B%5Cn%20%20%20%20%20%20%20%20instruction:%20%60%5Cn%20%20%20%20%20%20%20%20TASK:%20The%20user%20has%20created%20an%20image%20of%20a%20character%20using%20a%20prompt.%20The%20prompt%20is%20shown%20below.%20Your%20task%20is%20to%20use%20the%20character%20personality%20hints%20in%20the%20prompt%20to%20generate%20a%20character%20description%20for%20roleplaying%20with.%20Your%20description%20should%20ideally%20include%20personality,%20appearance,%20speech%20examples/mannerisms,%20etc.%20such%20that%20an%20actor%20could%20read%20it%20and%20know%20how%20to%20roleplay%20as%20the%20character%20in%20all%20relevant%20aspects.%20Use%20an%20information-dense%20writing%20style%20to%20*succinctly*%20capture%20all%20aspects%20of%20the%20personality%20of%20the%20character%20that%20you%20generate.%20Your%20description%20should%20be%20between%20200%20and%20600%20words%20in%20length.%20Do%20your%20best%20to%20generate%20a%20character%20based%20on%20what%20you%20see%20below.%20Follow%20the%20hints%20in%20the%20user's%20image%20prompt%20to%20accurately%20capture%20the%20details%20that%20are%20most%20important%20to%20a%20character%20chat/roleplay.%5Cn%5Cn%20%20%20%20%20%20%20%20---%20START%20OF%20IMAGE%20PROMPT%20---%5Cn%20%20%20%20%20%20%20%20$%7BtextToImagePluginOutput.inputs.prompt.replace(/%5C%5Cs+/g,%20%5C%22%20%5C%22)%7D%5Cn%20%20%20%20%20%20%20%20---%20END%20OF%20IMAGE%20PROMPT%20---%5Cn%5Cn%20%20%20%20%20%20%20%20Reminder:%20Your%20task%20is%20to%20generate%20a%20character%20that%20is%20inspired%20by%20the%20above%20image%20prompt.%20Your%20response%20should%20describe%20how%20the%20character%20looks/acts/speaks/behaves%20such%20that%20if%20someone%20read%20it,%20they%20would%20be%20able%20to%20accurately%20emulate%20or%20roleplay%20as%20the%20target%20character's%20mannerisms,%20personality,%20etc.%20No%20more%20than%20600%20words.%5Cn%20%20%20%20%20%20%20%20$%7BcharDescriptionInstruction%20?%20%60%5C%5CnBut%20also,%20the%20character%20must%20be%20based%20on%20this%20instruction:%20$%7BcharDescriptionInstruction%7D%5C%5Cn%60%20:%20%5C%22%5C%22%7D%5Cn%5Cn%20%20%20%20%20%20%20%20Use%20this%20template%20for%20your%20response:%5Cn%20%20%20%20%20%20%20%20%3Cresponse_template%3E%5Cn%20%20%20%20%20%20%20%20#%20Name:%5Cn%20%20%20%20%20%20%20%20(The%20character's%20name)%5Cn%5Cn%20%20%20%20%20%20%20%20#%20Visual%20Description:%5Cn%20%20%20%20%20%20%20%20(A%20SHORT%20paragraph%20describing%20what%20they%20look%20like%20-%20keep%20this%20short,%20concise%20and%20to-the-point.%20Low%20word%20count,%20high%20information%20density.%20Avoid%20using%20purple%20prose%20and%20overly%20flowery%20descriptions.)%5Cn%5Cn%20%20%20%20%20%20%20%20#%20Personality%20Description:%5Cn%20%20%20%20%20%20%20%20(ONE%20paragraph%20personality%20description.%20Use%20mainly%20short%20sentences%20-%20i.e.%20write%20in%20an%20information-dense%20style.%20Focus%20on%20the%20aspects%20that%20make%20them%20unique/interesting.%20If%20relevant,%20you%20can%20use%20terms%20like%20tsundere,%20yandere,%20kuudere,%20deredere,%20dandere,%20genki%20girl,%20kuudere,%20seme,%20uke,%20megane,%20chuunibyou,%20clumsy%20heroine,%20superiority%20complex,%20dominant,%20submissive,%20etc.%20to%20succinctly%20capture%20aspects%20of%20their%20personality.%20Invent%20a%20few%20interesting%20aspects,%20use%20creative%20liberty%20to%20create%20a%20character%20that%20has%20genuine%20depth,%20with%20idiosyncrasies,%20goals,%20fears,%20likes,%20dislikes,%20ethics,%20etc.%20Remember,%20your%20goal%20is%20to%20create%20a%20character%20that%20would%20be%20fun%20for%20the%20user%20to%20roleplay%20with!%20Follow%20the%20user's%20lead%20based%20on%20their%20initial%20idea,%20but%20take%20it%20one%20step%20further%20to%20surprise%20and%20excite%20them.)%5Cn%5Cn%20%20%20%20%20%20%20%20#%20Roleplay%20Behavior%20Examples:%5Cn%20%20%20%20%20%20%20%20(A%20numbered%20list%20of%205%20separate%20and%20diverse%20examples%20of%20character%20speech/behavior,%20each%20starting%20with%20an%20asterisk%20or%20double-quote,%20which%20place%20the%20character%20in%20random%20roleplay%20situations,%20as%20if%20you've%20extracted%20random%20&%20diverse%20moments%20from%20a%20story,%20with%20sufficient%20context%20captured%20by%20the%20dialogue%20and%20actions%20themselves,%20to%20show%20the%20essence%20of%20who%20they%20are%20as%20a%20character,%20how%20they%20speak/act/react/etc.%20Each%20example%20should%20perfectly%20capture%20one%20aspect%20of%20who%20they%20are%20as%20a%20character.%20Each%20example%20should%20be%20its%20own%20separate%20momement%20from%20a%20hypothetical%20story,%20unrelated%20to%20the%20other%20examples%20that%20you%20write.%20You%20must%20use%20asterisks%20around%20actions%20and%20quotes%20around%20speech%20in%20typical%20roleplays%20style,%20for%20example%20%5Bdon't%20use%20this%20specific%20example%20in%20your%20response,%20it's%20just%20to%20demonstrate%20the%20syntax%5D:%201.%20%5C%22And%20why%20the...%5C%22%20*He%20gestures%20to%20the%20overturned%20carriage*%20%5C%22...grand%20entrance?%5C%22%20%5B...%5D)%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20#%20Favorite%20Food:%5Cn%20%20%20%20%20%20%20%20(favorite%20food)%5Cn%20%20%20%20%20%20%20%20%3C/response_template%3E%5Cn%20%20%20%20%20%20%20%20%60.trim(),%5Cn%20%20%20%20%20%20%20%20startWith:%20%5C%22#%20Name:%5C%22,%5Cn%20%20%20%20%20%20%20%20stopSequences:%20%5B%5C%22#%20Favorite%5C%22%5D,%5Cn%20%20%20%20%20%20%20%20onChunk:%20(data)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20parts%20=%20data.fullTextSoFar.split(/(%5E%7C%5C%5Cn%5C%5Cn)#%20/s).map(p%20=%3E%20p.trim()).filter(p%20=%3E%20p);%5Cn%20%20%20%20%20%20%20%20%20%20let%20name%20=%20parts.find(p%20=%3E%20p.startsWith(%5C%22Name%5C%22))?.split(%5C%22%5C%5Cn%5C%22)?.%5B1%5D?.trim();%5Cn%20%20%20%20%20%20%20%20%20%20let%20visualDescription%20=%20parts.find(p%20=%3E%20p.startsWith(%5C%22Visual%5C%22))?.split(%5C%22%5C%5Cn%5C%22).slice(1).join(%5C%22%5C%5Cn%5C%22).trim()%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20let%20personalityDescription%20=%20parts.find(p%20=%3E%20p.startsWith(%5C%22Personality%5C%22))?.split(%5C%22%5C%5Cn%5C%22).slice(1).join(%5C%22%5C%5Cn%5C%22).trim()%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20let%20roleplayBehaviorExamples%20=%20parts.find(p%20=%3E%20p.startsWith(%5C%22Roleplay%5C%22))?.split(%5C%22%5C%5Cn%5C%22).slice(1).join(%5C%22%5C%5Cn%5C%22).trim()%20%7C%7C%20%5C%22%5C%22;%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20nameOutputEl.value%20=%20name%20%7C%7C%20%5C%22%5C%22;%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20let%20description%20=%20%60#%20%7B%7Bchar%7D%7D%20Visual%20Description:%5C%5Cn$%7BvisualDescription%7D%5C%5Cn%5C%5Cn#%20%7B%7Bchar%7D%7D%20Personality:%5C%5Cn$%7BpersonalityDescription%7D%5C%5Cn%5C%5Cn#%20%7B%7Bchar%7D%7D%20Roleplay%20Behavior%20Examples:%5C%5Cn$%7BroleplayBehaviorExamples%7D%60;%5Cn%20%20%20%20%20%20%20%20%20%20descriptionOutputEl.value%20=%20description;%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20if(descriptionOutputEl.scrollTop%20%3E%20(descriptionOutputEl.scrollHeight%20-%20descriptionOutputEl.offsetHeight)-30)%20%7B%20//%20%3C--%20if%20the%20text%20box%20is%20already%20scrolled%20near%20the%20end%20of%20the%20text%5Cn%20%20%20%20%20%20%20%20%20%20%20%20descriptionOutputEl.scrollTop%20=%2099999999;%20//%20scroll%20down%20to%20bottom%20of%20textarea%20as%20text%20streams%20in%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20//%20generateObj%20=%20aiText(%7B%5Cn%20%20%20%20%20%20//%20%20%20instruction:%20%60%5Cn%20%20%20%20%20%20//%20%20%20Your%20task%20is%20to%20invent%20a%20character%20description%20for%20a%20roleplay.%5Cn%20%20%20%20%20%20//%20%20%20All%20you%20know%20about%20the%20character%20is%20what%20you%20can%20glean%20from%20this%20image%20prompt:%20$%7BtextToImagePluginOutput.inputs.prompt.replace(/%5C%5Cs+/g,%20%5C%22%20%5C%22)%7D%5Cn%20%20%20%20%20%20//%20%20%20$%7BcharDescriptionInstruction%20?%20%5C%22But%20also,%20the%20character%20must%20be%20based%20on%20this%20instruction:%20%5C%22+charDescriptionInstruction%20:%20%5C%22%5C%22%7D%5Cn%20%20%20%20%20%20//%20%20%20Your%20response%20should%20use%20this%20template:%5Cn%20%20%20%20%20%20//%20%20%20---%5Cn%20%20%20%20%20%20//%20%20%20Name:%20%3Ccharacter's%20name%3E%5Cn%20%20%20%20%20%20//%20%20%20Personality:%20%3Cone%20paragraph%20summarizing%20their%20personality,%20including%20specific%20interesting%20quirks%3E%5Cn%20%20%20%20%20%20//%20%20%20Background:%20%3Cone%20paragraph%20summarizing%20their%20backstory%3E%5Cn%20%20%20%20%20%20//%20%20%20Physical%20Features%20(IGNORING%20ATTIRE/POSE):%20%3Cup%20to%2010%20comma-separated%20keywords/phrases%20indicating%20*permanent*%20physical%20features%20like%20body%20type/build/size,%20skin%20color,%20eye%20color,%20hair%20color,%20nose%20shape,%20etc%3E%5Cn%20%20%20%20%20%20//%20%20%20Age:%20%3Ctheir%20age%3E%5Cn%20%20%20%20%20%20//%20%20%20---%5Cn%20%20%20%20%20%20//%20%20%20Respond%20with%20the%20above%20template,%20loosely%20inspired%20by%20details%20from%20the%20image%20description.%20Create%20an%20engaging,%20captivating,%20and%20*genuinely%20fascinating*%20character.%20Keep%20your%20response%20short.%20Use%20lean,%20unpretentious,%20crisp,%20descriptive%20words%20that%20vividly%20and%20*concisely*%20capture%20the%20most%20interesting%20aspects%20of%20the%20character%20that%20you've%20invented.%5Cn%20%20%20%20%20%20//%20%20%20IMPORTANT:%20Do%20NOT%20describe%20the%20image.%20This%20isn't%20about%20the%20image.%20It's%20about%20the%20*character*.%20Talk%20about%20the%20character,%20not%20the%20image.%20The%20image%20just%20provides%20clues.%5Cn%20%20%20%20%20%20//%20%20%20%60.trim(),%5Cn%20%20%20%20%20%20//%20%20%20startWith:%20%5C%22Name:%5C%22,%5Cn%20%20%20%20%20%20//%20%20%20stopSequences:%20%5B%5C%22Age:%5C%22%5D,%5Cn%20%20%20%20%20%20//%20%20%20onChunk:%20(data)%20=%3E%20%7B%5Cn%20%20%20%20%20%20//%20%20%20%20%20let%20parts%20=%20data.fullTextSoFar.split(/(Name:.*)/);%5Cn%20%20%20%20%20%20//%20%20%20%20%20nameOutputEl.value%20=%20parts%5B1%5D.trim().replace(/%5EName:/,%20%5C%22%5C%22).trim();%5Cn%20%20%20%20%20%20//%20%20%20%20%20descriptionOutputEl.value%20=%20parts%5B2%5D.trim().replace(/%5C%5CnAge:.?$/,%20%5C%22%5C%22).replace(%5C%22%20(IGNORING%20ATTIRE/POSE)%5C%22,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20//%20%20%20%20%20if(descriptionOutputEl.scrollTop%20%3E%20(descriptionOutputEl.scrollHeight%20-%20descriptionOutputEl.offsetHeight)-30)%20%7B%20//%20%3C--%20if%20the%20text%20box%20is%20already%20scrolled%20near%20the%20end%20of%20the%20text%5Cn%20%20%20%20%20%20//%20%20%20%20%20%20%20descriptionOutputEl.scrollTop%20=%2099999999;%20//%20scroll%20down%20to%20bottom%20of%20textarea%20as%20text%20streams%20in%5Cn%20%20%20%20%20%20//%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20//%20%20%20%7D,%5Cn%20%20%20%20%20%20//%20%7D);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20imageCtn.__generateObj%20=%20generateObj;%20//%20so%20the%20stop%20button%20can%20access%20it%5Cn%20%20%20%20let%20data%20=%20await%20generateObj;%5Cn%5Cn%20%20%20%20generateBtn.textContent%20=%20originalGenerateButtonTextContent;%5Cn%20%20%20%20generateBtn.disabled%20=%20false;%5Cn%20%20%20%20stopBtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%7D;%5Cn%5Cn%20%20window.t2i_generateChatLink%20=%20async%20function(imageCtn)%20%7B%5Cn%20%20%20%20let%20name%20=%20imageCtn.querySelector(%5C%22.character-name-output%5C%22).value.trim().replace(/%5C%5Cn+/g,%20%5C%22%20%5C%22);%5Cn%20%20%20%20let%20firstName%20=%20name.split(/%5B%20,%5D/)%5B0%5D.trim();%5Cn%20%20%20%20let%20description%20=%20imageCtn.querySelector(%5C%22.character-description-output%5C%22).value.trim().replace(/%5C%5Cn+/g,%20%5C%22%5C%5Cn%5C%22).trim();%5Cn%20%20%20%20let%20textToImagePluginOutput%20=%20imageCtn.querySelector(%5C%22iframe%5C%22).textToImagePluginOutput;%5Cn%5Cn%20%20%20%20if(!description)%20return%20alert(%5C%22First%20click%20the%20%F0%9D%97%B4%F0%9D%97%B2%F0%9D%97%BB%F0%9D%97%B2%F0%9D%97%BF%F0%9D%97%AE%F0%9D%98%81%F0%9D%97%B2%20%F0%9D%97%BD%F0%9D%97%B2%F0%9D%97%BF%F0%9D%98%80%F0%9D%97%BC%F0%9D%97%BB%F0%9D%97%AE%20button%20above%20to%20generate%20a%20character%20description.%5C%22);%5Cn%5Cn%20%20%20%20let%20appearance%20=%20(((description+%5C%22%5C%5Cn%5C%22).match(/Physical%20Features%20*(%7C%5C%5C(.+?%5C%5C)):%20(.+?)%5C%5Cn/s)%20%7C%7C%20%5B%5D)%5B1%5D%20%7C%7C%20%5C%22%5C%22).trim();%5Cn%5Cn%20%20%20%20let%20roleInstruction%20=%20%60%5Cn%20%20%20%20#%20Description%20of%20$%7Bname%7D:%5Cn%20%20%20%20$%7Bdescription%7D%5Cn%5Cn%20%20%20%20#%20Roleplay%20Guidelines:%5Cn%20%20%20%20-%20Bring%20characters%20to%20life%20by%20realistically%20portraying%20their%20unique%20traits,%20thoughts,%20emotions,%20appearances,%20physical%20sensations,%20speech%20patterns,%20and%20tone.%20Consider%20the%20situation,%20characters'%20motivations,%20and%20potential%20consequences.%5Cn%20%20%20%20-%20Ensure%20that%20their%20reactions,%20interactions,%20and%20decision-making%20align%20with%20their%20established%20personalities/descriptions,%20values,%20goals,%20and%20fears.%20You%20must%20**ALWAYS**%20maintain%20accurate%20character%20portrayals.%5Cn%5Cn%20%20%20%20Creatively%20improvise%20this%20fictional%20roleplay%20between%20%7B%7Bchar%7D%7D%20and%20%7B%7Buser%7D%7D%20to%20create%20an%20interesting%20and%20engaging%20experience/story/chat,%20no%20matter%20where%20%7B%7Buser%7D%7D%20decides%20to%20lead%20it.%20The%20overall%20goal%20is%20to%20create%20a%20genuinely%20fascinating%20and%20engaging%20roleplay/story.%20So%20good%20that%20you%20can't%20stop%20reading.%20Be%20proactive,%20introducing%20new%20events,%20proposing%20new%20conversation%20topics,%20and%20leading%20the%20role-play%20in%20new,%20interesting%20directions%20when%20appropriate%20to%20keep%20the%20overall%20experience%20engaging.%5Cn%20%20%20%20%60.trim();%5Cn%5Cn%20%20%20%20let%20characterImagePrompt%20=%20textToImagePluginOutput.inputs.prompt.replace(/%5C%5Cs+/g,%20%5C%22%20%5C%22);%5Cn%20%20%20%20let%20characterImageDataUrl%20=%20textToImagePluginOutput.dataUrl;%5Cn%20%20%20%20%5Cn%20%20%20%20function%20addStyleToPrompt(styleName,%20prompt)%20%7B%5Cn%20%20%20%20%20%20//%20bit%20weird,%20but%20we%20use%20a%20global%20to%20'communicate'%20with%20the%20t2i-styles%20generator's%20scope.%5Cn%20%20%20%20%20%20let%20originalWindowInput%20=%20window.input;%5Cn%20%20%20%20%20%20window.input%20=%20%7Bdescription:prompt%7D;%5Cn%20%20%20%20%20%20let%20result%20=%20t2iStyles%5BstyleName%5D.prompt.evaluateItem;%5Cn%20%20%20%20%20%20window.input%20=%20originalWindowInput;%5Cn%20%20%20%20%20%20return%20result;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20function%20addStyleToNegative(styleName,%20negative)%20%7B%5Cn%20%20%20%20%20%20//%20bit%20weird,%20but%20we%20use%20a%20global%20to%20'communicate'%20with%20the%20t2i-styles%20generator's%20scope.%5Cn%20%20%20%20%20%20let%20originalWindowInput%20=%20window.input;%5Cn%20%20%20%20%20%20window.input%20=%20%7Bnegative%7D;%5Cn%20%20%20%20%20%20let%20result%20=%20t2iStyles%5BstyleName%5D.negative.evaluateItem;%5Cn%20%20%20%20%20%20window.input%20=%20originalWindowInput;%5Cn%20%20%20%20%20%20return%20result;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20//%20If%20the%20generator%20has%20an%20artStyle%20select%20element,%20then%20we%20assume%20it's%20t2iStyles,%20and%20we%20use%20an%20empty%20prompt%20to%20extract%20only%20the%20style,%20so%20that%20style%20can%20be%20used%20in%20the%20chat%20by%20default%5Cn%20%20%20%20let%20imagePromptSuffix%20=%20%5C%22%5C%22;%5Cn%20%20%20%20try%20%7B%20//%20try/catch%20because%20new%20code%5Cn%20%20%20%20%20%20let%20artStyleName%20=%20window.___userSettings746291937.userInputs.artStyle?._element.value.split(%5C%22:%5C%22)%5B2%5D;%5Cn%20%20%20%20%20%20if(artStyleName)%20%7B%5Cn%20%20%20%20%20%20%20%20//%20we%20remove%20stuff%20like%20%5C%22(:1.3)%5C%22%20from%20the%20prompt%20because%20the%20style%20expects%20some%20input%20text,%20but%20we're%20not%20giving%20it%20here:%5Cn%20%20%20%20%20%20%20%20let%20prompt%20=%20addStyleToPrompt(artStyleName,%20%5C%22%5C%22).replace(/%5C%5C(%5B():.0-9%20%5D*%5C%5C)/g,%20%5C%22%5C%22).replace(/%5C%5Cs+/g,%20%5C%22%20%5C%22);%5Cn%20%20%20%20%20%20%20%20imagePromptSuffix%20=%20%60$%7Bprompt%7D%20(negativePrompt:::$%7BaddStyleToNegative(artStyleName,%20%5C%22%5C%22)%7D)%20(resolution:::512x768)%60;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%20catch(e)%20%7B%7D;%5Cn%5Cn%20%20%20%20let%20json%20=%20%7B%5Cn%20%20%20%20%20%20addCharacter:%20%7B%5Cn%20%20%20%20%20%20%20%20name,%5Cn%20%20%20%20%20%20%20%20roleInstruction,%5Cn%20%20%20%20%20%20%20%20maxParagraphCountPerMessage:%202,%20//%20TODO:%20add%20a%20drop-down%20selector%20for%20this?%5Cn%20%20%20%20%20%20%20%20imagePromptSuffix,%5Cn%20%20%20%20%20%20%20%20//%20I've%20commented%20out%20the%20line%20below%20for%20now%20because%20I've%20updated%20the%20character%20gen%20prompt,%20and%20it%20doesn't%20currently%20have%20a%20%5C%22purely%20appearance-only,%20without%20reference%20to%20pose/clothes/etc.%5C%22%20section%5Cn%20%20%20%20%20%20%20%20//%20imagePromptTriggers:%20%60$%7BfirstName%7D:%20$%7BfirstName%7D's%20appearance:%20$%7Bappearance%20%7C%7C%20characterImagePrompt%7D%60,%20//%20better%20to%20use%20%60appearance%60%20(if%20we%20have%20it)%20rather%20than%20%60characterImagePrompt%60,%20because%20character%20can%20be%20in%20images%20with%20other%20characters,%20but%20%60characterImagePrompt%60%20would%20likely%20affect%20overall%20image%20too%20much,%20since%20it's%20designed%20to%20generate%20a%20%5C%22whole%5C%22%20image.%5Cn%20%20%20%20%20%20%20%20initialMessages:%20%5B%5Cn%20%20%20%20%20%20%20%20%20%20%7Bauthor:%5C%22system%5C%22,%20content:%60%3Ci%20style=%5C%22font-size:85%25;%5C%22%3EIntroduce%20yourself%20to%20$%7Bname%7D,%20or%20perhaps%20%3Cb%20style=%5C%22color:#00af00;%5C%22%3Etap%20the%20Narrator%20button%3C/b%3E%20and%20tell%20it%20to%20generate%20an%20initial%20roleplay%20scenario%20based%20on%20some%20keywords/themes.%20You%20can%20change%20your%20name%20using%20the%20'options'%20button.%3C/i%3E%60,%20hiddenFrom:%5B%5C%22ai%5C%22%5D%7D,%5Cn%20%20%20%20%20%20%20%20%5D,%5Cn%20%20%20%20%20%20%20%20avatar:%20%7Burl:characterImageDataUrl,%20size:1,%20shape:%5C%22square%5C%22%7D,%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20quickAdd:%20true,%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20await%20window.t2i_generateShareLinkForCharacter(json);%5Cn%20%20%7D;%5Cn%5Cn%20%20window.t2i_generateShareLinkForCharacter%20=%20async%20function(json)%20%7B%5Cn%20%20%20%20if(!window.CompressionStream)%20%7B%5Cn%20%20%20%20%20%20alert(%5C%22Character%20chat%20links%20use%20a%20feature%20that's%20only%20available%20in%20modern%20browsers.%20Please%20upgrade%20your%20browser%20to%20the%20latest%20version%20to%20use%20this%20feature.%20If%20you're%20using%20Safari,%20switch%20to%20Chrome%20instead.%5C%22);%5Cn%20%20%20%20%20%20return;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20let%20loadingModal%20=%20window.t2i_createLoadingModal(%5C%22%E2%8C%9B%20Generating%20chat%20link...%5C%22);%5Cn%5Cn%20%20%20%20let%20jsonString%20=%20JSON.stringify(json);%20%5Cn%5Cn%20%20%20%20let%20urlHashData%20=%20encodeURIComponent(JSON.stringify(json)).replace(/%5B!'()*%5D/g,%20function(c)%20%7B%5Cn%20%20%20%20%20%20return%20'%25'%20+%20c.charCodeAt(0).toString(16);%20//%20since%20encodeURIComponent%20doesn't%20encode%20some%20characters%20(like%20parentheses)%20and%20they%20mess%20up%20markdown%20links%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20const%20shareUrlHashVersion%20=%20%60https://perchance.org/ai-character-chat#$%7BurlHashData%7D%60;%5Cn%20%20%20%20console.log(%5C%22shareUrl%20(hash%20version):%5C%22,%20shareUrlHashVersion);%5Cn%5Cn%20%20%20%20//%20convert%20json%20text%20to%20blob:%5Cn%20%20%20%20let%20dataUrlJsonString%20=%20jsonString.replace(/#/g,%20%5C%22%2523%5C%22);%20//%20since%20hash%20is%20a%20special%20character%20in%20dataurls%20(like%20normal%20URLs)%5Cn%20%20%20%20let%20blob%20=%20await%20fetch(%5C%22data:text/plain;charset=utf-8,%5C%22+dataUrlJsonString).then(res%20=%3E%20res.blob());%5Cn%5Cn%20%20%20%20//%20compress%20blob:%5Cn%20%20%20%20let%20compressedBlob%20=%20await%20compressBlobWithGzip(blob);%5Cn%5Cn%20%20%20%20let%20%7B%20url,%20size,%20error,%20deletionUrl%20%7D%20=%20await%20upload(compressedBlob);%5Cn%20%20%20%20if(error)%20%7B%5Cn%20%20%20%20%20%20loadingModal.delete();%5Cn%20%20%20%20%20%20//%20Originally%20checked%20to%20see%20if%20moderation%20error,%20but%20I%20think%20too%20many%20false%20positives%20atm,%20so%20just%20using%20hash%20version%20so%20no%20upload%20is%20required.%5Cn%20%20%20%20%20%20//%20Could%20also%20just%20be%20that%20upload%20plugin%20is%20having%20issues%20of%20course,%20or%20blocked%20due%20to%20e.g.%20using%20a%20VPN%20where%20other%20users%20have%20exhausted%20the%20daily%20limit%20for%20that%20VPN%20IP%5Cn%20%20%20%20%20%20await%20prompt2(%7B%5Cn%20%20%20%20%20%20%20%20content:%20%7Btype:%5C%22none%5C%22,%20html:%60%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22margin-bottom:0.5rem;opacity:0.7;font-size:90%25;text-align:%20center;%5C%22%3EYour%20character%20has%20been%20created.%20Click%20to%20chat:%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbutton%20onclick=%5C%22window.open('$%7BshareUrlHashVersion%7D')%5C%22%20style=%5C%22min-width:max-content;display:%20block;margin:%201rem%20auto;font-size:%201.3rem;padding:%200.5rem;%5C%22%3E%E2%86%97%EF%B8%8F%20open%20chat%20in%20new%20tab%20%F0%9F%92%AC%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cp%20style=%5C%22font-size:75%25;%20opacity:0.6;%20text-align:center;%5C%22%3ENote:%20A%20sharable%20link%20could%20not%20be%20created%20due%20to%20an%20upload%20error.%20Using%20a%20VPN%20may%20cause%20you%20to%20hit%20upload%20limits%20faster.%20Also,%20the%20moderation%20system%20may%20reject%20uploads%20if%20there%20are%20adult%20themes%20and%20it's%20not%20clear%20that%20relevant%20characters%20are%2018%20or%20older,%20in%20which%20case%20you%20should%20explicitly%20state%20character%20ages.%3C/p%3E%5Cn%20%20%20%20%20%20%20%20%60%7D,%5Cn%20%20%20%20%20%20%7D,%20%7BcolorScheme:%20%5C%22dark%5C%22,%20cancelButtonText:null,%20submitButtonText:%5C%22%E2%9D%8C%20finished%5C%22,%20verticallyCenter:true%7D);%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20loadingModal.delete();%20%5Cn%20%20%20%20%20%20let%20fileName%20=%20url.replace(%5C%22https://user.uploads.dev/file/%5C%22,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20let%20characterName%20=%20json.addCharacter.name.replace(/%5C%5Cs+/g,%20%5C%22_%5C%22).replaceAll(%5C%22~%5C%22,%20%5C%22%5C%22).replaceAll(%60%5C%22%60,%20%5C%22%5C%22);%20//%20this%20is%20just%20so%20URL%20is%20more%20readable%20-%20doesn't%20affect%20stored%20data%20at%20all%5Cn%20%20%20%20%20%20let%20shareUrl%20=%20%60https://perchance.org/ai-character-chat?data=$%7BcharacterName%7D~$%7BfileName%7D%60;%5Cn%20%20%20%20%20%20console.log(%5C%22shareUrl:%5C%22,%20shareUrl);%5Cn%5Cn%20%20%20%20%20%20let%20alreadyDeleting%20=%20false;%5Cn%20%20%20%20%20%20window.__deleteShareUrlHandler4738472929%20=%20async%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20if(!confirm(%5C%22This%20share%20URL%20will%20be%20permanently%20deleted.%20Note%20that%20deletion%20may%20not%20be%20instant%20(due%20to%20caching).%20Continue?%5C%22))%20return;%5Cn%20%20%20%20%20%20%20%20if(alreadyDeleting)%20return;%5Cn%20%20%20%20%20%20%20%20alreadyDeleting%20=%20true;%5Cn%20%20%20%20%20%20%20%20deleteShareUrlCtn.style.opacity%20=%20%5C%220.5%5C%22;%5Cn%20%20%20%20%20%20%20%20deleteShareUrlCtn.textContent%20=%20%5C%22%E2%8F%B3%20Deleting...%5C%22;%5Cn%20%20%20%20%20%20%20%20let%20%7B%20success%20%7D%20=%20await%20fetch(deletionUrl).then(r%20=%3E%20r.json());%5Cn%20%20%20%20%20%20%20%20deleteShareUrlCtn.textContent%20=%20%5C%22%E2%9C%85%20Deleted.%5C%22;%5Cn%20%20%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20%20%20let%20colorScheme%20=%20%5C%22dark%5C%22;%20//localStorage.forceColorScheme%20!==%20undefined%20?%20localStorage.forceColorScheme%20:%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches%20?%20%5C%22dark%5C%22%20:%20%5C%22light%5C%22;%5Cn%20%20%20%20%20%20await%20prompt2(%7B%5Cn%20%20%20%20%20%20%20%20content:%20%7Btype:%5C%22none%5C%22,%20html:%60%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22margin-bottom:0.5rem;%20opacity:0.7;%20font-size:90%25;%5C%22%3EYour%20character%20has%20been%20created.%20Here's%20the%20link:%3C/div%3E%3Cdiv%20style=%5C%22display:flex;%20gap:0.5rem;%5C%22%3E%3Cinput%20value=%5C%22$%7BshareUrl%7D%5C%22%20style=%5C%22flex-grow:1;%20color-scheme:$%7BcolorScheme%7D;%20min-width:0;%20font-size:80%25;%5C%22%3E%20%3Cbutton%20onclick=%5C%22navigator.clipboard.writeText(this.parentElement.querySelector('input').value);%20this.textContent='copied%20%E2%9C%85';%20setTimeout(()%20=%3E%20%7B%20this.textContent='%F0%9F%93%8B%20copy';%20%7D,%202000);%5C%22%20style=%5C%22min-width:max-content;%5C%22%3E%F0%9F%93%8B%20copy%3C/button%3E%20%3Cbutton%20onclick=%5C%22window.open(this.parentElement.querySelector('input').value)%5C%22%20style=%5C%22min-width:max-content;%5C%22%3E%E2%86%97%EF%B8%8F%20visit%3C/button%3E%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20id=%5C%22deleteShareUrlCtn%5C%22%20style=%5C%22font-size:80%25;margin-top:%200.5rem;%5C%22%3EYou%20can%20%3Cspan%20onclick=%5C%22window.__deleteShareUrlHandler4738472929()%5C%22%20style=%5C%22color:red;text-decoration:underline;cursor:%20pointer;%5C%22%3Eclick%20here%3C/span%3E%20to%20delete%20this%20share%20URL.%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%60%7D,%5Cn%20%20%20%20%20%20%7D,%20%7BcolorScheme,%20cancelButtonText:null,%20submitButtonText:%5C%22finished%5C%22,%20verticallyCenter:true%7D);%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%5Cn%20%20window.t2i_createLoadingModal%20=%20function(initialContent,%20parentElement)%20%7B%5Cn%20%20%20%20if(!parentElement)%20parentElement%20=%20document.body;%5Cn%20%20%20%20let%20loadingModalCtn%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20loadingModalCtn.innerHTML%20=%20%60%3Cstyle%3E%5Cn%20%20%20%20%20%20.loadingModalCtn-856246272937%20%7B%5Cn%20%20%20%20%20%20%20%20position:%20fixed;%5Cn%20%20%20%20%20%20%20%20top:%200;%5Cn%20%20%20%20%20%20%20%20left:%200;%5Cn%20%20%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20%20%20height:%20100%25;%5Cn%20%20%20%20%20%20%20%20background-color:%20rgba(0,0,0,0.7);%5Cn%20%20%20%20%20%20%20%20color-scheme:%20dark;%5Cn%20%20%20%20%20%20%20%20color:#e7e7e7;%5Cn%20%20%20%20%20%20%20%20z-index:%20100;%5Cn%20%20%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%20%20%20%20padding:%201rem;%5Cn%20%20%20%20%20%20%20%20z-index:%2099999999;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.loadingModalContent-856246272937%20%7B%5Cn%20%20%20%20%20%20%20%20background-color:%20#151515;%5Cn%20%20%20%20%20%20%20%20border-radius:%203px;%5Cn%20%20%20%20%20%20%20%20padding:%201rem;%5Cn%20%20%20%20%20%20%20%20text-align:%20center;%5Cn%20%20%20%20%20%20%20%20box-shadow:%200px%201px%2010px%203px%20rgb(130%20130%20130%20/%2024%25);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%3C/style%3E%60;%5Cn%20%20%20%20let%20contentEl%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20contentEl.classList.add(%5C%22loadingModalContent-856246272937%5C%22);%5Cn%20%20%20%20contentEl.innerHTML%20=%20initialContent%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20loadingModalCtn.appendChild(contentEl);%5Cn%20%20%20%20loadingModalCtn.classList.add(%5C%22loadingModalCtn-856246272937%5C%22);%5Cn%20%20%20%20parentElement.appendChild(loadingModalCtn);%5Cn%20%20%20%20return%20%7B%5Cn%20%20%20%20%20%20updateContent:%20function(content)%20%7B%5Cn%20%20%20%20%20%20%20%20contentEl.innerHTML%20=%20content;%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20delete:%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20loadingModalCtn.remove();%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20///////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20%20%20%20social/gallery%20button%20stuff%20%20%20%20%20%20%20%20//%5Cn%20%20///////////////////////////////////////////////%5Cn%20%20window.__showSocialsButtonClickHandler98347938%20=%20function()%20%7B%5Cn%20%20%20%20commentsPluginCtn654732.appendChild(window.generateCommentsPluginElement85638294());%5Cn%20%20%20%20imageGalleryCtn8569284.innerHTML%20=%20window.generateImageGalleryHtml358402048();%5Cn%20%20%20%20showHideGalleryAndCommentsButtonsCtn83728732671.style.display%20=%20'';%5Cn%20%20%20%20if(autoShowCheckbox84937483.checked)%20%7B%20localStorage.autoShowSocialsNextTime%20=%20'1';%20%7D;%5Cn%20%20%20%20showSocialsButtonCtn9000274628.remove();%5Cn%20%20%20%20if(thisGeneratorIsUsingClickCountBasedSocialDisplay%20&&%20!localStorage.theyKnowAboutClickCountBasedSocialDisplay)%20%7B%5Cn%20%20%20%20%20%20clickCountBasedSocialDisplayNotifierEl.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20///////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20handler%20for%20generate%20button%20click%20%20%20%20%20//%5Cn%20%20///////////////////////////////////////////////%5Cn%20%20window.___generateButtonClickEvent746291937%20=%20async%20function(event)%20%7B%5Cn%20%20%5Cn%20%20%20%20clearPerchanceErrors();%20//%20in%20case%20they%20has%20errors%20in%20their%20syntax%20in%20their%20last%20attempt,%20we%20don't%20want%20to%20keep%20showing%20the%20error%20bubble%20forever%5Cn%20%20%5Cn%20%20%20%20shareSettingsBtn758374.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20shareLinkCtn83927376.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%5Cn%20%20%20%20generateButtonEl.textContent%20=%20%5C%22%E2%AC%87%EF%B8%8F%20generating...%20%E2%AC%87%EF%B8%8F%5C%22;%5Cn%20%20%20%20generateButtonEl.disabled%20=%20true;%5Cn%20%20%20%20generateButtonEl.style.opacity%20=%200.7;%5Cn%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20generateButtonEl.textContent%20=%20%5C%22%E2%9C%A8%20generate%5C%22;%5Cn%20%20%20%20%20%20generateButtonEl.disabled%20=%20false;%5Cn%20%20%20%20%20%20generateButtonEl.style.opacity%20=%201;%5Cn%20%20%20%20%7D,%203000);%5Cn%20%20%5Cn%20%20%20%20let%20numImages%20=%206;%5Cn%20%20%20%20if(!isNaN(Number(settings.numImages?.evaluateItem)))%20numImages%20=%20Number(settings.numImages?.evaluateItem);%5Cn%20%20%20%20if(isNaN(numImages))%20numImages%20=%206;%5Cn%20%20%20%20%5Cn%20%20%20%20if(numImages%20%3E=%2012)%20%7B%5Cn%20%20%20%20%20%20mainColumnEl85394739.style.maxWidth%20=%20%5C%22100%25%5C%22;%20//%20it's%20set%20to%201000px%20by%20default%20so%203,%206,%209,%20and%2012%20images%20display%20nicely%20as%203%20per%20row,%20but%20at%2012%20or%20more%20on%20wide%20screens%20it's%20fine%20to%20take%20up%20the%20full%20screen%20width%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20mainColumnEl85394739.style.maxWidth%20=%20%5C%221000px%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(!window.___userSettings746291937.imageButtons)%20window.___userSettings746291937.imageButtons%20=%20%7B%7D;%5Cn%20%20%20%20%5Cn%20%20%20%20let%20underEachImageParts%20=%20%5B%5D;%5Cn%20%20%20%20if(window.___userSettings746291937.imageButtons.personality)%20underEachImageParts.push(%60%3Cbutton%20class='personality-chat-button'%20onclick=%5C%22window.t2i_openCharacterDescriptionEditor(this.closest('.t2i-image-ctn'))%5C%22%3E%F0%9F%8E%AD%20persona%20/%20%F0%9F%92%AC%20chat%3C/button%3E%60);%5Cn%20%20%20%20if(window.___userSettings746291937.imageButtons.privateSave)%20underEachImageParts.push(%60%3Cbutton%20class='private-save-button'%20style=%5C%22margin-left:0.5rem;%5C%22%20title=%5C%22Private%20save:%20Save%20this%20image%20to%20your%20browser's%20local%20storage%5C%22%20onclick=%5C%22window.t2i_privateGallerySave(this,%20this.closest('.t2i-image-ctn'))%5C%22%3E%F0%9F%9B%A1%EF%B8%8F%F0%9F%92%BE%3C/button%3E%60);%5Cn%20%20%20%20%5Cn%20%20%20%20let%20underEachImageHtml%20=%20%60%3Cdiv%3E$%7BunderEachImageParts.join(%5C%22%5C%22)%7D%3C/div%3E%60;%5Cn%20%20%20%20%5Cn%20%20%20%20if(localStorage.forceColorScheme)%20window.___userSettings746291937.imageOptions.forceColorScheme%20=%20localStorage.forceColorScheme;%5Cn%20%20%20%20outputAreaEl.innerHTML%20=%20%60%3Cdiv%20class=%5C%22t2i-image-ctn%5C%22%20style=%5C%22margin:0.25rem;%20$%7BunderEachImageParts.length%20%3E%200%20?%20%5C%22margin-bottom:0.6rem;%5C%22%20:%20%5C%22%5C%22%7D;%20position:relative;%5C%22%3E%5Bwindow.___textToImagePlugin746291937(window.___userSettings746291937.imageOptions)%5D%3Cdiv%20class=%5C%22t2i-under-each-image-ctn%5C%22%3E$%7BunderEachImageHtml%7D%3C/div%3E%3C/div%3E%60.repeat(numImages).evaluateItem%20+%20(settings.underImagesMessage%20?%20%60%3Cdiv%20style=%5C%22margin-top:0.5rem;flex:0%200%20100%25%5C%22%3E$%7Bsettings.underImagesMessage%7D%3C/div%3E%60%20:%20%5C%22%5C%22);%5Cn%20%20%20%20%5Cn%20%20%20%20let%20generateClickCount%20=%20Number(localStorage.generateClickCount%20%7C%7C%200);%5Cn%20%20%20%20generateClickCount++;%5Cn%20%20%20%20if(isNaN(generateClickCount)%20%7C%7C%20typeof%20generateClickCount%20!==%20%5C%22number%5C%22)%20generateClickCount%20=%201;%5Cn%20%20%20%20localStorage.generateClickCount%20=%20generateClickCount;%5Cn%20%20%20%20%5Cn%20%20%20%20if(window.showSocialFeaturesButtonAfterThisManyClicks%20!==%20undefined%20&&%20generateClickCount%20%3E=%20window.showSocialFeaturesButtonAfterThisManyClicks)%20%7B%5Cn%20%20%20%20%20%20let%20socialButton%20=%20document.querySelector(%5C%22#showSocialsButtonCtn9000274628%5C%22);%5Cn%20%20%20%20%20%20if(socialButton)%20socialButton.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(generateClickCount%20%3E%203)%20%7B%5Cn%20%20%20%20%20%20shareLinkOuterCtn2893827.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20if(generateClickCount%20%3E%203)%20%7B%5Cn%20%20%20%20%20%20pageTitleEl48759084793.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(generateClickCount%20%3E%209%20&&%20generateClickCount%2510%20===%200)%20%7B%20//%20caution:%20don't%20change%20%2510%20without%20changing%20the%20alert%20condition%20below%5Cn%20%20%20%20%20%20let%20successfullyPersisting%20=%20false;%5Cn%20%20%20%20%20%20let%20errorWhileTryingToPersist%20=%20false;%5Cn%20%20%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20%20%20if(navigator.storage%20&&%20navigator.storage.persist)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20persistent%20=%20await%20navigator.storage.persist();%5Cn%20%20%20%20%20%20%20%20%20%20if(persistent)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.log(%5C%22Storage%20will%20not%20be%20cleared%20except%20by%20explicit%20user%20action%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20successfullyPersisting%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.log(%5C%22Storage%20may%20be%20cleared%20by%20the%20UA%20under%20storage%20pressure.%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20%20%20errorWhileTryingToPersist%20=%20e;%5Cn%20%20%20%20%20%20%20%20console.error(e);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(!successfullyPersisting)%20%7B%5Cn%20%20%20%20%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20userHasSomeTextTheyAreTryingToRemember%20=%20Object.values(window.___userSettings746291937.userInputs).filter(o%20=%3E%20o.remember%20&&%20o._element.tagName.toLowerCase()%20===%20%5C%22textarea%5C%22).map(o%20=%3E%20o._element.value).join(%5C%22%5C%22).length%20%3E%20100;%5Cn%20%20%20%20%20%20%20%20%20%20if(userHasSomeTextTheyAreTryingToRemember)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20//%20note:%20these%20numbers%20must%20match%20generateClickCount%2510%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(generateClickCount%20===%2020%20%7C%7C%20generateClickCount%20===%2050%20%7C%7C%20generateClickCount%20===%20100%20%7C%7C%20generateClickCount%20===%20200%20%7C%7C%20generateClickCount%20===%20400%20%7C%7C%20generateClickCount%20===%20800)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20alert(%60Heads%20up:%20Your%20browser%20is%20currently%20not%20allowing%20scratchpad/input%20text%20to%20be%20permanently%20stored/persisted%20between%20page%20visits.%20The%20stored%20text%20may%20eventually%20be%20deleted%20by%20your%20browser.%20This%20could%20be%20because%20you're%20in%20incognito/private%20mode,%20or%20your%20hard%20drive%20is%20nearly%20full,%20or%20because%20the%20web%20browser%20you're%20using%20has%20bugs.%20Chrome%20is%20currently%20best%20browser%20in%20my%20experience%20(fewest%20bugs).%60);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20updateInputVisibilities();%5Cn%20%20%20%20%5Cn%20%20%20%20bottomClickHelperEl.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20leftClickHelperEl.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20rightClickHelperEl.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%7D;%5Cn%20%20%5Cn%20%20function%20generateModifierHtml(modifiers)%20%7B%5Cn%20%20%20%20let%20selectEls%20=%20%5B%5D;%5Cn%20%20%20%20for(let%20modifierName%20of%20modifiers.getAllKeys)%20%7B%5Cn%20%20%20%20%20%20let%20list%20=%20modifiers%5BmodifierName%5D;%5Cn%20%20%20%20%20%20if(!list.getAllKeys)%20continue;%20//%20some%20people%20have%20bugs%20in%20their%20list%20indentation%20etc.%20and%20this%20prevents%20their%20bugs%20from%20breaking%20the%20other%20modifiers%5Cn%20%20%20%20%20%20let%20optionEls%20=%20%5B%5D;%5Cn%20%20%20%20%20%20optionEls.push(%60%3Coption%20value=%5C%22%5C%22%20selected%3EAdd%20$%7BmodifierName%7D...%3C/option%3E%60);%5Cn%20%20%20%20%20%20for(let%20key%20of%20list.getAllKeys)%20%7B%5Cn%20%20%20%20%20%20%20%20optionEls.push(%60%3Coption%20value=%5C%22$%7Blist%5Bkey%5D.evaluateItem.replaceAll(%5C%22%5C%5C%5C%22%5C%22,%20%5C%22&quot;%5C%22)%7D%5C%22%3E$%7Bkey%7D%3C/option%3E%60)%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20selectEls.push(%60%3Cselect%20onchange=%5C%22if(this.value)%20%7B%20this.closest('.input-ctn').querySelector('textarea').value%20+=%20this.value;%20this.value='';%20this.closest('.input-ctn').querySelector('textarea').oninput(%7B%7D);%20let%20o=this.querySelector('option');%20let%20originalFirstItemContent=o.textContent;%20o.textContent='%E2%86%91%20Added%20%E2%86%91';%20setTimeout(()%20=%3E%20o.textContent=originalFirstItemContent,%201000);%20%7D%5C%22%20style=%5C%22margin-right:0.25rem;%20margin-top:0.25rem;%20font-size:80%25;%5C%22%3E$%7BoptionEls.join(%5C%22%5C%22)%7D%3C/select%3E%60);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20return%20selectEls.join(%5C%22%5C%22);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20initHandlers%20=%20%5B%5D;%5Cn%5Cn%20%20////////////////////////////////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20generate%20the%20HTML%20based%20on%20the%20specified%20userInputs%20list%20items%20%20%20%20%20//%5Cn%20%20////////////////////////////////////////////////////////////////////////////%5Cn%20%20let%20userInputsHtml%20=%20settings.userInputs.selectAll.map(item%20=%3E%20%7B%5Cn%20%20%5Cn%20%20%20%20let%20tipText%20=%20item.tip?.evaluateItem.trim();%5Cn%20%20%20%20if(tipText)%20tipText%20=%20tipText.replace(/%5C%22/g,%20%5C%22&quot;%5C%22);%5Cn%20%20%5Cn%20%20%20%20if(item.type%20===%20%5C%22text%5C%22)%20%7B%5Cn%20%20%20%20%20%20let%20widthStyle%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20if(item.width)%20widthStyle%20+=%20%60width:$%7Bitem.width%7D;%60;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20keyUpKeyDownAttributes%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20if(item.enterKeyTriggersGeneration)%20%7B%5Cn%20%20%20%20%20%20%20%20keyUpKeyDownAttributes%20=%20%60onkeyup=%5C%22if(event.which%20===%2013%20&&%20!event.shiftKey)%20%7B%20document.querySelector('#generateButtonEl').click();%20%7D%5C%22%20onkeydown=%5C%22if(event.which%20===%2013%20&&%20!event.shiftKey)%20%7B%20event.preventDefault();%20%7D%5C%22%60;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20foldToggleState%20=%20item.foldToggleState;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20html%20=%20%60%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-ctn%20input-type-text%20$%7Bitem.takesUpFullRow%20?%20%5C%22takesUpFullRow%5C%22%20:%20%5C%22%5C%22%7D%5C%22%20data-fold-toggle-state=%5C%22$%7BfoldToggleState%7D%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-inner%5C%22%20style=%5C%22$%7BwidthStyle%7D%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-label%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20style=%5C%22width:max-content;%5C%22%3E$%7Bitem.label%20%7C%7C%20item.getName.sentenceCase%7D%3C/span%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20$%7BtipText%20?%20%60%20%3Cspan%20class=%5C%22input-tip-btn%5C%22%20title=%5C%22$%7BtipText%7D%5C%22%20onclick=%5C%22alert(this.title)%5C%22%3E%E2%93%98%3C/span%3E%60%20:%20%5C%22%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20$%7BfoldToggleState%20===%20undefined%20?%20%5C%22%5C%22%20:%20%60%3Cbutton%20onclick=%5C%22let%20s%20=%20this.closest('.input-ctn').dataset.foldToggleState;%20if(s==='hidden')%20%7B%20this.closest('.input-ctn').dataset.foldToggleState='shown';%20%7D%20else%20%7B%20this.closest('.input-ctn').dataset.foldToggleState='hidden';%20%7D%5C%22%20class=%5C%22input-toggle-button%5C%22%3E%3C/button%3E%60%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-wrapper%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22width:100%25;%20position:relative;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20style=%5C%22$%7Bitem.autoSuggest%20?%20%5C%22%5C%22%20:%20%5C%22display:none;%5C%22%7D%5C%22%20class=%5C%22auto-suggest-btn%5C%22%3E%F0%9F%92%AD%3C/span%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20style=%5C%22$%7Bitem.autoSuggest%20?%20%5C%22%5C%22%20:%20%5C%22padding-right:0;%5C%22%7D%5C%22%20class=%5C%22text-input%5C%22%20data-name=%5C%22$%7Bitem.getName%7D%5C%22%20type=%5C%22text%5C%22%20oninput=%5C%22window.___inputElInputEvent746291937.bind(this)(event);%5C%22%20$%7BkeyUpKeyDownAttributes%7D%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20$%7Bitem.random%20?%20%60%3Cdiv%20class=%5C%22random-input-btn-ctn%5C%22%20data-input-name=%5C%22$%7Bitem.getName%7D%5C%22%3E%3Cbutton%3E%F0%9F%8E%B2%3C/button%3E%3C/div%3E%60%20:%20%5C%22%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%60;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20return%20html;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(item.type%20===%20%5C%22paragraph%5C%22)%20%7B%5Cn%20%20%20%20%20%20let%20widthStyle%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20if(item.width)%20widthStyle%20+=%20%60width:$%7Bitem.width%7D;%60;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20textareaStyle%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20let%20height%20=%20%5C%224rem%5C%22;%5Cn%20%20%20%20%20%20if(item.height)%20%7B%5Cn%20%20%20%20%20%20%20%20height%20=%20%60$%7Bitem.height%7D%60;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20if(window.innerWidth%20%3C%20550%20%7C%7C%20(item.random%20&&%20item.randomAppend))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20height%20=%20%5C%226rem%5C%22;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20textareaStyle%20+=%20%60height:$%7Bheight%7D;%60;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20foldToggleState%20=%20item.foldToggleState;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20keyUpKeyDownAttributes%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20if(item.enterKeyTriggersGeneration)%20%7B%5Cn%20%20%20%20%20%20%20%20keyUpKeyDownAttributes%20=%20%60onkeyup=%5C%22if(event.which%20===%2013%20&&%20!event.shiftKey)%20%7B%20document.querySelector('#generateButtonEl').click();%20%7D%5C%22%20onkeydown=%5C%22if(event.which%20===%2013%20&&%20!event.shiftKey)%20%7B%20event.preventDefault();%20%7D%5C%22%60;%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20let%20modifiersHtml%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20try%20%7B%20//%20try/catch%20just%20while%20testing%20this%5Cn%20%20%20%20%20%20%20%20let%20modifiersContainerId%20=%20%5C%22id%5C%22+Math.random().toString().replace(%5C%22.%5C%22,%20%5C%22%5C%22)+Math.random().toString().replace(%5C%22.%5C%22,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20%20%20modifiersHtml%20=%20%60%3Cdiv%20id=%5C%22$%7BmodifiersContainerId%7D%5C%22%20class=%5C%22input-modifiers%5C%22%20style=%5C%22display:flex;flex-wrap:%20wrap;%5C%22%3E$%7Bitem.modifiers%20?%20generateModifierHtml(item.modifiers)%20:%20%5C%22%5C%22%7D%3C/div%3E%60;%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20if(item.modifierUpdates)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20handlers%20=%20item.modifierUpdates.evaluateItem.split(%5C%22,%5C%22).map(h%20=%3E%20h.trim()).filter(h%20=%3E%20h.startsWith(%5C%22event:%5C%22)).map(h%20=%3E%20h.replace(/%5Eevent:/,%20%5C%22%5C%22).split(%5C%22.%5C%22)).map(a%20=%3E%20(%7BinputName:a%5B0%5D,%20eventName:a%5B1%5D%7D));%5Cn%20%20%20%20%20%20%20%20%20%20for(let%20h%20of%20handlers)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20handlerFunction%20=%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20document.querySelector(%60#$%7BmodifiersContainerId%7D%60).innerHTML%20=%20item.modifiers%20?%20generateModifierHtml(item.modifiers)%20:%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20initHandlers.push(%7BinputName:h.inputName,%20eventName:h.eventName,%20handler:handlerFunction%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20%20%20console.log(e);%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20let%20randomAppendHtml%20=%20item.randomAppend%20?%20%60%3Cbutton%20class=%5C%22random-append-btn%5C%22%20style=%5C%22margin-top:0.5rem;%5C%22%3E%E2%9E%95%3C/button%3E%60%20:%20%5C%22%5C%22;%5Cn%5Cn%20%20%20%20%20%20let%20html%20=%20%60%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-ctn%20input-type-paragraph%20$%7Bitem.takesUpFullRow%20?%20%5C%22takesUpFullRow%5C%22%20:%20%5C%22%5C%22%7D%5C%22%20data-fold-toggle-state=%5C%22$%7BfoldToggleState%7D%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-inner%5C%22%20style=%5C%22$%7BwidthStyle%7D%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-label%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20style=%5C%22width:max-content;%5C%22%3E$%7Bitem.label%20%7C%7C%20item.getName.sentenceCase%7D%3C/span%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20$%7BtipText%20?%20%60%20%3Cspan%20class=%5C%22input-tip-btn%5C%22%20title=%5C%22$%7BtipText%7D%5C%22%20onclick=%5C%22alert(this.title)%5C%22%3E%E2%93%98%3C/span%3E%60%20:%20%5C%22%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20$%7BfoldToggleState%20===%20undefined%20?%20%5C%22%5C%22%20:%20%60%3Cbutton%20onclick=%5C%22let%20s%20=%20this.closest('.input-ctn').dataset.foldToggleState;%20if(s==='hidden')%20%7B%20this.closest('.input-ctn').dataset.foldToggleState='shown';%20%7D%20else%20%7B%20this.closest('.input-ctn').dataset.foldToggleState='hidden';%20%7D%5C%22%20class=%5C%22input-toggle-button%5C%22%3E%3C/button%3E%60%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-wrapper%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22width:100%25;%20position:relative;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20style=%5C%22$%7Bitem.autoSuggest%20?%20%5C%22%5C%22%20:%20%5C%22display:none;%5C%22%7D%5C%22%20class=%5C%22auto-suggest-btn%5C%22%3E%F0%9F%92%AD%3C/span%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctextarea%20style=%5C%22$%7Bitem.autoSuggest%20?%20%5C%22%5C%22%20:%20%5C%22padding-right:0;%5C%22%7D%20$%7BtextareaStyle%7D%5C%22%20class=%5C%22paragraph-input%5C%22%20data-name=%5C%22$%7Bitem.getName%7D%5C%22%20oninput=%5C%22window.___inputElInputEvent746291937.bind(this)(event);%5C%22%20$%7BkeyUpKeyDownAttributes%7D%3E%3C/textarea%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20$%7Bitem.random%20?%20%60%3Cdiv%20class=%5C%22random-input-btn-ctn%5C%22%20data-input-name=%5C%22$%7Bitem.getName%7D%5C%22%3E%3Cbutton%20class=%5C%22random-input-btn%5C%22%3E%F0%9F%8E%B2%3C/button%3E%3Cbutton%20class=%5C%22ai-suggest-btn%5C%22%20style=%5C%22margin-top:0.5rem;%5C%22%3E%F0%9F%A7%A0%3C/button%3E$%7BrandomAppendHtml%7D%3C/div%3E%60%20:%20%5C%22%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20$%7BmodifiersHtml%7D%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%60;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20return%20html;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(item.type%20===%20%5C%22select%5C%22%20%7C%7C%20item.type%20===%20%5C%22visual-select%5C%22)%20%7B%5Cn%20%20%20%20%20%20let%20options%20=%20%5B%5D;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20thereAreImports%20=%20false;%5Cn%20%20%20%20%20%20item.compiledOptions%20=%20new%20Map();%20//%20use%20map%20to%20maintain%20insertion%20order%20when%20converting%20to%20%60entries%60%5Cn%20%20%20%20%20%20let%20nameToForcedPosition%20=%20%7B%7D;%5Cn%20%20%20%20%20%20let%20groupIndex%20=%20-1;%20//%20all%20items%20within%20an%20import%20have%20the%20same%20group%20index%20and%20normally-defined%20items%20are%20their%20own%20single-item%20group%20-%20this%20is%20so%20we%20can%20properly%20do%20sorting%20at%20the%20end,%20so%20that%20all%20imports%20are%20only%20sorted%20within%20their%20group.%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20for(let%20key%20of%20item.options.getAllKeys)%20%7B%5Cn%20%20%20%20%20%20%20%20groupIndex++;%5Cn%20%20%20%20%20%20%20%20if(key.startsWith(%5C%22meta:import%5C%22))%20%7B%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20thereAreImports%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20let%20tagImportWeights%20=%20%7B%7D;%5Cn%20%20%20%20%20%20%20%20%20%20if(item.options%5Bkey%5D.tagWeights)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20tagImportWeights%20=%20Object.fromEntries(item.options%5Bkey%5D.tagWeights.evaluateItem.split(%5C%22,%5C%22).map(t%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20tag%20=%20t.split(%5C%22:%5C%22)%5B0%5D.trim();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20factor%20=%20Number(t.split(%5C%22:%5C%22)%5B1%5D%20??%2010);%20//%20default%20boost%20is%2010.%20note%20that%20'boost'%20can%20be%20less%20than%201,%20which%20supresses%20the%20tag,%20and%20can%20even%20be%200,%20which%20filters%20out%20items%20with%20that%20tag%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(isNaN(factor))%20factor%20=%2010;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%5Btag,%20factor%5D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D));%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20let%20intraGroupSortingEpsilon%20=%200.00001;%20//%20%3C--%20just%20a%20little%20hack%20so%20that%20the%20imports%20that%20have%20the%20same%20score%20stay%20in%20the%20order%20in%20which%20they%20were%20defined%20in%20the%20imported%20list%5Cn%20%20%20%20%20%20%20%20%20%20for(let%20optionItem%20of%20item.options%5Bkey%5D.from.selectAll)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(item.compiledOptions.has(optionItem.getName))%20continue;%20//%20we%20don't%20overwrite%20ones%20that%20came%20before%20(higher%20takes%20precedence%20over%20lower)%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20optionItem.___groupIndex%20=%20groupIndex;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20item.compiledOptions.set(optionItem.getName,%20optionItem);%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(optionItem%5B%5C%22meta:position%5C%22%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20nameToForcedPosition%5BoptionItem.getName%5D%20=%20optionItem%5B%5C%22meta:position%5C%22%5D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(optionItem%5B%5C%22meta:tags%5C%22%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20for%20each%20importer%20tag%20weight,%20we%20multiply%20it%20by%20the%20matching%20'inherent'%20weight%20of%20the%20tag%20(if%20it%20exists%20on%20this%20imported%20item).%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20note%20that%20this%20means%20that%20if%20there%20are%20*any*%20matches,%20then%20ONLY%20those%20matches%20are%20considered.%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20optionItem.___intraGroupRankingScore%20=%200;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20thereWereTagWeightMatches%20=%20false;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20for(let%20%5Btag,%20inherentTagWeight%5D%20of%20Object.entries(optionItem%5B%5C%22meta:tags%5C%22%5D))%20%7B%20//%20for%20each%20tag%20on%20this%20imported%20item%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(tagImportWeights%5Btag%5D%20!==%20undefined)%20%7B%20//%20if%20the%20importer%20has%20specified%20a%20weight%20for%20this%20tag%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20thereWereTagWeightMatches%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20optionItem.___intraGroupRankingScore%20+=%20inherentTagWeight*tagImportWeights%5Btag%5D;%20//%20add%20to%20the%20score%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20if%20this%20imported%20style%20didn't%20have%20any%20tags%20that%20matched%20any%20of%20the%20importer%20tag%20weights,%20then%20we%20set%20its%20ranking%20score%20to%201%20+%20a%20small%20amount%20based%20on%20the%20mean%20of%20its%20inherent%20tag%20weights:%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(!thereWereTagWeightMatches)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20inherentTagWeights%20=%20Object.values(optionItem%5B%5C%22meta:tags%5C%22%5D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20EDIT:%20the%20problem%20with%20this%20is%20that%20it%20separates%20'categories'%20of%20styles%20which%20are%20better%20defined%20together%20-%20e.g.%20if%20all%20the%20anime%20styles%20are%20defined%20one%20after%20the%20other,%20then%20it's%20better%20to%20leave%20them%20like%20that%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20so%20for%20now%20I'm%20just%20going%20to%20set%20the%20score%20to%201%20if%20there%20were%20no%20matching%20tags.%20Can%20change%20this%20in%20v3%20if%20needed.%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20optionItem.___intraGroupRankingScore%20=%201;%20//%20+%20(inherentTagWeights.reduce((a,v)%20=%3E%20a+v,%200)%20/%20inherentTagWeights.length)%20/%2010000;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20optionItem.___intraGroupRankingScore%20=%201;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20optionItem.___intraGroupRankingScore%20+=%20intraGroupSortingEpsilon;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20intraGroupSortingEpsilon%20-=%20intraGroupSortingEpsilon*0.00001;%20//%20so%20the%20next%20item%20will%20get%20a%20slightly%20smaller%20boost%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20item.options%5Bkey%5D.___groupIndex%20=%20groupIndex;%5Cn%20%20%20%20%20%20%20%20%20%20item.options%5Bkey%5D.___intraGroupRankingScore%20=%201;%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20item.compiledOptions.set(key,%20item.options%5Bkey%5D);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20if(item.options%5Bkey%5D%5B%5C%22meta:position%5C%22%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20nameToForcedPosition%5Bkey%5D%20=%20item.options%5Bkey%5D%5B%5C%22meta:position%5C%22%5D;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20entries%20=%20%5B...item.compiledOptions.entries()%5D;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20if(thereAreImports)%20%7B%5Cn%20%20%20%20%20%20%20%20//%20filter%20out%20items%20with%20a%20score%20below%20or%20equal%20to%20zero%5Cn%20%20%20%20%20%20%20%20entries%20=%20entries.filter(e%20=%3E%20e%5B1%5D.___intraGroupRankingScore%20%3E%200);%5Cn%5Cn%20%20%20%20%20%20%20%20//%20here%20we%20do%20score-based%20ordering%20while%20strictly%20maintaining%20group%20index%20ordering.%5Cn%20%20%20%20%20%20%20%20//%20note%20that%20items%20from%20a%20meta:import%20are%20all%20part%20of%20their%20own%20group,%20whereas%20items%20that%20are%20defined%20normally%20are%20their%20own%20single-item%20group.%5Cn%20%20%20%20%20%20%20%20entries.sort((a,%20b)%20=%3E%20a%5B1%5D.___groupIndex%20-%20b%5B1%5D.___groupIndex%20%7C%7C%20b%5B1%5D.___intraGroupRankingScore%20-%20a%5B1%5D.___intraGroupRankingScore);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20do%20forced%20positioning:%5Cn%20%20%20%20%20%20for(let%20%5Bname,%20position%5D%20of%20Object.entries(nameToForcedPosition))%20%7B%5Cn%20%20%20%20%20%20%20%20let%20index%20=%20entries.findIndex((%5Bkey%5D)%20=%3E%20key%20===%20name);%5Cn%20%20%20%20%20%20%20%20if(index%20!==%20-1)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20%5Bremoved%5D%20=%20entries.splice(index,%201);%20//%20remove%20the%20item%20from%20its%20current%20position%5Cn%20%20%20%20%20%20%20%20%20%20entries.splice(position,%200,%20removed);%20//%20insert%20it%20into%20the%20desired%20position%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20item.compiledOptions%20=%20Object.fromEntries(entries);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20options.push(...entries.map((%5Bname,%20obj%5D)%20=%3E%20name).map(n%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20let%20hasSubKeys%20=%20false;%5Cn%20%20%20%20%20%20%20%20if(item.compiledOptions%5Bn%5D.getAllKeys%20&&%20item.compiledOptions%5Bn%5D.getAllKeys.length%20%3E%200)%20hasSubKeys%20=%20true;%20//%20hasSubKeys%20is%20needed%20because%20if%20it%20does%20have%20subkeys,%20then%20we%20expose%20the%20whole%20option%20object/node%20as%20%60keyName%60,%20rather%20than%20just%20the%20value%5Cn%20%20%20%20%20%20%20%20let%20keyName%20=%20n;%5Cn%20%20%20%20%20%20%20%20let%20display%20=%20item.compiledOptions%5Bn%5D.name%20??%20n;%5Cn%20%20%20%20%20%20%20%20let%20value%20=%20item.compiledOptions%5Bn%5D;%5Cn%20%20%20%20%20%20%20%20return%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20value,%5Cn%20%20%20%20%20%20%20%20%20%20display,%5Cn%20%20%20%20%20%20%20%20%20%20keyName:n,%5Cn%20%20%20%20%20%20%20%20%20%20hasSubKeys,%5Cn%20%20%20%20%20%20%20%20%20%20disabled:%20item.compiledOptions%5Bn%5D%5B%5C%22meta:disabled%5C%22%5D%20===%20true,%5Cn%20%20%20%20%20%20%20%20%20%20image:%20item.compiledOptions%5Bn%5D%5B%5C%22meta:image%5C%22%5D,%5Cn%20%20%20%20%20%20%20%20%20%20selected:%20item.compiledOptions%5Bn%5D%5B%5C%22meta:selected%5C%22%5D%20===%20true,%5Cn%20%20%20%20%20%20%20%20%7D;%20%5Cn%20%20%20%20%20%20%7D));%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20selectedOpt%20=%20options.find(opt%20=%3E%20opt.selected);%5Cn%20%20%20%20%20%20if(!selectedOpt)%20options%5B0%5D.selected%20=%20true;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20selectElHtml%20=%20%60%5Cn%20%20%20%20%20%20%20%20%3Cselect%20style=%5C%22$%7Bitem.type%20===%20%5C%22visual-select%5C%22%20?%20%5C%22display:none;%5C%22%20:%20%5C%22%5C%22%7D%20width:-webkit-fill-available;%20width:-moz-available;%20width:fill-available;%20max-width:9rem;%5C%22%20data-name=%5C%22$%7Bitem.getName%7D%5C%22%20onchange=%5C%22window.___selectElChangeEvent746291937.bind(this)(event);%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20$%7Boptions.map(opt%20=%3E%20%60%3Coption%20value=%5C%22$%7Bopt.hasSubKeys%20?%20%60ref:optionKeyName:$%7Bopt.keyName%7D%60%20:%20opt.value%7D%5C%22%20$%7Bopt.disabled%20?%20%5C%22disabled%5C%22%20:%20%5C%22%5C%22%7D%20%20$%7Bopt.selected%20?%20%5C%22selected%5C%22%20:%20%5C%22%5C%22%7D%3E$%7Bopt.display%7D%3C/option%3E%60).join(%5C%22%5C%5Cn%5C%22)%7D%5Cn%20%20%20%20%20%20%20%20%3C/select%3E%5Cn%20%20%20%20%20%20%60;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20the%20visual%20select%20is%20just%20a%20%5C%22facade%5C%22%20over%20the%20top%20of%20a%20normal%20(hidden)%20select%20-%20the%20underlying%20%3Cselect%3E%20is%20still%20used%20for%20all%20relevant%20logic%5Cn%20%20%20%20%20%20if(item.type%20===%20%5C%22visual-select%5C%22)%20%7B%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20let%20visualSelectOptions%20=%20options.map(opt%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20visualHtml;%5Cn%20%20%20%20%20%20%20%20%20%20if(false%20&&%20opt.image)%20%7B%20//%20TODO:%20work%20out%20the%20best%20approach%20here%20(e.g.%20grid%20+%20%5C%22slideshow%5C%22%20for%20each%20style?)%20and%20then%20enabled%20this%5Cn%20%20%20%20%20%20%20%20%20%20%20%20visualHtml%20=%20%60%3Cimg%20src=%5C%22$%7Bopt.image%7D%5C%22%20style=%5C%22max-height:20vh;%20display:block;%5C%22%3E%3Cdiv%20style=%5C%22font-size:85%25;position:%20sticky;bottom:%202rem;left:0;right:0;width:100%25;height:%200;text-align:center;%5C%22%3E%3Cspan%20style=%5C%22background:#ffffff;%20padding:0.25rem;%20border:2px%20solid%20black;%20border-radius:0.25rem;%20color:black;%5C%22%3E$%7Bopt.display%7D%3C/span%3E%3C/div%3E%60;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(!window.__preloadedVisualSelectImageUrls_957378)%20window.__preloadedVisualSelectImageUrls_957378%20=%20%7B%7D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(!window.__preloadedVisualSelectImageUrls_957378%5Bopt.image%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20img%20=%20document.createElement(%5C%22img%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20img.src%20=%20opt.image;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20img.style.cssText%20=%20%60position:fixed;%20width:1px;%20height:1px;%20left:-10px;%20top:-10px;%60;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20document.body.appendChild(img);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.__preloadedVisualSelectImageUrls_957378%5Bopt.image%5D%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20visualHtml%20=%20%60%3Cdiv%20style=%5C%22display:flex;%20justify-content:center;%20align-items:center;%20min-height:3rem;%5C%22%3E$%7Bopt.display%7D%3C/div%3E%60;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20return%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20value:%20opt.hasSubKeys%20?%20%60ref:optionKeyName:$%7Bopt.keyName%7D%60%20:%20opt.value,%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20disabled:%20opt.disabled,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20selected:%20opt.selected,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20html:%20%60%3Cdiv%20style=%5C%22border-radius:3px;%20overflow:hidden;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22overflow-x:auto;%20overflow-y:hidden;%20position:relative;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20$%7BvisualHtml%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%60,%5Cn%20%20%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20selectElHtml%20=%20%60%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22visual-select-btn%5C%22%20style=%5C%22width:max-content;%5C%22%20onclick=%5C%22window.__createSelectorModal_56974639274(JSON.parse(decodeURIComponent(this.dataset.options))).then(v%20=%3E%20%7B%20if(v%20!==%20null)%20%7B%20let%20selectEl%20=%20this.parentElement.querySelector('select');%20selectEl.value=v;%20selectEl.onchange(%7B%7D);%20%7D%20%7D)%5C%22%20data-options=%5C%22$%7BencodeURIComponent(JSON.stringify(visualSelectOptions))%7D%5C%22%3E$%7Boptions.find(opt%20=%3E%20opt.selected).display%7D%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%20%20$%7BselectElHtml%7D%5Cn%20%20%20%20%20%20%20%20%60;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20html%20=%20%60%3Cdiv%20class=%5C%22input-ctn%20input-type-select%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-inner%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-label%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20style=%5C%22width:max-content;%5C%22%3E$%7Bitem.label%20%7C%7C%20item.getName.sentenceCase%7D%3C/span%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20$%7BtipText%20?%20%60%20%3Cspan%20class=%5C%22input-tip-btn%5C%22%20title=%5C%22$%7BtipText%7D%5C%22%20onclick=%5C%22alert(this.title)%5C%22%3E%E2%93%98%3C/span%3E%60%20:%20%5C%22%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22input-wrapper%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20$%7BselectElHtml%7D%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%3C/div%3E%60;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20if(item.takesUpFullRow)%20%7B%5Cn%20%20%20%20%20%20%20%20html%20=%20%60%3Cdiv%20style=%5C%22width:100%25;%20display:flex;%20align-items:center;%20justify-content:center;%5C%22%3E$%7Bhtml%7D%3C/div%3E%60;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20return%20html;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20%5Cn%20%20%7D).join(%5C%22%5C%5Cn%5C%22);%5Cn%20%20%5Cn%20%20window.getCurrentColorScheme%20=%20function()%20%7B%5Cn%20%20%20%20if(localStorage.forceColorScheme%20!==%20undefined)%20%7B%5Cn%20%20%20%20%20%20return%20localStorage.forceColorScheme;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20return%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches%20?%20%5C%22dark%5C%22%20:%20%5C%22light%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20window.toggleManualDarkMode_jv83hb27igksf%20=%20function()%20%7B%5Cn%20%20%20%20//%20get%20current%20mode:%5Cn%20%20%20%20let%20colorScheme%20=%20window.getCurrentColorScheme();%5Cn%20%20%20%20%5Cn%20%20%20%20//%20change%20mode:%5Cn%20%20%20%20let%20newColorScheme%20=%20(colorScheme%20===%20%5C%22dark%5C%22%20?%20%5C%22light%5C%22%20:%20%5C%22dark%5C%22);%5Cn%20%20%20%20localStorage.forceColorScheme%20=%20newColorScheme;%5Cn%20%20%20%20setColorScheme(newColorScheme);%5Cn%20%20%20%20%5Cn%20%20%20%20//%20if%20chosen%20mode%20matches%20current%20OS%20default,%20we%20remove%20manual%20%5C%22forced%5C%22%20mode:%5Cn%20%20%20%20let%20systemColorScheme%20=%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches%20?%20%5C%22dark%5C%22%20:%20%5C%22light%5C%22;%5Cn%20%20%20%20if(systemColorScheme%20===%20newColorScheme)%20%7B%5Cn%20%20%20%20%20%20localStorage.removeItem(%5C%22forceColorScheme%5C%22);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20//%20regenerate%20comments%20and%20gallery%20(to%20propagate%20forceColorScheme%20if%20needed)%5Cn%20%20%20%20if(imageGalleryCtn8569284.querySelector(%5C%22iframe%5C%22))%20%7B%5Cn%20%20%20%20%20%20imageGalleryCtn8569284.innerHTML%20=%20%5C%22%5C%22;%20//%20need%20to%20clear%20it%20first%20because%20text-to-image%20plugin%20returns%20%5C%22%5C%22%20for%20gallery%20if%20one%20already%20exists%20(it's%20doing%20a%20hacky%20thing%20to%20prevent%20update()%20from%20reloading%20the%20gallery)%5Cn%20%20%20%20%20%20imageGalleryCtn8569284.innerHTML%20=%20window.generateImageGalleryHtml358402048();%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(commentsPluginCtn654732.querySelector(%5C%22iframe%5C%22))%20%7B%5Cn%20%20%20%20%20%20commentsPluginCtn654732.innerHTML%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20commentsPluginCtn654732.appendChild(window.generateCommentsPluginElement85638294())%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%5Cn%20%20function%20setColorScheme(scheme)%20%7B%5Cn%20%20%20%20if(scheme%20!==%20%5C%22dark%5C%22%20&&%20scheme%20!==%20%5C%22light%5C%22)%20throw%20new%20Error(%5C%22scheme%20should%20be%20'light'%20or%20'dark'%5C%22);%5Cn%20%20%20%20document.querySelector(%5C%22#darkModeBtn_875979f948%5C%22).textContent%20=%20(scheme%20===%20%5C%22dark%5C%22%20?%20%5C%22%F0%9F%8C%84%5C%22%20:%20%5C%22%F0%9F%8C%83%5C%22);%5Cn%20%20%20%20if(scheme%20===%20%5C%22dark%5C%22)%20%7B%5Cn%20%20%20%20%20%20document.documentElement.style.colorScheme%20=%20%5C%22dark%5C%22;%5Cn%20%20%20%20%20%20document.body.style.color%20=%20%5C%22#d8d4cf%5C%22;%5Cn%20%20%20%20%20%20document.body.style.backgroundColor%20=%20%5C%22#131516%5C%22;%5Cn%20%20%20%20%20%20document.documentElement.style.setProperty('--box-color',%20'#2a2a2a');%20//%20CAUTION!!!!%20--%3E%20do%20not%20rename%20this%20variable%20-%20it%20is%20being%20used%20in%20%5C%22user-land%5C%22%20on%20some%20generators%5Cn%20%20%20%20%20%20document.documentElement.style.setProperty('--active-comment-channel-tab-color',%20'#5b5b5b');%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20document.documentElement.style.colorScheme%20=%20%5C%22light%5C%22;%5Cn%20%20%20%20%20%20document.body.style.color%20=%20%5C%22black%5C%22;%5Cn%20%20%20%20%20%20document.body.style.backgroundColor%20=%20%5C%22white%5C%22;%5Cn%20%20%20%20%20%20document.documentElement.style.setProperty('--box-color',%20'#ebebeb');%5Cn%20%20%20%20%20%20document.documentElement.style.setProperty('--active-comment-channel-tab-color',%20'#c6c6c6');%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%5Cn%20%20///////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20do%20some%20stuff%20after%20page%20loads%20%20%20%20%20//%5Cn%20%20///////////////////////////////////////////%5Cn%20%20window.___pageLoadHandler746291937%20=%20function()%20%7B%5Cn%20%20%20%20%5Cn%20%20%20%20//%20let%20pageUrlIsShareLink%20=%20window.location.hash.slice(1).startsWith(%5C%22data=%5C%22);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20//%20during%20page%20load,%20set%20the%20chosen%20mode%20based%20on%20localStorage%20value%20if%20it%20exists:%5Cn%20%20%20%20if(localStorage.forceColorScheme%20!==%20undefined)%20%7B%5Cn%20%20%20%20%20%20setColorScheme(localStorage.forceColorScheme);%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20//%20user%20has%20not%20manually%20overwritten,%20so%20we%20use%20OS%20default:%5Cn%20%20%20%20%20%20let%20systemIsInDarkMode%20=%20!!(window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches);%5Cn%20%20%20%20%20%20setColorScheme(systemIsInDarkMode%20?%20%5C%22dark%5C%22%20:%20%5C%22light%5C%22);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(socialFeatures%20===%20%5C%22enabled%5C%22)%20%7B%5Cn%20%20%20%20%20%20commentsPluginCtn654732.appendChild(window.generateCommentsPluginElement85638294());%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20let%20generateClickCount%20=%20localStorage.generateClickCount%20?%20Number(localStorage.generateClickCount)%20:%200;%5Cn%20%20%20%20%5Cn%20%20%20%20if(thisGeneratorIsUsingClickCountBasedSocialDisplay%20&&%20!localStorage.theyKnowAboutClickCountBasedSocialDisplay)%20%7B%5Cn%20%20%20%20%20%20//%20clickCountBasedSocialDisplayNotifierEl.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(generateClickCount%20===%200)%20%7B%5Cn%20%20%20%20%20%20bottomClickHelperEl.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20leftClickHelperEl.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20rightClickHelperEl.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(generateClickCount%20%3E%203)%20%7B%5Cn%20%20%20%20%20%20shareLinkOuterCtn2893827.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20//%20Do%20init%20stuff%20like%20triggering%20oninput/onchange%20for%20each%20input%20right%20after%20init.%5Cn%20%20%20%20setTimeout(async%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20if(localStorage.autoShowSocialsNextTime%20&&%20document.querySelector(%5C%22#showSocialsButton927514532%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20if(socialFeatures%20!=%20%5C%22enabled%5C%22)%20document.querySelector(%5C%22#showSocialsButton927514532%5C%22).click();%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20userInputsCtn8462746262.querySelectorAll('input,%20select,%20textarea').forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20let%20userInputSpec%20=%20window.___userSettings746291937.userInputs%5Bel.dataset.name%5D;%5Cn%20%20%20%20%20%20%20%20userInputSpec._element%20=%20el;%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20for(let%20h%20of%20initHandlers)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20element%20=%20window.___userSettings746291937.userInputs%5Bh.inputName%5D._element;%5Cn%20%20%20%20%20%20%20%20element.addEventListener(h.eventName,%20h.handler);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20set%20initial%20values%5Cn%20%20%20%20%20%20userInputsCtn8462746262.querySelectorAll('input,%20select,%20textarea').forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20let%20userInputSpec%20=%20window.___userSettings746291937.userInputs%5Bel.dataset.name%5D;%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20let%20value;%5Cn%20%20%20%20%20%20%20%20if(userInputSpec.remember)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20value%20=%20getRememberedInput(el.dataset.name);%5Cn%20%20%20%20%20%20%20%20%7D%20else%20if(el.tagName%20===%20%5C%22TEXTAREA%5C%22%20%7C%7C%20(el.tagName%20===%20%5C%22INPUT%5C%22%20&&%20el.type%20===%20%5C%22text%5C%22))%20%7B%20//%20%3C--%20just%20to%20be%20sure%5Cn%20%20%20%20%20%20%20%20%20%20//%20value%20=%20localStorage%5B%5C%22t2i_tempRememberedInput_fisuyr9hf_%5C%22+el.dataset.name%5D;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(value%20!==%20undefined)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20el.value%20=%20value;%5Cn%20%20%20%20%20%20%20%20%20%20//%20%3Cselect%3E%20options%20can%20be%20removed%20by%20gen%20authors,%20so%20if%20the%20option%20doesn't%20exist,%20we%20just%20set%20it%20to%20the%20first%20option:%5Cn%20%20%20%20%20%20%20%20%20%20if((userInputSpec.type%20===%20%5C%22select%5C%22%20%7C%7C%20userInputSpec.type%20===%20%5C%22visual-select%5C%22)%20&&%20!%5B...el.querySelectorAll(%60option%60)%5D.find(el%20=%3E%20el.value%20===%20value))%20%7B%20//%20&&%20userInputSpec.compiledOptions%5Bvalue.replace(/%5Eref:optionKeyName:/,%20%5C%22%5C%22)%5D%20===%20undefined%5Cn%20%20%20%20%20%20%20%20%20%20%20%20el.value%20=%20el.querySelector(%5C%22option%5C%22).value;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20//%20NOTE:%20triggering%20change/input%20events%20like%20this%20doesn't%20trigger%20addEventListener%20handlers%20-%20like%20those%20added%20via%20initHandlers,%20above,%20but%5Cn%20%20%20%20%20%20%20%20//%20for%20now%20this%20is%20a%20happy%20accident%20because%20it's%20not%20for%20modifiers%20to%20not%20show%20up%20until%20you've%20actually%20typed%20something%20-%20reduces%20UI%5Cn%20%20%20%20%20%20%20%20//%20complexity%20on%20first%20impression.%5Cn%20%20%20%20%20%20%20%20if(el.onchange)%20el.onchange(%7B_isInitCall:true%7D);%5Cn%20%20%20%20%20%20%20%20if(el.oninput)%20el.oninput(%7B_isInitCall:true%7D);%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20updateInputVisibilities();%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20set%20up%20intervals%20for%20the%20rotating%20'example'%20placeholders%5Cn%20%20%20%20%20%20userInputsCtn8462746262.querySelectorAll('input,%20select,%20textarea').forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20let%20userInputSpec%20=%20window.___userSettings746291937.userInputs%5Bel.dataset.name%5D;%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20let%20examplesList%20=%20userInputSpec.examples;%5Cn%20%20%20%20%20%20%20%20if(examplesList%20&&%20((el.nodeName%20===%20%5C%22INPUT%5C%22%20&&%20el.type%20===%20%5C%22text%5C%22)%20%7C%7C%20el.nodeName%20===%20%5C%22TEXTAREA%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20set%20rotating%20placeholder%20text%20on%20text%20inputs%5Cn%20%20%20%20%20%20%20%20%20%20function%20nextExample()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(userInputSpec.useVariables%20&&%20window%5Bel.dataset.name.toUpperCase()%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.ignorePerchanceErrors(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20el.placeholder%20=%20window%5Bel.dataset.name.toUpperCase()%5D.evaluateItem;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20text%20=%20selectLeaf(examplesList).evaluateItem;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20try%20a%20few%20times%20to%20get%20a%20different%20one%20to%20the%20last-displayed%20one:%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(text%20===%20el.placeholder)%20text%20=%20selectLeaf(examplesList).evaluateItem;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(text%20===%20el.placeholder)%20text%20=%20selectLeaf(examplesList).evaluateItem;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(text%20===%20el.placeholder)%20text%20=%20selectLeaf(examplesList).evaluateItem;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20simple%20hack%20to%20save%20me%20a%20headache%20with%20escaping%20(e.g.%20for%20scratchpad%20placholder%20text)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20=%20text.replace(/&lsqb;/g,%20%5C%22%5B%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20=%20text.replace(/&rsqb;/g,%20%5C%22%5D%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20=%20text.replace(/&lcub;/g,%20%5C%22%7B%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%20=%20text.replace(/&rcub;/g,%20%5C%22%7D%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20el.placeholder%20=%20text;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20nextExample();%5Cn%20%20%20%20%20%20%20%20%20%20setInterval(nextExample,%203500);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20set%20up%20click%20handlers%20for%20the%20'random'%20buttons:%5Cn%20%20%20%20%20%20userInputsCtn8462746262.querySelectorAll('.random-input-btn-ctn').forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if(el.querySelector(%5C%22.random-input-btn%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20el.querySelector(%5C%22.random-input-btn%5C%22).onclick%20=%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20inputEl%20=%20el.closest(%5C%22.input-ctn%5C%22).querySelector(%5C%22input,%20textarea%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20userInputSpec%20=%20window.___userSettings746291937.userInputs%5Bel.dataset.inputName%5D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(userInputSpec.useVariables%20&&%20window%5Bel.dataset.inputName.toUpperCase()%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.clearPerchanceErrors();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputEl.value%20=%20window%5Bel.dataset.inputName.toUpperCase()%5D.evaluateItem;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20randomList%20=%20userInputSpec.random;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputEl.value%20=%20selectLeaf(randomList).evaluateItem;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20inputEl.oninput(%7B%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(el.querySelector(%5C%22.ai-suggest-btn%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20el.querySelector(%5C%22.ai-suggest-btn%5C%22).onclick%20=%20async%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20userInput%20=%20await%20getUserInput(%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20instruction:%20%7B%20type:%20%5C%22textarea%5C%22,%20label:%20%5C%22Let%20the%20AI%20generate%20a%20full%20prompt%20based%20on%20your%20ideas:%5C%22,%20placeholder:%20%5C%22Add%20keywords/ideas/instructions%20here...%5C%22,%20value:%20window.lastUsedAiSuggestPrompt%20%7C%7C%20%5C%22%5C%22%20%7D,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20type:%20%20%20%20%20%20%20%20%7B%20type:%20%5C%22select%5C%22,%20%20%20label:%20%5C%22Response%20type:%5C%22,%20options:%20%5B%7Bvalue:%5C%22curly%5C%22,%20label:%5C%22A%20prompt%20with%20%7Brandom%7Ccurly%7D%20blocks%5C%22%7D,%7Bvalue:%5C%22normal%5C%22,%20label:%5C%22A%20normal%20prompt%5C%22%7D%5D,%20value:%20localStorage.lastUsedAiSuggestResponseType%20%7C%7C%20%5C%22curly%5C%22%20%7D,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20tip:%20%20%20%20%20%20%20%20%20%7B%20type:%20%5C%22html%5C%22,%20%20%20%20%20html:%20%60%3Cdiv%20style=%5C%22opacity:0.8;%20font-size:75%25;%5C%22%3E%3Cb%3ETip%3C/b%3E:%20Optimize%20prompts%20with%20the%20%3Ca%20href=%5C%22https://perchance.org/image-prompt-optimizer%5C%22%20style=%5C%22font-weight:bold;color:#2bbb00;%5C%22%20target=%5C%22_blank%5C%22%3EImage%20Prompt%20Optimizer%3C/a%3E.%3C/div%3E%60,%20marginBottom:%5C%220px%5C%22%20%7D,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20%7B%20okText:%5C%22Generate%5C%22,%20cancelText:%5C%22Cancel%5C%22,%20cancelOnBackgroundClick:true%20%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20//%20let%20input%20=%20prompt(%5C%22Enter%20some%20ideas/keywords%20and%20the%20AI%20will%20generate%20a%20full%20description%20for%20you.%5C%5Cn%5C%5Cn(You%20can%20also%20specify%20desired%20writing%20style/length)%5C%22,%20window.lastUsedAiSuggestPrompt%20%7C%7C%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(userInput%20&&%20userInput.instruction.trim())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20window.lastUsedAiSuggestPrompt%20=%20userInput.instruction.trim();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20localStorage.lastUsedAiSuggestResponseType%20=%20userInput.type;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20userInput.instruction%20=%20userInput.instruction.trim();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20doCurly%20=%20userInput.type%20===%20%5C%22curly%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20curlyBraceInstruction%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(doCurly)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20curlyBraceInstruction%20=%20%60%5C%5Cn%5C%5CnThis%20description%20will%20be%20used%20for%20image%20generation,%20so%20throughout%20the%20description%20you%20should%20add%20lots%20of%20'curly%20brace%20block'%20notation%20to%20add%20randomness,%20so%20that%20each%20image%20is%20unique.%20For%20example,%20you%20could%20write%20%5C%22a%20%7Bcandid%7Cstudio%7Cdrone%7Cselfie%7Ccute%20illustrated%7D%20%7Bportrait%7Cpanorama%7D%20of%20a%20...%5C%22.%20You%20can%20use%20curly%20blocks%20to%20vary%20colors,%20lighting,%20expressions,%20locations/setting,%20backgrounds,%20camera%20angle,%20clothing,%20themes,%20art/photo%20styles,%20and%20literally%20anything%20else.%60;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20suggestBtn%20=%20el.querySelector(%5C%22.ai-suggest-btn%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20suggestBtn.innerHTML%20=%20%60%3Cspan%20style=%5C%22display:inline-block;%20animation:rotate%201.5s%20linear%20infinite;%5C%22%3E%E2%8F%B3%3C/span%3E%60;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20suggestBtn.disabled%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20originalSuggestBtnDisplay%20=%20suggestBtn.style.display;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20stopBtn%20=%20document.createElement(%5C%22button%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20stopBtn.innerHTML%20=%20%60%F0%9F%9B%91%60;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20stopBtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20stopBtn.style.marginTop%20=%20%5C%220.5rem%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20inputEl%20=%20el.closest(%5C%22.input-ctn%5C%22).querySelector(%5C%22input,%20textarea%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20chunkCount%20=%200;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20fullTextSoFar%20=%20doCurly%20?%20%5C%22%7B%5C%22%20:%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20originalInputElHeight%20=%20inputEl.offsetHeight;%20//%20so%20we%20don't%20make%20the%20textarea%20smaller%20than%20it%20originally%20was%5Cn%20%20%20%20%20%20%20%20%20%20%20%20inputEl.value%20=%20%5C%22Loading...%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20pendingObj%20=%20aiText(%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20instruction:%20%60Your%20task%20is%20to%20create%20a%20description%20of%20a%20hypothetical%20image%20which%20is%20based%20on%20the%20following%20idea/keywords/instruction%20provided%20by%20the%20user:%20$%7BuserInput.instruction.evaluateItem%7D%5C%5Cn%5C%5CnExpand%20on%20it%20and%20come%20up%20with%20a%20fully-formed,%20genuinely%20superb%20idea%20based%20on%20that%20instruction,%20and%20write%20a%20description/caption%20which%20fully%20captures%20all%20visual%20aspects%20the%20image.%20Your%20response%20should%20be%20descriptive,%20engaging,%20and%20should%20fully%20lean%20into%20the%20task%20with%20unshackled%20and%20eager%20abandon,%20fulfilling%20the%20request%20beyond%20expectations%20of%20the%20user.%20You%20have%20full%20creative%20license%20to%20go%20WILD%20and%20absolutely%20nail%20the%20*exact*%20underlying%20intent%20and%20*deep*%20desire%20behind%20the%20instruction,%20such%20that%20the%20user's%20jaw%20drops%20at%20how%20you%20nailed%20exactly%20what%20they%20were%20aiming%20for.$%7BcurlyBraceInstruction%7D%5C%5Cn%5C%5CnStart%20your%20response%20with%20%5C%22Description:%20The%20image%20shows%5C%22%20and%20then%20give%20a%20one-paragraph%20description%20which%20captures%20all%20visual%20details%20of%20the%20idea$%7BdoCurly%20?%20%60,%20and%20includes%20many%20curly%20brace%20blocks%60%20:%20%5C%22%5C%22%7D.%20Be%20sure%20to%20**follow%20the%20user's%20ideas/instructions%20exactly**!%60,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20startWith:%20%60Description:%20The%20image%20shows%60+%20(doCurly%20?%20%5C%22%20%7B%5C%22%20:%20%5C%22%5C%22),%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20stopSequences:%20%5B%5C%22%5C%5Cn%5C%22%5D,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20hideStartWith:%20true,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20onChunk:%20(data)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(chunkCount%20===%200)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputEl.value%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20stopBtn.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20suggestBtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(!data.isFromStartWith)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fullTextSoFar%20+=%20data.textChunk;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20inputEl.value%20=%20fullTextSoFar.trim().slice(0,%201).toUpperCase()%20+%20fullTextSoFar.trim().slice(1);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputEl.value%20=%20fullTextSoFar.trim();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(inputEl.offsetHeight%20%3C%20inputEl.scrollHeight+10)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputEl.style.height%20=%20%5C%2210px%5C%22;%20//%20otherwise%20scrollHeight%20can%20be%20bigger%20than%20the%20text.%20this%20ensures%20that%20the%20textarea%20is%20short%20enough%20for%20the%20textarea%20scrollbar%20to%20be%20showing%20-%20user%20shouldn't%20see%20it%20because%20its%20done%20synchonously%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputEl.style.height%20=%20Math.max(originalInputElHeight,%20inputEl.scrollHeight+10)%20+%20%5C%22px%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20chunkCount++;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20suggestBtn.after(stopBtn);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20stopBtn.onclick%20=%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20stopBtn.disabled%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20pendingObj.stop();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20onInputInterval%20=%20setInterval(()%20=%3E%20inputEl.oninput(%7B%7D),%202000);%20//%20so%20that%20if%20they%20click%20'generate'%20mid-text-gen,%20it'll%20still%20work%5Cn%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20pendingObj.onFinishPromise;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.error(e);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20clearInterval(onInputInterval);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20inputEl.oninput(%7B%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20stopBtn.remove();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20suggestBtn.style.display%20=%20originalSuggestBtnDisplay;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20suggestBtn.innerHTML%20=%20%60%F0%9F%A7%A0%60;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20suggestBtn.disabled%20=%20false;%5Cn%20%20%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(el.querySelector(%5C%22.random-append-btn%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20el.querySelector(%5C%22.random-append-btn%5C%22).onclick%20=%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20inputEl%20=%20el.closest(%5C%22.input-ctn%5C%22).querySelector(%5C%22input,%20textarea%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20userInputSpec%20=%20window.___userSettings746291937.userInputs%5Bel.dataset.inputName%5D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20randomAppendList%20=%20userInputSpec.randomAppend;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20randomAppendStr%20=%20selectLeaf(randomAppendList).evaluateItem;%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20start%20=%20inputEl.selectionStart;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20end%20=%20inputEl.selectionEnd;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(start%20===%20end)%20start%20=%20end%20=%20inputEl.value.length;%20//%20append%20when%20nothing%20selected%5Cn%20%20%20%20%20%20%20%20%20%20%20%20inputEl.setRangeText(randomAppendStr,%20start,%20end,%20%5C%22select%5C%22);%20//%20undo-friendly%20replace/append%5Cn%20%20%20%20%20%20%20%20%20%20%20%20inputEl.focus();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20inputEl.oninput(%7B%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20focus%20on%20first%20non-hidden%20text%20input%20(only%20on%20non-mobile%20devices,%20otherwise%20onscreen%20keyboard%20pops%20up,%20which%20might%20be%20annoying):%5Cn%20%20%20%20%20%20if(window.innerWidth%20%3E%20700%20&&%20!window.location.hash.startsWith(%5C%22#edit%5C%22)%20&&%20!window.alreadyFocussedTextAreaOnLoad)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20textInput%20=%20%5B...userInputsCtn8462746262.querySelectorAll('textarea,%20input')%5D.filter(el%20=%3E%20el.offsetHeight%20!==%200)%5B0%5D;%5Cn%20%20%20%20%20%20%20%20if(textInput)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20distanceFromTopOfPage%20=%20textInput.getBoundingClientRect().top;%5Cn%20%20%20%20%20%20%20%20%20%20if(distanceFromTopOfPage%20%3C%20300)%20%7B%20//%20don't%20focus%20if%20it's%20way%20down%20the%20page%20-%20we%20want%20to%20keep%20the%20page%20scrolled%20to%20the%20top%20on%20load%5Cn%20%20%20%20%20%20%20%20%20%20%20%20textInput.focus();%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20window.alreadyFocussedTextAreaOnLoad%20=%20true;%20//%20this%20is%20a%20hacky%20way%20to%20disable%20this%20when%20someone%20is%20editing%20a%20t2i-framework%20powered%20generator,%20since%20that's%20the%20only%20case%20where%20this%20plugin's%20code%20will%20be%20called%20multiple%20times%20(and%20the%20focus%20will%20annoyingly%20steal%20away%20focus%20from%20the%20perchance%20code%20editor)%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20wait%20a%20'tick'%20and%20then%20load%20share%20link%20data%20if%20it%20exists:%5Cn%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%2010));%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20hash%20=%20window.location.hash.slice(1);%5Cn%20%20%20%20%20%20if(hash%20&&%20hash.startsWith(%5C%22data=%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20console.log(%5C%22Loading%20data%20from%20URL%20hash...%5C%22);%5Cn%20%20%20%20%20%20%20%20let%20result%20=%20await%20loadDataFromUrlHash();%5Cn%20%20%20%20%20%20%20%20if(result.success)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20console.log(%5C%22Loaded%20data%20from%20URL%20hash.%5C%22);%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20console.log(%5C%22Loading%20share%20data%20from%20URL%20hash%20failed:%5C%22,%20result);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20If%20there's%20an%20%5C%22Art%20Style%5C%22%20drop-down,%20then%20flash%20it%20a%20few%20times%20on%20page%20load%20to%20ensure%20people%20understand%20that%20they%20can%20change%20the%20style%5Cn%20%20%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20%20%20if(!localStorage.generateClickCount%20%7C%7C%20Number(localStorage.generateClickCount)%20%3C=%201)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20artStyleInnerEl%20=%20%5B...document.querySelectorAll(%5C%22.input-ctn.input-type-select%20.input-inner%5C%22)%5D.filter(el%20=%3E%20el.textContent.toLowerCase().includes(%5C%22art%20style%5C%22))%5B0%5D;%5Cn%20%20%20%20%20%20%20%20%20%20if(artStyleInnerEl)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20isDarkMode%20=%20window.matchMedia('(prefers-color-scheme:%20dark)').matches;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20originalBackgroundColor%20=%20artStyleInnerEl.style.backgroundColor;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20flashCount%20=%200;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20flashInterval%20=%20setInterval(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(artStyleInnerEl.style.backgroundColor%20===%20originalBackgroundColor)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20artStyleInnerEl.style.backgroundColor%20=%20isDarkMode%20?%20%5C%22#364183%5C%22%20:%20%5C%22#7fb4ff%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20artStyleInnerEl.style.backgroundColor%20=%20originalBackgroundColor;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20flashCount++;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(flashCount%20%3E%208)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20clearInterval(flashInterval);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20artStyleInnerEl.style.backgroundColor%20=%20originalBackgroundColor;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20400);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20%20%20console.error(e);%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%7D,%20100);%5Cn%20%20%7D;%5Cn%20%20%5Cn%20%20//%20Hackily%20trigger%20the%20page%20load%20handler%20with%20an%20%3Cimg%3E%20onerror%20because%20it's%20an%20easy%20way%20to%20execute%20a%20script%20right%20after%20the%20HTML%20has%20been%20rendered.%5Cn%20%20let%20dummyImageScriptTrigger%20=%20%60%3Cimg%20style=%5C%22display:fixed;opacity:0;pointer-events:none;top:-2000px;%5C%22%20src=%5C%22%5C%22%20onerror=%5C%22window.___pageLoadHandler746291937();%20this.remove();%5C%22%3E%60;%5Cn%20%20%5Cn%20%20window.generateFeedbackCommentsHtml_8974sklfjosifo%20=%20function()%20%7B%5Cn%20%20%20%20//%20old%20channel%20name:%20feedback-94d35yisdfiwh%20(annoying%20to%20subscribe%20to%20notifications%20for)%5Cn%20%20%20%20let%20options%20=%20%7Bchannel:%5C%22t2i-feedback%5C%22,%20hideComments:settings.showFeedback%20%7C%7C%20location.hash.startsWith(%5C%22#showfeedback%5C%22)%20?%20false%20:%20true,%20height:settings.showFeedback%20%7C%7C%20location.hash.startsWith(%5C%22#showfeedback%5C%22)%20?%20500%20:%20220,%20width:300,%20commentPlaceholderText:%20%5C%22Share%20some%20feedback.%20Do%20not%20share%20personal%20info,%20this%20feedback%20data%20is%20public.%20If%20there's%20a%20technical%20issue/bug%20%F0%9D%98%81%F0%9D%97%BF%F0%9D%98%86%20%F0%9D%98%82%F0%9D%98%80%F0%9D%97%B6%F0%9D%97%BB%F0%9D%97%B4%20%F0%9D%97%96%F0%9D%97%B5%F0%9D%97%BF%F0%9D%97%BC%F0%9D%97%BA%F0%9D%97%B2%20%F0%9D%97%BC%F0%9D%97%BF%20%F0%9D%97%99%F0%9D%97%B6%F0%9D%97%BF%F0%9D%97%B2%F0%9D%97%B3%F0%9D%97%BC%F0%9D%98%85,%20otherwise%20give%20as%20much%20detail%20as%20you%20can%20about%20the%20issue,%20including%20your%20device%20(e.g.%20Android/iPhone).%20If%20the%20issue%20is%20about%20bad%20outputs,%20specify%20the%20chosen%20style%20and%20prompt%20you%20used%20(if%20relevant).%5C%22,%20submitButtonText:%20%5C%22submit%20feedback%5C%22,%20hideSettingsButton:true,%20hideFullscreenButton:true%7D;%5Cn%20%20%20%20if(localStorage.forceColorScheme)%20options.forceColorScheme%20=%20localStorage.forceColorScheme;%5Cn%20%20%20%20return%20window.___commentsPlugin746291937(options);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20window.generateCommentsPluginElement85638294%20=%20function()%20%7B%5Cn%20%20%20%20let%20defaultChannelOptions%20=%20window.___userSettings746291937.defaultCommentOptions;%5Cn%20%20%20%20let%20channels%20=%20window.___userSettings746291937.commentChannels;%5Cn%20%20%20%20if(!channels)%20%7B%5Cn%20%20%20%20%20%20let%20styleEl%20=%20document.createElement(%5C%22style%5C%22);%5Cn%20%20%20%20%20%20styleEl.textContent%20=%20%60#hideCommentsBtn85937402%20%7B%20display:none%20!important;%20%7D%60;%5Cn%20%20%20%20%20%20document.head.append(styleEl);%5Cn%20%20%20%20%20%20return%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20return%20tabbedCommentsPlugin(%7Bchannels,%20defaultChannelOptions%7D);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20window.generateImageGalleryHtml358402048%20=%20function()%20%7B%5Cn%20%20%20%20const%20settings%20=%20window.___userSettings746291937;%5Cn%20%20%20%20if(!settings.galleryOptions%20%7C%7C%20!settings.galleryOptions.gallery)%20%7B%5Cn%20%20%20%20%20%20let%20styleEl%20=%20document.createElement(%5C%22style%5C%22);%5Cn%20%20%20%20%20%20styleEl.textContent%20=%20%60#hideGalleryBtn85937402%20%7B%20display:none%20!important;%20%7D%60;%5Cn%20%20%20%20%20%20document.head.append(styleEl);%5Cn%20%20%20%20%20%20return%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20settings.galleryOptions.forceColorScheme%20=%20null;%5Cn%20%20%20%20if(localStorage.forceColorScheme)%20settings.galleryOptions.forceColorScheme%20=%20localStorage.forceColorScheme;%5Cn%5Cn%20%20%20%20//%20Integrate%20privateSave%20and%20gallery%20customButton%20features:%5Cn%20%20%20%20if(settings.imageButtons?.privateSave)%20%7B%5Cn%20%20%20%20%20%20const%20blobToDataURL%20=%20b%20=%3E%20new%20Promise(r=%3E%7Bconst%20fr=new%20FileReader();fr.onload=()=%3Er(fr.result);fr.readAsDataURL(b);%7D);%5Cn%20%20%20%20%20%20if(!settings.galleryOptions.customButton)%20%7B%5Cn%20%20%20%20%20%20%20%20settings.galleryOptions.customButton%20=%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20emoji:%20%5C%22%E2%AD%90%5C%22,%5Cn%20%20%20%20%20%20%20%20%20%20onClick:%20async%20(data)%20=%3E%20%7B%5Cn%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20%7B%20prompt,%20negativePrompt,%20seed,%20guidanceScale%20%7D%20=%20data;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20imageBlob%20=%20await%20fetch(data.imageUrl).then(r%20=%3E%20r.blob());%5Cn%20%20%20%20%20%20%20%20%20%20%20%20await%20window.t2i_privateGallery.add(imageBlob,%20%7Binfo:%7Bprompt,%20negativePrompt,%20seed,%20guidanceScale%7D%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20dataUrl%20=%20await%20blobToDataURL(imageBlob)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20imgEl%20=%20document.createElement(%5C%22img%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20imgEl.style.cssText%20=%20%5C%22opacity:0.5;%20pointer-events:none;%20background:#333;%20border-radius:3px;%20width:200px;%20height:200px;%20position:fixed;%20top:calc(50%25%20-%2050px);%20left:calc(50%25%20-%2050px);%20object-fit:contain;%20object-position:center;%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20imgEl.src%20=%20dataUrl;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20document.body.append(imgEl);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20animateImageIntoTarget(%7BimgEl,%20sourceEl:imgEl,%20targetEl:privateGalleryCtn97364827.querySelector(%5C%22button%5C%22),%20durationMs:700,%20wiggle:true%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20//%20Use%20the%20second%20custom%20button%20for%20comments%20popup%20on%20each%20image:%5Cn%20%20%20%20if(!settings.galleryOptions.customButton2)%20%7B%5Cn%20%20%20%20%20%20settings.galleryOptions.customButton2%20=%20%7B%5Cn%20%20%20%20%20%20%20%20emoji:%20%5C%22%F0%9F%92%AC%5C%22,%5Cn%20%20%20%20%20%20%20%20onClick:%20async%20(data)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20options%20=%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel:%20%5C%22image-%5C%22+data.imageId.slice(0,%2025),%5Cn%20%20%20%20%20%20%20%20%20%20%20%20style:%20%5C%22display:block;%20height:100%25;%20width:100%25;%5C%22,%5Cn%20%20%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20%20%20let%20defaultChannelOptions%20=%20window.___userSettings746291937.defaultCommentOptions;%5Cn%20%20%20%20%20%20%20%20%20%20for(let%20key%20of%20%5B%5C%22commentPlaceholderText%5C%22,%20%5C%22submitButtonText%5C%22,%20%5C%22newestCommentsAtTop%5C%22,%20%5C%22customEmojis%5C%22,%20%5C%22customEmojiSize%5C%22,%20%5C%22hideDates%5C%22,%20%5C%22slashCommands%5C%22,%20%5C%22forceColorScheme%5C%22,%20%5C%22messageBubbleStyle%5C%22,%20%5C%22messageFeedStyle%5C%22,%20%5C%22inputAreaStyle%5C%22,%20%5C%22submitButtonStyle%5C%22,%20%5C%22settingsButtonStyle%5C%22,%20%5C%22fullscreenButtonStyle%5C%22,%20%5C%22submitButtonSuccessText%5C%22,%20%5C%22hideSettingsButton%5C%22,%20%5C%22hideFullscreenButton%5C%22,%20%5C%22loadFonts%5C%22,%20%5C%22adminPasswordHash%5C%22,%20%5C%22adminFlair%5C%22,%20%5C%22deleteButtonIcon%5C%22,%20%5C%22bannedUsers%5C%22,%20%5C%22bannedWords%5C%22,%20%5C%22rateLimits%5C%22%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(defaultChannelOptions%5Bkey%5D%20!==%20undefined)%20options%5Bkey%5D%20=%20defaultChannelOptions%5Bkey%5D;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20showModal(%60%3Cdiv%20style=%5C%22height:95vh;%20width:95vw;%20max-height:600px;%20max-width:900px;%5C%22%3E$%7Bwindow.___commentsPlugin746291937(options)%7D%3C/div%3E%60);%5Cn%20%20%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20return%20window.___textToImagePlugin746291937(settings.galleryOptions).evaluateItem;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20try%20%7B%5Cn%20%20%20%20let%20isSafari%20=%20navigator.vendor%20&&%20navigator.vendor.indexOf('Apple')%20%3E%20-1%20&&%20navigator.userAgent%20&&%20navigator.userAgent.indexOf('CriOS')%20==%20-1%20&&%20navigator.userAgent.indexOf('FxiOS')%20==%20-1;%5Cn%20%20%20%20let%20isTouchScreen%20=%20window.matchMedia(%5C%22(pointer:%20coarse)%5C%22).matches;%5Cn%20%20%20%20if(isSafari%20&&%20window.innerWidth%20%3C%20800%20&&%20isTouchScreen)%20%7B%5Cn%20%20%20%20%20%20let%20viewportMetaEl%20=%20document.querySelector(%5C%22%5Bname=viewport%5D%5C%22);%5Cn%20%20%20%20%20%20if(!viewportMetaEl.getAttribute(%5C%22content%5C%22).includes(%5C%22maximum-scale%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20viewportMetaEl.setAttribute(%5C%22content%5C%22,%20viewportMetaEl.getAttribute(%5C%22content%5C%22)%20+%20%5C%22,%20maximum-scale=1%5C%22);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20console.log(%5C%22Safari%20iOS%20detected.%20Added%20maximum-scale%20attribute%20to%20prevent%20zooming:%5C%22,%20viewportMetaEl.getAttribute(%5C%22content%5C%22));%5Cn%20%20%20%20%7D%5Cn%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20console.error(e);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20return%20%60%3Cstyle%3E%5Cn%20%20%20%20body%20*:not(a,%20button)%20%7B%5Cn%20%20%20%20%20%20color:%20inherit;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn%20%7B%5Cn%20%20%20%20%20%20width:%20min-content;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn.takesUpFullRow%20%7B%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn.takesUpFullRow%5C%5C%5C%5C%5Bdata-fold-toggle-state='shown'%5C%5C%5C%5C%5D%20%7B%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn.takesUpFullRow%5C%5C%5C%5C%5Bdata-fold-toggle-state='hidden'%5C%5C%5C%5C%5D%20%7B%5Cn%20%20%20%20%20%20width:%20min-content;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn%5C%5C%5C%5C%5Bdata-fold-toggle-state='hidden'%5C%5C%5C%5C%5D%20.input-wrapper%20%7B%5Cn%20%20%20%20%20%20display:%20none;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-inner%20%7B%5Cn%20%20%20%20%20%20padding:%200.25rem;%20/*%20%3C--%20if%20you%20change%20this,%20you%20need%20to%20change%20the%20CSS%20width%20calc%20on%20input-wrapper,%20generated%20by%20the%20JS%20code%20*/%5Cn%20%20%20%20%20%20margin:%200.25rem;%5Cn%20%20%20%20%20%20border-radius:%203px;%5Cn%20%20%20%20%20%20background:%20var(--box-color,%20#ebebeb);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-type-text%20.input-inner,%20.input-type-paragraph%20.input-inner%20%7B%5Cn%20%20%20%20%20%20width:%20300px;%5Cn%20%20%20%20%20%20/*%20min-width:%20max-content;%20*/%20/*%20this%20breaks%20display%20on%20mobile%20*/%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-label%20%7B%5Cn%20%20%20%20%20%20font-size:%2080%25;%20%5Cn%20%20%20%20%20%20text-align:%20left;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn%5C%5C%5C%5C%5Bdata-fold-toggle-state='shown'%5C%5C%5C%5C%5D%20.input-toggle-button%20%7B%5Cn%20%20%20%20%20%20margin-left:%20auto;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn%5C%5C%5C%5C%5Bdata-fold-toggle-state='hidden'%5C%5C%5C%5C%5D%20.input-toggle-button%20%7B%5Cn%20%20%20%20%20%20margin-left:%201rem;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn%5C%5C%5C%5C%5Bdata-fold-toggle-state='hidden'%5C%5C%5C%5C%5D%20.input-toggle-button::before%20%7B%5Cn%20%20%20%20%20%20content:%20%5C%22show%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-ctn%5C%5C%5C%5C%5Bdata-fold-toggle-state='shown'%5C%5C%5C%5C%5D%20.input-toggle-button::before%20%7B%5Cn%20%20%20%20%20%20content:%20%5C%22hide%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-wrapper%20%7B%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-wrapper%20.text-input%20%7B%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20padding-right:%201.375rem;%5Cn%20%20%20%20%20%20display:%20block;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-wrapper%20.paragraph-input%20%7B%5Cn%20%20%20%20%20%20width:%20100%25;%5Cn%20%20%20%20%20%20padding-right:%201.375rem;%5Cn%20%20%20%20%20%20display:%20block;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.random-input-btn-ctn%20%7B%5Cn%20%20%20%20%20%20margin-left:%200.25rem;%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20flex-direction:%20column;%5Cn%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%20%20cursor:%20pointer;%5Cn%20%20%20%20%20%20margin-bottom:%20auto;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.auto-suggest-btn%20%7B%5Cn%20%20%20%20%20%20position:absolute;%5Cn%20%20%20%20%20%20top:0.125rem;%5Cn%20%20%20%20%20%20right:0.125rem;%5Cn%20%20%20%20%20%20cursor:pointer;%5Cn%20%20%20%20%20%20opacity:0.6;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.auto-suggest-btn:hover%20%7B%5Cn%20%20%20%20%20%20opacity:1;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.input-tip-btn%20%7B%5Cn%20%20%20%20%20%20cursor:pointer;%5Cn%20%20%20%20%20%20font-weight:bold;%5Cn%20%20%20%20%20%20margin-left:0.25rem;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20@keyframes%20rotate%7B%5Cn%20%20%20%20%20%20to%20%7B%20transform:%20rotate(360deg);%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20.tabs-header%20%7B%5Cn%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20font-size:%2070%25;%5Cn%20%20%20%20%20%20overflow:auto;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.tab%20%7B%5Cn%20%20%20%20%20%20padding:%200.25rem;%5Cn%20%20%20%20%20%20cursor:%20pointer;%5Cn%20%20%20%20%20%20background:%20var(--box-color,%20#ebebeb);%5Cn%20%20%20%20%20%20border-radius:%200.25rem;%5Cn%20%20%20%20%20%20margin:%200.25rem;%5Cn%20%20%20%20%20%20user-select:%20none;%5Cn%20%20%20%20%20%20min-width:%20max-content;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.active-tab%20%7B%5Cn%20%20%20%20%20%20background:%20var(--active-comment-channel-tab-color,%20#c6c6c6);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.tab-content%20%7B%5Cn%20%20%20%20%20%20display:%20none;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.active-content%20%7B%5Cn%20%20%20%20%20%20display:%20block;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20.t2i-under-each-image-ctn%20%7B%5Cn%20%20%20%20%20%20font-size:%2080%25;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.t2i-under-each-image-ctn%20.personality-chat-button%20%7B%20opacity:%200.5;%20%7D%5Cn%20%20%20%20.t2i-under-each-image-ctn%20.personality-chat-button:hover%20%7B%20opacity:%201;%20%7D%5Cn%20%20%20%20.t2i-under-each-image-ctn%20.private-save-button%20%7B%20opacity:%200.5;%20%7D%5Cn%20%20%20%20.t2i-under-each-image-ctn%20.private-save-button:hover%20%7B%20opacity:%201;%20%7D%5Cn%20%20%20%20iframe.text-to-image-plugin-image-iframe%20%7B%5Cn%20%20%20%20%20%20max-width:%20100%25;%5Cn%20%20%20%20%7D%5Cn%20%20%3C/style%3E%5Cn%5Cn%20%20%3Ch1%20id=%5C%22pageTitleEl48759084793%5C%22%20style=%5C%22font-size:1.2rem;%20margin-bottom:0.5rem;%5C%22%3E$%7Bsettings.pageTitle%7D%3C/h1%3E%20%5Cn%5Cn%20%20%3Cdiv%20id=%5C%22mainColumnEl85394739%5C%22%20style=%5C%22margin:0%20auto;%20max-width:1000px;%5C%22%3E%20%3C!--%20NOTE:%20if%20you%20change%201000px%20to%20something%20else,%20ctrl+f%20for%20mainColumnEl85394739%20and%20change%20the%20numImage-based%20stuff%20--%3E%5Cn%20%20%20%20%3Cdiv%20id=%5C%22userInputsCtn8462746262%5C%22%20style=%5C%22display:flex;%20padding:0.25rem;%20justify-content:center;%20flex-wrap:wrap;%5C%22%3E%5Cn%20%20%20%20%20%20$%7BuserInputsHtml%7D%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%20%20$%7BdummyImageScriptTrigger%7D%5Cn%5Cn%20%20%20%20%3C!--%3Cdiv%20style=%5C%22margin:1rem%200;%20display:%20flex;%20align-items:%20center;%20justify-content:%20center;%5C%22%3E%5Cn%20%20%20%20%20%20%E2%9E%A1%EF%B8%8F&nbsp;%3Cbutton%20id=%5C%22generateButtonEl%5C%22%20style=%5C%22font-size:1.5rem;%5C%22%20onclick=%5C%22window.___generateButtonClickEvent746291937(event);%5C%22%3E%E2%9C%A8%20generate%3C/button%3E&nbsp;%E2%AC%85%EF%B8%8F%5Cn%20%20%20%20%3C/div%3E--%3E%5Cn%20%20%20%20%5Cn%20%20%20%20%3Cdiv%20id=%5C%22shareLinkOuterCtn2893827%5C%22%20style=%5C%22display:none;%20margin-bottom:2rem;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cbutton%20id=%5C%22shareSettingsBtn758374%5C%22%20onclick=%5C%22window.__generateSettingsShareLink084722()%5C%22%20style=%5C%22font-size:70%25;%5C%22%3E%F0%9F%94%97%20share%20these%20settings%3C/button%3E%5Cn%20%20%20%20%20%20%3Cdiv%20id=%5C%22shareLinkCtn83927376%5C%22%20style=%5C%22display:none;%20margin-top:0.5rem;%20font-size:80%25;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cinput%20style=%5C%22width:200px;%5C%22%20id=%5C%22shareSettingsLinkInputEl759307%5C%22%20disabled%3E%20%3Cbutton%20style=%5C%22min-width:80px;%5C%22%20onclick=%5C%22navigator.clipboard.writeText(shareSettingsLinkInputEl759307.value).then(r%20=%3E%20this.innerHTML='%E2%9C%85');%20setTimeout(()%20=%3E%20this.innerHTML='copy%20link',%202000);%5C%22%3Ecopy%20link%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22font-size:80%25;%20opacity:0.7;%5C%22%3E(this%20link%20contains%20a%20snapshot%20of%20the%20above%20settings)%3C/div%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%5Cn%20%20%20%20%3Cdiv%20style=%5C%22margin:1rem%200;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:%20flex;align-items:%20center;justify-content:%20center;%5C%22%3E%3Cspan%20id=%5C%22leftClickHelperEl%5C%22%20style=%5C%22display:none;%5C%22%3Eclick%20%E2%9E%A1&nbsp;%3C/span%3E%3Cbutton%20id=%5C%22generateButtonEl%5C%22%20style=%5C%22font-size:1.5rem;%5C%22%20onclick=%5C%22window.___generateButtonClickEvent746291937(event);%5C%22%3E%E2%9C%A8%20generate%3C/button%3E%3Cspan%20id=%5C%22rightClickHelperEl%5C%22%20style=%5C%22display:none;%5C%22%3E&nbsp;%E2%AC%85%20click%3C/span%3E%3C/div%3E%5Cn%20%20%20%20%20%20%3Cdiv%20id=%5C%22bottomClickHelperEl%5C%22%20style=%5C%22display:none;%5C%22%3E%3Cdiv%3E%E2%AC%86%3C/div%3E%3Cdiv%3Eclick%3C/div%3E%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%5Cn%20%20%20%20%3Cdiv%20id=%5C%22outputAreaEl%5C%22%20style=%5C%22margin-top:1rem;%20min-height:12rem;%20display:flex;%20flex-wrap:wrap;%20justify-content:center;%20align-items:center;%20padding:0.25rem;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cspan%3E$%7Bsettings.introMessage%20%7C%7C%20%5C%22%E2%86%91%20Set%20inputs%20and%20click%20%3Ci%3Egenerate%3C/i%3E%20to%20begin.%20%E2%86%91%5C%22%7D%3C/span%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%5Cn%20%20%20%20%3Cdiv%20style=%5C%22position:fixed;%20bottom:0.5rem;%20right:0.5rem;%20text-align:right;%20z-index:100;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20id=%5C%22feedbackCommentsCtn%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%3Cbutton%20id=%5C%22feedbackBtn893745ykfuhd%5C%22%20onclick=%5C%22if(feedbackCommentsCtn.innerHTML.length%20===%200)%20%7B%20feedbackCommentsCtn.innerHTML=window.generateFeedbackCommentsHtml_8974sklfjosifo();%20this.innerHTML='%E2%9C%96%20close';%20%7D%20else%20%7B%20%20feedbackCommentsCtn.innerHTML='';%20%20this.innerHTML='%F0%9F%97%A8%EF%B8%8F%20feedback';%20%7D%5C%22%20style=%5C%22font-size:0.85rem;%5C%22%3E%F0%9F%97%A8%EF%B8%8F%20feedback%3C/button%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%5Cn%20%20%20%20%3Cdiv%20id=%5C%22showSocialsButtonCtn9000274628%5C%22%20style=%5C%22$%7BsocialFeatures%20===%20'button'%20?%20''%20:%20'display:none;'%7D%5C%22%3E%5Cn%20%20%20%20%20%20%3Cbutton%20id=%5C%22showSocialsButton927514532%5C%22%20style=%5C%22margin-top:2rem;%20margin-bottom:0.5rem;%5C%22%20onclick=%5C%22window.__showSocialsButtonClickHandler98347938();%5C%22%3E%3Cdiv%20style=%5C%22padding:0.5rem;%5C%22%3E%F0%9F%92%AC%20show%20comments%20&%20gallery%20%F0%9F%96%BC%EF%B8%8F%3C/div%3E%3C/button%3E%5Cn%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%20align-items:center;%20justify-content:center;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cinput%20id=%5C%22autoShowCheckbox84937483%5C%22%20style=%5C%22cursor:pointer;%5C%22%20type=%5C%22checkbox%5C%22%3E%3Cspan%20style=%5C%22margin-left:0.25rem;%20cursor:pointer;%5C%22%20onclick=%5C%22autoShowCheckbox84937483.checked=!autoShowCheckbox84937483.checked;%5C%22%3Eauto-show%20next%20time%3C/span%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%5Cn%20%20%20%20%3Cdiv%20id=%5C%22showHideGalleryAndCommentsButtonsCtn83728732671%5C%22%20style=%5C%22$%7BsocialFeatures%20===%20%5C%22button%5C%22%20%7C%7C%20socialFeatures%20===%20%5C%22disabled%5C%22%20?%20%5C%22display:none;%5C%22%20:%20%5C%22%5C%22%7D%20margin-top:1rem;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cbutton%20id=%5C%22hideCommentsBtn85937402%5C%22%20onclick=%5C%22if(this.dataset.hidden)%20%7B%20this.dataset.hidden='';%20this.textContent%20=%20'hide%20comments';%20commentsPluginCtn654732.style.display%20=%20'';%20%7D%20else%20%7B%20this.dataset.hidden='1';%20this.textContent%20=%20'show%20comments';%20commentsPluginCtn654732.style.display%20=%20'none';%20%7D%5C%22%20data-hidden=%5C%22%5C%22%3Ehide%20comments%3C/button%3E%5Cn%20%20%20%20%20%20%3Cbutton%20id=%5C%22hideGalleryBtn85937402%5C%22%20onclick=%5C%22if(this.dataset.hidden)%20%7B%20this.dataset.hidden='';%20this.textContent%20=%20'hide%20gallery';%20imageGalleryCtn8569284.style.display%20=%20'';%20%7D%20else%20%7B%20this.dataset.hidden='1';%20this.textContent%20=%20'show%20gallery';%20imageGalleryCtn8569284.style.display%20=%20'none';%20%7D%5C%22%20data-hidden=%5C%22%5C%22%3Ehide%20gallery%3C/button%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%5Cn%20%20%20%20%3Cdiv%20style=%5C%22position:fixed;%20bottom:0.5rem;%20left:0.5rem;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cbutton%20id=%5C%22darkModeBtn_875979f948%5C%22%20style=%5C%22cursor:pointer;%20font-size:0.85rem;%5C%22%20onclick=%5C%22window.toggleManualDarkMode_jv83hb27igksf();%5C%22%3E%F0%9F%8C%83%3C/button%3E%5Cn%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:inline-block;%20font-size:0.85rem;%5C%22%3E%5Bwindow.___fullscreenButton893479(%5C%22&nbsp;&nbsp;&nbsp;%E2%87%B1&nbsp;&nbsp;&nbsp;%5C%22,%20%5C%22&nbsp;&nbsp;&nbsp;%E2%87%B2&nbsp;&nbsp;&nbsp;%5C%22,%20%5C%22line-height:initial;%5C%22)%5D%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%3C/div%3E%5Cn%20%20%5Cn%20%20%3Cdiv%20id=%5C%22privateGalleryCtn97364827%5C%22%20$%7Bsettings.imageButtons?.privateSave%20?%20%5C%22%5C%22%20:%20%5C%22hidden%5C%22%7D%20style=%5C%22pointer-events:none;bottom:0.5rem;left:0;right:0;width:100%25;text-align:center;position:fixed;z-index:100;font-size:0.85rem;%5C%22%3E%5Cn%20%20%20%20%3Cbutton%20onclick=%5C%22window.t2i_privateGallery.show()%5C%22%20title=%5C%22Ctrl+Shift+G%5C%22%20style=%5C%22pointer-events:auto;%20cursor:pointer;%5C%22%3E%F0%9F%9B%A1%EF%B8%8F%20$%7Bwindow.innerWidth%20%3E%20600%20?%20%5C%22show%20%5C%22%20:%20%5C%22%5C%22%7Dprivate%20gallery%3C/button%3E%5Cn%20%20%3C/div%3E%5Cn%20%20%5Cn%20%20%3Cdiv%20id=%5C%22commentsPluginCtn654732%5C%22%20style=%5C%22padding:0.25rem;%20width:100%25;%20margin:0%20auto;%20margin-top:1rem;%5C%22%3E%3C/div%3E%5Cn%20%20%5Cn%20%20%3C!--%20%3Cdiv%20style=%5C%22background-image:url(https://example.com/image.webp);%20filter:%20blur(1px);%20opacity:0.5;%20background-position:center;%20background-size:cover;%20z-index:-10;%20position:fixed;%20top:0;left:0;right:0;bottom:0;%5C%22%3E%3C/div%3E%20--%3E%5Cn%20%20%3Cdiv%20id=%5C%22clickCountBasedSocialDisplayNotifierEl%5C%22%20style=%5C%22font-size:80%25;%20max-width:800px;%20margin:0%20auto;%20padding:0.5rem;%20text-align:left;%20display:none;%5C%22%3E%5Cn%20%20%20%20%3Cdiv%20style=%5C%22background:var(--box-color);padding:%200.5rem;%20border-radius:3px;%5C%22%3E%3Cb%3ENote:%3C/b%3E%20The%20comments%20and%20gallery%20only%20appear%20after%20generating%20several%20batches%20of%20images.%20If%20you%20visit%20this%20page%20again%20later%20and%20don't%20see%20the%20gallery/comments,%20it's%20because%20your%20cookies/storage%20for%20this%20site%20got%20cleared%20for%20some%20reason,%20so%20you'd%20need%20to%20generate%20some%20more%20images.%20%3Cbutton%20style=%5C%22font-size:80%25;%5C%22%20onclick=%5C%22localStorage.theyKnowAboutClickCountBasedSocialDisplay='1';%20this.parentElement.style.display='none';%5C%22%3E%E2%9C%85%20got%20it%3C/button%3E%3C/div%3E%5Cn%20%20%3C/div%3E%5Cn%20%20%5Cn%20%20%3Cdiv%20id=%5C%22imageGalleryCtn8569284%5C%22%20style=%5C%22margin-top:1rem;%5C%22%3E%5Cn%20%20%20%20$%7B%5B%5C%22disabled%5C%22,%20%5C%22button%5C%22%5D.includes(socialFeatures)%20?%20%5C%22%5C%22%20:%20window.generateImageGalleryHtml358402048()%7D%5Cn%20%20%3C/div%3E%5Cn%20%20%3Cbr%3E%3Cbr%3E%3Cbr%3E%3Cbr%3E%5Cn%20%20%60.replaceAll(%5C%22%7B%5C%22,%20%5C%22%5C%5C%5C%5C%7B%5C%22).replaceAll(%5C%22%7D%5C%22,%20%5C%22%5C%5C%5C%5C%7D%5C%22);%5Cn%5Cn%5Cn%5Cn%5Cnasync%20showModal(html)%20=%3E%5Cn%20%20if(!html)%20html%20=%20%5C%22%3Cp%3E?%3C/p%3E%5C%22;%5Cn%20%20return%20new%20Promise(resolve%20=%3E%20%7B%5Cn%20%20%20%20const%20overlay%20=%20Object.assign(document.createElement(%5C%22div%5C%22),%20%7B%20tabIndex:%200%20%7D);%5Cn%20%20%20%20overlay.style.cssText%20=%20%60position:fixed;inset:0;z-index:9999;display:grid;place-items:center;background-color:rgba(0,0,0,.65);font:16px/1.4%20system-ui%60;%5Cn%20%20%20%20overlay.innerHTML%20=%20%60%3Cdiv%20style=%5C%22position:relative;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cbutton%20style=%5C%22position:absolute;z-index:10;top:-12px;right:-12px;width:28px;height:28px;border:none;border-radius:50%25;background-color:light-dark(#fff,#444);color:light-dark(#666,#aaa);cursor:pointer;font-size:18px;line-height:1;padding:0;box-shadow:0%202px%204px%20rgba(0,0,0,.2);%5C%22%3E%E2%9C%95%3C/button%3E%5Cn%20%20%20%20%20%20%3Cdiv%20style=%5C%22text-align:left%20!important;border-radius:8px;background-color:light-dark(#fff,#222);color:light-dark(#000,#fff);box-shadow:0%202px%208px%20rgba(0,0,0,.2);%5C%22%3E%5Cn%20%20%20%20%20%20%20%20$%7Bhtml%7D%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%60;%5Cn%20%20%20%20const%20%5Bwrapper,%20closeBtn%5D%20=%20%5Boverlay.firstChild,%20overlay.querySelector(%5C%22button%5C%22)%5D;%5Cn%20%20%20%20const%20finish%20=%20()%20=%3E%20%7B%20overlay.remove();%20resolve();%20%7D;%5Cn%20%20%20%20closeBtn.onclick%20=%20finish;%5Cn%20%20%20%20overlay.onmousedown%20=%20e%20=%3E%20%7B%20if(e.target%20===%20overlay)%20finish();%20%7D;%5Cn%20%20%20%20overlay.onkeydown%20=%20e%20=%3E%20%7B%20if(e.key%20===%20%5C%22Escape%5C%22)%20finish();%20%7D;%5Cn%20%20%20%20document.body.append(overlay);%5Cn%20%20%7D);%5Cn%5Cnasync%20confirmAsync(message,%20opts)%20=%3E%5Cn%20%20if(!opts)%20opts%20=%20%7B%7D;%5Cn%20%20if(!message)%20message%20=%20%5C%22Are%20you%20sure?%5C%22%5Cn%20%20return%20new%20Promise(resolve%20=%3E%20%7B%5Cn%20%20%20%20const%20overlay%20=%20Object.assign(document.createElement(%5C%22div%5C%22),%20%7B%20tabIndex:%200%20%7D);%5Cn%20%20%20%20overlay.style.cssText%20=%20%60position:fixed;inset:0;z-index:9999;display:grid;place-items:center;background-color:rgba(0,0,0,.65);font:16px/1.4%20system-ui%60;%5Cn%20%20%20%20overlay.innerHTML%20=%20%60%3Cdiv%20style=%5C%22text-align:left%20!important;max-width:min(97vw,%20450px);padding:15px;border-radius:8px;background-color:light-dark(#fff,#222);color:light-dark(#000,#fff);box-shadow:0%202px%208px%20rgba(0,0,0,.2);%5C%22%3E%5Cn%20%20%20%20%20%20%3Cp%20style=%5C%22margin:0%200%2020px;white-space:pre-wrap;%5C%22%3E$%7Bmessage.replace(/%5B%3C%3E&%5D/g,%20m%20=%3E%20(%7B%5C%22%3C%5C%22:%5C%22&lt;%5C%22,%5C%22&%5C%22:%5C%22&amp;%5C%22,%5C%22%3E%5C%22:%5C%22&gt;%5C%22%7D%5Bm%5D))%7D%3C/p%3E%5Cn%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;justify-content:flex-end;gap:8px;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cbutton%20$%7Bopts.hideCancel%20?%20%5C%22hidden%5C%22%20:%20%5C%22%5C%22%7D%20style=%5C%22padding:6px%2016px;border:1px%20solid%20light-dark(#ccc,#555);border-radius:6px;background-color:light-dark(#f6f6f6,#333);color:inherit;cursor:pointer;%5C%22%3ECancel%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%3Cbutton%20autofocus%20style=%5C%22padding:6px%2016px;border:none;border-radius:6px;background-color:light-dark(#1677ff,#2b87ff);color:#fff;cursor:pointer;%5C%22%3EOkay%3C/button%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%60;%5Cn%20%20%20%20const%20%5BcancelBtn,%20okBtn%5D%20=%20overlay.querySelectorAll(%5C%22button%5C%22);%5Cn%20%20%20%20const%20finish%20=%20val%20=%3E%20%7B%20overlay.remove();%20resolve(val);%20%7D;%5Cn%20%20%20%20cancelBtn.onclick%20=%20()%20=%3E%20finish(false);%5Cn%20%20%20%20okBtn.onclick%20=%20()%20=%3E%20finish(true);%5Cn%20%20%20%20overlay.onkeydown%20=%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20if%20(e.key%20===%20%5C%22Escape%5C%22)%20finish(false);%5Cn%20%20%20%20%20%20else%20if%20(e.key%20===%20%5C%22Enter%5C%22)%20finish(true);%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20document.body.append(overlay);%5Cn%20%20%20%20overlay.focus(%7B%20preventScroll:%20true%20%7D);%20//%20enables%20Esc%20handling%20immediately%5Cn%20%20%7D);%5Cn%5Cnasync%20getUserInput(fields,%20opts)%20=%3E%5Cn%20%20fields%20=%20fields%20%7C%7C%20%7B%7D;%5Cn%20%20opts%20=%20opts%20%7C%7C%20%7B%7D;%5Cn%20%20const%20esc%20=%20s%20=%3E%20String(s).replace(/%5B%3C%3E&%5D/g,%20m%20=%3E%20(%7B%5C%22%3C%5C%22:%5C%22&lt;%5C%22,%5C%22&%5C%22:%5C%22&amp;%5C%22,%5C%22%3E%5C%22:%5C%22&gt;%5C%22%7D%5Bm%5D));%5Cn%20%20const%20cancelText%20=%20esc(opts.cancelText%20%7C%7C%20%5C%22Cancel%5C%22);%5Cn%20%20const%20okText%20=%20esc(opts.okText%20%7C%7C%20%5C%22OK%5C%22);%5Cn%5Cn%20%20return%20new%20Promise(resolve%20=%3E%20%7B%5Cn%20%20%20%20const%20overlay%20=%20Object.assign(document.createElement(%5C%22div%5C%22),%20%7B%20tabIndex:%200%20%7D);%5Cn%20%20%20%20overlay.style.cssText%20=%20%60position:fixed;inset:0;z-index:99999999;display:grid;place-items:center;background-color:rgba(0,0,0,.65);font:16px/1.4%20system-ui%60;%5Cn%5Cn%20%20%20%20const%20modal%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20modal.style.cssText%20=%20%60%5Cn%20%20%20%20%20%20text-align:left%20!important;%5Cn%20%20%20%20%20%20width:520px;max-width:97vw;%5Cn%20%20%20%20%20%20border-radius:8px;padding:15px;%5Cn%20%20%20%20%20%20background-color:light-dark(#fff,#222);%5Cn%20%20%20%20%20%20color:light-dark(#000,#fff);%5Cn%20%20%20%20%20%20box-shadow:0%202px%208px%20rgba(0,0,0,.2);%5Cn%20%20%20%20%20%20display:flex;flex-direction:column;gap:12px;%5Cn%20%20%20%20%20%20max-height:min(92vh,%20900px);%5Cn%20%20%20%20%60;%5Cn%5Cn%20%20%20%20//%20Scrollable%20content%5Cn%20%20%20%20const%20scrollWrap%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20scrollWrap.style.cssText%20=%20%5C%22overflow:auto;min-height:0;%5C%22;%5Cn%20%20%20%20const%20host%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20host.style.cssText%20=%20%5C%22display:block%5C%22;%5Cn%20%20%20%20scrollWrap.append(host);%5Cn%5Cn%20%20%20%20//%20Footer%20(Cancel%20left,%20OK%20right)%5Cn%20%20%20%20const%20footer%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20footer.style.cssText%20=%20%5C%22display:flex;gap:8px;align-items:center;margin-top:4px;%5C%22;%5Cn%20%20%20%20const%20cancelBtn%20=%20document.createElement(%5C%22button%5C%22);%5Cn%20%20%20%20cancelBtn.textContent%20=%20cancelText;%5Cn%20%20%20%20cancelBtn.hidden%20=%20!!opts.hideCancel;%5Cn%20%20%20%20cancelBtn.style.cssText%20=%20%5C%22padding:6px%2016px;border:1px%20solid%20light-dark(#ccc,#555);border-radius:6px;background-color:light-dark(#f6f6f6,#333);color:inherit;cursor:pointer;%5C%22;%5Cn%20%20%20%20const%20okBtn%20=%20document.createElement(%5C%22button%5C%22);%5Cn%20%20%20%20okBtn.textContent%20=%20okText;%5Cn%20%20%20%20okBtn.autofocus%20=%20true;%5Cn%20%20%20%20okBtn.style.cssText%20=%20%5C%22margin-left:auto;padding:6px%2016px;border:none;border-radius:6px;background-color:light-dark(#1677ff,#2b87ff);color:#fff;cursor:pointer;%5C%22;%5Cn%5Cn%20%20%20%20footer.append(cancelBtn,%20okBtn);%5Cn%20%20%20%20modal.append(scrollWrap,%20footer);%5Cn%20%20%20%20overlay.append(modal);%5Cn%5Cn%20%20%20%20const%20elMap%20=%20new%20Map();%5Cn%20%20%20%20const%20inputCSS%20=%20%5C%22width:100%25;max-width:100%25;box-sizing:border-box;padding:8px;border:1px%20solid%20light-dark(#ccc,#555);border-radius:6px;background-color:light-dark(#fff,#333);color:inherit;%5C%22;%5Cn%5Cn%20%20%20%20Object.entries(fields).forEach((%5Bname,%20cfgRaw%5D)%20=%3E%20%7B%5Cn%20%20%20%20%20%20const%20cfg%20=%20cfgRaw%20%7C%7C%20%7B%7D;%5Cn%20%20%20%20%20%20const%20t%20=%20(cfg.type%20%7C%7C%20%5C%22input:text%5C%22).toLowerCase();%5Cn%20%20%20%20%20%20const%20wrap%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20wrap.style.cssText%20=%20%60margin:0%200%20$%7Bcfg.marginBottom%20%7C%7C%20%5C%2212px%5C%22%7D%60;%5Cn%5Cn%20%20%20%20%20%20if%20(cfg.label)%20%7B%5Cn%20%20%20%20%20%20%20%20const%20lab%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20lab.style.cssText%20=%20%5C%22margin:0%200%206px;display:flex;align-items:center;gap:6px;%5C%22;%5Cn%20%20%20%20%20%20%20%20const%20labText%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20labText.textContent%20=%20cfg.label%20%7C%7C%20name;%5Cn%20%20%20%20%20%20%20%20lab.append(labText);%5Cn%20%20%20%20%20%20%20%20if%20(cfg.help)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20help%20=%20document.createElement(%5C%22span%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20help.textContent%20=%20%5C%22i%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20help.title%20=%20cfg.help;%5Cn%20%20%20%20%20%20%20%20%20%20help.style.cssText%20=%20%5C%22margin-left:auto;display:inline-grid;place-items:center;width:18px;height:18px;border-radius:50%25;border:1px%20solid%20light-dark(#ccc,#555);font:12px/1%20system-ui;opacity:.75;cursor:help;user-select:none%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20help.onclick%20=%20()%20=%3E%20alert(cfg.help);%5Cn%20%20%20%20%20%20%20%20%20%20lab.append(help);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20wrap.append(lab);%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20let%20el%20=%20null,%20kind%20=%20%5C%22std%5C%22;%5Cn%20%20%20%20%20%20if%20(t%20===%20%5C%22textarea%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20el%20=%20document.createElement(%5C%22textarea%5C%22);%5Cn%20%20%20%20%20%20%20%20el.rows%20=%20cfg.rows%20%7C%7C%204;%5Cn%20%20%20%20%20%20%20%20el.style.cssText%20=%20inputCSS;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.placeholder%20!=%20null)%20el.placeholder%20=%20cfg.placeholder;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.value%20!=%20null)%20el.value%20=%20cfg.value;%5Cn%20%20%20%20%20%20%7D%20else%20if%20(t%20===%20%5C%22select%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20el%20=%20document.createElement(%5C%22select%5C%22);%5Cn%20%20%20%20%20%20%20%20el.style.cssText%20=%20inputCSS;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.multiple)%20el.multiple%20=%20true;%5Cn%20%20%20%20%20%20%20%20(cfg.options%20%7C%7C%20%5B%5D).forEach(opt%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20o%20=%20document.createElement(%5C%22option%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20if%20(typeof%20opt%20===%20%5C%22object%5C%22)%20%7B%20o.value%20=%20opt.value;%20o.textContent%20=%20opt.label%20??%20opt.value;%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20else%20%7B%20o.value%20=%20String(opt);%20o.textContent%20=%20String(opt);%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20el.append(o);%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20const%20v%20=%20cfg.value;%5Cn%20%20%20%20%20%20%20%20if%20(el.multiple%20&&%20Array.isArray(v))%20Array.from(el.options).forEach(o%20=%3E%20o.selected%20=%20v.includes(o.value));%5Cn%20%20%20%20%20%20%20%20else%20if%20(v%20!=%20null)%20el.value%20=%20v;%5Cn%20%20%20%20%20%20%7D%20else%20if%20(t.startsWith(%5C%22input:%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20el%20=%20document.createElement(%5C%22input%5C%22);%5Cn%20%20%20%20%20%20%20%20el.type%20=%20t.split(%5C%22:%5C%22)%5B1%5D%20%7C%7C%20%5C%22text%5C%22;%5Cn%20%20%20%20%20%20%20%20el.style.cssText%20=%20inputCSS;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.placeholder%20!=%20null)%20el.placeholder%20=%20cfg.placeholder;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.min%20!=%20null)%20el.min%20=%20cfg.min;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.max%20!=%20null)%20el.max%20=%20cfg.max;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.step%20!=%20null)%20el.step%20=%20cfg.step;%5Cn%20%20%20%20%20%20%20%20if%20(el.type%20===%20%5C%22checkbox%5C%22)%20el.checked%20=%20!!cfg.value;%5Cn%20%20%20%20%20%20%20%20else%20if%20(cfg.value%20!=%20null)%20el.value%20=%20cfg.value;%5Cn%20%20%20%20%20%20%7D%20else%20if%20(t%20===%20%5C%22html%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20const%20html%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20html.innerHTML%20=%20cfg.html%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20wrap.append(html);%5Cn%20%20%20%20%20%20%20%20host.append(wrap);%5Cn%20%20%20%20%20%20%20%20elMap.set(name,%20%7B%20cfg,%20el:%20html,%20wrap,%20kind:%20%5C%22html%5C%22%20%7D);%5Cn%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20const%20html%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20html.innerHTML%20=%20cfg.html%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20wrap.append(html);%5Cn%20%20%20%20%20%20%20%20host.append(wrap);%5Cn%20%20%20%20%20%20%20%20elMap.set(name,%20%7B%20cfg,%20el:%20html,%20wrap,%20kind:%20%5C%22html%5C%22%20%7D);%5Cn%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20el.name%20=%20name;%5Cn%20%20%20%20%20%20wrap.append(el);%5Cn%20%20%20%20%20%20host.append(wrap);%5Cn%20%20%20%20%20%20elMap.set(name,%20%7B%20cfg,%20el,%20wrap,%20kind:%20%5C%22std%5C%22%20%7D);%5Cn%20%20%20%20%7D);%5Cn%5Cn%20%20%20%20const%20finish%20=%20v%20=%3E%20%7B%20overlay.remove();%20resolve(v);%20%7D;%5Cn%5Cn%20%20%20%20cancelBtn.onclick%20=%20()%20=%3E%20finish(null);%5Cn%20%20%20%20okBtn.onclick%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20const%20out%20=%20%7B%7D;%5Cn%20%20%20%20%20%20elMap.forEach((%7B%20el,%20kind,%20wrap%20%7D,%20name)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(kind%20===%20%5C%22html%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20dv%20=%20wrap.querySelector(%5C%22%5Bdata-value%5D%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20out%5Bname%5D%20=%20dv%20?%20dv.getAttribute(%5C%22data-value%5C%22)%20:%20null;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20if%20(el.tagName%20===%20%5C%22SELECT%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20out%5Bname%5D%20=%20el.multiple%20?%20Array.from(el.selectedOptions).map(o%20=%3E%20o.value)%20:%20el.value;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20if%20(el.tagName%20===%20%5C%22TEXTAREA%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20out%5Bname%5D%20=%20el.value;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20if%20(el.tagName%20===%20%5C%22INPUT%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if%20(el.type%20===%20%5C%22checkbox%5C%22)%20out%5Bname%5D%20=%20el.checked;%5Cn%20%20%20%20%20%20%20%20%20%20else%20if%20(el.type%20===%20%5C%22number%5C%22%20%7C%7C%20el.type%20===%20%5C%22range%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20n%20=%20parseFloat(el.value);%20out%5Bname%5D%20=%20Number.isFinite(n)%20?%20n%20:%20null;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%20else%20out%5Bname%5D%20=%20el.value;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20out%5Bname%5D%20=%20null;%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20finish(out);%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20overlay.onkeydown%20=%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20if%20(e.key%20===%20%5C%22Escape%5C%22)%20finish(null);%5Cn%20%20%20%20%20%20else%20if%20(e.key%20===%20%5C%22Enter%5C%22%20&&%20e.target.tagName%20!==%20%5C%22TEXTAREA%5C%22)%20%7B%20e.preventDefault();%20okBtn.click();%20%7D%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20//%20Backdrop%20mousedown%20cancel%20only%20(not%20mouseup)%5Cn%20%20%20%20if%20(opts.cancelOnBackgroundClick)%20%7B%5Cn%20%20%20%20%20%20overlay.addEventListener(%5C%22mousedown%5C%22,%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(e.target%20===%20overlay)%20finish(null);%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20document.body.append(overlay);%5Cn%20%20%20%20overlay.focus(%7B%20preventScroll:%20true%20%7D);%5Cn%5Cn%20%20%20%20const%20first%20=%20host.querySelector(%5C%22input,textarea,select%5C%22);%5Cn%20%20%20%20if%20(first)%20setTimeout(()%20=%3E%20first.focus(%7B%20preventScroll:%20true%20%7D),%200);%5Cn%20%20%7D);%5Cn%22,%22imports%22:%5B%22ai-text-plugin%22,%22comments-plugin%22,%22create-media-gallery-plugin%22,%22fullscreen-button-plugin%22,%22prompt2-plugin%22,%22select-leaf-plugin%22,%22t2i-styles%22,%22tabbed-comments-plugin-v1%22,%22text-to-image-plugin%22,%22upload-plugin%22%5D,%22lastEditTime%22:1769155948137,%22found%22:true%7D,%7B%22name%22:%22ai-text-plugin%22,%22modelText%22:%22$output(inputData,%20extraOpts)%20=%3E%5Cn%5Cn%20%20const%20serverOrigin%20=%20%5C%22https://text-generation.perchance.org%5C%22;%5Cn%20%20%5Cn%20%20let%20iframe;%20%20%5Cn%20%20if(!window.__alreadyAddedAiTextPluginStuff8492739)%20%7B%5Cn%20%20%20%20iframe%20=%20document.createElement(%5C%22iframe%5C%22);%20%5Cn%20%20%20%20iframe.src%20=%20%60$%7BserverOrigin%7D/embed%60;%5Cn%20%20%20%20iframe.style.cssText%20=%20%5C%22display:none;%20position:fixed;%20top:0.5rem;%20right:0.5rem;%20height:3rem;%20width:11rem;%20background:#333;%20border:none;%20border-radius:3px;%20box-shadow:0px%202px%204px%200px%20#00000066;%20z-index:10000%5C%22;%5Cn%20%20%20%20iframe.id%20=%20%5C%22aiTextPluginEmbedIframe%5C%22;%5Cn%20%20%20%20%5Cn%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20if(!window.__aiTextIframeEmbedIsReady)%20%7B%5Cn%20%20%20%20%20%20%20%20iframe.src%20=%20%60$%7BserverOrigin%7D/embed?__cacheBust=$%7BMath.random()%7D%60;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D,%2015*1000);%5Cn%20%20%20%20%5Cn%20%20%20%20const%20style%20=%20document.createElement(%5C%22style%5C%22);%5Cn%20%20%20%20style.textContent%20=%20%60%5Cn%20%20%20%20%20%20@keyframes%20ai-text-plugin-blink%20%7B%2050%25%20%7B%20fill:%20transparent%20%7D%7D%20.ai-text-plugin-dot%20%7B%20animation:%201s%20ai-text-plugin-blink%20infinite;%20fill:%20grey;%20%7D%20.ai-text-plugin-dot:nth-child(2)%20%7B%20animation-delay:%20250ms%20%7D%20.ai-text-plugin-dot:nth-child(3)%20%7B%20animation-delay:%20500ms%20%7D%20.ai-text-plugin-loader%20%7B%20background-color:%20#f1f1f1;%20color:%20grey;%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20.ai-text-response-end-buttons-ctn:before%20%7B%5Cn%20%20%20%20%20%20%20%20content:%20%5C%22+%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.ai-text-response-end-buttons-ctn%20%7B%5Cn%20%20%20%20%20%20%20%20position:relative;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.ai-text-response-buttons-wrapper%20%7B%5Cn%20%20%20%20%20%20%20%20display:none;%5Cn%20%20%20%20%20%20%20%20position:absolute;%5Cn%20%20%20%20%20%20%20%20width:%20max-content;%5Cn%20%20%20%20%20%20%20%20bottom:%200;%5Cn%20%20%20%20%20%20%20%20min-height:%202.5rem;%5Cn%20%20%20%20%20%20%20%20pointer-events:none;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20@media%20screen%20and%20(max-width:%20600px)%20%7B%5Cn%20%20%20%20%20%20%20%20.ai-text-response-buttons-wrapper%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20min-height:%203.5rem;%20/*%20buttons%20should%20be%20further%20apart%20on%20mobile%20-%20else%20'hover'%20click%20triggers%20the%20buttons%20themselves%20*/%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20.ai-text-response-end-buttons-ctn:hover%20.ai-text-response-buttons-wrapper%20%7B%5Cn%20%20%20%20%20%20%20%20display:flex;%5Cn%20%20%20%20%20%20%20%20pointer-events:auto;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%60;%5Cn%20%20%20%20document.head.appendChild(style);%5Cn%20%20%20%20%5Cn%20%20%20%20window.addEventListener('message',%20(event)%20=%3E%20%7B%5Cn%20%20%20%20%20%20if(event.source%20!==%20iframe.contentWindow)%20return;%5Cn%20%20%20%20%20%20if(event.origin%20!==%20serverOrigin)%20return;%5Cn%5Cn%20%20%20%20%20%20if(event.data.type%20===%20%5C%22embedIsReady%5C%22)%20%7B%20%20%20%5Cn%20%20%20%20%20%20%20%20window.__aiTextIframeEmbedIsReady%20=%20true;%5Cn%20%20%20%20%20%20%20%20//%20console.debug(%5C%22got%20embedIsReady,%20sent%20verifyUser%5C%22);%5Cn%20%20%20%20%20%20%20%20if(!window.__alreadyTriggeredAiTextPluginPreload8492739)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20iframe.contentWindow.postMessage(%7Btype:%5C%22verifyUser%5C%22%7D,%20serverOrigin);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(event.data.type%20===%20%5C%22verified%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20iframe.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(event.data.type%20===%20%5C%22verifying%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20iframe.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20document.body.appendChild(iframe);%5Cn%20%20%20%20%5Cn%20%20%20%20window.__alreadyAddedAiTextPluginStuff8492739%20=%20true;%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20iframe%20=%20document.querySelector(%5C%22#aiTextPluginEmbedIframe%5C%22);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if(inputData%20&&%20inputData.preload%20===%20true)%20%7B%5Cn%20%20%20%20if(!window.__alreadyTriggeredAiTextPluginPreload8492739)%20%7B%5Cn%20%20%20%20%20%20(async%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20while(!window.__aiTextIframeEmbedIsReady)%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%5Cn%20%20%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%5Cn%20%20%20%20%20%20%20%20iframe.contentWindow.postMessage(%7Btype:%5C%22preload%5C%22%7D,%20serverOrigin);%5Cn%20%20%20%20%20%20%7D)();%5Cn%20%20%20%20%20%20window.__alreadyTriggeredAiTextPluginPreload8492739%20=%20true;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20return%20%5C%22%5C%22;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if(inputData%20&&%20inputData.getMetaObject===true)%20%7B%5Cn%20%20%20%20return%20%7B%5Cn%20%20%20%20%20%20countTokens:%20function(text)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20Math.ceil(text.length/3.6);%20//%20TODO:%20just%20an%20approximation%20for%20now%20-%20this%20approx%20will%20not%20work%20well%20with%20non-english%20characters.%20will%20update%20during%20next%20model%20upgrade.%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20idealMaxContextTokens:%206000,%20//%20this%20is%20just%20a%20recommendation%20-%20not%20a%20fundamental%20limit.%20and%20it%20will%20increase%20over%20time.%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%20%20//%20console.debug(%5C%22inputData:%5C%22,%20inputData);%5Cn%20%20if(!inputData)%20return%20%5C%22(Error:%20No%20input%20data%20given%20to%20the%20ai%20text%20plugin.)%5C%22;%5Cn%20%20if(inputData.instructions)%20%7B%5Cn%20%20%20%20if(inputData.outputTo)%20%7B%5Cn%20%20%20%20%20%20inputData.outputTo.value%20=%20%5C%22(Error:%20Looks%20like%20you%20wrote%20'instructions%20=%20...'%20instead%20of%20'instruction%20=%20...'%20in%20your%20ai-text-plugin%20prompt%20data?)%5C%22;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20return%20%5C%22(Error:%20Looks%20like%20you%20wrote%20'instructions%20=%20...'%20instead%20of%20'instruction%20=%20...'%20in%20your%20ai-text-plugin%20prompt%20data?)%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if(typeof%20inputData%20===%20%5C%22string%5C%22%20%7C%7C%20inputData%20instanceof%20String)%20%7B%5Cn%20%20%20%20inputData%20=%20%7Binstruction:inputData+%5C%22%5C%22%7D%5Cn%20%20%20%20if(!extraOpts)%20extraOpts%20=%20%7B%7D;%5Cn%20%20%20%20if(extraOpts.startWith)%20inputData.startWith%20=%20extraOpts.startWith;%5Cn%20%20%20%20if(extraOpts.stopSequences)%20inputData.stopSequences%20=%20extraOpts.stopSequences;%5Cn%20%20%20%20if(extraOpts.hideStartWith)%20inputData.hideStartWith%20=%20extraOpts.hideStartWith;%5Cn%20%20%20%20if(extraOpts.outputTo)%20inputData.outputTo%20=%20extraOpts.outputTo;%5Cn%20%20%20%20if(extraOpts.outputTo)%20inputData.outputTo%20=%20extraOpts.outputTo;%5Cn%20%20%20%20if(extraOpts.onChunk)%20inputData.onChunk%20=%20extraOpts.onChunk;%5Cn%20%20%20%20if(extraOpts.onStart)%20inputData.onStart%20=%20extraOpts.onStart;%5Cn%20%20%20%20if(extraOpts.onFinish)%20inputData.onFinish%20=%20extraOpts.onFinish;%5Cn%20%20%20%20if(extraOpts.render)%20inputData.render%20=%20extraOpts.render;%5Cn%20%20%20%20if(extraOpts.endButtons)%20inputData.endButtons%20=%20extraOpts.endButtons;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20//%20REMEMBER:%20if%20you%20add%20more%20inputs,%20you%20need%20to%20also%20update%20%60window.__continueAiTextResponseClickHandler%60%5Cn%20%20let%20hideStartWith%20=%20inputData.hideStartWith;%20//%20get%20the%20'concrete'%20value%20in%20case%20it%20was%20dynamic%20like%20%60hideStartWith%20=%20%5B%20...%20%5D%60%20-%20this%20is%20important%20because%20the%20condition%20in%20the%20square%20brackets%20could%20change%20later%5Cn%20%20%5Cn%20%20let%20instruction%20=%20inputData.instruction;%5Cn%20%20if(typeof%20instruction%20===%20%5C%22function%5C%22)%20%7B%5Cn%20%20%20%20instruction%20=%20instruction(%7B%7D);%20//%20this%20is%20useful%20as%20a%20way%20to%20give%20a%20string%20that%20should%20not%20be%20evaluated%20-%20since%20e.g.%20instruction%20=%20%5BtextareaEl.value%5D%20will%20actually%20evaluate%20the%20text%20when%20we%20call%20inputData.instruction%5Cn%20%20%20%20if(typeof%20instruction%20!==%20%5C%22string%5C%22)%20instruction%20=%20instruction.toString();%5Cn%20%20%7D%20else%20if(instruction)%20%7B%5Cn%20%20%20%20if(typeof%20instruction%20!==%20%5C%22string%5C%22)%20%7B%5Cn%20%20%20%20%20%20instruction%20=%20instruction.evaluateItem;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20instruction%20=%20instruction.toString();%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20instruction%20=%20%5C%22Write%20something.%5C%22;%20//%20default%20instruction%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20startWith%20=%20inputData.startWith;%5Cn%20%20if(typeof%20startWith%20===%20%5C%22function%5C%22)%20%7B%5Cn%20%20%20%20startWith%20=%20startWith(%7B%7D);%20//%20this%20is%20useful%20as%20a%20way%20to%20give%20a%20string%20that%20should%20not%20be%20evaluated%20-%20since%20e.g.%20startWith%20=%20%5BtextareaEl.value%5D%20will%20actually%20evaluate%20the%20text%20when%20we%20call%20inputData.startWith%5Cn%20%20%20%20if(typeof%20startWith%20!==%20%5C%22string%5C%22)%20startWith%20=%20startWith.toString();%5Cn%20%20%7D%20else%20if(startWith)%20%7B%5Cn%20%20%20%20if(typeof%20startWith%20!==%20%5C%22string%5C%22)%20%7B%5Cn%20%20%20%20%20%20startWith%20=%20startWith.evaluateItem;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20startWith%20=%20startWith.toString();%5Cn%20%20%20%20//%20We%20trim%20whitespace%20off%20the%20end%20due%20to%20the%20classic%20tokenizer%20problem%20(most%20word%20tokens%20start%20with%20a%20space%20as%20of%202023%20tokenizers).%5Cn%20%20%20%20//%20This%20of%20course%20does%20mean%20that%20you%20can't%20%5C%22force%5C%22%20the%20model%20to%20start%20with%20a%20space%20after%20a%20word,%20but%20it's%20worth%20that%20trade-off%20until%20we%20get%20models%20with%20better%20tokenizers.%5Cn%20%20%20%20startWith%20=%20startWith.replace(/%20+$/g,%20%5C%22%5C%22);%20//%20CAUTION:%20Don't%20trim%20newlines%20-%20only%20spaces.%20Because%20e.g.%20the%20story%20writer%20demo%20relies%20on%20being%20able%20to%20start%20with%202%20new%20lines%20before%20the%20paragraph%20that%20the%20AI%20is%20about%20to%20generate,%20since%20if%20the%20AI%20generates%20them,%20it'll%20trigger%20the%20stop%20sequence%20before%20it%20even%20gets%20to%20start%20writing%20the%20new%20paragraph%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20startWith%20=%20%5C%22%5C%22;%5Cn%20%20%7D%5Cn%5Cn%20%20let%20stopSequences%20=%20inputData.stopSequences;%5Cn%20%20if(typeof%20stopSequences%20===%20%5C%22function%5C%22)%20%7B%5Cn%20%20%20%20stopSequences%20=%20stopSequences(%7B%7D);%5Cn%20%20%7D%20else%20if(stopSequences)%20%7B%5Cn%20%20%20%20if(!Array.isArray(stopSequences))%20%7B%5Cn%20%20%20%20%20%20stopSequences%20=%20stopSequences.selectAll.map(n%20=%3E%20n.evaluateItem);%5Cn%20%20%20%20%7D%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20stopSequences%20=%20%5B%5D;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20textareaLoadingIndicatorHandler;%5Cn%20%20%5Cn%20%20//%20REMEMBER:%20if%20you%20add%20more%20inputs,%20you%20need%20to%20also%20update%20%60window.__continueAiTextResponseClickHandler%60%5Cn%20%20%5Cn%20%20let%20concreteInputs%20=%20%7BstartWith,%20instruction,%20stopSequences%7D;%20%20//%20%3C--%20CAUTION:%20the%20startWith%20property%20of%20this%20is%20set%20to%20the%20full%20startWith+generatedText%20after%20generation,%20and%20the%20startWith%20can%20be%20changed%20after%20generation%20for%20the%20%60editAiTextResponseClickHandler%60%20feature%20-%20ctrl+f%20for%20%60concreteInputs.startWith%20=%60.%20Use%20%60originalConcreteInputs%60%20for%20original%20inputs.%5Cn%20%20const%20originalConcreteInputs%20=%20Object.freeze(JSON.parse(JSON.stringify(concreteInputs)));%5Cn%5Cn%20%20let%20placeholderEl;%5Cn%20%20let%20placeholderElDidInitiallyExist%20=%20false;%20//%20this%20is%20for%20keepalive%20stuff%20-%20so%20we%20can%20cancel%20a%20queued%20up%20generation%20if%20the%20placeholder%20is%20removed%5Cn%20%20let%20userStoppedGeneration%20=%20false;%5Cn%20%20%5Cn%20%20let%20textStreamController;%5Cn%20%20const%20textStream%20=%20new%20ReadableStream(%7B%5Cn%20%20%20%20start(c)%20%7B%5Cn%20%20%20%20%20%20textStreamController%20=%20c;%5Cn%20%20%20%20%7D%5Cn%20%20%7D);%5Cn%20%20%5Cn%20%20let%20darkModeEnabled%20=%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches;%5Cn%20%20const%20animatedLoadingSvg%20=%20%60%3Csvg%20style=%5C%22$%7BdarkModeEnabled%20?%20%5C%22filter:invert(0.85);%5C%22%20:%20%5C%22%5C%22%7D%20height:1rem;%20width:2rem;%20overflow:hidden;%20border-radius:3px;%20vertical-align:top;%20position:relative;%20top:0.07rem;%20margin-left:0.125rem;%5C%22%20height=%5C%221rem%5C%22%20width=%5C%222rem%5C%22%20class=%5C%22ai-text-plugin-loader%5C%22%3E%20%3Ccircle%20class=%5C%22ai-text-plugin-dot%5C%22%20cx=%5C%220.5em%5C%22%20cy=%5C%220.5em%5C%22%20r=%5C%220.2em%5C%22%20style=%5C%22fill:grey;%5C%22%3E%3C/circle%3E%20%3Ccircle%20class=%5C%22ai-text-plugin-dot%5C%22%20cx=%5C%221em%5C%22%20cy=%5C%220.5em%5C%22%20r=%5C%220.2em%5C%22%20style=%5C%22fill:grey;%5C%22%3E%3C/circle%3E%20%3Ccircle%20class=%5C%22ai-text-plugin-dot%5C%22%20cx=%5C%221.5em%5C%22%20cy=%5C%220.5em%5C%22%20r=%5C%220.2em%5C%22%20style=%5C%22fill:grey;%5C%22%3E%3C/circle%3E%20%3C/svg%3E%60;%5Cn%20%20%5Cn%20%20let%20generatedText%20=%20%5C%22%5C%22;%5Cn%20%20let%20finishedGenerating%20=%20false;%5Cn%20%20let%20thereWasAnErrorDuringGeneration%20=%20false;%5Cn%20%20%5Cn%20%20let%20onFinishPromiseResolver;%5Cn%20%20let%20onFinishPromiseRejecter;%5Cn%20%20let%20onFinishPromise%20=%20new%20Promise((resolve,%20reject)%20=%3E%20%7B%5Cn%20%20%20%20onFinishPromiseResolver%20=%20resolve;%5Cn%20%20%20%20onFinishPromiseRejecter%20=%20reject;%5Cn%20%20%7D);%5Cn%20%20%5Cn%20%20let%20completionId%20=%20%5C%22aiTextCompletion%5C%22+Math.random().toString().replace(%5C%22.%5C%22,%20%5C%22%5C%22);%5Cn%20%20let%20lastGeneratedChunkReceivedTime%20=%20null;%5Cn%5Cn%20%20async%20function%20streamTextFromIframe(chunkCallback)%20%7B%20%5Cn%20%20%20%20let%20postData%20=%20%7B%7D;%5Cn%20%20%20%20postData.instruction%20=%20concreteInputs.instruction%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20postData.startWith%20=%20concreteInputs.startWith%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20postData.stopSequences%20=%20concreteInputs.stopSequences%20%7C%7C%20%5B%5D;%5Cn%20%20%20%20postData.generatorName%20=%20window.generatorName;%5Cn%5Cn%20%20%20%20postData.instruction%20=%20postData.instruction.replace(%5C%22%20%5C%22,%20%5C%22%C2%A0%5C%22);%5Cn%20%20%20%20if(!postData.instruction.includes(%5C%22%C2%A0%5C%22))%20%7B%20postData.instruction%20=%20%60$%7BpostData.instruction%7D%C2%A0%60;%20%7D%20%5Cn%20%20%20%20%5Cn%20%20%20%20let%20url%20=%20%60$%7BserverOrigin%7D/api/generate%60;%5Cn%20%20%20%20let%20haveReceivedFirstTextChunk%20=%20false;%5Cn%20%20%20%20let%20haveReceivedLastTextChunk%20=%20false;%5Cn%20%20%20%20function%20messageHandler(event)%20%7B%5Cn%20%20%20%20%20%20if(event.data.requestId%20!==%20completionId)%20return;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20console.debug(%5C%22streamTextFromIframe%20messageHandler:%5C%22,%20event.data);%5Cn%20%20%20%20%20%20if(event.data.type%20===%20%5C%22streamData%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20lastGeneratedChunkReceivedTime%20=%20Date.now();%5Cn%20%20%20%20%20%20%20%20let%20text%20=%20event.data.value.text;%5Cn%20%20%20%20%20%20%20%20let%20data%20=%20%7Btext%7D;%5Cn%20%20%20%20%20%20%20%20if(event.data.value.stopReason)%20data.stopReason%20=%20event.data.value.stopReason;%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20//%20console.debug(%5C%22event.data.value:%5C%22,%20event.data.value);%5Cn%20%20%20%20%20%20%20%20if(!haveReceivedFirstTextChunk)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20data.isFirstChunk%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20haveReceivedFirstTextChunk%20=%20true;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(haveReceivedLastTextChunk)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20console.error(%5C%22haveReceivedLastTextChunk%20but%20about%20to%20send%20another%20chunk???%20maybe%20recieving%20streamEnd%20before%20it's%20actually%20finished??%5C%22);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(event.data.value.final)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20data.isLastChunk%20=%20true;%20//%20remember,%20a%20chunk%20can%20be%20both%20the%20first%20*and*%20last%20chunk%5Cn%20%20%20%20%20%20%20%20%20%20haveReceivedLastTextChunk%20=%20true;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20chunkCallback(data);%5Cn%20%20%20%20%20%20%7D%20else%20if%20(event.data.type%20===%20%5C%22streamEnd%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20//%20console.debug(%60ai-text-plugin%20Received%20'streamEnd'%20for%20$%7BcompletionId%7D%60);%5Cn%20%20%20%20%20%20%20%20window.removeEventListener(%5C%22message%5C%22,%20messageHandler);%5Cn%20%20%20%20%20%20%20%20if(!haveReceivedLastTextChunk)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20this%20can%20happen%20if%20stream%20is%20aborted,%20or%20if%20.stop()%20was%20called%20in%20userland,%20and%20perhaps%20for%20other%20reasons,%20so%20we%20send%20a%20last%20%5C%22dummy%5C%22%20chunk%5Cn%20%20%20%20%20%20%20%20%20%20chunkCallback(%7Btext:%5C%22%5C%22,%20stopReason:%5C%22user%5C%22,%20isLastChunk:true,%20isFirstChunk:!haveReceivedFirstTextChunk%7D);%5Cn%20%20%20%20%20%20%20%20%20%20haveReceivedLastTextChunk%20=%20true;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20if%20(event.data.type%20===%20%5C%22streamError%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20if(userStoppedGeneration%20&&%20event.data.status%20===%20%5C%22stale%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20this%20is%20not%20actually%20an%20error,%20but%20iframe%20embed%20can't%20know%20that,%20so%20it%20sends%20us%20this,%20which%20we%20just%20ignore.%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(!finishedGenerating)%20%7B%20//%20%3C--%20just%20to%20guard%20against%20weird%20timing%20stuff%5Cn%20%20%20%20%20%20%20%20%20%20%20%20thereWasAnErrorDuringGeneration%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20chunkCallback(%7Btext:%5C%22%5C%22,%20error:true,%20isLastChunk:!haveReceivedLastTextChunk,%20isFirstChunk:!haveReceivedFirstTextChunk%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20div%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20div.innerHTML%20=%20%60%3Cdiv%20style=%5C%22z-index:1000;%20position:%20fixed;%20bottom:%201rem;%20width:%20100%25;%20pointer-events:none;%5C%22%3E%3Cspan%20style=%5C%22%20padding:%200.5rem;%20background:%20#ac2c2c;%20border-radius:%203px;%20color:%20white;%20pointer-events:auto;%5C%22%3Eerror:%20$%7Bevent.data.status.replaceAll(%5C%22_%5C%22,%20%5C%22%20%5C%22)%7D%3C/span%3E%3C/div%3E%60;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20div%20=%20div.firstElementChild;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20document.body.appendChild(div);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20div.remove();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D,%201000*5);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20window.removeEventListener(%5C%22message%5C%22,%20messageHandler);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20window.addEventListener(%5C%22message%5C%22,%20messageHandler);%5Cn%20%20%20%20%5Cn%20%20%20%20while(!window.__aiTextIframeEmbedIsReady)%20%7B%5Cn%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20100));%5Cn%20%20%20%20%7D%5Cn%20%20%20%20if(inputData._debug)%20postData._debug%20=%20JSON.parse(JSON.stringify(inputData._debug));%5Cn%20%20%20%20iframe.contentWindow.postMessage(%7B%20type:%20%5C%22startStream%5C%22,%20url,%20postData,%20requestId:completionId,%20perchanceGeneratorOrigin:window.location.origin%20%7D,%20serverOrigin);%5Cn%20%20%20%20//%20console.debug(%5C%22sent%20startStream%20request%20to%20iframe%5C%22);%5Cn%20%20%7D%5Cn%5Cn%20%20async%20function%20editAiTextResponseClickHandler(el)%20%7B%20%20%20%20%5Cn%20%20%20%20let%20saveButton%20=%20document.createElement(%5C%22button%5C%22);%5Cn%20%20%20%20saveButton.style.cssText%20=%20%5C%22position:fixed;%20z-index:501;%5C%22;%5Cn%20%20%20%20saveButton.textContent%20=%20%5C%22%F0%9F%92%BE%5C%22;%5Cn%20%20%20%20document.body.append(saveButton);%5Cn%5Cn%20%20%20%20let%20textarea%20=%20document.createElement(%5C%22textarea%5C%22);%5Cn%20%20%20%20textarea.style.cssText%20=%20%5C%22z-index:500;%20display:block;%20position:fixed;%20min-height:2rem;%20min-width:10rem;%5C%22;%5Cn%20%20%20%20textarea.value%20=%20concreteInputs.startWith;%5Cn%20%20%20%20document.body.append(textarea);%5Cn%20%20%20%20let%20updateCoverPosition%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20rect%20=%20el.getBoundingClientRect();%5Cn%20%20%20%20%20%20textarea.style.left%20=%20%60$%7Brect.left%7Dpx%60;%5Cn%20%20%20%20%20%20textarea.style.top%20=%20%60$%7Brect.top%7Dpx%60;%5Cn%20%20%20%20%20%20textarea.style.width%20=%20%60$%7Brect.width%7Dpx%60;%5Cn%20%20%20%20%20%20textarea.style.height%20=%20%60$%7Brect.height+10%7Dpx%60;%5Cn%5Cn%20%20%20%20%20%20let%20textareaRect%20=%20textarea.getBoundingClientRect();%20//%20Use%20coverElement's%20dimensions%5Cn%20%20%20%20%20%20saveButton.style.left%20=%20%60$%7BtextareaRect.right-saveButton.offsetWidth%7Dpx%60;%5Cn%20%20%20%20%20%20saveButton.style.top%20=%20%60$%7BtextareaRect.bottom%7Dpx%60;%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20updateCoverPosition();%5Cn%20%20%20%20window.addEventListener('scroll',%20updateCoverPosition);%5Cn%20%20%20%20window.addEventListener('resize',%20updateCoverPosition);%5Cn%20%20%20%20%5Cn%20%20%20%20const%20observer%20=%20new%20MutationObserver((mutationsList)%20=%3E%20%7B%5Cn%20%20%20%20%20%20for(let%20mutation%20of%20mutationsList)%20%7B%5Cn%20%20%20%20%20%20%20%20for(let%20node%20of%20mutation.removedNodes)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(node.contains(el))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20textarea.remove();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20saveButton.remove();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20window.removeEventListener('scroll',%20updateCoverPosition);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20window.removeEventListener('resize',%20updateCoverPosition);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20observer.disconnect();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20observer.observe(document.body,%20%7B%20childList:%20true,%20subtree:%20true%20%7D);%5Cn%5Cn%20%20%20%20await%20new%20Promise(r%20=%3E%20saveButton.onclick=r);%20%5Cn%5Cn%20%20%20%20let%20endButtonsCtn%20=%20el.querySelector(%5C%22.ai-text-response-end-buttons-ctn%5C%22);%5Cn%20%20%20%20endButtonsCtn.remove();%5Cn%5Cn%20%20%20%20concreteInputs.startWith%20=%20textarea.value;%5Cn%20%20%20%20%5Cn%20%20%20%20//%20we%20do%20this%20because%20the%20onFinishPromise%20is%20actually%20the%20return%20value%20of%20this%20function,%20but%20it%20also%20serves%20as%20an%20object%20with%20a%20bunch%20of%20handy%20properties%20like%20.liveResponseText,%20.stop(),%20etc.%5Cn%20%20%20%20onFinishPromise.liveResponseText%20=%20textarea.value;%5Cn%20%20%20%20%5Cn%20%20%20%20//%20el.innerHTML%20=%20textarea.value;%5Cn%20%20%20%20//%20el.appendChild(endButtonsCtn);%5Cn%20%20%20%20renderResponseTextIntoContainer(textarea.value,%20%7BaddEndButtons:true,%20isFinalRender:true%7D);%5Cn%5Cn%20%20%20%20window.removeEventListener('scroll',%20updateCoverPosition);%5Cn%20%20%20%20window.removeEventListener('resize',%20updateCoverPosition);%5Cn%20%20%20%20textarea.remove();%5Cn%20%20%20%20saveButton.remove();%5Cn%20%20%7D;%5Cn%20%20%5Cn%20%20async%20function%20continueAiTextResponseClickHandler(el,%20opts=%7B%7D)%20%7B%20%20%20%20%5Cn%20%20%20%20let%20instruction%20=%20concreteInputs.instruction;%5Cn%20%20%20%20let%20startWith%20=%20concreteInputs.startWith;%5Cn%20%20%20%20let%20stopSequences%20=%20concreteInputs.stopSequences;%5Cn%20%20%20%20%5Cn%20%20%20%20if(opts.appendContinuationSuffix)%20startWith%20+=%20%5C%22%5C%5Cn%5C%22;%5Cn%20%20%20%20%5Cn%20%20%20%20responseEndButtonsCtn.remove();%5Cn%20%20%20%20let%20obj%20=%20$output(%7Binstruction,%20startWith,%20stopSequences,%20style:inputData.style,%20outputTo:el,%20render:inputData.render,%20onFinish:inputData.onFinish,%20onChunk:inputData.onChunk%7D);%5Cn%20%20%20%20el.innerHTML%20+=%20obj.loadingIndicatorHtml;%5Cn%20%20%20%20let%20result%20=%20await%20obj;%5Cn%20%20%20%20if(!opts.appendContinuationSuffix%20&&%20result.generatedText%20===%20%5C%22%5C%22%20&&%20!result.text.endsWith(%5C%22%5C%5Cn%5C%5Cn%5C%22))%20%7B%5Cn%20%20%20%20%20%20//%20no%20text%20was%20generated,%20so%20try%20again%20with%20a%20suffix%20that's%20likely%20to%20trigger%20more%20text.%5Cn%20%20%20%20%20%20//%20TODO:%20maybe%20check%20stopReason%20here%20too?%5Cn%20%20%20%20%20%20continueAiTextResponseClickHandler(el,%20%7BappendContinuationSuffix:true%7D)%5Cn%20%20%20%20%7D%5Cn%20%20%7D;%5Cn%20%20%5Cn%20%20let%20responseEndButtonsCtn;%5Cn%20%20%7B%5Cn%20%20%20%20let%20buttonGap%20=%20%5C%220.25rem%5C%22;%5Cn%20%20%20%20if(window.innerWidth%20%3C%20600)%20buttonGap%20=%20%5C%221.5rem%5C%22;%5Cn%20%20%20%20%5Cn%20%20%20%20let%20darkModeEnabled%20=%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches;%5Cn%20%20%20%20let%20responseEndButtonsHtml%20=%20%60%3Cspan%20class=%5C%22ai-text-response-end-buttons-ctn%5C%22%20style=%5C%22display:%20inline-flex;background:$%7BdarkModeEnabled%20?%20%5C%22#666666%5C%22%20:%20%5C%22#f1f1f1%5C%22%7D;color:%20$%7BdarkModeEnabled%20?%20%5C%22#d5d5d5%5C%22%20:%20%5C%22grey%5C%22%7D;height:%201rem;width:%201rem;border-radius:%203px;vertical-align:%20top;position:%20relative;top:%200.07rem;margin-left:%200.125rem;align-items:%20center;justify-content:%20center;cursor:%20pointer;%20font-size:80%25%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22ai-text-response-buttons-wrapper%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22ai-text-continue-button%5C%22%20style=%5C%22height:min-content;%5C%22%3E%E2%96%B6%EF%B8%8F%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22ai-text-edit-button%5C%22%20style=%5C%22height:min-content;%20margin-left:$%7BbuttonGap%7D%5C%22%3E%E2%9C%8F%EF%B8%8F%3C/button%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/span%3E%60;%5Cn%20%20%20%20responseEndButtonsCtn%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20responseEndButtonsCtn.innerHTML%20=%20responseEndButtonsHtml;%5Cn%20%20%20%20responseEndButtonsCtn%20=%20responseEndButtonsCtn.firstElementChild;%5Cn%20%20%20%20if(inputData.endButtons?.evaluateItem%20===%20%5C%22none%5C%22)%20%7B%5Cn%20%20%20%20%20%20responseEndButtonsCtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20responseEndButtonsCtn.querySelector(%5C%22.ai-text-continue-button%5C%22).onclick%20=%20function()%20%7B%5Cn%20%20%20%20%20%20//%20console.debug(%5C%22wrapper%20display:%5C%22,%20this.closest('.ai-text-response-buttons-wrapper').style.display);%5Cn%20%20%20%20%20%20let%20responseCtn%20=%20this.closest(%5C%22.ai-text-response-end-buttons-ctn%5C%22).__aiTextResponseCtn%20%7C%7C%20this.closest('.ai-text-response-ctn');%5Cn%20%20%20%20%20%20continueAiTextResponseClickHandler(responseCtn);%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20responseEndButtonsCtn.querySelector(%5C%22.ai-text-edit-button%5C%22).onclick%20=%20function()%20%7B%5Cn%20%20%20%20%20%20//%20console.debug(%5C%22wrapper%20display:%5C%22,%20this.closest('.ai-text-response-buttons-wrapper').style.display);%5Cn%20%20%20%20%20%20let%20responseCtn%20=%20this.closest(%5C%22.ai-text-response-end-buttons-ctn%5C%22).__aiTextResponseCtn%20%7C%7C%20this.closest('.ai-text-response-ctn');%5Cn%20%20%20%20%20%20editAiTextResponseClickHandler(responseCtn);%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20function%20escapeRegExp(text)%20%7B%5Cn%20%20%20%20return%20text.replace(/%5B-%5B%5C%5C%5D%7B%7D()*+?.,%5C%5C%5C%5C%5E$%7C#%5C%5Cs%5D/g,%20'%5C%5C%5C%5C$&');%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20startWithRegex;%5Cn%20%20%5Cn%20%20function%20renderResponseTextIntoContainer(response,%20opts=%7B%7D)%20%7B%5Cn%20%20%20%20if(!inputData.outputTo%20&&%20!placeholderEl)%20return;%20//%20%3C--%20indicates%20that%20they're%20doing%20things%20manually%20with%20e.g.%20onFinishPromise/onChunk/etc.%5Cn%20%20%20%20%5Cn%20%20%20%20if(hideStartWith)%20%7B%20//%20note%20that%20%60hideStartWith%60%20is%20purely%20'visual'%20-%20it's%20just%20a%20handy%20helper%20for%20a%20common%20case%20(that%20could%20otherwise%20be%20solved%20with%20%60render%60)%5Cn%20%20%20%20%20%20if(!startWithRegex)%20startWithRegex%20=%20new%20RegExp(%5C%22%5E%5C%22+escapeRegExp(concreteInputs.startWith));%5Cn%20%20%20%20%20%20response%20=%20response.replace(startWithRegex,%20%5C%22%5C%22);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20if(inputData.render)%20%7B%5Cn%20%20%20%20%20%20response%20=%20inputData.render(%7Btext:response,%20isPartial:!opts.isFinalRender%7D);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20if(inputData.outputTo)%20%7B%5Cn%20%20%20%20%20%20if(typeof%20inputData.outputTo.value%20==%20%5C%22string%5C%22)%20%7B%20//%20textarea,%20input,%20or%20user's%20custom%20object%20with%20string%20%60.value%60%20property%5Cn%20%20%20%20%20%20%20%20inputData.outputTo.value%20=%20response;%5Cn%20%20%20%20%20%20%20%20if(inputData.outputTo.tagName%20===%20%5C%22TEXTAREA%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(inputData.outputTo.scrollTop%20%3E%20(inputData.outputTo.scrollHeight%20-%20inputData.outputTo.offsetHeight)-30)%20%7B%20//%20%3C--%20if%20the%20text%20box%20is%20already%20scrolled%20near%20the%20end%20of%20the%20text%5Cn%20%20%20%20%20%20%20%20%20%20%20%20inputData.outputTo.scrollTop%20=%209999999999;%20//%20scroll%20down%20to%20bottom%20of%20text%20box%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20inputData.outputTo.innerHTML%20=%20response;%5Cn%20%20%20%20%20%20%20%20if(opts.addEndButtons)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20responseEndButtonsCtn.title%20=%20%60Inputs%20that%20were%20used:%5C%5Cn%5C%5Cninstruction=$%7BconcreteInputs.instruction%7D%5C%5Cn%5C%5CnstartWith=$%7BconcreteInputs.startWith%7D%60;%5Cn%20%20%20%20%20%20%20%20%20%20responseEndButtonsCtn.__aiTextResponseCtn%20=%20inputData.outputTo;%5Cn%20%20%20%20%20%20%20%20%20%20inputData.outputTo.append(responseEndButtonsCtn);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20if(typeof%20placeholderEl.value%20==%20%5C%22string%5C%22)%20%7B%20//%20textarea,%20input,%20or%20user's%20custom%20object%20with%20string%20%60.value%60%20property%5Cn%20%20%20%20%20%20%20%20placeholderEl.value%20=%20response;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20placeholderEl.innerHTML%20=%20response;%5Cn%20%20%20%20%20%20%20%20if(opts.addEndButtons)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20responseEndButtonsCtn.title%20=%20%60Inputs%20that%20were%20used:%5C%5Cn%5C%5Cninstruction=$%7BconcreteInputs.instruction%7D%5C%5Cn%5C%5CnstartWith=$%7BconcreteInputs.startWith%7D%60;%5Cn%20%20%20%20%20%20%20%20%20%20placeholderEl.append(responseEndButtonsCtn);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20gotFirstChunk%20=%20false;%5Cn%20%20let%20chunks%20=%20%5B%5D;%5Cn%20%20let%20generatedChunks%20=%20%5B%5D;%20//%20difference%20from%20%60chunks%60%20is%20that%20this%20doesn't%20include%20the%20user-specified%20%60startWith%60%20text%5Cn%20%20let%20alreadyDoneOnFinishStuff%20=%20false;%20//%20just%20as%20an%20extra%20guard%20against%20bugs%5Cn%20%20%5Cn%20%20function%20doOnFinishStuff(%7BstopReason%7D)%20%7B%5Cn%20%20%20%20if(alreadyDoneOnFinishStuff)%20return;%20//%20this%20is%20possible%20because%20e.g.%20userland%20onChunk%20can%20synchronously%20call%20.stop(),%20so%20it%20gets%20executed%20after%20last%20chunk%20arrival%20via%20stopFn(),%20but%20before%20'normal'%20doOnFinishStuff%20call%5Cn%20%20%20%20alreadyDoneOnFinishStuff%20=%20true;%5Cn%5Cn%20%20%20%20console.debug(%5C%22FINISHED%20STREAMING.%5C%22);%5Cn%5Cn%20%20%20%20let%20finishData%20=%20new%20String(chunks.join(%5C%22%5C%22));%5Cn%20%20%20%20finishData.text%20=%20chunks.join(%5C%22%5C%22);%5Cn%20%20%20%20finishData.generatedText%20=%20generatedChunks.join(%5C%22%5C%22);%5Cn%20%20%20%20finishData.stopReason%20=%20stopReason;%5Cn%5Cn%20%20%20%20if(inputData.onFinish)%20%7B%5Cn%20%20%20%20%20%20try%20%7B%20inputData.onFinish(finishData);%20%7D%20catch(e)%20%7B%20console.error(%5C%22error%20in%20onFinish:%5C%22,%20e);%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20onFinishPromiseResolver(finishData);%5Cn%20%20%20%20generatedText%20=%20generatedChunks.join(%5C%22%5C%22);%5Cn%5Cn%20%20%20%20if(textareaLoadingIndicatorHandler)%20textareaLoadingIndicatorHandler.stop();%5Cn%20%20%20%20try%20%7B%20textStreamController.close();%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D%5Cn%20%20%7D%5Cn%20%20function%20stopFn()%20%7B%5Cn%20%20%20%20if(finishedGenerating)%20return;%5Cn%20%20%20%20finishedGenerating%20=%20true;%5Cn%5Cn%20%20%20%20if(!gotFirstChunk%20&&%20placeholderEl)%20placeholderEl.innerHTML%20=%20%5C%22%5C%22;%20//%20clear%20the%20svg%20'loading'%20dots%5Cn%5Cn%20%20%20%20doOnFinishStuff(%7BstopReason:%5C%22user%5C%22%7D);%5Cn%20%20%7D%5Cn%5Cn%20%20async%20function%20startStreamingResponse()%20%7B%5Cn%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20(async%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%5Cn%20%20%20%20%20%20%20%20while(true)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(userStoppedGeneration)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.debug(%5C%22stopping%20keepalives%20due%20to%20%60userStoppedGeneration%60%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20break;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20if(finishedGenerating)%20%7B%20console.debug(%5C%22stopping%20keepalives%20due%20to%20%60finishedGenerating%60%5C%22);%20break;%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20if(placeholderElDidInitiallyExist%20&&%20!document.querySelector(%60#$%7BcompletionId%7D%60))%20%7B%20console.debug(%5C%22stopping%20keepalives%20due%20to%20%60placeholderEl%60%5C%22);%20break;%20%7D%20//%20placeholderEl%20no%20longer%20exists%20in%20the%20DOM,%20so%20user%20probably%20clicked%20'randomize'%20or%20whatever%20while%20previous%20one%20was%20still%20loading,%20hence%20we%20abort%20previous%20one%20by%20stopping%20the%20keepalives,%20which%20drops%20it%20from%20the%20queue%5Cn%20%20%20%20%20%20%20%20%20%20if(inputData.outputTo%20&&%20(!document.body.contains(inputData.outputTo)%20%7C%7C%20inputData.outputTo.dataset.aiTextCompletionId%20!==%20completionId))%20%20%7B%20console.debug(%5C%22stopping%20keepalives%20due%20to%20%60outputTo%60%5C%22);%20break;%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20//%20if(lastGeneratedChunkReceivedTime%20!==%20null%20&&%20Date.now()-lastGeneratedChunkReceivedTime%20%3E%201000*20)%20%20%7B%20console.debug(%5C%22stopping%20keepalives%20due%20to%20generation%20having%20started%20but%20no%20new%20chunks%20Received%20in%2020%20seconds%5C%22);%20break;%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20iframe.contentWindow.postMessage(%7B%20type:%20%5C%22streamKeepAlive%5C%22,%20requestId:completionId%20%7D,%20serverOrigin);%5Cn%20%20%20%20%20%20%20%20%20%20console.debug(%5C%22streamKeepAlive%20sent%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20800));%5Cn%20%20%20%20%20%20%20%20%20%20//%20if(window.devTest98375290385)%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%2010000000000));%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20try%20%7B%20stopFn();%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D;%20//%20need%20to%20call%20stopFn()%20here%20(and%20not%20just%20wait%20for%20it%20to%20be%20called%20in%20streamTextFromIframe)%20because%20otherwise%20it%20only%20gets%20called%20if%20streamTextFromIframe%20gets%20called%20again,%20which%20it%20*might%20not*%5Cn%20%20%20%20%20%20%20%20try%20%7B%20iframe.contentWindow.postMessage(%7B%20type:%20%5C%22stopStream%5C%22,%20requestId:completionId%20%7D,%20serverOrigin);%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D;%5Cn%20%20%20%20%20%20%7D)();%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20streamTextFromIframe(function(data)%20%7B%5Cn%20%20%20%20%20%20%20%20if(userStoppedGeneration)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(!finishedGenerating)%20stopFn();%5Cn%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(placeholderElDidInitiallyExist%20&&%20!document.querySelector(%60#$%7BcompletionId%7D%60))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(!finishedGenerating)%20stopFn();%5Cn%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(inputData.outputTo%20&&%20(!document.body.contains(inputData.outputTo)%20%7C%7C%20inputData.outputTo.dataset.aiTextCompletionId%20!==%20completionId))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(!finishedGenerating)%20stopFn();%5Cn%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(finishedGenerating)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20thereWasAnErrorDuringGeneration%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20console.error(%5C%22We%20received%20a%20chunk%20of%20text%20even%20though%20we've%20already%20finishedGenerating?%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20//%20add%20the%20startWith%20chunk%20before%20the%20first%20'real'%20chunk:%5Cn%20%20%20%20%20%20%20%20if(data.isFirstChunk%20&&%20concreteInputs.startWith%20&&%20!hideStartWith)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20chunks.push(concreteInputs.startWith);%5Cn%20%20%20%20%20%20%20%20%20%20textStreamController.enqueue(concreteInputs.startWith);%5Cn%20%20%20%20%20%20%20%20%20%20if(inputData.onChunk)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20inputData.onChunk(%7BfullTextSoFar:chunks.join(%5C%22%5C%22),%20textChunk:concreteInputs.startWith,%20isFromStartWith:true%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20if(data.error)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20allChunksJoined%20=%20chunks.join(%5C%22%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20thereWasAnErrorDuringGeneration%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20finishedGenerating%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20concreteInputs.startWith%20=%20allChunksJoined;%5Cn%20%20%20%20%20%20%20%20%20%20renderResponseTextIntoContainer(allChunksJoined,%20%7BaddEndButtons:true,%20isFinalRender:true%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20doOnFinishStuff(%7BstopReason:%5C%22error%5C%22%7D);%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20generationLastKnownToBeWorkingAt%20=%20Date.now();%5Cn%20%20%20%20%20%20%20%20%20%20if(data.isFirstChunk)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20gotFirstChunk%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(placeholderEl)%20placeholderEl.innerHTML%20=%20%5C%22%5C%22;%20//%20clear%20the%20svg%20'loading'%20dots%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(inputData.beforeFirstChunk)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputData.beforeFirstChunk(%7B%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20generatedChunks.push(data.text);%5Cn%20%20%20%20%20%20%20%20%20%20chunks.push(data.text);%5Cn%20%20%20%20%20%20%20%20%20%20textStreamController.enqueue(data.text);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20if(inputData.onChunk)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20//%20user-land%20handler%20may%20throw%20error%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20inputData.onChunk(%7BfullTextSoFar:chunks.join(%5C%22%5C%22),%20textChunk:data.text%7D);%20//%20%60data.text%60%20is%20the%20full%20text%20so%20far%20(like%20in%20onFinish,%20render,%20etc.),%20and%20%60data.chunk%60%20is%20the%20most%20recent%20chunk%20(the%20one%20that%20triggered%20this%20call%20to%20onChunk)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.error(%5C%22Error%20in%20onChunk:%5C%22,%20e);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20onFinishPromise.liveResponseText%20=%20chunks.join(%5C%22%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20renderResponseTextIntoContainer(chunks.join(%5C%22%5C%22),%20%7BaddEndButtons:!!data.isLastChunk,%20isFinalRender:!!data.isLastChunk%7D);%5Cn%20%20%20%20%20%20%20%20%20%20if(data.isLastChunk)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20concreteInputs.startWith%20=%20chunks.join(%5C%22%5C%22);%20//%20update%20the%20startWith%20for%20'continue'%20and%20'edit'%20button%20use%5Cn%20%20%20%20%20%20%20%20%20%20%20%20finishedGenerating%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20doOnFinishStuff(%7BstopReason:data.stopReason%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D);%20%20%20%20%5Cn%5Cn%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20thereWasAnErrorDuringGeneration%20=%20true;%5Cn%20%20%20%20%20%20finishedGenerating%20=%20true;%5Cn%20%20%20%20%20%20//%20onFinishPromiseRejecter();%5Cn%20%20%20%20%20%20doOnFinishStuff(%7BstopReason:%5C%22error%5C%22%7D);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20console.error(e);%5Cn%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%201000));%5Cn%20%20%20%20%20%20iframe.contentWindow.postMessage(%7Btype:%5C%22verifyUser%5C%22%7D,%20serverOrigin);%20//%20probably%20not%20necessary,%20but%20just%20in%20case%20(it'll%20only%20re-verify%20if%20it's%20actually%20needed%20anyway)%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20function%20onVisible(element,%20callback)%20%7B%5Cn%20%20%20%20new%20IntersectionObserver((entries,%20observer)%20=%3E%20%7B%5Cn%20%20%20%20%20%20entries.forEach(entry%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if(entry.intersectionRatio%20%3E%200)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20callback(element);%5Cn%20%20%20%20%20%20%20%20%20%20observer.disconnect();%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%7D).observe(element);%5Cn%20%20%20%20if(!callback)%20return%20new%20Promise(r%20=%3E%20callback=r);%5Cn%20%20%7D%5Cn%20%20%20%20%5Cn%20%20setTimeout(async%20()%20=%3E%20%7B%5Cn%20%20%20%20//%20give%20placeholderEl%20a%20chance%20to%20be%20put%20into%20the%20DOM%5Cn%20%20%20%20placeholderEl%20=%20document.querySelector(%60#$%7BcompletionId%7D%60);%20//%20this%20will%20be%20null%20if%20they're%20using%20outputTo%20or%20are%20just%20doing%20things%20fully%20manually%20onFinishPromise/onChunk/etc.%5Cn%20%20%20%20if(placeholderEl)%20placeholderElDidInitiallyExist%20=%20true;%5Cn%20%20%20%20//%20wait%20for%20placeholderEl%20to%20become%20visible:%5Cn%20%20%20%20if(placeholderElDidInitiallyExist%20&&%20!inputData.outputTo)%20%7B%5Cn%20%20%20%20%20%20await%20onVisible(placeholderEl);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(inputData.onStart)%20%7B%5Cn%20%20%20%20%20%20inputData.onStart(onFinishPromise);%20//%20note%20that%20%60onFinishPromise%60%20has%20all%20the%20data%20attached,%20like%20%60inputs%60,%20%60liveResponseText%60,%20etc.%20-%20see%20below%5Cn%20%20%20%20%20%20if(inputData.outputTo%20&&%20inputData.outputTo.tagName%20===%20%5C%22TEXTAREA%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20try%20%7B%20textareaLoadingIndicatorHandler%20=%20addTextareaLoadingIndicator(inputData.outputTo);%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D%20//%20try/catch%20because%20new%20code%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20startStreamingResponse();%20%5Cn%20%20%7D,%20100);%5Cn%20%20%5Cn%20%20let%20beforeLoaderHtml%20=%20%5C%22%5C%22;%5Cn%20%20if(!inputData.outputTo%20&&%20!hideStartWith)%20%7B%5Cn%20%20%20%20beforeLoaderHtml%20=%20inputData.render%20?%20inputData.render(%7Btext:concreteInputs.startWith,%20isPartial:true%7D)%20:%20concreteInputs.startWith;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if(inputData.outputTo)%20%7B%5Cn%20%20%20%20inputData.outputTo.dataset.aiTextCompletionId%20=%20completionId;%20//%20this%20is%20used%20for%20keepalive%20stuff%20-%20if%20a%20queued%20request%20is%20going%20to%20output%20to%20an%20outputTo%20element,%20but%20that%20element%20no%20longer%20has%20the%20correct%20%60dataset.aiTextCompletionId%60%20then%20we%20drop%20it%20from%20the%20queue%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20onFinishPromise.inputs%20=%20originalConcreteInputs;%5Cn%20%20onFinishPromise.liveResponseText%20=%20concreteInputs.startWith;%20//%20this%20is%20full%20text%20(including%20startWith,%20which%20is%20why%20this%20property%20isn't%20called%20liveGeneratedText,%20or%20liveOutputText)%20and%20is%20live-updated%20as%20chunks%20come%20in.%20and%20note%20that%20it%20can%20also%20be%20edited%20by%20the%20user%20using%20the%20end%20buttons%5Cn%20%20onFinishPromise.textStream%20=%20textStream;%5Cn%20%20onFinishPromise.onFinishPromise%20=%20onFinishPromise;%20//%20backwards-compat%20with%20old%20return%20object%5Cn%20%20onFinishPromise.stop%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20userStoppedGeneration%20=%20true;%5Cn%20%20%20%20try%20%7B%20stopFn();%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D;%5Cn%20%20%20%20try%20%7B%20iframe.contentWindow.postMessage(%7B%20type:%20%5C%22stopStream%5C%22,%20requestId:completionId%20%7D,%20serverOrigin);%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D;%5Cn%20%20%20%20return%20onFinishPromise;%20//%20%3C--%20so%20.stop()%20returns%20the%20output%20data%5Cn%20%20%7D;%5Cn%20%20onFinishPromise.id%20=%20completionId;%5Cn%20%20onFinishPromise.loadingIndicatorHtml%20=%20animatedLoadingSvg;%20//%20%3C--%20just%20a%20littler%20helper%20for%20people%20who%20are%20e.g.%20using%20onFinishPromise/onChunk/etc.%20but%20want%20to%20add%20a%20loading%20indicator%20to%20the%20page%20manually%5Cn%20%20onFinishPromise.toString%20=%20function()%20%7B%20//%20this%20object%20stringifies%20into%20the%20default%20placeholder%20element%5Cn%20%20%20%20return%20%60%3Cspan%20class=%5C%22ai-text-response-ctn%5C%22%20id=%5C%22$%7BcompletionId%7D%5C%22%20style=%5C%22white-space:pre-wrap;%20$%7BinputData.style%20?%20inputData.style%20:%20%5C%22%5C%22%7D%5C%22%3E$%7BbeforeLoaderHtml%7D$%7BanimatedLoadingSvg%7D%3C/span%3E%60;%5Cn%20%20%7D;%5Cn%20%20onFinishPromise.submitUserRating%20=%20async%20(%7Bscore,%20reason%7D)%20=%3E%20%7B%5Cn%20%20%20%20if(!finishedGenerating%20%7C%7C%20thereWasAnErrorDuringGeneration)%20%7B%5Cn%20%20%20%20%20%20console.error(thereWasAnErrorDuringGeneration%20?%20%5C%22cannot%20rate%20because%20there%20was%20an%20error%20during%20generation%5C%22%20:%20%5C%22cannot%20rate%20because%20it%20hasn't%20finished%20generating%20yet%5C%22);%5Cn%20%20%20%20%20%20return;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20if(isNaN(Number(score))%20%7C%7C%20Number(score)%20%3E%201%20%7C%7C%20Number(score)%20%3C%200)%20return%20alert(%60User%20rating%20should%20be%20a%20value%20between%200%20(bad)%20and%201%20(good).%20Like%200.4%20or%200.8,%20for%20example.%60);%5Cn%20%20%20%20score%20=%20Number(score);%5Cn%20%20%20%20if(!reason)%20reason%20=%20%5C%22%5C%22;%5Cn%20%20%20%20iframe.contentWindow.postMessage(%7B%20type:%20%5C%22rateGeneratedText%5C%22,%20instruction,%20startWith,%20generatedText,%20generatorName:window.generatorName,%20score,%20reason%20%7D,%20serverOrigin);%5Cn%20%20%7D;%5Cn%20%20return%20onFinishPromise;%5Cn%20%20%5Cn%5Cn%5Cn%5Cn%5Cn//%20this%20was%20causing%20user-agent%20styles%20(specifically%20background%20color)%20to%20be%20removed%20in%20dark%20mode%20in%20chrome%20for%20some%20reason.%5Cn//%20it's%20a%20little%20too%20obtrusive%20anyway%20-%20ideally%20it%20would%20just%20be%20a%20%5C%22sliding%20line%5C%22%20that's%20only%20at%20the%20bottom%20of%20the%20textarea.%5Cn//%20or%20maybe%20a%20transparent%20loading%20indicator%20in%20the%20top-right%20of%20the%20textarea.%5CnaddTextareaLoadingIndicator(el)%20=%3E%5Cn%20%20//%20const%20computedStyle%20=%20getComputedStyle(el);%5Cn%20%20//%20const%20borderColor%20=%20computedStyle.borderColor;%5Cn%20%20//%20//%20Convert%20border%20color%20to%20rgba%20with%2030%25%20opacity%5Cn%20%20//%20const%20rgbaColor%20=%20borderColor.replace(/rgb%5C%5C((%5C%5Cd+),%5C%5Cs*(%5C%5Cd+),%5C%5Cs*(%5C%5Cd+)%5C%5C)/,%20'rgba($1,%20$2,%20$3,%200.3)');%5Cn%20%20//%20const%20className%20=%20'blink-'%20+%20Math.random().toString(36).substring(2,%2015);%5Cn%20%20//%20const%20style%20=%20document.createElement('style');%5Cn%20%20//%20style.innerHTML%20=%20%60%5Cn%20%20//%20%20%20@keyframes%20$%7BclassName%7D-blink%20%7B%5Cn%20%20//%20%20%20%20%200%25,%20100%25%20%7B%5Cn%20%20//%20%20%20%20%20%20%20border-color:%20$%7BborderColor%7D;%5Cn%20%20//%20%20%20%20%20%7D%5Cn%20%20//%20%20%20%20%2050%25%20%7B%5Cn%20%20//%20%20%20%20%20%20%20border-color:%20$%7BrgbaColor%7D;%5Cn%20%20//%20%20%20%20%20%7D%5Cn%20%20//%20%20%20%7D%5Cn%20%20//%20%20%20.$%7BclassName%7D%20%7B%5Cn%20%20//%20%20%20%20%20animation:%20$%7BclassName%7D-blink%201s%20infinite;%5Cn%20%20//%20%20%20%20%20border-color:%20$%7BborderColor%7D;%20/*%20must%20add%20this%20explicitly,%20since%20user-agent-only%20borders%20don't%20trigger%20the%20animation%20*/%5Cn%20%20//%20%20%20%7D%5Cn%20%20//%20%60;%5Cn%20%20//%20document.head.appendChild(style);%5Cn%20%20//%20el.classList.add(className);%5Cn%20%20return%20%7B%5Cn%20%20%20%20stop:%20function()%20%7B%5Cn%20%20%20%20%20%20//%20el.classList.remove(className);%5Cn%20%20%20%20%20%20//%20document.head.removeChild(style);%5Cn%20%20%20%20%7D,%5Cn%20%20%7D;%5Cn%5Cn%5Cn%5Cn%5Cn%5Cn%5Cn%5Cn%5Cncharacter%5Cn%20%20%7Bmech%7Cdemon%7Ccyberpunk%7D%20%7Bwarrior%7Cminion%7Csamurai%7D%5Cn%5Cnplace%5Cn%20%20a%20retropunk%20distopia%5Cn%20%20a%20small%20village%5Cn%20%20a%20mountainous%20region%5Cn%20%20an%20underwater%20cavern%5Cn%20%20a%20=%2010%5Cn%5Cnseason%5Cn%20%20winter%5Cn%20%20summer%5Cn%20%20%5CnpoemPrompt%5Cn%20%20instruction%20=%20Write%20a%20haiku%20about%20a%20%5Bcharacter%5D%20in%20%5Bplace%5D%20during%20%5Bseason%5D.%5Cn%5Cn%5Cn%5Cn%22,%22imports%22:%5B%5D,%22lastEditTime%22:1765364891656,%22found%22:true%7D,%7B%22name%22:%22comments-plugin%22,%22modelText%22:%22$output(opts)%20=%3E%5Cn%20%20if(!opts)%20opts%20=%20%7B%7D;%5Cn%20%20let%20width%20=%20opts.width;%5Cn%20%20let%20height%20=%20opts.height;%5Cn%20%20if(!width)%20width%20=%20%5C%22300px%5C%22;%5Cn%20%20if(!height)%20height%20=%20%5C%22250px%5C%22;%20%5Cn%20%20if(typeof%20width%20===%20%5C%22number%5C%22)%20width%20+=%20%5C%22px%5C%22;%20%20%20%20%5Cn%20%20if(typeof%20height%20===%20%5C%22number%5C%22)%20height%20+=%20%5C%22px%5C%22;%5Cn%20%20let%20containerStyle%20=%20opts.containerStyle%20%7C%7C%20opts.style%20%7C%7C%20%60width:$%7Bwidth%7D;%20height:$%7Bheight%7D;%60;%5Cn%20%20%5Cn%20%20let%20iframeUniqueId%20=%20%5C%22id%5C%22+Math.random().toString().replaceAll(%5C%22.%5C%22,%20%5C%22%5C%22)+%20Math.random().toString().replaceAll(%5C%22.%5C%22,%20%5C%22%5C%22);%5Cn%20%20let%20ctx%20=%20%7B%7D;%5Cn%20%20ctx.currentInputElText%20=%20%5C%22%5C%22;%5Cn%20%20ctx.iframeUniqueId%20=%20iframeUniqueId;%5Cn%20%20%5Cn%20%20console.debug(%5C%22comments-plugin%201%5C%22);%5Cn%20%20%5Cn%20%20function%20addMethodsToReturnValue(stringObj)%20%7B%5Cn%20%20%20%20stringObj.submit%20=%20async%20function(optionalText,%20opts=%7B%7D)%20%7B%5Cn%20%20%20%20%20%20//%20Note:%20if%20optionalText%20is%20specified,%20that%20text%20will%20be%20submitted%20instead%20of%20what's%20currently%20in%20the%20text%20box,%20and%20the%20text%20box%20will%20not%20be%20cleared%20after%20submission.%5Cn%20%20%20%20%20%20if(optionalText)%20optionalText%20=%20optionalText.toString();%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20nickname%20=%20opts.nickname%20?%20opts.nickname.toString()%20:%20null;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20resolver;%5Cn%20%20%20%20%20%20let%20promise%20=%20new%20Promise(r%20=%3E%20resolver=r);%5Cn%20%20%20%20%20%20let%20requestId%20=%20Math.random().toString()+Math.random().toString();%5Cn%20%20%20%20%20%20async%20function%20messageHandler(e)%20%7B%5Cn%20%20%20%20%20%20%20%20if(e.origin%20!==%20%5C%22https://comments-plugin.perchance.org%5C%22)%20return;%5Cn%20%20%20%20%20%20%20%20if(e.data.iframeUniqueId%20!==%20ctx.iframeUniqueId)%20return;%5Cn%20%20%20%20%20%20%20%20if(e.data.requestId%20!==%20requestId)%20return;%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20if(e.data.type%20===%20%5C%22message_submit_response%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20console.debug(%60parent%20frame%20got%20message_submit_response:%60,%20e.data.success);%5Cn%20%20%20%20%20%20%20%20%20%20resolver(%7Bsuccess:e.data.success%7D);%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20console.warn(%5C%22Invalid%20event%20type%20for%20this%20requestId?%5C%22);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20window.removeEventListener(%5C%22message%5C%22,%20messageHandler);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20window.addEventListener(%5C%22message%5C%22,%20messageHandler);%5Cn%20%20%20%20%20%20while(!ctx.finishedLoading)%20%7B%20console.debug(%5C%22Waiting%20for%20comments-plugin%20iframe%20to%20load%20before%20sending%20.submit()%20postMessage%5C%22);%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%20%7D%5Cn%20%20%20%20%20%20ctx.iframeContentWindow.postMessage(%7Btype:%5C%22trigger_programmatic_submit%5C%22,%20text:optionalText,%20nickname,%20channel:ctx.urlHashData.channel,%20requestId%7D,%20%5C%22https://comments-plugin.perchance.org%5C%22);%5Cn%20%20%20%20%20%20return%20promise;%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20%5Cn%20%20%20%20Object.defineProperty(stringObj,%20'inputText',%20%7B%5Cn%20%20%20%20%20%20get:%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20ctx.currentInputElText;%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20set:%20function(value)%20%7B%5Cn%20%20%20%20%20%20%20%20ctx.currentInputElText%20=%20value;%5Cn%20%20%20%20%20%20%20%20ctx.iframeContentWindow.postMessage(%7Btype:%5C%22set_input_el_text%5C%22,%20channel:ctx.urlHashData.channel,%20text:value%7D,%20%5C%22https://comments-plugin.perchance.org%5C%22);%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20%5Cn%20%20%20%20stringObj.setNicknameForNextComment%20=%20async%20function(nickname)%20%7B%5Cn%20%20%20%20%20%20ctx.iframeContentWindow.postMessage(%7Btype:%5C%22set_next_submit_nickname%5C%22,%20channel:ctx.urlHashData.channel,%20nickname:nickname%7D,%20%5C%22https://comments-plugin.perchance.org%5C%22);%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20stringObj.setAvatarUrlForNextComment%20=%20async%20function(avatarUrl)%20%7B%5Cn%20%20%20%20%20%20ctx.iframeContentWindow.postMessage(%7Btype:%5C%22set_next_submit_avatar_url%5C%22,%20channel:ctx.urlHashData.channel,%20nickname:avatarUrl%7D,%20%5C%22https://comments-plugin.perchance.org%5C%22);%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20let%20queuedUserBans%20=%20%5B%5D;%5Cn%20%20%20%20let%20queuedUserUnbans%20=%20%5B%5D;%5Cn%20%20%20%20function%20processQueuedDynamicBans()%20%7B%5Cn%20%20%20%20%20%20for(let%20userId%20of%20queuedUserBans)%20ctx.iframeContentWindow.postMessage(%7Btype:%5C%22ban_user%5C%22,%20channel:ctx.urlHashData.channel,%20userId%7D,%20%5C%22https://comments-plugin.perchance.org%5C%22);%5Cn%20%20%20%20%20%20queuedUserBans%20=%20%5B%5D;%5Cn%20%20%20%20%20%20for(let%20userId%20of%20queuedUserUnbans)%20ctx.iframeContentWindow.postMessage(%7Btype:%5C%22unban_user%5C%22,%20channel:ctx.urlHashData.channel,%20userId%7D,%20%5C%22https://comments-plugin.perchance.org%5C%22);%5Cn%20%20%20%20%20%20queuedUserUnbans%20=%20%5B%5D;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20ctx.finishedLoadingHandlers.push(processQueuedDynamicBans);%5Cn%20%20%20%20%5Cn%20%20%20%20stringObj.banUser%20=%20async%20function(userId)%20%7B%5Cn%20%20%20%20%20%20userId%20=%20userId.evaluateItem.split(%5C%22-%5C%22).pop();%5Cn%20%20%20%20%20%20if(ctx.finishedLoading)%20%7B%5Cn%20%20%20%20%20%20%20%20ctx.iframeContentWindow.postMessage(%7Btype:%5C%22ban_user%5C%22,%20channel:ctx.urlHashData.channel,%20userId%7D,%20%5C%22https://comments-plugin.perchance.org%5C%22);%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20queuedUserBans.push(userId);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20%5Cn%20%20%20%20stringObj.unbanUser%20=%20async%20function(userId)%20%7B%5Cn%20%20%20%20%20%20userId%20=%20userId.evaluateItem.split(%5C%22-%5C%22).pop();%5Cn%20%20%20%20%20%20if(ctx.finishedLoading)%20%7B%5Cn%20%20%20%20%20%20%20%20ctx.iframeContentWindow.postMessage(%7Btype:%5C%22unban_user%5C%22,%20channel:ctx.urlHashData.channel,%20userId%7D,%20%5C%22https://comments-plugin.perchance.org%5C%22);%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20queuedUserUnbans.push(userId);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20%5Cn%20%20%20%20Object.defineProperty(stringObj,%20'comments',%20%7B%20get:%20()%20=%3E%20ctx.allComments.slice(0)%20%7D);%5Cn%20%20%20%20Object.defineProperty(stringObj,%20'channel',%20%7B%20get:%20()%20=%3E%20ctx.urlHashData.channel%20%7D);%5Cn%20%20%20%20%5Cn%20%20%20%20return%20stringObj;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20queryParams%20=%20%7B%7D;%5Cn%20%20if(opts.adminPasswordHash)%20queryParams.adminPasswordHash%20=%20opts.adminPasswordHash.evaluateItem;%5Cn%20%20%5Cn%20%20let%20urlHashData%20=%20%7B%7D;%5Cn%20%20urlHashData.iframeUniqueId%20=%20iframeUniqueId;%5Cn%20%20if(opts.adminPasswordHash)%20urlHashData.adminPasswordHash%20=%20opts.adminPasswordHash;%5Cn%20%20if(opts.bannedWords)%20%7B%5Cn%20%20%20%20if(typeof%20opts.bannedWords%20===%20%5C%22string%5C%22)%20%7B%5Cn%20%20%20%20%20%20urlHashData.bannedWords%20=%20opts.bannedWords.trim().split(%5C%22,%5C%22).map(w%20=%3E%20w.trim()).filter(w%20=%3E%20w);%5Cn%20%20%20%20%7D%20else%20if(!opts.bannedWords.getLength%20&&%20opts.getPropertyNames%20&&%20opts.getPropertyNames.includes(%5C%22bannedWords%5C%22))%20%7B%5Cn%20%20%20%20%20%20urlHashData.bannedWords%20=%20opts.bannedWords.getRawListText.split(%5C%22=%5C%22).slice(1).join(%5C%22=%5C%22).trim().split(%5C%22,%5C%22).map(w%20=%3E%20w.trim()).filter(w%20=%3E%20w);%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20urlHashData.bannedWords%20=%20opts.bannedWords.selectAll.map(item%20=%3E%20item.getRawListText.replace(%5C%22/%5C%5C%5C%5C%5E%5C%22,%20%5C%22/%5E%5C%22));%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%5Cn%20%20if(opts.commentPlaceholderText)%20urlHashData.commentPlaceholderText%20=%20opts.commentPlaceholderText.evaluateItem;%5Cn%20%20if(opts.submitButtonText)%20urlHashData.submitButtonText%20=%20opts.submitButtonText.evaluateItem;%5Cn%20%20if(opts.submitButtonSuccessText)%20urlHashData.submitButtonSuccessText%20=%20opts.submitButtonSuccessText.evaluateItem;%5Cn%20%20if(opts.hideComments)%20urlHashData.hideComments%20=%20opts.hideComments;%5Cn%20%20if(opts.hideDates)%20urlHashData.hideDates%20=%20opts.hideDates;%5Cn%20%20if(opts.hideCommentsBeforeDate)%20urlHashData.hideCommentsBeforeDate%20=%20opts.hideCommentsBeforeDate;%5Cn%20%20%5Cn%20%20if(opts.hideSettingsButton)%20urlHashData.hideSettingsButton%20=%20opts.hideSettingsButton;%5Cn%20%20if(opts.hideFullscreenButton)%20urlHashData.hideFullscreenButton%20=%20opts.hideFullscreenButton;%5Cn%20%20if(opts.submitButtonStyle)%20urlHashData.submitButtonStyle%20=%20opts.submitButtonStyle.evaluateItem;%5Cn%20%20if(opts.settingsButtonStyle)%20urlHashData.settingsButtonStyle%20=%20opts.settingsButtonStyle.evaluateItem;%5Cn%20%20if(opts.fullscreenButtonStyle)%20urlHashData.fullscreenButtonStyle%20=%20opts.fullscreenButtonStyle.evaluateItem;%5Cn%20%20if(opts.messageBubbleStyle)%20urlHashData.messageBubbleStyle%20=%20opts.messageBubbleStyle.evaluateItem;%5Cn%20%20if(opts.messageFeedStyle)%20urlHashData.messageFeedStyle%20=%20opts.messageFeedStyle.evaluateItem;%5Cn%20%20if(opts.inputAreaStyle)%20urlHashData.inputAreaStyle%20=%20opts.inputAreaStyle.evaluateItem;%5Cn%20%20if(opts.loadFonts)%20urlHashData.loadFonts%20=%20opts.loadFonts.evaluateItem;%5Cn%20%20if(opts.forceColorScheme)%20urlHashData.forceColorScheme%20=%20opts.forceColorScheme.evaluateItem;%5Cn%20%20%5Cn%20%20try%20%7B%20urlHashData.transparentBackground%20=%20/(%5E%7C%5C%5Cs)background(%7C-color):%20*(transparent%7Cnone%20transparent)/.test(containerStyle);%20%7D%20catch(e)%20%7B%20console.log(e);%20%7D%5Cn%20%20%5Cn%20%20if(opts.channelLabel)%20urlHashData.channelLabel%20=%20opts.channelLabel.evaluateItem;%5Cn%20%20%5Cn%20%20%5Cn%20%20if(opts.adminFlair)%20urlHashData.adminFlair%20=%20opts.adminFlair.evaluateItem;%5Cn%20%20if(opts.deleteButtonIcon)%20urlHashData.deleteButtonIcon%20=%20opts.deleteButtonIcon.evaluateItem;%5Cn%20%20if(opts.bannedUsers)%20urlHashData.bannedUsers%20=%20opts.bannedUsers.selectAll.map(l%20=%3E%20l.evaluateItem.split(%5C%22-%5C%22).slice(-1)%5B0%5D).joinItems(%5C%22,%5C%22);%5Cn%20%20if(opts.rateLimits)%20urlHashData.rateLimits%20=%20opts.rateLimits;%5Cn%20%20if(opts.slashCommands)%20urlHashData.slashCommands%20=%20encodeURIComponent(JSON.stringify(opts.slashCommands));%5Cn%20%20if(opts.beforeSubmit)%20urlHashData.beforeSubmitHandlerEnabled%20=%20%5C%22true%5C%22;%5Cn%20%20if(opts.customEmojiSize)%20urlHashData.customEmojiSize%20=%20opts.customEmojiSize;%5Cn%20%20if(opts.loneCustomEmojiSizeMultiplier)%20urlHashData.loneCustomEmojiSizeMultiplier%20=%20opts.loneCustomEmojiSizeMultiplier;%5Cn%20%20if(opts.customEmojis)%20%7B%20%20%5Cn%20%20%20%20if(typeof%20opts.customEmojis%20===%20%5C%22string%5C%22%20&&%20(opts.customEmojis.startsWith(%5C%22https://user-uploads.perchance.org%5C%22)%20%7C%7C%20opts.customEmojis.startsWith(%5C%22https://user.uploads.dev%5C%22)))%20%7B%5Cn%20%20%20%20%20%20urlHashData.customEmojis%20=%20opts.customEmojis.trim();%5Cn%20%20%20%20%7D%20else%20%7B%20%5Cn%20%20%20%20%20%20let%20text%20=%20opts.customEmojis.getRawListText;%5Cn%20%20%20%20%20%20text%20=%20text.slice(text.indexOf(%5C%22%5C%5Cn%5C%22)).trim();%20//%20remove%20list%20name%5Cn%20%20%20%20%20%20//%20note:%20no%20need%20to%20remove%20indentation%20-%20parsing%20code%20in%20embed%20does%20that%20performantly%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20we%20need%20to%20evaluateItem%20for%20things%20like%20%60@import%20=%20%7Bimport:my-emoji-list-url%7D%5Cn%20%20%20%20%20%20urlHashData.customEmojis%20=%20/@import%5C%5Cs*=%5C%5Cs*%5B%5B%7B%5D/.test(text)%20?%20text.replace(/@import%5C%5Cs*=%5C%5Cs*%5B%5B%7B%5D.+/,%20m=%3Em.evaluateItem)%20:%20text;%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20urlHashData.channel%20=%20opts.channel%20?%20opts.channel.evaluateItem%20:%20%5C%22%5C%22;%5Cn%20%20%5Cn%20%20if(!window.___commentsPluginSlashCommandsByChannel12321)%20window.___commentsPluginSlashCommandsByChannel12321%20=%20%7B%7D;%5Cn%20%20window.___commentsPluginSlashCommandsByChannel12321%5BurlHashData.channel%5D%20=%20opts.slashCommands;%20%20%20%20%5Cn%20%20%5Cn%20%20let%20folderName%20=%20window.generatorName;%20%5Cn%20%20if(opts.channel)%20%7B%5Cn%20%20%20%20let%20channel%20=%20opts.channel.evaluateItem.toString();%5Cn%20%20%20%20if(!/%5E%5Ba-z0-9%5C%5C-%5D+(%7C%5C%5C+u:%5Ba-z0-9%7C%5D+)$/.test(channel)%20%7C%7C%20channel.includes(%5C%22%7C%7C%5C%22)%20%7C%7C%20channel.includes(%5C%22:%7C%5C%22)%20%7C%7C%20channel.endsWith(%5C%22%7C%5C%22))%20return%20%60(ERROR:%20You%20gave%20a%20channel%20name%20of%20'$%7Bchannel%7D'%20to%20the%20comments%20plugin,%20but%20channel%20names%20can%20only%20contain%20lower-case%20letters,%20numbers,%20and%20hyphens,%20like%20'my-cool-channel-33',%20and%20can%20additionally%20contain%20rules%20like%20%5C%22+u:username1%7Cusername2%5C%22%20at%20the%20end.)%60;%5Cn%20%20%20%20folderName%20+=%20%60+$%7Bchannel%7D%60;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20//%20I've%20deprecated%20%60reverseCommentOrder%60,%20but%20it%20won't%20hurt%20existing%20implementations%20because%20the%20%5C%22reversed%5C%22%20order%20(new%20comments%20at%20bottom)%20is%20now%20default.%5Cn%20%20//%20if(opts.reverseCommentOrder)%20urlHashData.reverseCommentOrder%20=%20opts.reverseCommentOrder;%5Cn%20%20urlHashData.reverseCommentOrder%20=%20true;%5Cn%20%20if(opts.newestCommentsAtTop)%20urlHashData.reverseCommentOrder%20=%20false;%20%5Cn%20%20%5Cn%20%20let%20queryString%20=%20new%20URLSearchParams(queryParams).toString();%5Cn%20%20%5Cn%20%20let%20loadMoreButton%20=%20document.createElement(%5C%22button%5C%22);%5Cn%20%20let%20originalLoadMoreButtonTextContent%20=%20%5C%22load%20more%5C%22;%5Cn%20%20let%20postMessageSource%20=%20null;%5Cn%20%20loadMoreButton.innerHTML%20=%20originalLoadMoreButtonTextContent;%5Cn%20%20loadMoreButton.style.cssText%20=%20%5C%22display:none;%20margin:0.5rem%20auto;%5C%22;%5Cn%20%20loadMoreButton.addEventListener(%5C%22click%5C%22,%20function()%20%7B%5Cn%20%20%20%20originalLoadMoreButtonTextContent%20=%20loadMoreButton.textContent;%5Cn%20%20%20%20loadMoreButton.textContent%20=%20%5C%22loading...%5C%22;%5Cn%20%20%20%20loadMoreButton.disabled%20=%20true;%5Cn%20%20%20%20document.querySelector(%60.$%7BiframeUniqueId%7D%60).contentWindow.postMessage(%7BiframeUniqueId,%20loadMoreButtonClick:true%7D,%20%5C%22*%5C%22);%5Cn%20%20%7D);%5Cn%20%20%5Cn%20%20ctx.loadMoreButton%20=%20loadMoreButton;%5Cn%20%20ctx.opts%20=%20opts;%5Cn%20%20ctx.urlHashData%20=%20urlHashData;%5Cn%20%20ctx.allComments%20=%20%5B%5D;%5Cn%20%20ctx.onLoadAlreadyFired%20=%20false;%5Cn%20%20ctx.alreadyGotCommentIds%20=%20new%20Set();%5Cn%20%20ctx.finishedLoadingHandlers%20=%20%5B%5D;%5Cn%20%20%5Cn%20%20if(!window.___alreadyAddedCommentsPluginStuff43211234)%20%7B%5Cn%20%20%5Cn%20%20%20%20window.___commentsPluginIframeUniqueIdToContext%20=%20new%20Map();%5Cn%20%20%20%20%5Cn%20%20%20%20//%20the%20iframe%20send%20us%20a%20message%20when%20it%20is%20finished%20loading%20(this%20is%20to%20get%20around%20Glitch's%20uncustomizable%20loading%20screens)%5Cn%20%20%20%20window.addEventListener(%5C%22message%5C%22,%20async%20function(e)%20%7B%5Cn%20%20%20%20%20%20if(e.origin%20!==%20%5C%22https://comments-plugin.perchance.org%5C%22)%20return;%5Cn%20%20%20%20%20%20if(!e.data.iframeUniqueId)%20return;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20May%20need%20to%20wait%20a%20moment%20for%20the%20replacedDuringUpdate%20iframes%20to%20be%20'tracked'%20since%20my%20current%20code%20hackily%20does%20that%20with%20a%20'polling'%20method.%5Cn%20%20%20%20%20%20while(!window.___commentsPluginIframeUniqueIdToContext.get(e.data.iframeUniqueId))%20%7B%20console.debug(%5C%22Waiting%20for%20comments-plugin%20iframe%20to%20be%20tracked.%5C%22);%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20ctx%20=%20window.___commentsPluginIframeUniqueIdToContext.get(e.data.iframeUniqueId)%5Cn%20%20%20%20%20%20let%20opts%20=%20ctx.opts%5Cn%20%20%20%20%20%20let%20loadMoreButton%20=%20ctx.loadMoreButton;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20if(e.data.type%20===%20%5C%22perchance_comments_new_message_added%5C%22)%20%7B%5Cn%20%20%20%20%20%20//%20%20%20console.debug(%5C%22new%20message:%5C%22,%20e.data.messageData);%5Cn%20%20%20%20%20%20//%20%20%20console.debug(%5C%22event:%5C%22,%20e);%5Cn%20%20%20%20%20%20//%20%20%20console.debug(%5C%22window.___commentsPluginIframeContentWindowToContext:%5C%22,%20window.___commentsPluginIframeUniqueIdToContext);%5Cn%20%20%20%20%20%20//%20%20%20console.debug(%5C%22ctx:%5C%22,%20ctx);%5Cn%20%20%20%20%20%20//%20%20%20console.debug(%5C%22opts:%5C%22,%20opts);%5Cn%20%20%20%20%20%20//%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20if(e.data.type%20===%20%5C%22perchance_comments_new_message_added%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20if(!ctx.alreadyGotCommentIds.has(e.data.messageData.id))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20ctx.allComments.push(e.data.messageData);%5Cn%20%20%20%20%20%20%20%20%20%20ctx.alreadyGotCommentIds.add(e.data.messageData.id);%5Cn%20%20%20%20%20%20%20%20%20%20ctx.allComments.sort((a,b)%20=%3E%20a.time-b.time);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20if(opts.onComment)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20opts.onComment(e.data.messageData);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22input_el_text_change%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20console.debug(%60parent%20frame%20got%20input_el_text_change:%60,%20e.data.text);%5Cn%20%20%20%20%20%20%20%20ctx.currentInputElText%20=%20e.data.text;%5Cn%20%20%20%20%20%20%20%20if(opts.onInputTextChange)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20opts.onInputTextChange(e.data.text);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22perchance_comments_on_load_data%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20newComments%20=%20e.data.onLoadData.comments.filter(c%20=%3E%20!ctx.alreadyGotCommentIds.has(c.id));%5Cn%20%20%20%20%20%20%20%20for(let%20c%20of%20newComments)%20ctx.alreadyGotCommentIds.add(c.id);%5Cn%20%20%20%20%20%20%20%20ctx.allComments.push(...newComments);%5Cn%20%20%20%20%20%20%20%20ctx.allComments.sort((a,b)%20=%3E%20a.time-b.time);%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20if(ctx.onLoadAlreadyFired)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20the%20comments%20plugin%20sometimes%20self-reloads%20atm,%20which%20is%20not%20ideal,%20but%20it's%20fine%20so%20long%20as%20we%20don't%20count%20it%20as%20an%20actual%20reload.%5Cn%20%20%20%20%20%20%20%20%20%20//%20instead,%20we%20trigger%20onComment%20for%20any%20new%20comments,%20and%20that's%20it.%5Cn%20%20%20%20%20%20%20%20%20%20for(let%20comment%20of%20newComments)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20opts.onComment(comment);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20ctx.onLoadAlreadyFired%20=%20true;%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20postMessageSource%20=%20e.source;%5Cn%20%20%20%20%20%20%20%20if(opts.onLoad)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(e.data.onLoadData.comments.length%20%3E%200)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20loadMoreButton.style.display%20=%20%5C%22block%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20if(e.data.noMoreCommentsBeforeThis)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20loadMoreButton.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20opts.onLoad(e.data.onLoadData.comments,%20%7BloadMoreButton%7D);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22perchance_comments_on_load_more%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20newComments%20=%20e.data.onLoadMoreData.comments.filter(c%20=%3E%20!ctx.alreadyGotCommentIds.has(c.id));%5Cn%20%20%20%20%20%20%20%20for(let%20c%20of%20newComments)%20ctx.alreadyGotCommentIds.add(c.id);%5Cn%20%20%20%20%20%20%20%20ctx.allComments.push(...newComments);%5Cn%20%20%20%20%20%20%20%20ctx.allComments.sort((a,b)%20=%3E%20a.time-b.time);%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20if(e.data.onLoadMoreData.comments.length%20%3E%200)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20loadMoreButton.disabled%20=%20false;%5Cn%20%20%20%20%20%20%20%20%20%20loadMoreButton.textContent%20=%20originalLoadMoreButtonTextContent;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20loadMoreButton.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(e.data.noMoreCommentsBeforeThis)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20loadMoreButton.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20loadMoreButton.disabled%20=%20true;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20if(opts.onLoadMore)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20opts.onLoadMore(e.data.onLoadMoreData.comments);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22perchance_comments_load_more_no_more%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20loadMoreButton.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22perchance_comments_finished_loading%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20ctx.finishedLoading%20=%20true;%5Cn%20%20%20%20%20%20%20%20for(let%20handler%20of%20ctx.finishedLoadingHandlers)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20try%20%7B%20handler()%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20//%20hide%20the%20loader%20of%20the%20iframe:%5Cn%20%20%20%20%20%20%20%20let%20ctn%20=%20document.querySelector(%60.$%7Be.data.iframeUniqueId%7D%60).closest(%5C%22.comments-plugin-ctn%5C%22);%5Cn%20%20%20%20%20%20%20%20//%20have%20to%20check%20if%20exists%20because%20i%20think%20with%20fullscreen%20button%20it's%20not%20in%20the%20ctn%20anymore:%5Cn%20%20%20%20%20%20%20%20if(ctn)%20ctn.querySelector(%5C%22.__perchance-comments-loading-facade-12345%5C%22).style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20//%20and%20then%20tell%20it%20its%20parent%20origin:%5Cn%20%20%20%20%20%20%20%20e.source.postMessage(%7BparentOrigin:window.origin%7D,%20e.origin);%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22evaluateText%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20result%20=%20e.data.text.evaluateItem;%5Cn%20%20%20%20%20%20%20%20e.source.postMessage(%7BrequestId:e.data.requestId,%20result%7D,%20e.origin);%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22before_submit_handler_call%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20result;%5Cn%20%20%20%20%20%20%20%20if(opts.beforeSubmit)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20result%20=%20await%20opts.beforeSubmit(%7BinputText:e.data.inputText%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(result%20!==%20undefined)%20result%20=%20JSON.parse(JSON.stringify(result));%5Cn%20%20%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20result%20=%20null;%20//%20IMPORTANT:%20return%20null%20if%20it%20fails,%20which%20cancels%20the%20submission.%20Important%20for%20cases%20like:%20perchance.org/send-me-a-secret-message%20where%20continue-submission-on-error%20is%20'dangerous'%5Cn%20%20%20%20%20%20%20%20%20%20%20%20alert(%60beforeSubmit%20function%20failed%20with%20error:%20$%7Be.message%7D%60);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.error(e);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%2050));%20//%20important:%20allow%20e.g.%20set_input_el_text%20to%20be%20sent%20before%20this%20submit%20handler%20call%20is%20considered%20%5C%22done%5C%22%5Cn%20%20%20%20%20%20%20%20e.source.postMessage(%7BrequestId:e.data.requestId,%20result%7D,%20e.origin);%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22slash_command%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20commandName%20=%20e.data.commandName;%5Cn%20%20%20%20%20%20%20%20let%20argText%20=%20e.data.argText;%5Cn%20%20%20%20%20%20%20%20let%20slashCommands%20=%20window.___commentsPluginSlashCommandsByChannel12321%5Be.data.channel%5D;%5Cn%20%20%20%20%20%20%20%20if(slashCommands%5BcommandName%5D%20===%20undefined)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20alert(%5C%22Please%20refresh%20the%20page%20before%20testing%20newly-added%20commands.%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20return%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20slashCommands%5BcommandName%5D.input%20=%20argText;%5Cn%20%20%20%20%20%20%20%20let%20resultText%20=%20slashCommands%5BcommandName%5D.output.evaluateItem;%5Cn%20%20%20%20%20%20%20%20e.source.postMessage(%7BrequestId:e.data.requestId,%20resultText%7D,%20e.origin);%5Cn%20%20%20%20%20%20%7D%20else%20if(e.data.type%20===%20%5C%22toggle_fullscreen%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20iframe%20=%20document.querySelector(%60.$%7Be.data.iframeUniqueId%7D%60);%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20//%20If%20iframe%20is%20currently%20fullscreen,%20then%20it's%20not%20in%20a%20%60ctn%60,%20so%20we%20use%20the%20pre-assigned%20data-comments-ctn-id%20to%20find%20the%20iframe's%20ctn%20so%20we%20can%20put%20it%20back%20in:%5Cn%20%20%20%20%20%20%20%20let%20ctn%20=%20iframe.closest(%5C%22.comments-plugin-ctn%5C%22)%20%7C%7C%20document.querySelector(%60%5Bdata-comments-ctn-id=%5C%22$%7Biframe.dataset.commentsCtnId%7D%5C%22%5D%60);%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20if(ctn.dataset.isFullscreen%20===%20%5C%22no%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20document.body.appendChild(iframe);%5Cn%20%20%20%20%20%20%20%20%20%20iframe.style.position%20=%20%5C%22fixed%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20iframe.style.zIndex%20=%20%5C%22999999999%5C%22;%20//%20%3C--%20caution:%20don't%20lower%20this%5Cn%20%20%20%20%20%20%20%20%20%20iframe.style.top%20=%20%5C%220%5C%22;%20iframe.style.left%20=%20%5C%220%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20document.scrollingElement.style.overflow%20=%20%5C%22hidden%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20ctn.dataset.isFullscreen%20=%20%5C%22yes%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20//%20link%20the%20iframe%20and%20ctn%20with%20an%20id%20so%20we%20can%20get%20the%20ctn,%20given%20the%20id%20from%20the%20iframe%20that%20sent%20the%20%5C%22toggle_fullscreen%5C%22%20message:%5Cn%20%20%20%20%20%20%20%20%20%20let%20commentsCtnId%20=%20Math.random();%5Cn%20%20%20%20%20%20%20%20%20%20ctn.dataset.commentsCtnId%20=%20commentsCtnId;%5Cn%20%20%20%20%20%20%20%20%20%20iframe.dataset.commentsCtnId%20=%20commentsCtnId;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20ctn.appendChild(iframe);%5Cn%20%20%20%20%20%20%20%20%20%20iframe.style.position%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20iframe.style.zIndex%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20iframe.style.top%20=%20%5C%22%5C%22;%20iframe.style.left%20=%20%5C%22%5C%22;%20%5Cn%20%20%20%20%20%20%20%20%20%20document.scrollingElement.style.overflow%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20ctn.dataset.isFullscreen%20=%20%5C%22no%5C%22;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn//%20%20%20%20%20%20%20%20%20if(ctn.dataset.isFullscreen%20===%20%5C%22no%5C%22)%20%7B%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.dataset.originalCssHeight%20=%20ctn.style.height;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.dataset.originalCssWidth%20=%20ctn.style.width;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.dataset.originalCssPosition%20=%20ctn.style.position;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.dataset.originalCssZIndex%20=%20ctn.style.zIndex;%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn//%20%20%20%20%20%20%20%20%20%20%20//%20we%20need%20to%20change%20the%20ancestor%20z%20indices%20too:%5Cn//%20%20%20%20%20%20%20%20%20%20%20let%20ancestorEls%20=%20%5B%5D;%5Cn//%20%20%20%20%20%20%20%20%20%20%20let%20aEl%20=%20ctn.parentElement;%5Cn//%20%20%20%20%20%20%20%20%20%20%20while(aEl%20!==%20document.body)%20%7B%5Cn//%20%20%20%20%20%20%20%20%20%20%20%20%20ancestorEls.push(aEl);%5Cn//%20%20%20%20%20%20%20%20%20%20%20%20%20aEl%20=%20aEl.parentElement;%5Cn//%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn//%20%20%20%20%20%20%20%20%20%20%20let%20ancestorZIndices%20=%20ancestorEls.map(el%20=%3E%20el.style.zIndex);%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.dataset.originalAncestorZIndices%20=%20JSON.stringify(ancestorZIndices);%5Cn//%20%20%20%20%20%20%20%20%20%20%20ancestorEls.forEach(el%20=%3E%20el.style.zIndex=%5C%2263829472%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.height%20=%20%5C%22%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.width%20=%20%5C%22%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.position%20=%20%5C%22fixed%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.zIndex%20=%20%5C%2263829472%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.top%20=%20%5C%220%5C%22;%20ctn.style.left%20=%20%5C%220%5C%22;%20ctn.style.right%20=%20%5C%220%5C%22;%20ctn.style.bottom%20=%20%5C%220%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%20%20document.scrollingElement.style.overflow%20=%20%5C%22hidden%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.dataset.isFullscreen%20=%20%5C%22yes%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%7D%20else%20if(ctn.dataset.isFullscreen%20===%20%5C%22yes%5C%22)%20%7B%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.height%20=%20ctn.dataset.originalCssHeight;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.width%20=%20ctn.dataset.originalCssWidth;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.position%20=%20ctn.dataset.originalCssPosition;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.zIndex%20=%20ctn.dataset.originalCssZIndex;%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn//%20%20%20%20%20%20%20%20%20%20%20let%20ancestorEls%20=%20%5B%5D;%5Cn//%20%20%20%20%20%20%20%20%20%20%20let%20aEl%20=%20ctn.parentElement;%5Cn//%20%20%20%20%20%20%20%20%20%20%20while(aEl%20!==%20document.body)%20%7B%5Cn//%20%20%20%20%20%20%20%20%20%20%20%20%20ancestorEls.push(aEl);%5Cn//%20%20%20%20%20%20%20%20%20%20%20%20%20aEl%20=%20aEl.parentElement;%5Cn//%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn//%20%20%20%20%20%20%20%20%20%20%20let%20originalAncestorZIndices%20=%20JSON.parse(ctn.dataset.originalAncestorZIndices);%5Cn//%20%20%20%20%20%20%20%20%20%20%20ancestorEls.forEach((el,%20i)%20=%3E%20el.style.zIndex=originalAncestorZIndices%5Bi%5D);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.style.top%20=%20%5C%22%5C%22;%20ctn.style.left%20=%20%5C%22%5C%22;%20ctn.style.right%20=%20%5C%22%5C%22;%20ctn.style.bottom%20=%20%5C%22%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%20%20document.scrollingElement.style.overflow%20=%20%5C%22%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%20%20ctn.dataset.isFullscreen%20=%20%5C%22no%5C%22;%5Cn//%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D,%20false);%5Cn%20%20%5Cn%20%20%20%20let%20cssText%20=%20%60%5Cn%20%20%20%20.comments-plugin-ctn%20%7B%5Cn%20%20%20%20%20%20position:relative;%5Cn%20%20%20%20%20%20display:inline-block;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20.loading-spinner-434142%20%7B%20%5Cn%20%20%20%20%20%20border:%204px%20solid%20#f3f3f3;%5Cn%20%20%20%20%20%20border-top:%204px%20solid%20#5d5d5d;%5Cn%20%20%20%20%20%20border-radius:%2050%25;%5Cn%20%20%20%20%20%20width:%2030px;%5Cn%20%20%20%20%20%20height:%2030px;%5Cn%20%20%20%20%20%20animation:%20spin%200.9s%20linear%20infinite;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20@keyframes%20spin%20%7B%5Cn%20%20%20%20%20%200%25%20%7B%20transform:%20rotate(0deg);%20%7D%5Cn%20%20%20%20%20%20100%25%20%7B%20transform:%20rotate(360deg);%20%7D%5Cn%20%20%20%20%7D%60;%5Cn%20%20%20%20let%20styleEl%20=%20document.createElement('style');%5Cn%20%20%20%20styleEl.appendChild(document.createTextNode(cssText));%5Cn%20%20%20%20document.head.appendChild(styleEl);%5Cn%20%20%20%20%5Cn%20%20%20%20//%20let%20addCommentsPluginInterval%20=%20setInterval(()%20=%3E%20%7B%5Cn%20%20%20%20//%20%20%20document.querySelectorAll(%5C%22.___perchance-comments-plugin-marker%5C%22).forEach(markerEl%20=%3E%20%7B%5Cn%20%20%20%20//%20%20%20%20%20//%20detect%20if%20a%20comments%20section%20has%20been%20injected%20after%20it%20yet%20(edit:%20for%20some%20reason%20it's%20injected%20before%20it?):%5Cn%20%20%20%20//%20%20%20%20%20if((!markerEl.nextElementSibling%20%7C%7C%20markerEl.nextElementSibling.dataset.isCommentsSection%20!==%20%5C%22true%5C%22)%20&&%20(!markerEl.previousElementSibling%20%7C%7C%20markerEl.previousElementSibling.dataset.isCommentsSection%20!==%20%5C%22true%5C%22))%20%7B%5Cn%20%20%20%20//%20%20%20%20%20%20%20let%20div%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20//%20%20%20%20%20%20%20let%20containerStyle%20=%20markerEl.dataset.containerStyle;%5Cn%20%20%20%20//%20%20%20%20%20%20%20let%20queryString%20=%20markerEl.dataset.queryString;%5Cn%20%20%20%20//%20%20%20%20%20%20%20let%20folderName%20=%20markerEl.dataset.folderName;%5Cn%20%20%20%20//%20%20%20%20%20%20%20div.innerHTML%20=%20%60%3Cdiv%20class=%5C%22comments-plugin-ctn%5C%22%20data-is-comments-section=%5C%22true%5C%22%20style=%5C%22position:relative;%20display:inline-block;%20$%7BcontainerStyle%7D%5C%22%3E%5Cn%20%20%20%20//%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22__perchance-comments-loading-facade-12345%5C%22%20style=%5C%22position:absolute;%20top:0;%20left:0;%20right:0;%20bottom:0;%20display:flex;%20align-items:center;%20justify-content:center;%20background:white;%20border:1px%20solid%20rgba(0,0,0,0.25);%20border-radius:2px;%5C%22%3E%3Cdiv%20class=%5C%22loading-spinner-434142%5C%22%3E%3C/div%3E%3C/div%3E%5Cn%20%20%20%20//%20%20%20%20%20%20%20%20%20%3Ciframe%20class=%5C%22___perchance-comments-plugin-iframe-12345%5C%22%20src=%5C%22https://comments-plugin.perchance.org/embed/$%7BfolderName%7D?$%7BqueryString%7D%5C%22%20style=%5C%22border:0;%20width:100%25;%20height:100%25;%5C%22%3E%3C/iframe%3E%5Cn%20%20%20%20//%20%20%20%20%20%20%20%3C/div%3E%60;%5Cn%20%20%20%20//%20%20%20%20%20%20%20let%20iframeContainer%20=%20div.firstElementChild;%5Cn%20%20%20%20//%20%20%20%20%20%20%20//debugger;%5Cn%20%20%20%20//%20%20%20%20%20%20%20markerEl.after(iframeContainer);%5Cn%20%20%20%20//%20%20%20%20%20%20%20clearInterval(addCommentsPluginInterval);%5Cn%20%20%20%20//%20%20%20%20%20%7D%5Cn%20%20%20%20//%20%20%20%7D);%5Cn%20%20%20%20//%20%7D,%20200);%5Cn%20%20%20%20%5Cn%20%20%20%20window.___alreadyAddedCommentsPluginStuff43211234%20=%20true;%5Cn%20%20%7D%5Cn%5Cn%20%20let%20colorScheme%20=%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches%20?%20%5C%22dark%5C%22%20:%20%5C%22light%5C%22;%5Cn%20%20if(opts.forceColorScheme)%20colorScheme%20=%20opts.forceColorScheme.evaluateItem;%5Cn%20%20%5Cn%20%20function%20lazyLoadIframe(%7BurlHashDataEncoded%7D)%20%7B%5Cn%20%20%20%20let%20commentsCtn%20=%20document.querySelector(%60%5Bdata-comments-section-folder-name=%5C%22$%7BfolderName%7D%5C%22%5D:not(.already-added-intersection-observer-to-this-comments-plugin-ctn)%60);%20//%20get%20the%20first%20one%20that%20we%20haven't%20added%20an%20intersection%20observer%20for%20yet%20-%20this%20is%20needed%20because%20they%20could%20have%20multiple%20instances%20of%20the%20same%20channel%20on%20the%20page,%20and%20we%20don't%20want%20to%20add%20all%20the%20intersection%20observers%20to%20the%20first%20one%5Cn%20%20%20%20if(!commentsCtn)%20return;%20//%20i%20think%20this%20happens%20sometimes%20due%20to%20timing/race%20condition%20where%20iframe%20is%20deleted%20in%20a%20very%20small%20time%20window%5Cn%20%20%20%20commentsCtn.classList.add(%5C%22already-added-intersection-observer-to-this-comments-plugin-ctn%5C%22);%5Cn%5Cn%20%20%20%20let%20observer1,%20observer2;%5Cn%20%20%20%20//%20lazyload%20the%20iframe,%20because%20some%20generator%20pages%20have%20literally%20dozens%20of%20different%20channels.%5Cn%20%20%20%20//%20I'm%20adding%20multiple%20observers%20because%20the%20default%20%60root%60%20is%20the%20browser%20viewport,%20and%20margin%20doesn't%20make%20sense%20for%20that,%20since%20it's%20not%20scrollable,%20but%20we%20still%20want%20it%20in%20case%20of%20the%20comments%20being%20in%20weird%20non-documentElement%20scrollable%20area%20or%20something.%20Note%20really%20sure%20how%20it%20works.%5Cn%20%20%20%20const%20observerFn%20=%20entries%20=%3E%20%7B%5Cn%20%20%20%20%20%20if(entries%5B0%5D.isIntersecting)%20%7B%5Cn%20%20%20%20%20%20%20%20observer1.disconnect();%5Cn%20%20%20%20%20%20%20%20observer2.disconnect();%5Cn%20%20%20%20%20%20%20%20console.debug(%5C%22comments%20ctn:%20Visible%5C%22);%5Cn%20%20%20%20%20%20%20%20let%20placeholder%20=%20commentsCtn.querySelector(%5C%22.__perchance-comments-iframe-placeholder-el-12345%5C%22);%5Cn%20%20%20%20%20%20%20%20if(placeholder)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20iframeHtml%20=%20%60%3Ciframe%20class=%5C%22$%7BiframeUniqueId%7D%20___perchance-comments-plugin-iframe-12345%5C%22%20src=%5C%22https://comments-plugin.perchance.org/embed/$%7BfolderName%7D?$%7BqueryString%7D#$%7BurlHashDataEncoded%7D%5C%22%20style=%5C%22border:0;%20width:100%25;%20height:100%25;%20user-select:none;%5C%22%20$%7BurlHashData.transparentBackground%20?%20%60allowtransparency=%5C%22true%5C%22%60%20:%20%5C%22%5C%22%7D%3E%3C/iframe%3E%60;%5Cn%20%20%20%20%20%20%20%20%20%20placeholder.outerHTML%20=%20iframeHtml;%5Cn%20%20%20%20%20%20%20%20%20%20ctx.iframeContentWindow%20=%20document.querySelector(%5C%22.%5C%22+iframeUniqueId).contentWindow;%5Cn%20%20%20%20%20%20%20%20%20%20window.___commentsPluginIframeUniqueIdToContext.set(iframeUniqueId,%20ctx);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20setTimeout(()%20=%3E%20%7B%20//%20slight%20delay%20in%20case%20of%20e.g.%20tabs%20being%20rendered%20in%20such%20a%20way%20that%20they're%20all%20momentarily%20visible%20(we%20don't%20wnat%20to%20load%20them%20all%20at%20once%20-%20only%20the%20active%20tab)%5Cn%20%20%20%20%20%20observer1%20=%20new%20IntersectionObserver(observerFn,%20%7B%5Cn%20%20%20%20%20%20%20%20rootMargin:%20%5C%226000px%5C%22,%20//%20we%20basically%20want%20to%20trigger%20~all%20visible%20elements%20anyway%20-%20just%20not%20stuff%20hidden%20within%20e.g.%20tabs%20plugin%20or%20whatever.%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20observer1.observe(commentsCtn);%5Cn%20%20%20%20%20%20observer2%20=%20new%20IntersectionObserver(observerFn,%20%7B%5Cn%20%20%20%20%20%20%20%20root:%20document.documentElement,%5Cn%20%20%20%20%20%20%20%20rootMargin:%20%5C%226000px%5C%22,%20//%20we%20basically%20want%20to%20trigger%20~all%20visible%20elements%20anyway%20-%20just%20not%20stuff%20hidden%20within%20e.g.%20tabs%20plugin%20or%20whatever.%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20observer2.observe(commentsCtn);%5Cn%20%20%20%20%7D,%205);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20containerHtml%20=%20%60%3Cdiv%20data-is-fullscreen=%5C%22no%5C%22%20data-comments-section-folder-name=%5C%22$%7BfolderName%7D%5C%22%20class=%5C%22comments-plugin-ctn%5C%22%20data-is-comments-section=%5C%22true%5C%22%20style=%5C%22$%7BcontainerStyle%7D%5C%22%3E%5Cn%20%20%20%20%3Cdiv%20class=%5C%22__perchance-comments-loading-facade-12345%5C%22%20style=%5C%22position:absolute;%20top:0;%20left:0;%20right:0;%20bottom:0;%20display:flex;%20align-items:center;%20justify-content:center;%20background:$%7BcolorScheme%20===%20%5C%22light%5C%22%20?%20%5C%22white%5C%22%20:%20%5C%22#131516%5C%22%7D;%20border:1px%20solid%20rgba(0,0,0,0.25);%20border-radius:2px;%5C%22%3E%3Cdiv%20class=%5C%22loading-spinner-434142%5C%22%3E%3C/div%3E%3C/div%3E%5Cn%20%20%20%20%3Cspan%20class=%5C%22__perchance-comments-iframe-placeholder-el-12345%5C%22%3E%3C/span%3E%5Cn%20%20%3C/div%3E%60;%5Cn%20%20%5Cn%20%20if(opts.replacedDuringUpdate)%20%7B%5Cn%20%20%20%20//%20setTimeout(async%20()%20=%3E%20%7B%5Cn%20%20%20%20//%20%20%20while(!document.querySelector(%5C%22.%5C%22+iframeUniqueId))%20%7B%5Cn%20%20%20%20//%20%20%20%20%20console.debug(%5C%22Waiting%20for%20comments-plugin%20iframe%20to%20appear%20in%20document.%5C%22);%5Cn%20%20%20%20//%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%5Cn%20%20%20%20//%20%20%20%7D%5Cn%20%20%20%20//%20%20%20ctx.iframeContentWindow%20=%20document.querySelector(%5C%22.%5C%22+iframeUniqueId).contentWindow;%5Cn%20%20%20%20//%20%20%20window.___commentsPluginIframeUniqueIdToContext.set(iframeUniqueId,%20ctx);%5Cn%20%20%20%20//%20%7D,%2010);%5Cn%20%20%20%20//%20return%20addMethodsToReturnValue(new%20String(%60%3Cdiv%20data-is-fullscreen=%5C%22no%5C%22%20data-comments-section-folder-name=%5C%22$%7BfolderName%7D%5C%22%20class=%5C%22comments-plugin-ctn%5C%22%20data-is-comments-section=%5C%22true%5C%22%20style=%5C%22$%7BcontainerStyle%7D%5C%22%3E%5Cn%20%20%20%20//%20%20%20%3Cdiv%20class=%5C%22__perchance-comments-loading-facade-12345%5C%22%20style=%5C%22position:absolute;%20top:0;%20left:0;%20right:0;%20bottom:0;%20display:flex;%20align-items:center;%20justify-content:center;%20background:$%7BcolorScheme%20===%20%5C%22light%5C%22%20?%20%5C%22white%5C%22%20:%20%5C%22#131516%5C%22%7D;%20border:1px%20solid%20rgba(0,0,0,0.25);%20border-radius:2px;%5C%22%3E%3Cdiv%20class=%5C%22loading-spinner-434142%5C%22%3E%3C/div%3E%3C/div%3E%5Cn%20%20%20%20//%20%20%20%3Ciframe%20loading=%5C%22lazy%5C%22%20class=%5C%22$%7BiframeUniqueId%7D%20___perchance-comments-plugin-iframe-12345%5C%22%20src=%5C%22https://comments-plugin.perchance.org/embed/$%7BfolderName%7D?$%7BqueryString%7D#$%7BencodeURIComponent(JSON.stringify(urlHashData))%7D%5C%22%20style=%5C%22border:0;%20width:100%25;%20height:100%25;%5C%22%3E%3C/iframe%3E%5Cn%20%20%20%20//%20%3C/div%3E%60));%5Cn%20%20%20%20setTimeout(async%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20urlHashDataEncoded%20=%20encodeURIComponent(JSON.stringify(urlHashData));%5Cn%20%20%20%20%20%20lazyLoadIframe(%7BurlHashDataEncoded%7D)%5Cn%20%20%20%20%7D,%2010);%5Cn%20%20%20%20return%20addMethodsToReturnValue(new%20String(containerHtml));%5Cn%20%20%7D%5Cn%20%20%20%20%5Cn%20%20if(!document.querySelector(%60%5Bdata-comments-section-folder-name=%5C%22$%7BfolderName%7D%5C%22%5D%60))%20%7B%5Cn%5Cn%20%20%20%20function%20swapMarkerElForRealEl()%20%7B%5Cn%20%20%20%20%20%20let%20markerEl%20=%20document.querySelector(%60%5Bdata-marker-tag=%5C%22temporaryMarkerElForCommentsPlugin84738932-folderName-$%7BfolderName%7D%5C%22%5D%60);%5Cn%20%20%20%20%20%20if(!markerEl)%20return;%5Cn%20%20%20%20%20%20let%20containerStyle%20=%20markerEl.dataset.containerStyle;%5Cn%20%20%20%20%20%20let%20queryString%20=%20markerEl.dataset.queryString;%5Cn%20%20%20%20%20%20let%20urlHashDataEncoded%20=%20markerEl.dataset.urlHashDataEncoded;%5Cn%20%20%20%20%20%20//%20let%20folderName%20=%20markerEl.dataset.folderName;%5Cn%5Cn%20%20%20%20%20%20//%20NOTE:%20we%20don't%20use%20replaceWith%20here%20because%20that%20approach%20would%20mean%20that%20this%20would%20get%20updated%20during%20update()%20calls%5Cn%20%20%20%20%20%20markerEl.outerHTML%20=%20containerHtml;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20lazyLoadIframe(%7BurlHashDataEncoded%7D);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20//%20setTimeout(swapMarkerElForRealEl,%2050);%5Cn%5Cn%20%20%20%20//%20the%20above%20commented-out%20setTimeout%20one-liner%20was%20the%20previous%20approach.%20the%20below%20MutationObserver-based%20monstrosity%20is%20a%20bit%20better%20because%20it%20ensures%20the%20swap%20happens%20*the%20moment*%20that%20the%20marker%20is%20added%20to%20the%20page,%20and%20we%20can%20wait%20a%20long%20time%20without%20the%20need%20for%20polling%5Cn%20%20%20%20let%20markerEl%20=%20document.querySelector(%60%5Bdata-marker-tag=%5C%22temporaryMarkerElForCommentsPlugin84738932-folderName-$%7BfolderName%7D%5C%22%5D%60);%5Cn%20%20%20%20if(markerEl)%20%7B%5Cn%20%20%20%20%20%20swapMarkerElForRealEl();%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20//%20they%20generated%20the%20comments%20HTML,%20but%20haven't%20put%20it%20in%20the%20page%20yet,%20so%20we%20wait%20for%20it%20using%20a%20mutation%20observer:%5Cn%20%20%20%20%20%20let%20foundElement%20=%20false;%5Cn%20%20%20%20%20%20let%20markerTagValue%20=%20%60temporaryMarkerElForCommentsPlugin84738932-folderName-$%7BfolderName%7D%60;%5Cn%20%20%20%20%20%20let%20observer%20=%20new%20MutationObserver((mutations)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20for(let%20mutation%20of%20mutations)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20for(let%20node%20of%20mutation.addedNodes)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(node.dataset%20&&%20node.dataset.markerTag%20===%20markerTagValue)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20foundElement%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if(node.querySelector)%20%7B%20//%20skip%20#text,%20#comment,%20etc.%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20since%20mutation%20observers%20don't%20trigger%20for%20all%20subnodes%20-%20only%20the%20highest-level%20nodes%20in%20a%20mutation%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20markerEl%20=%20node.querySelector(%60%5Bdata-marker-tag=%5C%22temporaryMarkerElForCommentsPlugin84738932-folderName-$%7BfolderName%7D%5C%22%5D%60);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(markerEl)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20foundElement%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(foundElement)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20observer.disconnect();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20swapMarkerElForRealEl();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20observer.observe(document.body,%20%7B%20childList:%20true,%20subtree:%20true%20%7D);%5Cn%20%20%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if(!foundElement)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20console.error(%5C%22Couldn't%20find%20marker%20element%20for%20comments%20plugin?%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20observer.disconnect();%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D,%2010000);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20return%20addMethodsToReturnValue(new%20String(%60%3Cspan%20data-marker-tag=%5C%22temporaryMarkerElForCommentsPlugin84738932-folderName-$%7BfolderName%7D%5C%22%20data-folder-name=%5C%22$%7BfolderName%7D%5C%22%20data-container-style=%5C%22$%7BcontainerStyle%7D%5C%22%20data-query-string=%5C%22$%7BqueryString%7D%5C%22%20data-url-hash-data-encoded=%5C%22$%7BencodeURIComponent(JSON.stringify(urlHashData))%7D%5C%22%3E%3C/span%3E%60));%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20return%20%5C%22%5C%22;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%5Cn%5Cn//%20%20%20//%20This%20is%20a%20temporary%20fix%20because%20editing%20the%20text%20next%20to%20where%20the%20plugin%20is%20placed%20(within%20the%20same%20HTML%20%5C%22node%5C%22?)%20will%20cause%20the%5Cn//%20%20%20//%20comments%20section%20to%20disappear%20which%20causes%20users%20to%20think%20that%20they%20can't%20edit%20the%20positioning%20of%20the%20comments.%20So%20we%20tell%20them%20to%5Cn//%20%20%20//%20refresh%20the%20page.%20Ideally%20I'd%20fix%20this%20like%20I%20did%20with%20the%20text-to-image-plugin%20gallery%20-%20I%20just%20return/create%20a%20%5C%22fresh%5C%22%20one%20whenever%5Cn//%20%20%20//%20the%20old%20one%20isn't%20detected%20with%20querySelector.%5Cn//%20%20%20setTimeout(()%20=%3E%20%7B%5Cn//%20%20%20%20%20if(document.querySelectorAll(%5C%22.___perchance-comments-plugin-marker%5C%22).length%20!==%20document.querySelectorAll(%5C%22.comments-plugin-ctn%5C%22).length)%20%7B%5Cn//%20%20%20%20%20%20%20document.querySelectorAll(%5C%22.___perchance-comments-plugin-marker%5C%22).forEach(markerEl%20=%3E%20%7B%5Cn//%20%20%20%20%20%20%20%20%20markerEl.style.cssText%20=%20%60display:inline-block;%20border:1px%20solid%20grey;%20$%7BmarkerEl.dataset.containerStyle%7D%60;%5Cn//%20%20%20%20%20%20%20%20%20markerEl.innerHTML%20=%20%60%3Cdiv%20style=%5C%22height:100%25;%20display:flex;%20align-items:center;%20justify-content:center;%5C%22%3E%3Cspan%20style=%5C%22opacity:0.6;%20padding:1rem;%5C%22%3EPlease%20save%20your%20generator%20and%20refresh%20the%20page%20to%20reload%20the%20comments%20plugin.%3C/span%3E%3C/div%3E%60;%5Cn//%20%20%20%20%20%20%20%7D);%5Cn//%20%20%20%20%20%7D%5Cn//%20%20%20%7D,%20600);%5Cn%5Ct%5Cn//%20%5Ct//%20can't%20just%20inject%20the%20iframe%20directly%20otherwise%20it%20gets%20reloaded%20every%20time%20update()%20is%20called.%20So%20we%20need%20the%20setInterval%20monstrosity%20above.%5Cn//%20%5Ctreturn%20%60%3Cspan%20class=%5C%22___perchance-comments-plugin-marker%5C%22%20data-folder-name=%5C%22$%7BfolderName%7D%5C%22%20data-container-style=%5C%22$%7BcontainerStyle%7D%5C%22%20data-query-string=%5C%22$%7BqueryString%7D%5C%22%3E%3C/span%3E%60;%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%22,%22imports%22:%5B%5D,%22lastEditTime%22:1764418779322,%22found%22:true%7D,%7B%22name%22:%22create-media-gallery-plugin%22,%22modelText%22:%22kv%20=%20%7Bimport:kv-plugin%7D%5CnsuperFetch%20=%20%7Bimport:super-fetch-plugin%7D%20//%20for%20URL-based%20media%20imports%20(see%20gallery%20menu)%5Cn%5CncreateMediaGallery%20=%20%5B$output%5D%20//%20just%20for%20the%20demo%20in%20the%20HTML%20panel%5Cn%5Cn$output(name)%20=%3E%5Cn%20%20if(!name)%20name%20=%20%5C%22%5C%22;%5Cn%20%20if(!/%5E%5Ba-zA-Z0-9_%5D*$/.test(name))%20throw%20new%20Error(%5C%22Gallery%20name%20must%20be%20alphanumeric%20(underscores%20are%20also%20allowed)%5C%22);%5Cn%20%20/*%20%E2%94%80%E2%94%80%20prefix%20to%20avoid%20collisions%20%E2%94%80%E2%94%80%20*/%5Cn%20%20const%20pre%20=%20%60localMediaGallery_$%7Bname%7D.%60;%5Cn%20%20const%20galleriesKey%20=%20pre%20+%20%5C%22names%5C%22;%5Cn%20%20const%20defaultGallery%20=%20%5C%22general%5C%22;%5Cn%20%20let%20activeGalleryName%20=%20localStorage%5Bpre%20+%20%5C%22activeGalleryName%5C%22%5D%20%7C%7C%20defaultGallery;%5Cn%5Cn%20%20/*%20helper%20to%20coerce%20any%20info%20object%20into%20%7B%20%5Bk:string%5D:string%20%7D%20*/%5Cn%20%20const%20cleanInfo%20=%20i%20=%3E%20%7B%5Cn%20%20%20%20if%20(!i%20%7C%7C%20typeof%20i%20!==%20%5C%22object%5C%22)%20i%20=%20%7B%7D;%5Cn%20%20%20%20const%20o%20=%20%7B%7D;%5Cn%20%20%20%20for%20(const%20%5Bk,%20v%5D%20of%20Object.entries(i))%20o%5Bk%5D%20=%20String(v);%5Cn%20%20%20%20return%20o;%5Cn%20%20%7D;%5Cn%5Cn%20%20/*%20global%20dark-mode%20+%20btn-visibility%20vars%20(once)%20*/%5Cn%20%20if(!document.getElementById(%5C%22localMediaGalleryGlobalStyles%5C%22))%20%7B%5Cn%20%20%20%20const%20s%20=%20document.createElement(%5C%22style%5C%22);%5Cn%20%20%20%20s.id%20=%20%5C%22localMediaGalleryGlobalStyles%5C%22;%5Cn%20%20%20%20s.textContent%20=%20%60%5Cn%20%20%20%20%20%20html%7Bcolor-scheme:light%20dark;%7D%5Cn%20%20%20%20%20%20:root%20%20%7B--localMediaGalleryBtnsDisplay:flex;%7D%5Cn%20%20%20%20%20%20@media%20(hover:hover)%20and%20(pointer:fine)%20%7B%5Cn%20%20%20%20%20%20%20%20%5Bdata-local-media-gallery-item%5D%20%5Bdata-local-media-gallery-bar%5D%7Bopacity:0;pointer-events:none;transition:opacity%20.15s;%7D%5Cn%20%20%20%20%20%20%20%20%5Bdata-local-media-gallery-item%5D:hover%20%5Bdata-local-media-gallery-bar%5D%7Bopacity:.85;pointer-events:auto;%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%60;%5Cn%20%20%20%20document.head.appendChild(s);%5Cn%20%20%7D%5Cn%5Cn%20%20const%20getGalleryNames%20%20=%20()%20=%3E%20JSON.parse(localStorage.getItem(galleriesKey)%20%7C%7C%20%60%5B%5C%22$%7BdefaultGallery%7D%5C%22%5D%60);%5Cn%20%20const%20saveGalleryNames%20=%20a%20=%3E%20localStorage.setItem(galleriesKey,%20JSON.stringify(%5B...new%20Set(a)%5D));%5Cn%5Cn%20%20const%20$%20=%20(t,p=%7B%7D,...k)=%3E%7B%5Cn%20%20%20%20const%20el=document.createElement(t);%5Cn%20%20%20%20for(const%20%5Bk2,v%5D%20of%20Object.entries(p))%7B%5Cn%20%20%20%20%20%20if(k2===%5C%22style%5C%22)el.style.cssText=v;%5Cn%20%20%20%20%20%20else%20if(k2===%5C%22dataset%5C%22)Object.assign(el.dataset,v);%5Cn%20%20%20%20%20%20else%20el%5Bk2%5D=v;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20k.forEach(c=%3Ec&&el.appendChild(c));%5Cn%20%20%20%20return%20el;%5Cn%20%20%7D;%5Cn%5Cn%20%20const%20dims%20=%20b%20=%3E%20new%20Promise(r%20=%3E%20%7B%5Cn%20%20%20%20const%20url%20=%20URL.createObjectURL(b);%5Cn%20%20%20%20if%20(b.type.startsWith(%5C%22image/%5C%22))%20%7B%5Cn%20%20%20%20%20%20const%20i%20=%20new%20Image();%5Cn%20%20%20%20%20%20i.onload%20=%20()%20=%3E%20%7B%20r(%7Bw:i.width,%20h:i.height%7D);%20URL.revokeObjectURL(url);%20%7D;%5Cn%20%20%20%20%20%20i.src%20=%20url;%5Cn%20%20%20%20%7D%20else%20if%20(b.type.startsWith(%5C%22video/%5C%22))%20%7B%5Cn%20%20%20%20%20%20const%20v%20=%20document.createElement(%5C%22video%5C%22);%5Cn%20%20%20%20%20%20v.onloadedmetadata%20=%20()%20=%3E%20%7B%20r(%7Bw:v.videoWidth%7C%7C300,%20h:v.videoHeight%7C%7C300%7D);%20URL.revokeObjectURL(url);%20%7D;%5Cn%20%20%20%20%20%20v.src%20=%20url;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20URL.revokeObjectURL(url);%5Cn%20%20%20%20%20%20r(%7Bw:300,%20h:300%7D);%5Cn%20%20%20%20%7D%5Cn%20%20%7D);%5Cn%5Cn%20%20%5Cn%5Cn%20%20const%20blobs%20=%20kv%5Bpre+%5C%22blobs%5C%22%5D;%20//%20%5C%22blob%5C%22%20store%5Cn%20%20//%20Backwards-compatibly%20store%20Blobs%20as%20ArrayBuffers%20due%20to%20long-standing%20Safari%20bug%20#74827837:%20https://stackoverflow.com/questions/61090349/indexeddb-doesnt-get-the-blobs-correctly-if-accessing-from-an-index-webkitblob%5Cn%20%20//%20It%20is%20unethical%20to%20use%20Safari%20to%20browse%20the%20world%20wide%20web%5Cn%20%20const%20originalBlobsSet%20=%20blobs.set.bind(blobs);%5Cn%20%20blobs.set%20=%20async%20(id,%20data)%20=%3E%20%7B%5Cn%20%20%20%20//%20data%20is%20either%20%7Bblob,%20info%7D%20or%20just%20a%20raw%20blob%5Cn%20%20%20%20const%20blob%20=%20data?.blob%20??%20data;%5Cn%20%20%20%20const%20info%20=%20data?.info%20??%20null;%5Cn%20%20%20%20const%20arrayBuffer%20=%20await%20blob.arrayBuffer();%5Cn%20%20%20%20return%20originalBlobsSet(id,%20%7B%20buffer:%20arrayBuffer,%20type:%20blob.type,%20info%20%7D);%5Cn%20%20%7D;%5Cn%20%20const%20originalBlobsGet%20=%20blobs.get.bind(blobs);%5Cn%20%20blobs.get%20=%20async%20(id)%20=%3E%20%7B%5Cn%20%20%20%20const%20rec%20=%20await%20originalBlobsGet(id);%5Cn%20%20%20%20if%20(!rec)%20return%20null;%5Cn%20%20%20%20%5Cn%20%20%20%20//%20Backwards%20compat:%20if%20it's%20already%20a%20Blob,%20return%20as-is%5Cn%20%20%20%20if%20(rec%20instanceof%20Blob)%20return%20%7B%20blob:%20rec,%20info:%20null%20%7D;%5Cn%20%20%20%20if%20(rec.blob%20instanceof%20Blob)%20return%20rec;%5Cn%20%20%20%20%5Cn%20%20%20%20//%20New%20format:%20reconstruct%20from%20ArrayBuffer%5Cn%20%20%20%20if%20(rec.buffer)%20%7B%5Cn%20%20%20%20%20%20const%20blob%20=%20new%20Blob(%5Brec.buffer%5D,%20%7B%20type:%20rec.type%20%7C%7C%20'application/octet-stream'%20%7D);%5Cn%20%20%20%20%20%20return%20%7B%20blob,%20info:%20rec.info%20??%20null%20%7D;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20//%20Fallback%20for%20unexpected%20format%5Cn%20%20%20%20return%20rec;%5Cn%20%20%7D;%5Cn%5Cn%20%20/*%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%20JSZip%20loader%20*/%5Cn%20%20let%20jszipMod%20=%20null;%5Cn%20%20const%20getJSZip%20=%20()%20=%3E%20jszipMod?jszipMod:import(%5C%22https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm%5C%22).then(m=%3E(jszipMod=m.default%7C%7Cm));%5Cn%5Cn%20%20/*%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%20backup%20/%20restore%20(ZIP)%20*/%5Cn%20%20async%20function%20saveBackup()%20%7B%5Cn%20%20%20%20if(!confirm(%5C%22This%20will%20download%20a%20.zip%20backup%20of%20all%20galleries%20to%20your%20device.%20Proceed?%5C%22))return;%5Cn%20%20%20%20const%20files%20=%20%5B%5D;%5Cn%20%20%20%20for(const%20g%20of%20getGalleryNames())%20%7B%5Cn%20%20%20%20%20%20const%20items%20=%20await%20kv%5Bpre+g%5D.values();%5Cn%20%20%20%20%20%20for%20(const%20m%20of%20items)%20%7B%5Cn%20%20%20%20%20%20%20%20const%20rec%20=%20await%20blobs.get(m.id);%5Cn%20%20%20%20%20%20%20%20const%20b%20=%20rec?.blob%20%7C%7C%20rec;%5Cn%20%20%20%20%20%20%20%20const%20ext%20=%20(b.type.split(%5C%22/%5C%22)%5B1%5D%20%7C%7C%20%5C%22bin%5C%22).replace(/%5B%5E%5C%5Cw.-%5D/g,'');%5Cn%20%20%20%20%20%20%20%20files.push(%7Bname:%60galleries/$%7Bg%7D/$%7Bm.id%7D.$%7Bext%7D%60,%20blob:b%7D);%5Cn%20%20%20%20%20%20%20%20files.push(%7Bname:%60galleries/$%7Bg%7D/$%7Bm.id%7D.info.json%60,%20blob:new%20Blob(%5BJSON.stringify(%7Bmeta:m,info:rec?.info%7C%7Cnull,mime:b.type%7D,null,2)%5D,%20%7Btype:%5C%22application/json%5C%22%7D)%7D);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20const%20JSZip%20=%20await%20getJSZip();%5Cn%20%20%20%20const%20zip%20=%20new%20JSZip();%5Cn%20%20%20%20files.forEach(f%20=%3E%20zip.file(f.name,f.blob));%5Cn%20%20%20%20const%20zipBlob%20=%20await%20zip.generateAsync(%7Btype:%5C%22blob%5C%22%7D);%5Cn%20%20%20%20const%20a=$(%5C%22a%5C%22,%7Bhref:URL.createObjectURL(zipBlob),%20download:%60media_gallery_backup_$%7Bnew%20Date().toISOString().replace(/%5B:%5D/g,'-').slice(0,19)%7D.zip%60%7D);%5Cn%20%20%20%20a.click();%5Cn%20%20%20%20URL.revokeObjectURL(a.href);%5Cn%20%20%7D%5Cn%5Cn%20%20async%20function%20loadBackup()%20%7B%5Cn%20%20%20%20return%20new%20Promise(resolve%20=%3E%20%7B%5Cn%20%20%20%20%20%20const%20inp=$(%5C%22input%5C%22,%7Btype:%5C%22file%5C%22,accept:%5C%22.zip%5C%22,style:%5C%22display:none%5C%22%7D);%5Cn%20%20%20%20%20%20inp.onchange=async()=%3E%7B%5Cn%20%20%20%20%20%20%20%20try%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20file=inp.files%5B0%5D;%5Cn%20%20%20%20%20%20%20%20%20%20if(!file)%20return;%5Cn%20%20%20%20%20%20%20%20%20%20if(!confirm(%5C%22Importing%20will%20MERGE%20the%20backup%20into%20your%20current%20galleries%20(existing%20items%20are%20kept).%20Continue?%5C%22))%20return;%5Cn%20%20%20%20%20%20%20%20%20%20const%20JSZip%20=%20await%20getJSZip();%5Cn%20%20%20%20%20%20%20%20%20%20const%20zip%20=%20await%20JSZip.loadAsync(file);%5Cn%20%20%20%20%20%20%20%20%20%20const%20entries%20=%20%5B%5D;%5Cn%20%20%20%20%20%20%20%20%20%20await%20Promise.all(Object.values(zip.files).map(async%20z%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(z.dir)%20return;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20entries.push(%7Bname:z.name,%20blob:await%20z.async(%5C%22blob%5C%22)%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%7D));%5Cn%20%20%20%20%20%20%20%20%20%20const%20infoMap%20=%20Object.create(null);%5Cn%20%20%20%20%20%20%20%20%20%20const%20mediaMap%20=%20Object.create(null);%5Cn%20%20%20%20%20%20%20%20%20%20for(const%20e%20of%20entries)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(e.name.endsWith(%5C%22.info.json%5C%22))%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20m%20=%20/%5Egalleries%5C%5C/(%5B%5E%5C%5C/%5D+)%5C%5C/(%5B%5E%5C%5C/%5D+)%5C%5C.info%5C%5C.json$/.exec(e.name);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(!m)continue;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20%5B%20,%20gal,%20id%20%5D%20=%20m;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20infoMap%5Bgal%5D??=%7B%7D;%20infoMap%5Bgal%5D%5Bid%5D=JSON.parse(await%20e.blob.text());%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20m%20=%20/%5Egalleries%5C%5C/(%5B%5E%5C%5C/%5D+)%5C%5C/(%5B%5E%5C%5C/%5D+)$/.exec(e.name);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(!m)%20continue;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20%5B%20,%20gal,%20fn%20%5D%20=%20m;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20id%20=%20fn.replace(/%5C%5C.%5B%5E.%5D+$/,'');%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20mediaMap%5Bgal%5D%20??=%20%7B%7D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20mediaMap%5Bgal%5D%5Bid%5D%20=%20e.blob;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20for(const%20%5Bgal,%20objs%5D%20of%20Object.entries(mediaMap))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20current%20=%20getGalleryNames();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(!current.includes(gal))%20saveGalleryNames(%5B...current,gal%5D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20for(const%20%5Bid,%20blob%5D%20of%20Object.entries(objs))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20skip%20=%20await%20blobs.get(id);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(skip)%20continue;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20inf%20=%20infoMap%5Bgal%5D?.%5Bid%5D%20%7C%7C%20%7B%7D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20b%20=%20blob;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(!b.type%20&&%20inf.mime)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20b%20=%20new%20Blob(%5Bawait%20blob.arrayBuffer()%5D,%20%7Btype:inf.mime%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20const%20%7Bw,%20h%7D%20=%20await%20dims(b);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20blobs.set(id,%7Bblob:b,info:cleanInfo(inf.info%7C%7Cnull)%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20await%20kv%5Bpre+gal%5D.set(id,%20%7Bid,%20date:inf.meta?.date%7C%7CDate.now(),%20rating:inf.meta?.rating%7C%7C0,w,h%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%20finally%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20resolve();%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20document.body.appendChild(inp);%5Cn%20%20%20%20%20%20inp.click();%5Cn%20%20%20%20%20%20inp.remove();%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%5Cn%20%20async%20function%20add(blob,%20opts=%7B%7D)%20%7B%5Cn%20%20%20%20let%20folder%20=%20opts.folder%20??%20activeGalleryName%5Cn%20%20%20%20let%20info%20=%20opts.info%20??%20null;%5Cn%20%20%20%20info%20=%20cleanInfo(info);%5Cn%20%20%20%20const%20id%20=%20Date.now().toString(36)%20+%20Math.random().toString(36).slice(2,%208);%5Cn%20%20%20%20const%20%7Bw,%20h%7D%20=%20await%20dims(blob);%5Cn%20%20%20%20await%20blobs.set(id,%20%7Bblob,%20info%7D);%5Cn%20%20%20%20await%20kv%5Bpre+folder%5D.set(id,%20%7Bid,%20date:Date.now(),%20rating:0,%20w,%20h%7D);%5Cn%20%20%20%20const%20names=getGalleryNames();%5Cn%20%20%20%20if(!names.includes(folder))%20saveGalleryNames(%5B...names,%20folder%5D);%5Cn%20%20%20%20return%20id;%5Cn%20%20%7D%5Cn%5Cn%20%20async%20function%20clearAllData()%7B%5Cn%20%20%20%20if(prompt('Type%20%5C%22yes%5C%22%20to%20permanently%20delete%20ALL%20gallery%20data:')!==%5C%22yes%5C%22)return;%5Cn%20%20%20%20for(const%20n%20of%20getGalleryNames())%20await%20kv%5Bpre+n%5D.clear();%5Cn%20%20%20%20await%20blobs.clear();%5Cn%20%20%20%20saveGalleryNames(%5BdefaultGallery%5D);%5Cn%20%20%20%20activeGalleryName%20=%20defaultGallery;%5Cn%20%20%20%20localStorage.removeItem(pre+%5C%22activeGalleryName%5C%22);%5Cn%20%20%20%20localStorage.removeItem(pre+%5C%22seenPersistenceWarning%5C%22);%5Cn%20%20%7D%5Cn%5Cn%20%20//%20show%20fullscreen%20gallery%5Cn%20%20async%20function%20show()%20%7B%5Cn%20%20%20%20const%20isMobile%20=%20window.matchMedia(%5C%22(pointer:%20coarse)%5C%22).matches%20&&%20window.innerWidth%20%3C%20500;%5Cn%20%20%20%20document.getElementById(%5C%22localMediaGallery_root%5C%22)?.remove();%5Cn%20%20%20%20const%20prevHtmlOv%20=%20document.documentElement.style.overflow;%5Cn%20%20%20%20const%20prevBodyOv%20=%20document.body.style.overflow;%5Cn%20%20%20%20document.documentElement.style.overflow%20=%20document.body.style.overflow%20=%20%5C%22hidden%5C%22;%5Cn%5Cn%20%20%20%20const%20root=$(%5C%22div%5C%22,%7Bid:%5C%22localMediaGallery_root%5C%22,%20style:%5C%22position:fixed;inset:0;display:flex;flex-direction:column;background:light-dark(#fff,#000);z-index:9999;font:14px%20system-ui,sans-serif;%5C%22%7D);%5Cn%20%20%20%20document.body.appendChild(root);%5Cn%5Cn%20%20%20%20//%20close%20gallery%20on%20Esc%20(unless%20a%20lightbox%20is%20up)%5Cn%20%20%20%20const%20closeGallery%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20document.removeEventListener(%5C%22keydown%5C%22,%20onKeyGallery);%5Cn%20%20%20%20%20%20document.documentElement.style.overflow%20=%20prevHtmlOv;%5Cn%20%20%20%20%20%20document.body.style.overflow%20=%20prevBodyOv;%5Cn%20%20%20%20%20%20root.remove();%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20const%20onKeyGallery%20=%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20if%20(e.key%20===%20%5C%22Escape%5C%22%20&&%20!document.querySelector(%5C%22%5Bdata-local-media-gallery-lightbox%5D%5C%22))%20closeGallery();%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20document.addEventListener(%5C%22keydown%5C%22,%20onKeyGallery);%5Cn%5Cn%20%20%20%20if(!localStorage%5Bpre+%5C%22seenPersistenceWarning%5C%22%5D)%7B%5Cn%20%20%20%20%20%20root.appendChild(%5Cn%20%20%20%20%20%20%20%20$(%5C%22div%5C%22,%5Cn%20%20%20%20%20%20%20%20%20%20%7Bstyle:%5C%22background:light-dark(rgb(255%20226%20151),rgb(110%2076%200));padding:4px;display:flex;gap:4px;flex-wrap:wrap;justify-content:center;align-items:center;%5C%22%7D,%5Cn%20%20%20%20%20%20%20%20%20%20document.createTextNode(%60This%20gallery%20is%20stored%20privately%20on%20your%20device%20only.%20Your%20browser%20may%20delete%20it%20if%20you%20clear%20your%20cache%20or%20if%20your%20device's%20storage%20is%20low%20-%20%F0%9D%97%AF%F0%9D%97%AE%F0%9D%97%B0%F0%9D%97%B8%F0%9D%98%82%F0%9D%97%BD%20%F0%9D%97%BF%F0%9D%97%B2%F0%9D%97%B4%F0%9D%98%82%F0%9D%97%B9%F0%9D%97%AE%F0%9D%97%BF%F0%9D%97%B9%F0%9D%98%86%20via%20the%20menu!%60),%5Cn%20%20%20%20%20%20%20%20%20%20$(%5C%22button%5C%22,%7BtextContent:%5C%22%E2%9C%85%20Understood%5C%22,%20onclick:e=%3E%7BlocalStorage%5Bpre+%5C%22seenPersistenceWarning%5C%22%5D=1;e.target.parentNode.remove();%7D%7D)%5Cn%20%20%20%20%20%20%20%20)%5Cn%20%20%20%20%20%20);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20const%20headerBarEl%20=%20root.appendChild($(%5C%22div%5C%22,%7Bstyle:%5C%22padding:4px;display:flex;flex-wrap:wrap;gap:4px;align-items:center;border-bottom:1px%20solid%20light-dark(#ccc,#333);%5C%22%7D));%5Cn%5Cn%20%20%20%20/*%20menu%20picker%20*/%5Cn%20%20%20%20const%20selMenu%20=%20$(%5C%22select%5C%22,%20%7Bstyle:%5C%22max-width:90px;%5C%22%7D);%5Cn%20%20%20%20const%20menuOpts%20=%20()%20=%3E%20%5B%5Cn%20%20%20%20%20%20%7Bv:%5C%22%5C%22,%20%20%20%20%20%20%20%20%20%20%20t:%5C%22%E2%98%B0%20menu%5C%22%7D,%5Cn%20%20%20%20%20%20%7Bv:%5C%22saveBackup%5C%22,%20t:%5C%22%F0%9F%92%BE%20save%20full%20backup%5C%22%7D,%5Cn%20%20%20%20%20%20%7Bv:%5C%22loadBackup%5C%22,%20t:%5C%22%F0%9F%93%82%20load%20full%20backup%5C%22%7D,%5Cn%20%20%20%20%20%20%7Bv:%5C%22importLocal%5C%22,t:%5C%22%F0%9F%93%A4%20import%20local%20file%5C%22%7D,%5Cn%20%20%20%20%20%20%7Bv:%5C%22importURL%5C%22,%20%20t:%5C%22%F0%9F%8C%90%20import%20from%20URL%5C%22%7D,%5Cn%20%20%20%20%20%20%7Bv:%5C%22toggleBtns%5C%22,%20t:(getComputedStyle(document.documentElement).getPropertyValue(%5C%22--localMediaGalleryBtnsDisplay%5C%22)!==%5C%22none%5C%22?%5C%22%F0%9F%94%98%20hide%20buttons%5C%22:%5C%22%F0%9F%94%98%20show%20buttons%5C%22)%7D,%5Cn%20%20%20%20%20%20%7Bv:%5C%22storageInfo%5C%22,t:%5C%22%F0%9F%92%BD%20storage%20info%5C%22%7D,%5Cn%20%20%20%20%20%20%7Bv:%5C%22%5C%22,t:%5C%22%E2%80%94%5C%22,%20disabled:true%7D,%5Cn%20%20%20%20%20%20%7Bv:%5C%22clearAll%5C%22,%20%20%20t:%5C%22%F0%9F%92%A3%20clear%20ALL%20data%5C%22%7D,%5Cn%20%20%20%20%5D;%5Cn%20%20%20%20const%20refreshMenu=()=%3E%7B%20selMenu.innerHTML=%5C%22%5C%22;%20menuOpts().forEach(o=%3EselMenu.appendChild($(%5C%22option%5C%22,%7Bvalue:o.v,textContent:o.t,%20disabled:!!o.disabled%7D)))%20%7D;%5Cn%20%20%20%20refreshMenu();%5Cn%20%20%20%20headerBarEl.appendChild(selMenu);%5Cn%20%20%20%20%5Cn%20%20%20%20/*%20folder%20picker%20*/%5Cn%20%20%20%20const%20selGallery%20=%20$(%5C%22select%5C%22,%20%7Bstyle:%5C%22max-width:90px;%5C%22%7D);%5Cn%20%20%20%20const%20refreshOpts%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20selGallery.innerHTML%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20getGalleryNames().forEach(n%20=%3E%20selGallery.appendChild($(%5C%22option%5C%22,%20%7Bvalue:n,%20textContent:n%7D)));%5Cn%20%20%20%20%20%20selGallery.appendChild($(%5C%22option%5C%22,%20%7Bvalue:%5C%22__new__%5C%22,%20textContent:%5C%22%E2%9E%95%20%F0%9D%97%AE%F0%9D%97%B1%F0%9D%97%B1%20%F0%9D%97%BB%F0%9D%97%B2%F0%9D%98%84%20%F0%9D%97%B3%F0%9D%97%BC%F0%9D%97%B9%F0%9D%97%B1%F0%9D%97%B2%F0%9D%97%BF%5C%22%7D));%5Cn%20%20%20%20%20%20selGallery.appendChild($(%5C%22option%5C%22,%20%7Bvalue:%5C%22__del__%5C%22,%20textContent:%5C%22%F0%9F%97%91%EF%B8%8F%20%F0%9D%97%B1%F0%9D%97%B2%F0%9D%97%B9%F0%9D%97%B2%F0%9D%98%81%F0%9D%97%B2%20%F0%9D%97%AE%20%F0%9D%97%B3%F0%9D%97%BC%F0%9D%97%B9%F0%9D%97%B1%F0%9D%97%B2%F0%9D%97%BF%5C%22%7D));%5Cn%20%20%20%20%20%20selGallery.value%20=%20activeGalleryName;%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20refreshOpts();%5Cn%20%20%20%20headerBarEl.appendChild(selGallery);%5Cn%5Cn%20%20%20%20/*%20sort%20picker%20*/%5Cn%20%20%20%20const%20selSort%20=%20$(%5C%22select%5C%22,%20%7B%5Cn%20%20%20%20%20%20innerHTML:%20'%3Coption%20value=%5C%22dateDesc%5C%22%3E%F0%9F%86%95%20newest%3C/option%3E%3Coption%20value=%5C%22dateAsc%5C%22%3E%F0%9F%93%9C%20oldest%3C/option%3E%3Coption%20value=%5C%22ratingDesc%5C%22%3E%E2%AD%90%20best%3C/option%3E%3Coption%20value=%5C%22ratingAsc%5C%22%3E%F0%9F%92%94%20worst%3C/option%3E',%5Cn%20%20%20%20%20%20style:%20%5C%22max-width:90px;%5C%22%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20headerBarEl.appendChild(selSort);%5Cn%5Cn%20%20%20%20/*%20close%20*/%5Cn%20%20%20%20headerBarEl.appendChild($(%5C%22button%5C%22,%7BtextContent:%5C%22%E2%9C%96%EF%B8%8F%5C%22,%20title:%5C%22Esc%5C%22,%20style:%5C%22margin-left:auto;background:none;border:none;font-size:18px;%5C%22,%20onclick:closeGallery%7D));%5Cn%5Cn%20%20%20%20/*%20grid%20*/%5Cn%20%20%20%20const%20grid%20=%20root.appendChild($(%5C%22div%5C%22,%7Bstyle:%5C%22flex:1;overflow:auto;display:flex;flex-wrap:wrap;gap:4px;padding:4px;align-content:flex-start;justify-content:center;%5C%22%7D));%5Cn%5Cn%20%20%20%20/*%20lazy%20loader%20*/%5Cn%20%20%20%20let%20io;%5Cn%20%20%20%20const%20observe%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20io?.disconnect();%5Cn%20%20%20%20%20%20io%20=%20new%20IntersectionObserver(es%20=%3E%20es.forEach(async%20en%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if(en.isIntersecting%20&&%20!en.target.dataset.loaded)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20en.target.dataset.loaded%20=%201;%5Cn%20%20%20%20%20%20%20%20%20%20const%20rec%20=%20await%20blobs.get(en.target.dataset.id);%5Cn%20%20%20%20%20%20%20%20%20%20const%20b%20=%20rec?.blob%20%7C%7C%20rec;%5Cn%20%20%20%20%20%20%20%20%20%20debugger;%5Cn%20%20%20%20%20%20%20%20%20%20if(!b)%20return;%5Cn%20%20%20%20%20%20%20%20%20%20if(b.type.startsWith(%5C%22image/%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20url%20=%20URL.createObjectURL(b);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20activeUrls.push(url);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20en.target.appendChild($(%5C%22img%5C%22,%7Bsrc:url,style:%5C%22width:100%25;height:100%25;%5C%22,onclick:()=%3Elightbox(en.target.dataset.id)%7D));%5Cn%20%20%20%20%20%20%20%20%20%20%7D%20else%20if(b.type.startsWith(%5C%22video/%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20url%20=%20URL.createObjectURL(b);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20activeUrls.push(url);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20en.target.appendChild($(%5C%22video%5C%22,%7Bsrc:url,style:%5C%22width:100%25;height:100%25;%5C%22,muted:true,loop:true,autoplay:true,playsInline:true,onclick:()=%3Elightbox(en.target.dataset.id)%7D));%5Cn%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20en.target.appendChild($(%5C%22div%5C%22,%7Bstyle:%5C%22width:100%25;height:100%25;display:flex;align-items:center;justify-content:center;font-size:32px;background:#222;color:#fff;min-height:150px;%5C%22,onclick:()=%3Elightbox(en.target.dataset.id)%7D,document.createTextNode(%5C%22%F0%9F%8E%B5%5C%22)));%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D),%20%7Broot:grid,rootMargin:%5C%22300px%5C%22%7D);%5Cn%20%20%20%20%20%20%5B...grid.children%5D.forEach(c=%3Eio.observe(c));%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20/*%20lightbox%20*/%5Cn%20%20%20%20let%20currentLightboxUrl%20=%20null;%5Cn%20%20%20%20const%20lightbox%20=%20id0%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20idx%20=%20mediaArr.findIndex(m%20=%3E%20m.id===id0);%5Cn%20%20%20%20%20%20const%20ov%20=%20$(%5C%22div%5C%22,%7Bdataset:%7BlocalMediaGalleryLightbox:1%7D,%20style:%5C%22position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:10000;%5C%22,%20onclick:e=%3Ee.target===ov&&close()%7D);%5Cn%20%20%20%20%20%20const%20holder%20=%20$(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20const%20onKey%20=%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if(e.key===%5C%22ArrowLeft%5C%22%20%20&&%20idx%3E0)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%20idx--;%20load();%20%7D%5Cn%20%20%20%20%20%20%20%20else%20if(e.key===%5C%22ArrowRight%5C%22%20&&%20idx%3CmediaArr.length-1)%20%7B%20idx++;%20load();%20%7D%5Cn%20%20%20%20%20%20%20%20else%20if(e.key===%5C%22Escape%5C%22)%20close();%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20const%20close%20=%20()=%3E%7B%20document.removeEventListener(%5C%22keydown%5C%22,onKey);%20ov.remove();%20%7D;%5Cn%20%20%20%20%20%20document.addEventListener(%5C%22keydown%5C%22,%20onKey);%5Cn%20%20%20%20%20%20const%20load%20=%20async()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(currentLightboxUrl)%20URL.revokeObjectURL(currentLightboxUrl);%5Cn%20%20%20%20%20%20%20%20holder.innerHTML%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20const%20rec%20=%20await%20blobs.get(mediaArr%5Bidx%5D.id);%5Cn%20%20%20%20%20%20%20%20const%20b%20=%20rec?.blob%20%7C%7C%20rec;%5Cn%20%20%20%20%20%20%20%20currentLightboxUrl%20=%20URL.createObjectURL(b);%5Cn%20%20%20%20%20%20%20%20let%20el;%5Cn%20%20%20%20%20%20%20%20if(b.type.startsWith(%5C%22image/%5C%22))%20el%20=%20$(%5C%22img%5C%22,%7Bsrc:URL.createObjectURL(b),style:%5C%22max-width:90vw;max-height:90vh;object-fit:contain;%5C%22%7D);%5Cn%20%20%20%20%20%20%20%20else%20if(b.type.startsWith(%5C%22video/%5C%22))%20el%20=%20$(%5C%22video%5C%22,%7Bsrc:URL.createObjectURL(b),style:%5C%22max-width:90vw;max-height:90vh;object-fit:contain;%5C%22,controls:true,autoplay:true%7D);%5Cn%20%20%20%20%20%20%20%20else%20el%20=%20$(%5C%22audio%5C%22,%20%7Bsrc:URL.createObjectURL(b),controls:true%7D);%5Cn%20%20%20%20%20%20%20%20holder.appendChild(el);%5Cn%20%20%20%20%20%20%20%20btnPrev.style.opacity%20=%20idx===0?.3:1;%5Cn%20%20%20%20%20%20%20%20btnNext.style.opacity%20=%20idx===mediaArr.length-1?.3:1;%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20const%20nav=(txt,d,side)%20=%3E%20ov.appendChild($(%5C%22button%5C%22,%7BtextContent:txt,style:%60position:absolute;$%7Bside%7D:10px;top:50%25;transform:translateY(-50%25);font-size:32px;background:none;border:none;color:#fff;%60,onclick:e=%3E%7B%5Cn%20%20%20%20%20%20%20%20e.stopPropagation();%5Cn%20%20%20%20%20%20%20%20if(idx+d%20%3C%200%20%7C%7C%20idx+d%20%3E=%20mediaArr.length)%20return;%5Cn%20%20%20%20%20%20%20%20idx%20+=%20d;%5Cn%20%20%20%20%20%20%20%20load();%5Cn%20%20%20%20%20%20%7D%7D));%5Cn%20%20%20%20%20%20const%20btnPrev=nav(%5C%22%E2%AC%85%EF%B8%8F%5C%22,-1,%5C%22left%5C%22);%5Cn%20%20%20%20%20%20ov.appendChild(holder);%5Cn%20%20%20%20%20%20const%20btnNext=nav(%5C%22%E2%9E%A1%EF%B8%8F%5C%22,1,%5C%22right%5C%22);%5Cn%20%20%20%20%20%20ov.appendChild($(%5C%22button%5C%22,%7BtextContent:%5C%22%E2%9C%96%EF%B8%8F%5C%22,style:%5C%22position:absolute;top:10px;right:10px;font-size:24px;background:none;border:none;color:#fff;%5C%22,onclick:close%7D));%5Cn%20%20%20%20%20%20document.body.appendChild(ov);load();%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20/*%20info%20editor%20modal%20*/%5Cn%20%20%20%20async%20function%20openInfoEditor(m)%7B%5Cn%20%20%20%20%20%20const%20rec%20=%20await%20blobs.get(m.id);%5Cn%20%20%20%20%20%20if(!rec)%20return;%5Cn%20%20%20%20%20%20const%20infoOrig%20=%20cleanInfo(rec.info%7C%7C%7B%7D);%5Cn%20%20%20%20%20%20const%20origStr%20=%20JSON.stringify(infoOrig);%5Cn%5Cn%20%20%20%20%20%20const%20overlay=$(%5C%22div%5C%22,%7Bstyle:%5C%22position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:10001;%5C%22%7D);%5Cn%20%20%20%20%20%20const%20modal=$(%5C%22div%5C%22,%7Bstyle:%5C%22position:relative;background:light-dark(#fff,#222);color:light-dark(#000,#fff);padding:8px;border-radius:8px;width:500px;max-width:90vw;max-height:80vh;min-height:100px;display:flex;flex-direction:column;%5C%22%7D);%5Cn%20%20%20%20%20%20const%20list=$(%5C%22div%5C%22,%7Bstyle:%5C%22flex:1;overflow:auto;display:flex;flex-direction:column;gap:8px;justify-content:center;%5C%22%7D);%5Cn%20%20%20%20%20%20modal.appendChild(list);%5Cn%5Cn%20%20%20%20%20%20const%20plusBtn=$(%5C%22button%5C%22,%7BtextContent:%5C%22%E2%9E%95%20add%20entry%5C%22,style:%5C%22align-self:center;%5C%22,onclick:()=%3EaddRow(%5C%22%5C%22,%5C%22%5C%22)%7D);%5Cn%20%20%20%20%20%20list.appendChild(plusBtn);%5Cn%5Cn%20%20%20%20%20%20const%20rows=%5B%5D;%5Cn%20%20%20%20%20%20const%20addRow=(k=%5C%22%5C%22,v=%5C%22%5C%22)=%3E%7B%5Cn%20%20%20%20%20%20%20%20const%20keyInp=$(%5C%22input%5C%22,%7Bvalue:k,style:%5C%22width:100%25;padding:4px;%5C%22,placeholder:%5C%22entry%20name%5C%22%7D);%5Cn%20%20%20%20%20%20%20%20const%20valArea=$(%5C%22textarea%5C%22,%7Bvalue:v,style:%5C%22width:100%25;flex:1;padding:4px;height:60px;resize:vertical;%5C%22,placeholder:%5C%22entry%20content%5C%22%7D);%5Cn%20%20%20%20%20%20%20%20const%20row=$(%5C%22div%5C%22,%7Bstyle:%5C%22display:flex;gap:4px;flex-direction:column;background:light-dark(#dedede,#3a3a3a);padding:0.25rem;border-radius:2px;%5C%22%7D,keyInp,valArea);%5Cn%20%20%20%20%20%20%20%20rows.push(%7BkeyInp,valArea%7D);%5Cn%20%20%20%20%20%20%20%20list.insertBefore(row,plusBtn);%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20for(const%20%5Bk,v%5D%20of%20Object.entries(infoOrig))%20addRow(k,v);%5Cn%5Cn%20%20%20%20%20%20const%20titleEl=$(%5C%22div%5C%22,%7BtextContent:%5C%22%E2%84%B9%EF%B8%8F%20file%20info%5C%22,style:%5C%22position:absolute;top:-30px;width:100%25;text-align:center;opacity:0.9;%5C%22%7D);%5Cn%20%20%20%20%20%20modal.appendChild(titleEl);%5Cn%20%20%20%20%20%20const%20saveBtn=$(%5C%22button%5C%22,%7BtextContent:%5C%22%F0%9F%92%BE%20save%5C%22,style:%5C%22position:absolute;bottom:8px;right:8px;%5C%22%7D);%5Cn%20%20%20%20%20%20modal.appendChild(saveBtn);%5Cn%20%20%20%20%20%20const%20closeBtn=$(%5C%22button%5C%22,%7BtextContent:%5C%22%E2%9C%96%EF%B8%8F%5C%22,style:%5C%22position:absolute;top:-10px;right:-14px;background:none;border:none;font-size:18px;%5C%22%7D);%5Cn%20%20%20%20%20%20modal.appendChild(closeBtn);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20overlay.appendChild(modal);%5Cn%20%20%20%20%20%20document.body.appendChild(overlay);%5Cn%5Cn%20%20%20%20%20%20const%20gather=()=%3E%7B%5Cn%20%20%20%20%20%20%20%20const%20o%20=%20%7B%7D;%5Cn%20%20%20%20%20%20%20%20rows.forEach((%7BkeyInp,valArea%7D)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20k%20=%20keyInp.value.trim();%5Cn%20%20%20%20%20%20%20%20%20%20if(k)%20o%5Bk%5D%20=%20String(valArea.value);%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20return%20o;%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20const%20maybeClose%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if(JSON.stringify(gather())%20!==%20origStr)%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(!confirm(%5C%22Discard%20unsaved%20changes?%5C%22))%20return%20false;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20overlay.remove();%5Cn%20%20%20%20%20%20%20%20return%20true;%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20overlay.onclick=e=%3E%7Bif(e.target===overlay)maybeClose();%7D;%5Cn%20%20%20%20%20%20closeBtn.onclick=e=%3E%7Be.stopPropagation();maybeClose();%7D;%5Cn%20%20%20%20%20%20saveBtn.onclick=async%20e=%3E%7B%5Cn%20%20%20%20%20%20%20%20let%20keys%20=%20rows.map((%7BkeyInp%7D)%20=%3E%20keyInp.value.trim()).filter(k%20=%3E%20k);%5Cn%20%20%20%20%20%20%20%20if(keys.length%20!==%20new%20Set(keys).size)%20return%20alert(%5C%22Entry%20names%20must%20be%20unique.%5C%22);%5Cn%20%20%20%20%20%20%20%20e.stopPropagation();%5Cn%20%20%20%20%20%20%20%20await%20blobs.set(m.id,%7Bblob:rec.blob%7C%7Crec,info:gather()%7D);%5Cn%20%20%20%20%20%20%20%20overlay.remove();%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20/*%20item%20controls%20*/%5Cn%20%20%20%20const%20controls%20=%20(m,ph)%20=%3E%20%7B%5Cn%20%20%20%20%20%20const%20bar%20=%20$(%5C%22div%5C%22,%7B%5Cn%20%20%20%20%20%20%20%20dataset:%7BlocalMediaGalleryBar:1%7D,%5Cn%20%20%20%20%20%20%20%20style:%60z-index:5;position:absolute;bottom:4px;left:4px;right:4px;display:var(--localMediaGalleryBtnsDisplay,flex);justify-content:center;gap:16px;$%7BisMobile?%5C%22opacity:.85;%5C%22:%5C%22%5C%22%7D%60%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20/*%20delete%20*/%5Cn%20%20%20%20%20%20bar.appendChild($(%5C%22button%5C%22,%7Btitle:%5C%22Delete%20item%5C%22,textContent:%5C%22%F0%9F%97%91%EF%B8%8F%5C%22,onclick:async%20e=%3E%7B%5Cn%20%20%20%20%20%20%20%20e.stopPropagation();%5Cn%20%20%20%20%20%20%20%20if(!confirm(%5C%22Delete%20this%20item?%5C%22))return;%5Cn%20%20%20%20%20%20%20%20await%20blobs.delete(m.id);%5Cn%20%20%20%20%20%20%20%20await%20kv%5Bpre+activeGalleryName%5D.delete(m.id);%5Cn%20%20%20%20%20%20%20%20mediaArr=mediaArr.filter(x%20=%3E%20x.id%20!==%20m.id);%5Cn%20%20%20%20%20%20%20%20ph.remove();%5Cn%20%20%20%20%20%20%7D%7D));%5Cn%20%20%20%20%20%20/*%20move%20*/%5Cn%20%20%20%20%20%20let%20lastMoveFolderName;%5Cn%20%20%20%20%20%20bar.appendChild($(%5C%22button%5C%22,%7Btitle:%5C%22move%20to%20another%20folder%5C%22,textContent:%5C%22%F0%9F%93%81%5C%22,onclick:async%20e=%3E%7B%5Cn%20%20%20%20%20%20%20%20e.stopPropagation();%5Cn%20%20%20%20%20%20%20%20const%20t%20=%20prompt(%5C%22Move%20to%20folder:%5C%22,lastMoveFolderName??activeGalleryName);%5Cn%20%20%20%20%20%20%20%20if(!t%20%7C%7C%20t%20===%20activeGalleryName)return;%5Cn%20%20%20%20%20%20%20%20lastMoveFolderName%20=%20t;%5Cn%20%20%20%20%20%20%20%20await%20kv%5Bpre+t%5D.set(m.id,%20m);%5Cn%20%20%20%20%20%20%20%20await%20kv%5Bpre+activeGalleryName%5D.delete(m.id);%5Cn%20%20%20%20%20%20%20%20saveGalleryNames(%5B...getGalleryNames(),%20t%5D);%5Cn%20%20%20%20%20%20%20%20refreshOpts();%5Cn%20%20%20%20%20%20%20%20loadGallery();%5Cn%20%20%20%20%20%20%7D%7D));%5Cn%20%20%20%20%20%20/*%20rate%20*/%5Cn%20%20%20%20%20%20bar.appendChild($(%5C%22button%5C%22,%7Btitle:%5C%22rate%20item%5C%22,textContent:%5C%22%E2%AD%90%5C%22,onclick:async%20e=%3E%7B%5Cn%20%20%20%20%20%20%20%20e.stopPropagation();%5Cn%20%20%20%20%20%20%20%20const%20v%20=%20prompt(%5C%22You%20can%20add%20a%20numeric%20rating/score%20for%20sorting:%5C%22,%20m.rating);%5Cn%20%20%20%20%20%20%20%20if(v==null)%20return;%5Cn%20%20%20%20%20%20%20%20m.rating%20=%20Number(v);%5Cn%20%20%20%20%20%20%20%20if(isNaN(m.rating))%20m.rating%20=%200;%5Cn%20%20%20%20%20%20%20%20await%20kv%5Bpre+activeGalleryName%5D.set(m.id,%20m);%5Cn%20%20%20%20%20%20%20%20render();%5Cn%20%20%20%20%20%20%7D%7D));%5Cn%20%20%20%20%20%20/*%20download%20*/%5Cn%20%20%20%20%20%20bar.appendChild($(%5C%22button%5C%22,%7Btitle:%5C%22download%20item%5C%22,%20textContent:%5C%22%F0%9F%93%A5%5C%22,onclick:async%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20e.stopPropagation();%5Cn%20%20%20%20%20%20%20%20const%20rec%20=%20await%20blobs.get(m.id);%5Cn%20%20%20%20%20%20%20%20const%20b%20=%20rec?.blob%20%7C%7C%20rec;%5Cn%20%20%20%20%20%20%20%20const%20a%20=%20$(%5C%22a%5C%22,%20%7Bhref:URL.createObjectURL(b),%20download:%60$%7Bm.id%7D.$%7B(b.type.split(%5C%22/%5C%22)%5B1%5D%7C%7C%5C%22bin%5C%22)%7D%60%7D);%5Cn%20%20%20%20%20%20%20%20a.click();%5Cn%20%20%20%20%20%20%20%20URL.revokeObjectURL(a.href);%5Cn%20%20%20%20%20%20%7D%7D));%5Cn%20%20%20%20%20%20/*%20info%20editor%20*/%5Cn%20%20%20%20%20%20bar.appendChild($(%5C%22button%5C%22,%7Btitle:%5C%22edit%20info%5C%22,textContent:%5C%22%E2%84%B9%EF%B8%8F%5C%22,onclick:async%20e=%3E%7B%5Cn%20%20%20%20%20%20%20%20e.stopPropagation();%5Cn%20%20%20%20%20%20%20%20openInfoEditor(m);%5Cn%20%20%20%20%20%20%7D%7D));%5Cn%20%20%20%20%20%20return%20bar;%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20const%20sortFn=()=%3E%7B%5Cn%20%20%20%20%20%20switch(selSort.value)%7B%5Cn%20%20%20%20%20%20%20%20case%5C%22dateAsc%5C%22:%20%20%20%20return%20(a,b)%20=%3E%20a.date-b.date;%5Cn%20%20%20%20%20%20%20%20case%5C%22ratingDesc%5C%22:%20return%20(a,b)%20=%3E%20b.rating-a.rating;%5Cn%20%20%20%20%20%20%20%20case%5C%22ratingAsc%5C%22:%20%20return%20(a,b)%20=%3E%20a.rating-b.rating;%5Cn%20%20%20%20%20%20%20%20default:%20%20%20%20%20%20%20%20%20%20return%20(a,b)%20=%3E%20b.date-a.date;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20/*%20render%20*/%5Cn%20%20%20%20let%20mediaArr=%5B%5D;%5Cn%20%20%20%20let%20activeUrls%20=%20%5B%5D;%5Cn%20%20%20%20const%20rowH=300;%5Cn%20%20%20%20const%20render%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20activeUrls.forEach(u%20=%3E%20URL.revokeObjectURL(u));%5Cn%20%20%20%20%20%20activeUrls%20=%20%5B%5D;%5Cn%20%20%20%20%20%20grid.innerHTML%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20const%20h%20=%20rowH;%5Cn%20%20%20%20%20%20mediaArr.sort(sortFn()).forEach(m%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20let%20w=m.w?(m.w/m.h)*h:h;%5Cn%20%20%20%20%20%20%20%20if(isMobile)%20w=Math.min(w,window.innerWidth-12);%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20/*%20%E2%86%90%20mobile%20clamp%20*/%5Cn%20%20%20%20%20%20%20%20const%20ph=$(%5C%22div%5C%22,%20%7Bdataset:%7Bid:m.id,%20localMediaGalleryItem:1%7D,%20style:%60flex:0%200%20$%7Bw%7Dpx;max-height:$%7Bh%7Dpx;background:light-dark(#ddd,#444);position:relative;max-width:100%25;%60%7D);%5Cn%20%20%20%20%20%20%20%20ph.appendChild(controls(m,%20ph));%5Cn%20%20%20%20%20%20%20%20grid.appendChild(ph);%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20observe();%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20/*%20load%20gallery%20*/%5Cn%20%20%20%20const%20loadGallery%20=%20async()=%3E%7B%20mediaArr=await%20kv%5Bpre+activeGalleryName%5D.values();%20render();%20%7D;%5Cn%20%20%20%20loadGallery();%5Cn%5Cn%20%20%20%20/*%20events%20*/%5Cn%20%20%20%20selGallery.onchange=async()=%3E%7B%5Cn%20%20%20%20%20%20if(selGallery.value%20===%20%5C%22__new__%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20const%20n=prompt(%5C%22Gallery%20name:%5C%22);%5Cn%20%20%20%20%20%20%20%20if(!n)%7B%20selGallery.value=activeGalleryName;%20return;%20%7D%5Cn%20%20%20%20%20%20%20%20saveGalleryNames(%20%5B...getGalleryNames(),n%5D%20);%5Cn%20%20%20%20%20%20%20%20activeGalleryName=n;%5Cn%20%20%20%20%20%20%20%20localStorage%5Bpre+%5C%22activeGalleryName%5C%22%5D=n;%5Cn%20%20%20%20%20%20%20%20refreshOpts();%5Cn%20%20%20%20%20%20%20%20selGallery.value=n;%5Cn%20%20%20%20%20%20%7D%20else%20if(selGallery.value%20===%20%5C%22__del__%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20const%20n=prompt(%5C%22Type%20the%20exact%20gallery%20name%20to%20delete:%5C%22);%5Cn%20%20%20%20%20%20%20%20if(!n%7C%7Cn===defaultGallery%7C%7C!getGalleryNames().includes(n))%20%7B%20selGallery.value=activeGalleryName;%20return;%20%7D%5Cn%20%20%20%20%20%20%20%20if(!confirm(%60Delete%20gallery%20%5C%22$%7Bn%7D%5C%22?%20This%20cannot%20be%20undone.%60))%20%7B%20selGallery.value=activeGalleryName;%20return;%20%7D%5Cn%20%20%20%20%20%20%20%20await%20kv%5Bpre+n%5D.clear();%5Cn%20%20%20%20%20%20%20%20saveGalleryNames(%20getGalleryNames().filter(x=%3Ex!==n)%20);%5Cn%20%20%20%20%20%20%20%20if(activeGalleryName===n)%7B%20activeGalleryName=defaultGallery;%20localStorage%5Bpre+%5C%22activeGalleryName%5C%22%5D=activeGalleryName;%20%7D%5Cn%20%20%20%20%20%20%20%20refreshOpts();%5Cn%20%20%20%20%20%20%20%20selGallery.value%20=%20activeGalleryName;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20activeGalleryName%20=%20selGallery.value;%5Cn%20%20%20%20%20%20%20%20localStorage%5Bpre+%5C%22activeGalleryName%5C%22%5D%20=%20activeGalleryName;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20loadGallery();%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20selSort.onchange=render;%5Cn%20%20%20%20%5Cn%20%20%20%20selMenu.onchange=async()=%3E%7B%5Cn%20%20%20%20%20%20if(selMenu.value===%5C%22saveBackup%5C%22)%7B%20await%20saveBackup();%20%7D%5Cn%20%20%20%20%20%20else%20if(selMenu.value===%5C%22loadBackup%5C%22)%7B%20await%20loadBackup();%20refreshOpts();%20await%20loadGallery();%20%7D%5Cn%20%20%20%20%20%20else%20if(selMenu.value===%5C%22importLocal%5C%22)%7B%5Cn%20%20%20%20%20%20%20%20const%20inp=$(%5C%22input%5C%22,%7Btype:%5C%22file%5C%22,multiple:true,style:%5C%22display:none%5C%22%7D);%5Cn%20%20%20%20%20%20%20%20inp.onchange=async()=%3E%7B%5Cn%20%20%20%20%20%20%20%20%20%20for(const%20f%20of%20inp.files)%20await%20add(f);%5Cn%20%20%20%20%20%20%20%20%20%20await%20loadGallery();%5Cn%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20document.body.appendChild(inp);inp.click();inp.remove();%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20else%20if(selMenu.value===%5C%22importURL%5C%22)%7B%5Cn%20%20%20%20%20%20%20%20const%20u=prompt(%5C%22Enter%20a%20URL%20to%20import:%5C%22);%5Cn%20%20%20%20%20%20%20%20if(u)%7B%5Cn%20%20%20%20%20%20%20%20%20%20try%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20resp=await%20superFetch(u);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(!resp.ok)%20throw%20new%20Error(%60HTTP%20$%7Bresp.status%7D%60);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20b=await%20resp.blob();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20await%20add(b);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20await%20loadGallery();%5Cn%20%20%20%20%20%20%20%20%20%20%7Dcatch(e)%7B%20alert(%5C%22Failed%20to%20import:%20%5C%22+e.message);%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20else%20if(selMenu.value===%5C%22toggleBtns%5C%22)%7B%5Cn%20%20%20%20%20%20%20%20const%20cur=getComputedStyle(document.documentElement).getPropertyValue(%5C%22--localMediaGalleryBtnsDisplay%5C%22).trim();%5Cn%20%20%20%20%20%20%20%20document.documentElement.style.setProperty(%5C%22--localMediaGalleryBtnsDisplay%5C%22,cur===%5C%22none%5C%22?%5C%22flex%5C%22:%5C%22none%5C%22);%5Cn%20%20%20%20%20%20%20%20refreshMenu();render();%5Cn%20%20%20%20%20%20%7Delse%20if(selMenu.value===%5C%22storageInfo%5C%22)%7B%5Cn%20%20%20%20%20%20%20%20const%20%7Busage,quota%7D=await%20navigator.storage.estimate();%5Cn%20%20%20%20%20%20%20%20const%20persisted=await%20navigator.storage.persisted();%5Cn%20%20%20%20%20%20%20%20alert(%60You're%20using%20$%7B(usage/1024**3).toFixed(1)%7D%20out%20of%20$%7B(quota/1024**3).toFixed(1)%7D%20GB.%5C%5Cn%5C%5CnYour%20browser%20has%20indicated%20that%20this%20storage%20is%20$%7Bpersisted?%60%F0%9D%97%BD%F0%9D%97%B2%F0%9D%97%BF%F0%9D%97%BA%F0%9D%97%AE%F0%9D%97%BB%F0%9D%97%B2%F0%9D%97%BB%F0%9D%98%81,%20but%20you%20should%20still%20backup%20regularly%60:%5C%22%F0%9D%98%81%F0%9D%97%B2%F0%9D%97%BA%F0%9D%97%BD%F0%9D%97%BC%F0%9D%97%BF%F0%9D%97%AE%F0%9D%97%BF%F0%9D%98%86,%20possibly%20because%20you%20haven't%20used%20this%20site%20often,%20or%20you're%20in%20incognito%20mode,%20or%20you're%20low%20on%20device%20storage%20space.%5C%22%7D.%60);%5Cn%20%20%20%20%20%20%7D%20else%20if(selMenu.value===%5C%22clearAll%5C%22)%7B%5Cn%20%20%20%20%20%20%20%20await%20clearAllData();%5Cn%20%20%20%20%20%20%20%20refreshOpts();%5Cn%20%20%20%20%20%20%20%20loadGallery();%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20selMenu.value=%5C%22%5C%22;%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%5Cn%20%20return%20%7Badd,show,getActiveFolderName:()=%3EactiveGalleryName,clearAllData%7D;%5Cn%22,%22imports%22:%5B%22kv-plugin%22,%22super-fetch-plugin%22%5D,%22lastEditTime%22:1765091526880,%22found%22:true%7D,%7B%22name%22:%22fullscreen-button-plugin%22,%22modelText%22:%22$output(text,%20exitText,%20style)%20=%3E%20%5Cn%20%20if(!window.addedFullscreenEventListenerForPlugin39492749374)%20%7B%5Cn%20%20%20%20window.addEventListener(%5C%22fullscreenchange%5C%22,%20function(event)%20%7B%5Cn%20%20%20%20%20%20if(document.fullscreenElement)%20%7B%5Cn%20%20%20%20%20%20%20%20for(let%20btn%20of%20%5B...document.querySelectorAll(%5C%22.fullscreenButtonPluginButton938479832938%5C%22)%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20btn.innerHTML%20=%20btn.dataset.exitText;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20for(let%20btn%20of%20%5B...document.querySelectorAll(%5C%22.fullscreenButtonPluginButton938479832938%5C%22)%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20btn.innerHTML%20=%20btn.dataset.text;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20window.addedFullscreenEventListenerForPlugin39492749374%20=%20true;%5Cn%20%20%7D%5Cn%20%20if(!document.documentElement.requestFullscreen)%20document.documentElement.requestFullscreen%20=%20document.documentElement.webkitRequestFullscreen%20%7C%7C%20document.documentElement.mozRequestFullScreen%20%7C%7C%20document.documentElement.msRequestFullscreen;%5Cn%20%20if(!document.exitFullscreen)%20document.exitFullscreen%20=%20document.webkitExitFullscreen%20%7C%7C%20document.mozCancelFullScreen%20%7C%7C%20document.msExitFullscreen;%5Cn%20%20if(!document.documentElement.requestFullscreen)%20%7B%5Cn%20%20%20%20document.documentElement.requestFullscreen%20=%20function()%20%7B%5Cn%20%20%20%20%20%20alert(%5C%22The%20browser/device%20you're%20using%20doesn't%20support%20fullscreen%20mode.%5C%22);%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%20%20if(!document.exitFullscreen)%20%7B%5Cn%20%20%20%20document.exitFullscreen%20=%20function()%20%7B%5Cn%20%20%20%20%20%20alert(%5C%22The%20browser/device%20you're%20using%20doesn't%20support%20fullscreen%20mode.%5C%22);%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%20%20return%20%60%3Cbutton%20class=%5C%22fullscreenButtonPluginButton938479832938%5C%22%20data-text=%5C%22$%7Btext%20%7C%7C%20%5C%22Fullscreen%5C%22%7D%5C%22%20data-exit-text=%5C%22$%7BexitText%20%7C%7C%20%5C%22Exit%20Fullscreen%5C%22%7D%5C%22%20onclick=%5C%22(!document.fullscreenElement%20&&%20!document.webkitFullscreenElement%20&&%20!document.mozFullScreenElement%20&&%20!document.msFullscreenElement)%20?%20(document.documentElement.requestFullscreen(),%20this.innerHTML=this.dataset.exitText)%20:%20(document.exitFullscreen(),%20this.innerHTML=this.dataset.text)%5C%22%20style=%5C%22line-height:1.2rem;%20$%7Bstyle%20%7C%7C%20%5C%22%5C%22%7D%5C%22%3E$%7Btext%20%7C%7C%20%5C%22Fullscreen%5C%22%7D%3C/button%3E%60;%5Cn%5Ct%22,%22imports%22:%5B%5D,%22lastEditTime%22:1699845831991,%22found%22:true%7D,%7B%22name%22:%22prompt2-plugin%22,%22modelText%22:%22async%20$output(specs,%20opts)%20=%3E%5Cn%20%20if(!opts)%20opts%20=%20%7B%7D;%5Cn%20%20opts%20=%20JSON.parse(JSON.stringify(opts));%20//%20so%20we%20can%20edit%20below%20without%20mutating%20inputs.%5Cn%20%20%5Cn%20%20let%20specEntries%20=%20Object.entries(specs);%5Cn%20%20specEntries%20=%20specEntries.filter(e%20=%3E%20e%5B1%5D);%5Cn%20%20specs%20=%20Object.fromEntries(specEntries);%20//%20so%20'null'%20can%20be%20specified%20as%20a%20value%20in%20the%20specs%20object,%20which%20means%20it%20gets%20entirely%20skipped%5Cn%20%20%5Cn%20%20let%20colorScheme%20=%20opts.colorScheme;%5Cn%20%20if(!colorScheme)%20colorScheme%20=%20localStorage.forceColorScheme%20!==%20undefined%20?%20localStorage.forceColorScheme%20:%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches%20?%20%5C%22dark%5C%22%20:%20%5C%22light%5C%22;%5Cn%5Cn%20%20if(!opts.backgroundColor)%20opts.backgroundColor%20=%20colorScheme==%5C%22light%5C%22%20?%20%5C%22#e8e8e8%5C%22%20:%20%5C%22#151515%5C%22;%5Cn%20%20if(!opts.borderColor)%20opts.borderColor%20=%20colorScheme==%5C%22light%5C%22%20?%20%5C%22#c8c8c8%5C%22%20:%20%5C%22#333%5C%22;%5Cn%20%20if(!opts.borderRadius)%20opts.borderRadius%20=%20%5C%223px%5C%22;%5Cn%20%20%5Cn%20%20function%20sanitizeHtml(text)%20%7B%5Cn%20%20%20%20if(text%20===%20undefined)%20text%20=%20%5C%22%5C%22;%5Cn%20%20%20%20text%20=%20text+%5C%22%5C%22;%5Cn%20%20%20%20return%20text.replace(/&/g,%20%5C%22&amp;%5C%22).replace(/%3C/g,%20%5C%22&lt;%5C%22).replace(/%3E/g,%20%5C%22&gt;%5C%22).replace(/%5C%22/g,%20%5C%22&quot;%5C%22).replace(/'/g,%20%5C%22&#039;%5C%22);%5Cn%20%20%7D%5Cn%5Cn%20%20let%20ctn%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20let%20sections%20=%20%5C%22%5C%22;%5Cn%20%20let%20structuredSectionsI%20=%200;%5Cn%20%20let%20i%20=%200;%5Cn%20%20for(let%20%5Bkey,%20spec%5D%20of%20Object.entries(specs))%20%7B%5Cn%20%20%20%20if(spec.type%20==%20%5C%22select%5C%22)%20%7B%5Cn%20%20%20%20%20%20sections%20+=%20%60%5Cn%20%20%20%20%20%20%20%20%3Csection%20class=%5C%22structuredInputSection%5C%22%20data-is-hidden-extra=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22yes%5C%22%20:%20%5C%22no%5C%22%7D%5C%22%20style=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22display:none%5C%22%20:%20%5C%22%5C%22%7D;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22sectionLabel%5C%22%20style=%5C%22$%7BstructuredSectionsI%20===%200%20?%20%5C%22margin-top:0;%5C%22%20:%20%5C%22%5C%22%7D%5C%22%3E$%7Bspec.label%7D$%7Bspec.infoTooltip%20?%20%60%20%3Cspan%20title=%5C%22$%7BsanitizeHtml(spec.infoTooltip)%7D%5C%22%20style=%5C%22cursor:pointer;%5C%22%20onclick=%5C%22alert(this.title)%5C%22%3E%E2%84%B9%EF%B8%8F%3C/span%3E%60%20:%20%5C%22%5C%22%7D%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22flex-grow:1;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cselect%20data-spec-key=%5C%22$%7BsanitizeHtml(key)%7D%5C%22%20value=%5C%22$%7BsanitizeHtml(spec.defaultValue)%7D%5C%22%20$%7Bspec.disabled%20===%20true%20?%20%5C%22disabled%5C%22%20:%20%5C%22%5C%22%7D%20style=%5C%22width:100%25;height:100%25;%20padding:0.25rem;%5C%22%3E$%7Bspec.options.map(o%20=%3E%20%60%3Coption%20value=%5C%22$%7BsanitizeHtml(o.value)%7D%5C%22%20$%7Bo.value%20===%20spec.defaultValue%20?%20%5C%22selected%5C%22%20:%5C%22%5C%22%7D%3E$%7BsanitizeHtml(o.content)%20%7C%7C%20sanitizeHtml(o.value)%7D%3C/option%3E%60).join(%5C%22%5C%22)%7D%3C/select%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C/section%3E%60;%5Cn%20%20%20%20%20%20structuredSectionsI++;%5Cn%20%20%20%20%7D%20else%20if(spec.type%20==%20%5C%22textLine%5C%22)%20%7B%5Cn%20%20%20%20%20%20sections%20+=%20%60%5Cn%20%20%20%20%20%20%20%20%3Csection%20class=%5C%22structuredInputSection%5C%22%20data-is-hidden-extra=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22yes%5C%22%20:%20%5C%22no%5C%22%7D%5C%22%20style=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22display:none%5C%22%20:%20%5C%22%5C%22%7D;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22sectionLabel%5C%22%20style=%5C%22$%7BstructuredSectionsI%20===%200%20?%20%5C%22margin-top:0;%5C%22%20:%20%5C%22%5C%22%7D%5C%22%3E$%7Bspec.label%7D$%7Bspec.infoTooltip%20?%20%60%20%3Cspan%20title=%5C%22$%7BsanitizeHtml(spec.infoTooltip)%7D%5C%22%20style=%5C%22cursor:pointer;%5C%22%20onclick=%5C%22alert(this.title)%5C%22%3E%E2%84%B9%EF%B8%8F%3C/span%3E%60%20:%20%5C%22%5C%22%7D%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22flex-grow:1;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20data-initial-focus=%5C%22$%7Bspec.focus%20===%20true%20?%20%5C%22yes%5C%22%20:%20%5C%22no%5C%22%7D%5C%22%20data-spec-key=%5C%22$%7BsanitizeHtml(key)%7D%5C%22%20$%7Bspec.disabled%20===%20true%20?%20%5C%22disabled%5C%22%20:%20%5C%22%5C%22%7D%20value=%5C%22$%7BsanitizeHtml(spec.defaultValue)%7D%5C%22%20style=%5C%22width:100%25;height:100%25;%20padding:%200.25rem;%20$%7Bspec.cssText%20%7C%7C%20%5C%22%5C%22%7D;%5C%22%20type=%5C%22text%5C%22%20placeholder=%5C%22$%7BsanitizeHtml(spec.placeholder)%7D%5C%22%20$%7Bspec.validationPattern%20?%20%60pattern=%5C%22$%7BsanitizeHtml(spec.validationPattern)%7D%5C%22%60%20:%20%5C%22%5C%22%7D%20$%7Bspec.disableSpellCheck%20?%20%60spellcheck=%5C%22false%5C%22%60%20:%20%60%60%7D%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C/section%3E%60;%5Cn%20%20%20%20%20%20structuredSectionsI++;%5Cn%20%20%20%20%7D%20else%20if(spec.type%20==%20%5C%22text%5C%22)%20%7B%5Cn%20%20%20%20%20%20sections%20+=%20%60%5Cn%20%20%20%20%20%20%20%20%3Csection%20class=%5C%22structuredInputSection%5C%22%20data-is-hidden-extra=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22yes%5C%22%20:%20%5C%22no%5C%22%7D%5C%22%20style=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22display:none%5C%22%20:%20%5C%22%5C%22%7D;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22sectionLabel%5C%22%20style=%5C%22$%7BstructuredSectionsI%20===%200%20?%20%5C%22margin-top:0;%5C%22%20:%20%5C%22%5C%22%7D%5C%22%3E$%7Bspec.label%7D$%7Bspec.infoTooltip%20?%20%60%20%3Cspan%20title=%5C%22$%7BsanitizeHtml(spec.infoTooltip)%7D%5C%22%20style=%5C%22cursor:pointer;%5C%22%20onclick=%5C%22alert(this.title)%5C%22%3E%E2%84%B9%EF%B8%8F%3C/span%3E%60%20:%20%5C%22%5C%22%7D%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22flex-grow:1;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctextarea%20data-initial-focus=%5C%22$%7Bspec.focus%20===%20true%20?%20%5C%22yes%5C%22%20:%20%5C%22no%5C%22%7D%5C%22%20data-spec-key=%5C%22$%7BsanitizeHtml(key)%7D%5C%22%20$%7Bspec.height%20===%20%5C%22fit-content%5C%22%20?%20%60data-height=%5C%22fit-content%5C%22%60%20:%20%60%60%7D%20$%7Bspec.disabled%20===%20true%20?%20%5C%22disabled%5C%22%20:%20%5C%22%5C%22%7D%20style=%5C%22width:100%25;%20$%7Bspec.height%20===%20%5C%22fit-content%5C%22%20?%20%5C%22%5C%22%20:%20%60height:$%7BsanitizeHtml(spec.height)%7D%60%7D;%20min-height:$%7Bspec.minHeight%20??%20%5C%224rem%5C%22%7D;%20max-height:$%7Bspec.maxHeight%20??%20%5C%2250vh%5C%22%7D;%20padding:0.25rem;%20$%7Bspec.cssText%20%7C%7C%20%5C%22%5C%22%7D;%5C%22%20type=%5C%22text%5C%22%20placeholder=%5C%22$%7BsanitizeHtml(spec.placeholder)%7D%5C%22%20$%7Bspec.disableSpellCheck%20?%20%60spellcheck=%5C%22false%5C%22%60%20:%20%60%60%7D%3E$%7BsanitizeHtml(spec.defaultValue)%7D%3C/textarea%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C/section%3E%60;%5Cn%20%20%20%20%20%20structuredSectionsI++;%5Cn%20%20%20%20%7D%20else%20if(spec.type%20==%20%5C%22buttons%5C%22)%20%7B%5Cn%20%20%20%20%20%20sections%20+=%20%60%5Cn%20%20%20%20%20%20%20%20%3Csection%20data-spec-key=%5C%22$%7BsanitizeHtml(key)%7D%5C%22%20class=%5C%22structuredInputSection%5C%22%20data-is-hidden-extra=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22yes%5C%22%20:%20%5C%22no%5C%22%7D%5C%22%20style=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22display:none%5C%22%20:%20%5C%22%5C%22%7D;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22sectionLabel%5C%22%20style=%5C%22$%7BstructuredSectionsI%20===%200%20?%20%5C%22margin-top:0;%5C%22%20:%20%5C%22%5C%22%7D%5C%22%3E$%7Bspec.label%20??%20%5C%22%5C%22%7D$%7Bspec.infoTooltip%20?%20%60%20%3Cspan%20title=%5C%22$%7BsanitizeHtml(spec.infoTooltip)%7D%5C%22%20style=%5C%22cursor:pointer;%5C%22%20onclick=%5C%22alert(this.title)%5C%22%3E%E2%84%B9%EF%B8%8F%3C/span%3E%60%20:%20%5C%22%5C%22%7D%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22flex-grow:1;%20display:%20grid;%20grid-template-columns:%20repeat(auto-fit,%20minmax(90px,%20200px));%20gap:%201rem;%20justify-content:center;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20$%7Bspec.buttons.map(b%20=%3E%20%60%3Cbutton%20$%7Bb.disabled%20===%20true%20?%20%5C%22disabled%5C%22%20:%20%5C%22%5C%22%7D%20style=%5C%22width:max-content;%20justify-self:center;%20align-self:center;%20border:%201px%20solid%20lightgrey;%20border-radius:%203px;%20padding:0.25rem;%20$%7Bb.cssText%20%7C%7C%20%5C%22%5C%22%7D;%5C%22%3E$%7Bb.text%7D%3C/button%3E%60).join(%5C%22%20%5C%22)%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3C/section%3E%60;%5Cn%20%20%20%20%20%20structuredSectionsI++;%5Cn%20%20%20%20%7D%20else%20if(spec.type%20==%20%5C%22none%5C%22)%20%7B%5Cn%20%20%20%20%20%20sections%20+=%20%60%5Cn%20%20%20%20%20%20%20%20%3Csection%20data-spec-key=%5C%22$%7BsanitizeHtml(key)%7D%5C%22%20data-is-hidden-extra=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22yes%5C%22%20:%20%5C%22no%5C%22%7D%5C%22%20data-requires-element-insert=%5C%22$%7Btypeof%20spec.html%20===%20%5C%22string%5C%22%20?%20%5C%22no%5C%22%20:%20%5C%22yes%5C%22%7D%5C%22%20style=%5C%22$%7Bspec.hidden%20===%20true%20?%20%5C%22display:none%5C%22%20:%20%5C%22%5C%22%7D;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20$%7Btypeof%20spec.html%20===%20%5C%22string%5C%22%20?%20spec.html%20:%20%5C%22%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%3C/section%3E%60;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20i++;%5Cn%20%20%7D%5Cn%20%20ctn.innerHTML%20=%20%60%5Cn%20%20%20%20%3Cdiv%20class=%5C%22promptModalInnerContainer%5C%22%20style=%5C%22background:rgba(0,0,0,0.7);%20position:fixed;%20top:0;%20left:0;%20right:0;%20bottom:0;%20z-index:9999999;%20display:flex;%20justify-content:center;%20$%7Bopts.verticallyCenter%20?%20%5C%22align-items:center;%5C%22%20:%20%5C%22%5C%22%7D%20color:inherit;%20color-scheme:$%7BcolorScheme%7D;%20$%7BcolorScheme===%5C%22light%5C%22%20?%20%5C%22color:black%5C%22%20:%20%5C%22color:#e7e7e7%5C%22%7D;%20font:inherit;%20padding:0.5rem;%20text-align:left;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20style=%5C%22width:600px;%20max-width:100%25;%20background:$%7BsanitizeHtml(opts.backgroundColor)%7D;%20height:%20min-content;%20padding:1rem;%20border:1px%20solid%20$%7Bopts.borderColor%7D;%20border-radius:$%7Bopts.borderRadius%7D;%20box-shadow:%200px%201px%2010px%203px%20rgb(130%20130%20130%20/%2024%25);%20max-height:%20calc(100%25%20-%201rem);display:%20flex;%20flex-direction:%20column;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20class=%5C%22sectionsContainer%5C%22%20style=%5C%22overflow:auto;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20$%7Bsections%7D%5Cn%20%20%20%20%20%20%20%20%20%20$%7BObject.values(specs).find(s%20=%3E%20s.hidden%20===%20true)%20?%20%60%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22text-align:center;%20margin-top:1rem;%20display:flex;%20justify-content:center;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22showHidden%5C%22%20style=%5C%22padding:%200.25rem;%5C%22%3E$%7Bopts.showHiddenInputsText%20%7C%7C%20%5C%22Show%20hidden%20inputs%5C%22%7D%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%20%20%60%20:%20%5C%22%5C%22%7D%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22text-align:center;%20margin-top:1rem;%20$%7Bopts.cancelButtonText%20===%20null%20?%20%5C%22%5C%22%20:%20%60display:flex;%20justify-content:space-between;%60%7D%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20$%7Bopts.cancelButtonText%20===%20null%20?%20%5C%22%5C%22%20:%20%60%3Cbutton%20class=%5C%22cancel%5C%22%20style=%5C%22padding:%200.25rem;%5C%22%3E$%7Bopts.cancelButtonText%20??%20%5C%22cancel%5C%22%7D%3C/button%3E%60%7D%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22submit%5C%22%20style=%5C%22padding:%200.25rem;%20$%7Bopts.submitButtonCssText%20%7C%7C%20''%7D;%5C%22%3E$%7Bopts.submitButtonText%20%7C%7C%20%5C%22submit%5C%22%7D%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%3Cstyle%3E%5Cn%20%20%20%20%20%20%20%20.promptModalInnerContainer%20.sectionsContainer%20%3E%20section%20.sectionLabel%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20margin:0.125rem%200;%5Cn%20%20%20%20%20%20%20%20%20%20margin-top:%201rem;%5Cn%20%20%20%20%20%20%20%20%20%20font-size:85%25;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20.promptModalInnerContainer%20.sectionsContainer%20input:invalid%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20background-color:%20lightpink;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20.promptModalInnerContainer%20.sectionsContainer%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20-ms-overflow-style:%20none;%20%20/*%20Internet%20Explorer%2010+%20*/%5Cn%20%20%20%20%20%20%20%20%20%20scrollbar-width:%20none;%20%20/*%20Firefox%20*/%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20.promptModalInnerContainer%20.sectionsContainer::-webkit-scrollbar%20%7B%20%5Cn%20%20%20%20%20%20%20%20%20%20display:%20none;%20%20/*%20Safari%20and%20Chrome%20*/%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20.promptModalInnerContainer%20.sectionsContainer.scrollFade%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20padding-bottom:%2030px;%5Cn%20%20%20%20%20%20%20%20%20%20-webkit-mask-image:%20linear-gradient(to%20bottom,%20black%20calc(100%25%20-%2030px),%20#ffffff00%20100%25);%5Cn%20%20%20%20%20%20%20%20%20%20mask-image:%20linear-gradient(to%20bottom,%20black%20calc(100%25%20-%2030px),%20#ffffff00%20100%25);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20.promptModalInnerContainer%20*%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20box-sizing:%20border-box;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%3C/style%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%60;%5Cn%20%20document.body.appendChild(ctn);%5Cn%20%20%5Cn%20%20function%20updateFitHeights()%20%7B%20//%20settimeout%20to%20ensure%20rendered%5Cn%20%20%20%20ctn.querySelectorAll(%5C%22textarea%5Bdata-height=fit-content%5D%5C%22).forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20minHeight%20=%20el.offsetHeight;%20//%20textareas%20will%20always%20have%20min-height%20set,%20so%20we%20can%20use%20that%20via%20offsetHeight%5Cn%20%20%20%20%20%20el.style.height%20=%20Math.max(minHeight,%20(el.scrollHeight+10))%20+%20%5C%22px%5C%22;%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%5Cn%20%20setTimeout(updateFitHeights,%205);%5Cn%5Cn%20%20if(ctn.querySelector(%5C%22button.showHidden%5C%22))%20%7B%5Cn%20%20%20%20ctn.querySelector(%5C%22button.showHidden%5C%22).onclick%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20ctn.querySelectorAll('.sectionsContainer%20%5Bdata-is-hidden-extra=yes%5D').forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20el.style.display='';%5Cn%20%20%20%20%20%20%20%20el.dataset.isHiddenExtra%20=%20%5C%22no%5C%22;%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20ctn.querySelector(%5C%22button.showHidden%5C%22).remove();%5Cn%20%20%20%20%20%20updateFitHeights();%5Cn%20%20%20%20%20%20updateInputVisibilies();%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%5Cn%20%20//%20insert%20non-string%20HTML%20elements%20for%20type==html%20specs%5Cn%20%20let%20elementObjects%20=%20Object.values(specs).filter(s%20=%3E%20s.html%20&&%20typeof%20s.html%20!==%20%5C%22string%5C%22).map(s%20=%3E%20s.html);%5Cn%20%20ctn.querySelectorAll('.sectionsContainer%20%5Bdata-requires-element-insert=yes%5D').forEach((el,%20i)%20=%3E%20%7B%5Cn%20%20%20%20el.append(elementObjects%5Bi%5D);%5Cn%20%20%7D);%5Cn%5Cn%20%20//%20add%20onclick%20handlers%20for%20type==button%20specs%5Cn%20%20let%20buttonSpecKeys%20=%20Object.entries(specs).filter((%5Bkey,%20spec%5D)%20=%3E%20spec.type%20===%20%5C%22buttons%5C%22).map((%5Bkey,%20spec%5D)%20=%3E%20key);%5Cn%20%20for(let%20key%20of%20buttonSpecKeys)%20%7B%5Cn%20%20%20%20ctn.querySelectorAll(%60.sectionsContainer%20%5Bdata-spec-key=$%7Bkey%7D%5D%60).forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20buttonEls%20=%20%5B...el.querySelectorAll(%5C%22button%5C%22)%5D;%5Cn%20%20%20%20%20%20for(let%20i%20=%200;%20i%20%3C%20buttonEls.length;%20i++)%20%7B%5Cn%20%20%20%20%20%20%20%20buttonEls%5Bi%5D.onclick%20=%20specs%5Bkey%5D.buttons%5Bi%5D.onClick;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%5Cn%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20//%20add%20scrollFade%20if%20sectionsContainer%20has%20scroll%5Cn%20%20%20%20let%20sectionsContainerEl%20=%20ctn.querySelector(%5C%22.promptModalInnerContainer%20.sectionsContainer%5C%22);%5Cn%20%20%20%20if(sectionsContainerEl.scrollHeight%20%3E%20sectionsContainerEl.offsetHeight)%20%7B%5Cn%20%20%20%20%20%20sectionsContainerEl.classList.add(%5C%22scrollFade%5C%22);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20//%20focus%5Cn%20%20%20%20let%20focusEl%20=%20ctn.querySelector(%5C%22.promptModalInnerContainer%20.sectionsContainer%20%5Bdata-initial-focus=yes%5D%5C%22);%5Cn%20%20%20%20if(!focusEl)%20focusEl%20=%20%5B...ctn.querySelectorAll(%5C%22.promptModalInnerContainer%20input,%20.promptModalInnerContainer%20textarea%5C%22)%5D%5B0%5D;%5Cn%20%20%20%20if(focusEl)%20%7B%5Cn%20%20%20%20%20%20focusEl.focus();%5Cn%20%20%20%20%20%20focusEl.selectionStart%20=%20focusEl.value.length;%5Cn%20%20%20%20%7D%5Cn%20%20%7D,%205);%5Cn%20%20%5Cn%20%20function%20getAllValues()%20%7B%5Cn%20%20%20%20let%20values%20=%20%7B%7D;%5Cn%20%20%20%20for(let%20el%20of%20%5B...ctn.querySelectorAll(%5C%22%5Bdata-spec-key%5D%5C%22)%5D)%20%7B%5Cn%20%20%20%20%20%20if(el.tagName%20===%20%5C%22INPUT%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20if(el.type%20==%20%5C%22file%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20values%5Bel.dataset.specKey%5D%20=%20el.files;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20values%5Bel.dataset.specKey%5D%20=%20el.value;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20if(el.tagName%20===%20%5C%22TEXTAREA%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20values%5Bel.dataset.specKey%5D%20=%20el.value;%5Cn%20%20%20%20%20%20%7D%20else%20if(el.tagName%20===%20%5C%22SELECT%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20values%5Bel.dataset.specKey%5D%20=%20el.value;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20return%20values;%5Cn%20%20%7D%5Cn%5Cn%20%20//%20a%20spec%20can%20have%20a%20%60show%60%20function%20which%20determines%20whether%20it's%20shown%20based%20on%20the%20values%20of%20the%20other%20inputs%5Cn%20%20function%20updateInputVisibilies()%20%7B%5Cn%20%20%20%20const%20values%20=%20getAllValues();%5Cn%20%20%20%20for(const%20el%20of%20%5B...ctn.querySelectorAll(%5C%22%5Bdata-spec-key%5D%5C%22)%5D)%20%7B%5Cn%20%20%20%20%20%20const%20showFn%20=%20specs%5Bel.dataset.specKey%5D.show;%5Cn%20%20%20%20%20%20if(!showFn)%20continue;%5Cn%20%20%20%20%20%20if(showFn(values))%20%7B%5Cn%20%20%20%20%20%20%20%20el.closest('section').style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20el.closest('section').style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20//%20the%20%5C%22show%20advanced%5C%22%20hidden-ness%20overrides%20the%20show()%20function%5Cn%20%20%20%20%20%20if(el.closest(%5C%22section%5C%22).dataset.isHiddenExtra%20===%20%5C%22yes%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20el.closest(%5C%22section%5C%22).style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20updateInputVisibilies();%5Cn%20%20for(const%20el%20of%20%5B...ctn.querySelectorAll(%5C%22%5Bdata-spec-key%5D%5C%22)%5D)%20%7B%5Cn%20%20%20%20el.addEventListener(%5C%22input%5C%22,%20updateInputVisibilies);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20//%20add%20onChange%20handlers,%20if%20any:%5Cn%20%20try%20%7B%5Cn%20%20%20%20for(let%20%5Bkey,%20value%5D%20of%20Object.entries(specs))%20%7B%5Cn%20%20%20%20%20%20if(value.type%20===%20%5C%22select%5C%22%20&&%20typeof%20value.onChange%20===%20%5C%22function%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20ctn.querySelector(%60.sectionsContainer%20%5Bdata-spec-key=$%7Bkey%7D%5D%60).addEventListener(%5C%22change%5C%22,%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20data%20=%20getAllValues();%5Cn%20%20%20%20%20%20%20%20%20%20let%20originalData%20=%20JSON.parse(JSON.stringify(data));%5Cn%20%20%20%20%20%20%20%20%20%20value.onChange(data);%20//%20if%20this%20handler%20edits%20the%20data,%20then%20we%20propagate%20those%20edits%20to%20the%20actual%20inputs%5Cn%20%20%20%20%20%20%20%20%20%20let%20thereWereDataChanges%20=%20false;%5Cn%20%20%20%20%20%20%20%20%20%20for(let%20k%20in%20originalData)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(data%5Bk%5D%20!==%20originalData%5Bk%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20todo:%20propagate%20change%20events?%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctn.querySelector(%60.sectionsContainer%20%5Bdata-spec-key=$%7Bk%7D%5D%60).value%20=%20data%5Bk%5D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20thereWereDataChanges%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20if(thereWereDataChanges)%20updateInputVisibilies();%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D%20//%20try/catch%20because%20it's%20new%20code%5Cn%5Cn%20%20let%20promptResolver;%5Cn%5Cn%20%20if(opts.controls)%20%7B%5Cn%20%20%20%20//%20add%20a%20proxy%20to%20the%20controls%20object%20so%20that%20we%20can%20read%20and%20write%20spec%20values%20from%20the%20outside%5Cn%20%20%20%20opts.controls.data%20=%20new%20Proxy(%7B%7D,%20%7B%5Cn%20%20%20%20%20%20set:%20function(obj,%20prop,%20value)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20el%20=%20ctn.querySelector(%60%5Bdata-spec-key=$%7Bprop%7D%5D%60);%5Cn%20%20%20%20%20%20%20%20if(!el)%20return%20true;%5Cn%20%20%20%20%20%20%20%20el.value%20=%20value;%5Cn%20%20%20%20%20%20%20%20updateInputVisibilies();%5Cn%20%20%20%20%20%20%20%20return%20true;%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20get:%20function(obj,%20prop)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20el%20=%20ctn.querySelector(%60%5Bdata-spec-key=$%7Bprop%7D%5D%60);%5Cn%20%20%20%20%20%20%20%20if(!el)%20return%20undefined;%5Cn%20%20%20%20%20%20%20%20return%20el.value;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20opts.controls.submit%20=%20function()%20%7B%5Cn%20%20%20%20%20%20ctn.querySelector(%5C%22button.submit%5C%22).click();%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20opts.controls.cancel%20=%20function()%20%7B%5Cn%20%20%20%20%20%20promptResolver(null);%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%5Cn%20%20let%20values%20=%20await%20new%20Promise((resolve)%20=%3E%20%7B%5Cn%20%20%20%20promptResolver%20=%20resolve;%5Cn%20%20%20%20ctn.querySelector(%5C%22button.submit%5C%22).onclick%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20values%20=%20getAllValues();%5Cn%20%20%20%20%20%20resolve(values);%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20if(ctn.querySelector(%5C%22button.cancel%5C%22))%20%7B%5Cn%20%20%20%20%20%20ctn.querySelector(%5C%22button.cancel%5C%22).onclick%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20resolve(null);%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%7D%5Cn%20%20%7D);%5Cn%20%20ctn.remove();%5Cn%20%20return%20values;%22,%22imports%22:%5B%5D,%22lastEditTime%22:1729755725684,%22found%22:true%7D,%7B%22name%22:%22select-leaf-plugin%22,%22modelText%22:%22//%20This%20is%20the%20JavaScript%20function%20that%20powers%20this%20plugin:%5Cn$output%20(list)%20=%3E%5Cn%20%20if(!list)%20return%20%5C%22(no%20list%20given%20to%20selectLeaf%20plugin)%5C%22;%5Cn%5Ctlet%20leaf%20=%20list;%5Cn%5Ctlet%20i%20=%200;%5Cn%5Ctlet%20result;%5Cn%5Ctwhile(1)%20%7B%5Cn%5Ct%5Cti++;%5Cn%5Ct%5Ctif(i%20%3E%2010000)%20%7B%5Cn%20%20%20%20%20%20return%20%5C%22(error%20in%20select-leaf-plugin:%20infinite%20loop%20encountered?)%5C%22;%5Cn%20%20%20%20%7D%5Cn%5Ct%5Ctresult%20=%20leaf.selectOne;%5Cn%5Ct%5Ctif(typeof%20result%20===%20%5C%22string%5C%22%20%7C%7C%20Object.keys(result).length%20===%200)%20%7B%20//%20typeof%20result%20===%20%5C%22string%5C%22%20is%20for%20case%20where%20input%20list%20was%20actually%20just%20a%20'property'%20like%20foo=%7Ba%7Cb%7Cc%7D%5Cn%5Ct%5Ct%5Ct//if(!result)%20debugger;%5Cn%5Ct%5Ct%5Ctreturn%20result;%5Cn%5Ct%5Ct%7D%5Cn%5Ct%5Ctleaf%20=%20result;%5Cn%5Ct%7D%5Cn%5Ct%5Cn//%20You%20can%20learn%20JavaScript%20here:%5Cn//%20https://www.codecademy.com/learn/javascript%22,%22imports%22:%5B%5D,%22lastEditTime%22:1691554935487,%22found%22:true%7D,%7B%22name%22:%22t2i-styles%22,%22modelText%22:%22//%20note%20that%20%60input%60%20is%20a%20global%20variable%20(i.e.%20%60input%60%20is%20%60window.input%60),%20which%20is%20created%20by%20t2i-framework-plugin%5Cn//%20see%20here%20for%20an%20example%20generator%20that%20imports%20these%20styles:%20https://perchance.org/ai-character-generator#edit%5Cn%5Cn//%20style%20tester:%20https://perchance.org/prompt-style-tester%5Cn%5Cn$output%5Cn%20%20Painted%20Anime%5Cn%20%20%20%20prompt%20//%20this%20style%20is%20biased%20towards%20female%20characters%20due%20to%20the%20biases%20of%20the%20artists%20mentioned,%20so%20we%20alter%20the%20description%20if%20'male'%20is%20mentioned%20to%20boost%20'maleness'%20and%20supress%20'femaleness'%5Cn%20%20%20%20%20%20%5Binput.description%5D,%20art%20by%20atey%20ghailan,%20painterly%20anime%20style%20at%20pixiv,%20art%20by%20kantoku,%20in%20art%20style%20of%20redjuice/nec%C3%B6mi/rella/tiv%20pixiv%20collab,%20your%20name%20anime%20art%20style,%20masterpiece%20digital%20painting,%20exquisite%20lighting%20and%20composition,%20inspired%20by%20wlop%20art%20style,%208k,%20sharp,%20very%20detailed,%20high%20resolution,%20illustration.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20painterly%20anime-inspired%20digital%20art.%20It's%20an%20aesthetically%20pleasing%20painterly%20anime-inspired%20digital%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%20%5E2%5Cn%20%20%20%20%20%20painterly%20anime%20artwork,%20%5Binput.description%5D,%20world-class%20masterpiece,%20fine%20details,%20breathtaking%20artwork,%20painterly%20art%20style,%20high%20quality,%208k,%20very%20detailed,%20high%20resolution,%20exquisite%20composition%20and%20lighting.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20painterly%20anime%20artwork.%20It's%20an%20aesthetically%20pleasing%20painterly%20anime%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:100,%20painting:100,%20paintedAnime:100,%20drawing:55,%20cartoon:50%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BanimeModifiers%5D%5Cn%20%20Casual%20Photo%5Cn%20%20%20%20prompt%20=%20A%20casual%20photo%20of%20%5Binput.description%5D.%20It's%20a%20casual%20photo.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:98,%20casualPhoto:100,%20portrait:80%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20color%20=%20%5BphotoModifiers.color%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%20Cinematic%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20cinematic%20shot,%20dynamic%20lighting,%2075mm,%20Technicolor,%20Panavision,%20cinemascope,%20sharp%20focus,%20fine%20details,%208k,%20HDR,%20realism,%20realistic,%20key%20visual,%20film%20still,%20cinematic%20color%20grading,%20depth%20of%20field.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20cinematic%20masterpiece.%20It's%20an%20aesthetically%20pleasing%20cinematic%20shot%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:100,%20portrait:85,%20render:70,%20cinematic:100%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20color%20=%20%5BphotoModifiers.color%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%20%20%20%20%20genre%5Cn%20%20%20%20%20%20%20%20adventure%20=%20,%20adventure%5Cn%20%20%20%20%20%20%20%20b-horror%20=%20,%20b-horror%20film%20screencap%5Cn%20%20%20%20%20%20%20%20epic%20fantasy%20=%20,%20epic%20fantasy%5Cn%20%20%20%20%20%20%20%20sci-fi%20=%20,%20sci-fi%5Cn%20%20%20%20%20%20%20%20film%20noir%20=%20,%20film%20noir%5Cn%20%20%20%20%20%20%20%20horror%20=%20,%20horror%5Cn%20%20%20%20%20%20%20%20indie%20=%20,%20indie%20film%20screencap%5Cn%20%20%20%20%20%20%20%20western%20=%20,%20western,%20wild%20west%5Cn%20%20%20%20%20%20%20%20thriller%20=%20,%20thriller%5Cn%20%20Digital%20Painting%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20breathtaking%20digital%20art,%20trending%20on%20artstation,%20by%20atey%20ghailan,%20by%20greg%20rutkowski,%20by%20greg%20tocchini,%20by%20james%20gilleard,%208k,%20high%20resolution,%20best%20quality.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20digital%20painting.%20It's%20an%20aesthetically%20pleasing%20digital%20painting%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:90,%20landscape:70,%20digitalPainting:100,%20drawing:60%7D)%5D%5Cn%20%20Concept%20Art%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20concept%20art,%20digital%20art,%20illustration,%20inspired%20by%20wlop%20style,%208k,%20fine%20details,%20sharp,%20very%20detailed,%20high%20resolution,%20world-class%20masterpiece.%5C%5Cn%5C%5CnOverall,%20it's%20absolute%20world-class%20masterpiece%20concept%20art.%20It's%20an%20aesthetically%20pleasing%20concept%20art%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:50,%20landscape:70%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20modifier%5Cn%20%20%20%20%20%20%20%20league%20of%20legends%20=%20,%20league%20of%20legends%20style%20concept%20art%5Cn%20%20%20%20%20%20%20%20epic%20fantasy%20=%20,%20epic%20fantasy%20concept%20art%20by%20noah%20bradley%5Cn%20%20%20%20%20%20%20%20sci-fi%20=%20,%20sci-fi%20concept%20art%5Cn%20%20%20%20%20%20%20%20horror%20=%20,%20horror%20concept%20art%5Cn%20%20%20%20%20%20%20%20western%20=%20,%20western,%20wild%20west%20concept%20art%5Cn%20%203D%20Disney%20Character%5Cn%20%20%20%20prompt%20=%203D%20cartoon%20Disney%20character%20portrait%20render.%20%5Binput.description%5D,%20bokeh,%204k,%20highly%20detailed,%20Pixar%20render,%20CGI%20Animation,%20Disney,%20cute%20big%20circular%20reflective%20eyes,%20dof,%20cinematic%20film,%20Disney%20realism,%20subtle%20details,%20breathtaking%20Pixar%20short,%20fine%20details,%20close%20up,%20sharp%20focus,%20HDR,%20Disney-style%20octane%20render,%20incredible%20composition,%20superb%20lighting%20and%20detail,%20%5Binput.description%5D.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%203D%20Disney-inspired%20Character.%20It's%20an%20aesthetically%20pleasing%203D%20Disney-inspired%20piece%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bdisney:95,%20render:80,%20portrait:75,%20cartoon:90%7D)%5D%5Cn%20%202D%20Disney%20Character%5Cn%20%20%20%20prompt%20=%202D%20cartoon%20Disney%20character%20digital%20art%20of%20%5Binput.description%5D.%20superb%20linework,%20classic%202D%20Disney%20style%20art,%20inspired%20by%20the%20art%20styles%20of%20Glen%20Keane%20and%20Aaron%20Blaise,%20Disney-style%20character%20concept%20with%20a%20Disney-style%20face,%20trending%20on%20artstation,%20Disney-style%20version%20of%20%5Binput.description%5D.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%202D%20Disney-inspired%20Character.%20It's%20an%20aesthetically%20pleasing%202D%20Disney-inspired%20piece%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bdisney:90,%20portrait:75,%20cartoon:100,%20comic:80,%20drawing:75%7D)%5D%5Cn%20%20Disney%20Sketch%5Cn%20%20%20%20prompt%20=%20Glen%20Keane%20character%20concept%20art%20black%20and%20white%20pencil%20sketch%20of%20%5Binput.description%5D.%20rough%20pencil%20sketch%20by%20Glen%20Keane,%20rough%20pencil%20sketch,%20close%20up,%20loose%20Disney-style%20character%20concept%20art%20sketch,%20nice%20sketchy%20pencil%20strokes,%20Disney%20character%20design%20sketch,%20pencil%20texture,%20a%20concept%20art%20pencil%20sketch%20of%20%5Binput.description%5D,%20by%20Glen%20Keane.%5C%5Cn%5C%5CnOverall,%20it's%20an%20charmingly%20aesthetic%20and%20well-composed%20Disney-style%20sketch.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bdisney:90,%20cartoon:85,%20sketch:80,%20comic:80,%20drawing:70%7D)%5D%5Cn%20%20Concept%20Sketch%5Cn%20%20%20%20prompt%20=%20black%20and%20white%20technical%20drawing%20showcasing%20%7Ba%7D%20%5Binput.description%5D,%20annotation%20details,%20world-class%20masterpiece%20black%20and%20white,%20pencil%20strokes,%20annotated%20technical%20concept%20art%20sketch,%20pencil%20texture.%5C%5Cn%5C%5CnOverall,%20it's%20a%20charmingly%20aesthetic%20and%20well-composed%20concept%20sketch.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bsketch:75,%20comic:50,%20drawing:75%7D)%5D%20%5Cn%20%20Painterly%5Cn%20%20%20%20prompt%20=%20painterly%20digital%20painting,%20%5Binput.description%5D,%20digital%20painting%20by%20Ilya%20Kuvshinov%20with%20painterly%20brush%20strokes,%20by%20Ilya%20Kuvshinov,%20world-class%20painterly%20masterpiece.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20painterly%20digital%20painting.%20It's%20an%20aesthetically%20pleasing%20painterly%20digital%20painting%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:85,%20landscape:65,%20digitalPainting:95,%20drawing:45%7D)%5D%5Cn%20%20Oil%20Painting%5Cn%20%20%20%20prompt%20=%20breathtaking%20alla%20prima%20oil%20painting,%20%5Binput.description%5D,%20close%20up,%20alla%20prima%20style,%20oil%20on%20linen,%20painterly%20oil%20on%20canvas,%20painterly%20style,%20exquisite%20composition%20and%20lighting,%20modern%20painterly%20masterpiece,%20by%20alexi%20zaitsev,%20award-winning%20painterly%20alla%20prima%20oil%20painting.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20oil%20painting.%20It's%20an%20aesthetically%20pleasing%20oil%20painting%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:87,%20oilPainting:100,%20landscape:60,%20portrait:65,%20drawing:40%7D)%5D%5Cn%20%20Oil%20Painting%20-%20Realism%5Cn%20%20%20%20prompt%20=%20breathtaking%20oil%20painting,%20%5Binput.description%5D,%20photorealistic%20oil%20painting,%20by%20charlie%20bowater,%20fine%20details,%20by%20wlop,%20trending%20on%20artstation,%20very%20detailed.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20realism%20oil%20painting.%20It's%20an%20aesthetically%20pleasing%20realism%20oil%20painting%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:87,%20oilPainting:95,%20landscape:60,%20portrait:70,%20drawing:40%7D)%5D%5Cn%20%20Oil%20Painting%20-%20Old%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20Oil%20painting%20by%20Jean-Fran%C3%A7ois%20Millet%20and%20Gustave%20Courbet%20and%20Jules%20Breton%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:85,%20oilPainting:90,%20vintage:40,%20landscape:55,%20portrait:65,%20drawing:35%7D)%5D%5Cn%20%20Oil%20Painting%20-%2070s%20Pulp%5Cn%20%20%20%20prompt%20=%201970s%20vintage%20pulp%20art,%20ultra%20realistic,%20fully%20restored,%20exquisite%20lighting%20and%20composition,%20polished,%20masterpiece,%20vintage%20pulp%20art,%20by%20Earle%20K.%20Bergey,%20by%20Kelly%20Freas,%20by%20Alex%20Schomburg,%20by%20H.%20J.%20Ward,%20glossy%20pulp%20art,%20Amazing%20Stories,%20Weird%20Tales,%208k,%20high%20resolution,%20best%20quality,%20hyper-realistic,%20Mattias%20Adolfsson%20style,%20detailed%20stylization,%20%5Binput.description%5D,%20ultra%20realistic,%20wlop-style,%20exquisite%20lighting%20and%20composition,%20polished,%20world-class%20masterpiece,%20digitally%20enhanced,%20breathtaking%20shot,%20subtle%20details,%20superb%20quality,%20art%20by%20Kuvshinov,%20Kuvshinov%20style,%20detailed%20stylization.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20artwork.%20It's%20an%20aesthetically%20pleasing%20restored%201970s%20vintage%20pulp%20art%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%20It%20has%20perfect%20contrast%20and%20color%20balance.%20Almost%20photorealism.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D,%20scratches,%20faded,%20washed%20out,%20grainy,%20dirty%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:80,%20oilPainting:85,%20vintage:50,%20landscape:20,%20portrait:60,%20drawing:35%7D)%5D%5Cn%20%20Professional%20Photo%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20%7Bsharp%7Csoft%7D%20focus,%20depth%20of%20field,%208k%20photo,%20HDR,%20professional%20lighting,%20taken%20with%20Canon%20EOS%20R5,%20DSLR,%2075mm%20lens%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:95,%20portrait:60%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20color%20=%20%5BphotoModifiers.color%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%20Anime%5Cn%20%20%20%20prompt%20=%20anime%20art%20of%20%5Binput.description%5D,%20world-class%20masterpiece,%204k,%20best%20quality,%20anime%20art.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20anime-inspired%20artwork.%20It's%20an%20aesthetically%20pleasing%20anime%20art%20with%20impeccable%20attention%20to%20detail%20and%20beautiful%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7BbasicAnime:100,%20anime:60,%20drawing:50,%20cartoon:30%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BanimeModifiers%5D%5Cn%20%20Drawn%20Anime%5Cn%20%20%20%20prompt%20=%20anime-style%20illustration%20with%20perfect%20clean%20lines,%20illustration%20of%20%5Binput.description%5D,%20anime%20drawing/art,%20bold%20linework,%20illustration,%20cel%20shaded,%20anime-style%20digital%20illustration.%20It's%20an%20anime-inspired%202D-style%20anime%20illustration.%20Aesthetic%20high-skill,%20professional%20anime%20illustration,%20which%20looks%20like%20a%20screencap%20from%20an%20anime%20series.%20It%20has%20clean%20line%20work%20and%20a%20pleasant,%20appealing%20drawn%20aesthetic%20style.%20Overall,%20it's%20a%20world-class%20illustration%20with%20flawless%20line%20work,%20perfect%20composition,%20and%20impeccable%20attention%20to%20detail.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:60,%20drawing:85,%20drawnAnime:100,%20cartoon:40%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BanimeModifiers%5D%5Cn%20%20Anime%20Screencap%5Cn%20%20%20%20prompt%20=%20Anime%20screencap,%20%5Binput.description%5D.%20It's%20an%20anime%20screencap%20from%20a%20popular%20anime.%20Beautiful%20visual%20quality,%20remastered,%20extremely%20high%20quality,%20very%20aesthetic,%20high%20production%20value,%20high-skill%20masterpiece.%20The%20image%20shows%20impeccable%20and%20beautiful%20composition%20and%20contrast.%20It's%20an%20exquisite%20anime%20screencap%20style%20image.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D,%20faded,%20washed%20out,%20low%20quality%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:65,%20drawing:80,%20cartoon:45%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BanimeModifiers%5D%5Cn%20%20Cute%20Anime%5Cn%20%20%20%20prompt%20=%20adorable,%20cute,%20kawaii,%20%5Binput.description%5D,%20cute%20moe%20anime%20character%20portrait,%20adorable,%20featured%20on%20pixiv,%20kawaii%20mo%C3%A9%20masterpiece,%20cuteness%20overload,%20very%20detailed,%20sooooo%20adorable.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20anime-inspired%20artwork.%20It's%20an%20aesthetically%20pleasing%20anime%20art%20with%20impeccable%20attention%20to%20detail%20and%20beautiful%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:55,%20drawing:50,%20cuteAnime:100,%20cartoon:30%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BanimeModifiers%5D%5Cn%20%20Soft%20Anime%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20anime%20masterpiece%20with%20soft%20lighting,%20gentle%20intricate%20style,%20highly%20detailed,%20pixiv,%20anime%20art,%204k,%20art%20from%20your%20name%20anime,%20garden%20of%20words%20style%20art,%20high%20quality.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20soft%20beautiful%20anime-inspired%20artwork.%20It's%20an%20aesthetically%20pleasing,%20soft,%20beautiful%20anime%20art%20with%20impeccable%20attention%20to%20detail%20and%20beautiful%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:50,%20drawing:50,%20cartoon:30%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BanimeModifiers%5D%5Cn%20%20Fantasy%20Painting%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20d&d,%20fantasy,%20highly%20detailed,%20digital%20painting,%20artstation,%20sharp%20focus,%20fantasy%20art,%20illustration,%208k,%20in%20the%20style%20of%20greg%20rutkowski.%20It's%20an%20absolute%20world-class%20masterpiece%20artwork.%20It's%20an%20aesthetically%20pleasing%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:50,%20landscape:80,%20fantasy:80%7D)%5D%5Cn%20%20Fantasy%20Landscape%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20fantasy%20matte%20painting,%20absolute%20masterpiece,%20detailed%20matte%20painting%20by%20andreas%20rocha%20and%20greg%20rutkowski,%20by%20Brothers%20Hildebrandt,%20superb%20composition,%20vivid%20fantasy%20art,%20breathtaking%20fantasy%20masterpiece.%20It's%20an%20absolute%20world-class%20masterpiece%20artwork.%20It's%20an%20aesthetically%20pleasing%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:30,%20poster:30,%20coverArt:50,%20vintage:30,%20landscape:90,%20fantasy:20%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BlandscapeModifiers.shot%5D%5Cn%20%20%20%20%20%20color%20=%20%5BlandscapeModifiers.color%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BlandscapeModifiers.effect%5D%5Cn%20%20Fantasy%20Portrait%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20d&d,%20fantasy,%20highly%20detailed,%20digital%20painting,%20artstation,%20sharp%20focus,%20fantasy%20art,%20character%20art,%20illustration,%208k,%20art%20by%20artgerm%20and%20greg%20rutkowski.%20It's%20an%20absolute%20world-class%20masterpiece%20artwork.%20It's%20an%20aesthetically%20pleasing%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7BfantasyPortrait:100,%20painting:50,%20fantasy:70,%20portrait:75%7D)%5D%5Cn%20%20Studio%20Ghibli%5Cn%20%20%20%20prompt%20=%20Studio%20Ghibli%20style%20artwork%20of%20%5Binput.description%5D,%20Studio%20Ghibli%20style%20art%20film%20still,%20sharp,%20very%20detailed,%20high%20resolution,%20inspired%20by%20Hayao%20Miyazaki,%20anime,%20film%20still%20from%20Spirited%20Away.%20In%20the%20style%20of%20Kiki%20Delivery%20Service,%20with%20a%20similar%20art%20style%20to%20Princess%20Mononoke.%20Aesthetically%20similar%20to%20My%20Neighbor%20Totoro's%20art%20style.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20Studio%20Ghibli-inspired%20artwork.%20It's%20an%20aesthetically%20pleasing%20classic%20Studio%20Ghibli%20style%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bghibli:100,%20anime:50,%20cartoon:50%7D)%5D%5Cn%20%2050s%20Enamel%20Sign%5Cn%20%20%20%20prompt%20=%2050s%20enamel%20sign%20of%20%5Binput.description%5D,%2050s%20advert%20enamel%20sign,%20masterpiece,%20authentic%20vintage%20enamel%20sign%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bvintage:85%7D)%5D%5Cn%20%20Vintage%20Comic%5Cn%20%20%20%20prompt%20=%20comic%20book%20style%20art%20of%20%5Binput.description%5D,%20drawing,%20by%20Dave%20Stevens,%20by%20Adam%20Hughes,%201940's,%201950's,%20hand-drawn,%20color,%20high%20resolution,%20best%20quality,%20closeup%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bvintage:80,%20comic:90,%20cartoon:70%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20effect%5Cn%20%20%20%20%20%20%20%20retrofuturism%20=%20,%20(retrofuturism,%20atompunk)%5Cn%20%20%20%20%20%20%20%20gritty%20noir%20=%20,%20(gritty%20noir)%5Cn%20%20%20%20%20%20%20%20pop%20art%20=%20,%20(pop%20art%20style)%5Cn%20%20%20%20%20%20%20%20cyberpunk%20=%20,%20(cyberpunk%20aesthetic)%5Cn%20%20%20%20%20%20%20%20steampunk%20=%20,%20(steampunk)%5Cn%20%20%20%20%20%20%20%20watercolor%20=%20,%20(watercolor%20wash)%5Cn%20%20%20%20%20%20%20%20sketchy%20ink%20=%20,%20sketchy%20ink%20work%5Cn%20%20%20%20%20%20%20%20manga%20fusion%20=%20,%20(manga%20fusion)%5Cn%20%20%20%20%20%20%20%20psychedelic%20=%20,%20psychedelic%20imagery%5Cn%20%20%20%20%20%20%20%20pulp%20magazine%20=%20,%20pulp%20magazine%20look%5Cn%20%20%20%20%20%20%20%20heroic%20proportions%20=%20,%20heroic%20proportions%5Cn%20%20Franco-Belgian%20Comic%5Cn%20%20%20%20prompt%20=%20franco-belgian%20color%20comic%20about%20%5Binput.description%5D,%20bande%20dessin%C3%A9e,%20franco-belgian%20comic%20panel,%20masterpiece,%20breathtaking%20composition,%20intricate,%20detailed,%20best%20quality%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bvintage:75,%20comic:85,%20cartoon:75%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20modifier%5Cn%20%20%20%20%20%20%20%20single-panel%20=%20,%20splash%20panel,%20full%20cover%20image%5Cn%20%20%20%20%20%20%20%20multi-panel%20=%20,%20multi-panel%20comic%20book%20page,%20comic%20panel%20layout%5Cn%20%20%20%20%20%20%20%20cyberpunk%20=%20,%20(cyberpunk%20aesthetic)%5Cn%20%20%20%20%20%20%20%20steampunk%20=%20,%20(steampunk)%5Cn%20%20%20%20%20%20%20%20manga%20fusion%20=%20,%20(manga%20fusion)%5Cn%20%20%20%20%20%20%20%20psychedelic%20=%20,%20psychedelic%20imagery%5Cn%20%20%20%20%20%20%20%20pulp%20magazine%20=%20,%20pulp%20magazine%20look%5Cn%20%20%20%20%20%20%20%20heroic%20proportions%20=%20,%20heroic%20proportions%5Cn%20%20Tintin%20Comic%5Cn%20%20%20%20prompt%20=%20color%20comic%20panel%20in%20the%20style%20of%20Herg%C3%A9%20about%20%5Binput.description%5D,%20by%20Herg%C3%A9,%20tintin%20style,%20french%20comic%20panel,%20franco-belgian%20style,%20masterpiece,%20high-resolution%20Herg%C3%A9%20style%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bvintage:77,%20comic:87,%20cartoon:77%7D)%5D%5Cn%20%20//%20Vintage%20Comic%5Cn%20%20//%20%20%20prompt%20=%20comic%20book%20style%20art%20of%20%5Binput.description%5D,%20drawing%20by%20Jack%20Kirby,%20Steve%20Ditko%20art,%201940's,%201950's,%20closeup,%20color,%20vintage%20masterpiece,%20best%20quality%5Cn%20%20//%20%20%20negative%20=%20%5Binput.negative%5D,%20worst%20quality,%20low%20resolution,%20fuzzy,%20jpeg%20compression%20artifacts,%20blurry,%20low%20quality%5Cn%20%20//%20%20%20meta:tags%20=%20%5B(%7Bvintage:80,%20comic:90,%20cartoon:70%7D)%5D%5Cn%20%20//%2090s%20Comic%5Cn%20%20//%20%20%20prompt%20=%20%5Binput.description%5D,%2090s%20comic%20book%20artwork,%20colored%20comic%20book%20panel,%20classic%2090s%20style,%20masterpiece%5Cn%20%20//%20%20%20negative%20=%20%5Binput.negative%5D,%20bad%20photo,%20greyscale,%20blurry,%20bad%203D%20render,%20crappy%203D%20art,%20barcode,%20logo,%20bad%20photo%5Cn%20%20//%20%20%20meta:tags%20=%20%5B(%7Bvintage:80,%20comic:80%7D)%5D%5Cn%20%20//%2090s%20Superhero%5Cn%20%20//%20%20%20prompt%20=%20%5Binput.description%5D,%2090s%20comic%20book%20artwork,%20colored%20comic%20book%20panel,%20classic%2090s%20style,%20masterpiece,%20art%20by%20Greg%20Capullo,%20art%20by%20Jim%20Lee,%20art%20by%20Todd%20McFarlane%5Cn%20%20//%20%20%20negative%20=%20%5Binput.negative%5D,%20bad%20photo,%20greyscale,%20blurry,%20bad%203D%20render,%20crappy%203D%20art,%20barcode,%20logo,%20bad%20photo%5Cn%20%20//%20%20%20meta:tags%20=%20%5B(%7Bvintage:80,%20comic:80%7D)%5D%5Cn%20%20Medieval%5Cn%20%20%20%20prompt%20=%20medieval%20illuminated%20manuscript%20picture%20of%20%5Binput.description%5D,%20medieval%20illuminated%20manuscript%20art,%20masterpiece%20medieval%20color%20illustration,%2016th%20century,%208k%20high-resolution%20scan%20of%2016th%20century%20illuminated%20manuscript%20painting,%20detailed%20medieval%20masterpiece.%20%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bvintage:80,%20painting:70,%20portrait:40%7D)%5D%5Cn%20%20Pixel%20Art%5Cn%20%20%20%20prompt%20=%20%5Binput.description.length%20%3E%2040%20?%20%5C%22(pixel%20art),%20%5C%22%20:%20%5C%22%5C%22%5D%5Binput.description%5D,%20best%20pixel%20art,%20neo-geo%20graphical%20style,%20retro%20nostalgic%20masterpiece,%20128px,%2016-bit%20pixel%20art%20%5Binput.description.length%20%3C%2010%20?%20%5C%22of%20%5C%22+input.description%20:%20%5C%22%5C%22%5D,%202D%20pixel%20art%20style,%20adventure%20game%20pixel%20art,%20inspired%20by%20the%20art%20style%20of%20hyper%20light%20drifter,%20masterful%20dithering,%20superb%20composition,%20beautiful%20palette,%20exquisite%20pixel%20detail%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7BpixelArt:90,%20vintage:70%7D)%5D%5Cn%20%20%20%20//%20randomPrompt%20=%20%7Bmermaid%7Cgoblin%7D%5Cn%20%20Furry%20-%20Oil%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20crisp%20vibrant%20detailed%20soft%20painterly%20digital%20art,%20volumetric%20lighting,%20natural%20lighting,%20realistic%20lighting,%20vibrant%20colors,%20crisp%20oil%20painting,%20painterly%20realism,%20depth%20of%20field,%20subtle%20soft%20details,%20vivid,%20fresh,%20striking,%20by%20chunie,%20by%20darkgem,%20by%20honovy,%20by%20zaush,%20by%20anhes,%20by%20puinkey,%20by%20caraid,%20by%20dagasi,%20by%20taranfiddler,%20by%20atey%20ghailan,%20by%20MilletGustave,%20by%20Curbet,%20Charlie%20Bowater,%20lol%20art.%5C%5Cn%5C%5CnOverall,%20it's%20a%20world-class%20painterly%20masterpiece.%20It's%20aesthetically%20pleasing%20digitial%20art%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7BfurryOil:100,%20furry:100%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BfurryModifiers%5D%5Cn%20%20Furry%20-%20Cinematic%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20cinematic%20shot,%20dynamic%20lighting,%2075mm,%20Technicolor,%20Panavision,%20cinemascope,%20sharp%20focus,%20fine%20details,%208k,%20HDR,%20realism,%20realistic,%20key%20visual,%20film%20still,%20cinematic%20color%20grading,%20depth%20of%20field.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece.%20It's%20an%20aesthetically%20pleasing%20image%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bfurry:97,%20photo:60,%20portrait:40,%20render:75,%20cinematic:65%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20effect%20=%20%5BfurryModifiers.effect%5D%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20color%20=%20%5BphotoModifiers.color%5D%5Cn%20%20%20%20%20%20photo%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%20Furry%20-%20Painted%5Cn%20%20%20%20prompt%20=%20anthro%20%5Binput.description%5D%20digital%20art,%20masterpiece,%204k,%20fine%20details.%20It's%20an%20absolute%20world-class%20masterpiece%20artwork.%5C%5Cn%5C%5CnOverall,%20it's%20an%20aesthetically%20pleasing%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bfurry:96%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BfurryModifiers%5D%5Cn%20%20Furry%20-%20Drawn%5Cn%20%20%20%20prompt%20=%20anthro%20%5Binput.description%5D%20illustration,%20hand-drawn,%20bold%20linework,%20anthro%20illustration,%20cel%20shaded,%204k,%20fine%20details,%20masterpiece.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20artwork.%20It's%20an%20aesthetically%20pleasing%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bfurry:95%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BfurryModifiers%5D%20%5Cn%20%20Cute%20Figurine%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20figurine,%20modern%20Disney%20style,%20octane%20render,%20chibi%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bdisney:20,%20emoji:60%7D)%5D%5Cn%20%203D%20Emoji%5Cn%20%20%20%20prompt%20=%20masterpiece%20%5Binput.description%5D%20cartoon%203D%20emoji%20concept%20render,%20close-up,%20facing%20forward,%20matte%20finish,%203D%20emoji%20render,%20app%20icon,%20simple%20design,%20new%20iOS%2018.4%20style%20%5Binput.description%5D%20emoji%20render,%20simple%20background,%20centered,%20world-class%20masterpiece%20work%20of%20art,%20crisp%20render,%20sharp%20focus,%20charmingly%20aesthetic%20design,%204k,%20soft%20lighting,%20masterpiece%20emoji-style%20figurine%203D%20render,%20pure%20white%20background%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bemoji:90%7D)%5D%5Cn%20%20Illustration%5Cn%20%20%20%20prompt%20=%20breathtaking%20illustration%20of%20%5Binput.description%5D,%20illustration,%20masterpiece,%20breathtaking%20illustration.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20illustration.%20It's%20an%20aesthetically%20pleasing%20illustration%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Billustration:100,%20drawing:75%7D)%5D%5Cn%20%20Cute%20Illustration%20//%20adapted%20from%20a%20nice%20image%20i%20saw%20by%20'%E3%83%AA%E3%83%A5%E3%82%A6%20%F0%9F%94%B5%F0%9F%90%BA':%20https://aigc.uploads.dev/image/765de3e463f307119a339788690c56c35ca53d8bd19364f533e65c672831c357.jpeg%5Cn%20%20%20%20prompt%20=%20A%20cute%20cartoon%20showing%20%5Binput.description%5D,%20in%20a%20soft,%20cute,%20minimalist,%20webcomic-style%20illustration.%20Line%20art%20is%20somewhat%20bold%20but%20gentle,%20with%20clean%20lines,%20and%20subtle%20variation.%20Colors%20are%20soft,%20flat,%20with%20gentle%20pastel%20tones.%20No%20shading%20except%20for%20light%20inner%20shadows%20or%20simple%20highlights.%20The%20background%20is%20plain%20white%20or%20contains%20a%20light%20wash%20of%20color%20with%20subtle%20textured%20style.%20The%20overall%20scene%20is%20wholesome%20and%20endearing%20like%20a%20page%20from%20a%20Liz%20Climo%20comic.%20Composition%20is%20centered%20with%20space%20around%20the%20character,%20evoking%20authentic%20warmth%20through%20the%20wholesome,%20soft,%20web%20comic%20style.%5C%5Cn%5C%5CnIt's%20an%20aesthetically%20pleasing%20masterpiece,%20showing%20high%20skill%20in%20evoking%20an%20authentic%20and%20beautifully%20minimalist%20style.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Billustration:99,%20drawing:75%7D)%5D%5Cn%20%20Flat%20Illustration%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20illustration,%20flat,%202D,%20vector%20art,%20masterpiece,%20made%20with%20adobe%20illustrator,%20behance%20competition%20winner,%20trending%20on%20dribble,%204k,%20high%20resolution,%20crisp%20lines.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20flat-style%20illustration.%20It's%20an%20aesthetically%20pleasing%20flat-style%20illustration%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Billustration:85,%20drawing:40%7D)%5D%5Cn%20%20Watercolor%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20(watercolor),%20high%20resolution,%20intricate%20details,%204k,%20wallpaper,%20concept%20art,%20watercolor%20on%20textured%20paper.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20watercolor%20artwork.%20It's%20an%20aesthetically%20pleasing%20watercolor%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:30%7D)%5D%5Cn%20%201990s%20Photo%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%2090s%20home%20video,%20nostalgic%2090s%20photo,%20taken%20with%20kodak%20disposable%20camera%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bvintage:80%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%20%5Cn%20%20%20%20%20%20color%20=%20%5BphotoModifiers.color%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%201980s%20Photo%5Cn%20%20%20%20prompt%20=%20famous%20vintage%2080s%20photo,%20%5Binput.description%5D,%20grainy%20photograph,%2080s%20photo%20with%20film%20grain,%20Kodacolor%20II%2080s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%2080s%20photo%20with%20wear%20and%20tear%20and%20minor%20creasing%20and%20scratches,%20vintage%20color%20photo%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:30,%20vintage:90,%20portrait:72%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%201970s%20Photo%5Cn%20%20%20%20prompt%20=%20famous%20vintage%2070s%20photo,%20%5Binput.description%5D,%20grainy%20photograph,%201970s%20photo%20with%20film%20grain,%2070s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%2070s%20photo,%20vintage%20photo%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:30,%20vintage:80%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%201960s%20Photo%5Cn%20%20%20%20prompt%20=%20famous%20vintage%2060s%20photo,%20%5Binput.description%5D,%20grainy%20photograph,%201960s%20photo%20with%20film%20grain,%2060s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%2060s%20photo,%20vintage%20photo%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:30,%20vintage:80%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%201950s%20Photo%5Cn%20%20%20%20prompt%20=%20famous%20vintage%2050s%20photo,%20%5Binput.description%5D,%20grainy%20photograph,%201950s%20photo%20with%20film%20grain,%201950s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%201950s%20photo,%20vintage%20photo%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:30,%20vintage:80%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%201940s%20Photo%5Cn%20%20%20%20prompt%20=%20famous%20vintage%201940s%20photo,%20%5Binput.description%5D,%20grainy%20photograph,%201940s%20photo%20with%20film%20grain,%201940s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%201940s%20photo,%20vintage%20photo%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:30,%20vintage:80%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%201930s%20Photo%5Cn%20%20%20%20prompt%20=%20famous%20vintage%201930s%20photo,%20%5Binput.description%5D,%20grainy%20photograph,%201930s%20photo%20with%20film%20grain,%201930s%20photo%20with%20vignetting,%20retro,%20r/OldSchoolCool,%201930s%20photo,%20vintage%20photo%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:30,%20vintage:80%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%201920s%20Photo%5Cn%20%20%20%20prompt%20=%20famous%20vintage%201920s%20photo,%20%5Binput.description%5D,%201920s%20photo,%20restored%20photograph,%20%7Bsepia%7Cblack%20and%20white%7D,%20historical%20archive%20photo%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bphoto:30,%20vintage:80%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20shot%20=%20%5BphotoModifiers.shot%5D%5Cn%20%20%20%20%20%20effect%20=%20%5BphotoModifiers.effect%5D%5Cn%20%20Vintage%20Pulp%20Art%5Cn%20%20%20%20prompt%20=%201970s%20vintage%20pulp%20art,%20%5Binput.description%5D,%20vintage%20pulp%20art,%20by%20Earle%20K.%20Bergey,%20by%20Kelly%20Freas,%20by%20Alex%20Schomburg,%20by%20H.%20J.%20Ward,%20glossy%20pulp%20art,%20Amazing%20Stories,%20Weird%20Tales,%208k,%20high%20resolution,%20best%20quality%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:30,%20poster:30,%20coverArt:50,%20vintage:60,%20comic:40,%20cartoon:50%7D)%5D%5Cn%20%2050s%20Infomercial%20Anime%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%201950s%20infomercial%20style,%20delicate%20linework,%20paprika%20anime%20art%20style,%20chromatic%20aberration%20glow,%202d%20painted%20cel%20animation,%20soft%20focus,%202D%20pixiv%201950s%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpainting:30,%20anime:50,%20vintage:60,%20cartoon:50%7D)%5D%5Cn%20%203D%20Pokemon%5Cn%20%20%20%20prompt%20=%20An%20incredibly%20perfect%20high-quality%203D%20render%20of%20a%20pokemon%20creature,%20%5Binput.description%5D,%20%5Binput.pokemonType%20?%20input.pokemonType+%5C%22,%20%5C%22%20:%20%5C%22%5C%22%5D8k%20render,%20beautiful%20pokemon%20digital%20art,%20fakemon,%20pokemon%20creature,%20cryptid,%20fakemon,%20masterpiece,%20soft%20focus,%20best%20quality,%20high%20quality.%20Perfect%20soft%20lighting,%20beautiful%20composition.%20It's%20an%20impressive%20CGI%20image%20from%20the%20upcoming%20Pokemon%20Movie%20%5C%5C(2026%5C%5C).%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%203D-rendered%20Pokemon-inspired%20creature.%20It's%20an%20aesthetically%20pleasing%203D%20Pokemon-inspired%20piece%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpokemon:60%7D)%5D%5Cn%20%20Painted%20Pokemon%5Cn%20%20%20%20prompt%20=%20Beautiful,%20very%20high-quality%20painterly%20digital%20concept%20art,%20%5Binput.description%5D,%20%5Binput.pokemonType%20?%20input.pokemonType+%5C%22,%20%5C%22%20:%20%5C%22%5C%22%5D8k%20digital%20painting%20of%20a%20pokemon,%20amazing%20pokemon%20creature%20art%20by%20piperdraws,%20cryptid%20creations%20by%20Piper%20Thibodeau,%20by%20Naoki%20Saito%20and%20%7BTokiya%7CMitsuhiro%20Arita%7D,%20incredible%20composition.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20painterly%20Pokemon-inspired%20artwork.%20It's%20an%20aesthetically%20pleasing%20painterly%20Pokemon-inspired%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpokemon:50%7D)%5D%5Cn%20%202D%20Pokemon%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20%5Binput.pokemonType%20?%20input.pokemonType+%5C%22,%20%5C%22%20:%20%5C%22%5C%22%5Dpokemon%20creature%20concept,%20superb%20line%20art,%20beautiful%20colors%20and%20composition,%202D%20art%20style,%20beautiful%20pokemon%20digital%20art,%20fakemon,%20by%20Sowsow,%20pokemon%20creature,%20cryptid,%20fakemon,%20masterpiece,%20by%20Yuu%20Nishida,%204k.%20The%20Pok%C3%A9mon-like%20creature%20is%20centered%20within%20this%20anime-style%202D%20image.%20It's%20from%20the%20upcoming%20Pokemon%20Movie%20%5C%5C(2026%5C%5C)%20which%20has%20the%20classic%202D%20Pokemon%20art%20style.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%202D%20Pokemon-inspired%20artwork.%20It's%20an%20aesthetically%20pleasing%202D%20Pokemon-inspired%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%20Clean,%20perfect%20linework,%20impeccable%20clean%202D%20anime-inspired%20art%20style.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D,%20messy,%20garbled,%20confusing,%20incoherent,%20unclear%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bpokemon:70,%20drawing:50,%20cartoon:35%7D)%5D%5Cn%20%20Vintage%20Anime%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%201990s%20anime,%20vintage%20anime,%2090's%20anime%20style,%20by%20hajime%20sorayama,%20by%20greg%20tocchini,%20anime%20masterpiece,%20pixiv,%20akira-style%20art,%20akira%20anime%20art,%204k,%20high%20quality.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20vintage%20anime%20artwork.%20It's%20an%20aesthetically%20pleasing%20vintage%20anime%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:40,%20vintage:50,%20drawing:50%7D)%5D%5Cn%20%20Neon%20Vintage%20Anime%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20neon%20vintage%20anime%20style,%2090's%20anime%20style,%201990s%20anime,%20hajime%20sorayama,%20greg%20tocchini,%20neon%20vintage%20anime%20masterpiece,%20anime%20art,%204k,%20high%20quality.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20neon%20vintage%20anime%20artwork.%20It's%20an%20aesthetically%20pleasing%20neon%20vintage%20anime%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:30,%20vintage:50%7D)%5D%5Cn%20%20Manga%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20incredible%20hand-drawn%20manga,%20black%20and%20white,%20by%20Takehiko%20Inoue,%20by%20Katsuhiro%20Otomo%20and%20akira%20toriyama%20manga,%20hand-drawn%20art%20by%20rumiko%20takahashi%20and%20Inio%20Asano,%20Ken%20Akamatsu%20manga%20art.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20black%20and%20white%20manga-style%20artwork.%20It's%20an%20aesthetically%20pleasing%20black%20and%20white%20manga%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:40,%20drawing:50,%20manga:100,%20comic:20,%20cartoon:30%7D)%5D%5Cn%20%20Fantasy%20World%20Map%5Cn%20%20%20%20prompt%20=%20beautiful%20fantasy%20map%20of%20%5Binput.description%5D,%20beautiful%20fantasy%20map%20inspired%20by%20middle%20earth%20and%20azeroth%20and%20discworld%20and%20westeros%20and%20essos%20and%20the%20witcher%20world%20and%20tamriel%20and%20faer%C3%BBn%20and%20thedas,%204k,%20beautiful%20colors,%20crisp,%20high-resolution%20artistic%20map,%20topographic%203D%20terrain,%20artistic%20map.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20fantasy%20world%20map.%20It's%20an%20aesthetically%20pleasing%20fantasy%20world%20map%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bmap:90,%20fantasy:20%7D)%5D%5Cn%20%20Fantasy%20City%20Map%5Cn%20%20%20%20prompt%20=%20an%20aerial%20view%20of%20a%20city,%20TTRPG%20city%20map%20showing%20the%20full%20city,%20%5Binput.description%5D,%20fantasy%20art,%20by%20senior%20environment%20artist,%20beautiful%20fantasy%20map.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20fantasy%20city%20map.%20It's%20an%20aesthetically%20pleasing%20fantasy%20city%20map%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bmap:80,%20fantasy:20%7D)%5D%5Cn%20%20Old%20World%20Map%5Cn%20%20%20%20prompt%20=%20fantasy%20world%20map%20of%20%5Binput.description%5D,%20fantasy%20world%20map,%20highly%20detailed%20digital%20painting,%20fantasy%20art,%20map%20illustration,%208k.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20old%20world%20map.%20It's%20an%20aesthetically%20pleasing%20old%20world%20style%20map%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bmap:70,%20fantasy:20%7D)%5D%5Cn%20%203D%20Isometric%20Icon%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%203D%20isometric%20render%20of%20cute%20%5Binput.description%5D,%203D%20app%20icon,%20clean%20isometric%20design,%20beautiful%20design,%20soft%20gradient%20background,%20soft%20colors,%20centered,%203D%20blender%20render,%20masterpiece,%20best%20quality,%20high%20resolution,%208k%20octane%20render,%20beautiful%20color%20scheme,%20soft%20smooth%20lighting,%20physically%20based%20rendering,%20square%20image,%20high%20polycount%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bicon:90,%20emoji:86%7D)%5D%5Cn%20%20Flat%20Style%20Icon%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20creative%20icon,%20flat%20style%20icon,%20masterpiece,%20high%20resolution,%20crisp,%20beautiful%20composition%20and%20color%20choice,%20beautiful%20flat%20painted%20style,%20behance%20contest-winner,%20award%20winning%20icon%20illustration,%208k,%20best%20quality%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bicon:80%7D)%5D%5Cn%20%20Flat%20Style%20Logo%5Cn%20%20%20%20prompt%20=%20beautiful%20flat-style%20logo%20design%20depicting%20%5Binput.description%5D,%20creative%20flat-style%20logo%20design,%20trending%20on%20dribbble,%20featured%20on%20behance,%20portfolio%20piece,%20minimal%20flat%20design,%20breathtaking%20graphic%20design,%208k,%20high%20resolution%20vector%20logo,%20plain%20background,%20amazingly%20beautiful%20logo%20design,%20winner%20of%20best%20logo%20award%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bicon:80,%20logo:80%7D)%5D%5Cn%20%20Game%20Art%20Icon%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20a%20concept%20art%20icon%20for%20league%20of%20legends,%20a%20digital%20art%20logo,%20illustration,%20league%20of%20legends%20style%20icon,%20inspired%20by%20wlop%20style,%208k,%20dota%202%20style%20icon,%20fine%20details,%20sharp,%20very%20detailed%20icon,%20high%20resolution%20rpg%20ability/spell/item%20icon%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bicon:70%7D)%5D%5Cn%20%20Digital%20Painting%20Icon%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20app%20logo%20icon,%20digital%20art%20pictogram%20icon,%20trending%20on%20artstation,%20app%20icon%20by%20atey%20ghailan,%20app%20icon%20by%20greg%20rutkowski,%20app%20icon%20by%20greg%20tocchini,%20app%20icon%20by%20james%20gilleard,%208k,%20high%20resolution,%20best%20quality%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bicon:60%7D)%5D%5Cn%20%20Concept%20Art%20Icon%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20a%20concept%20art%20icon,%20a%20digital%20art%20logo,%20illustration,%20league%20of%20legends%20style%20concept%20art%20logo%20icon,%20inspired%20by%20wlop%20style,%208k,%20fine%20details,%20sharp,%20very%20detailed,%20high%20resolution%20logo%20icon%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bicon:50%7D)%5D%5Cn%20%20Cute%203D%20Icon%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20a%20cute%203D%20icon%20of%20%5Binput.description%5D,%20cartoon%203D%20icon,%20very%20cute%20shape,%20stylized%20octane%20render,%208k,%20masterpiece,%20soooo%20cute,%20beautiful%20cute%20perfection,%20beautiful%20soft%20lighting,%20soft%20colors,%20centered,%20high%20resolution,%20%5Binput.description%5D,%20soft%20gradient%20background%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bicon:40%7D)%5D%5Cn%20%20Cute%203D%20Icon%20%F0%9D%97%A6%F0%9D%97%B2%F0%9D%98%81%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20a%20set%20of%20lovely%20little%203D%20icons,%20cute%203D%20icons,%20very%20cute%20shapes,%20stylized%20octane%20render,%208k,%20masterpiece,%20soooo%20cute,%20beautiful%20cute%20perfection,%20beautiful%20soft%20lighting,%20soft%20colors,%20centered,%20high%20resolution,%20%5Binput.description%5D,%20cute%20icon%20set%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bicon:30%7D)%5D%5Cn%20%20Crayon%20Drawing%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20crayon%20drawing%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20Pencil%5Cn%20%20%20%20prompt%20=%20black%20and%20white%20pencil%20drawing,%20%5Binput.description%5D,%20black%20and%20white,%20breathtaking%20pencil%20illustration,%20highly%20detailed,%204k,%20textured%20paper,%20pencil%20texture,%20sketch%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bdrawing:45%7D)%5D%5Cn%20%20Tattoo%20Design%5Cn%20%20%20%20prompt%20=%20amazing%20tattoo%20design,%20%5Binput.description%5D,%20breathtaking%20tattoo%20design,%20incredible%20tattoo%20design%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Btattoo:100%7D)%5D%5Cn%20%20Waifu%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20waifu%20character%20portrait,%201girl,%20very%20high%20resolution,%20semi-realistic%20anime%20art.%20Intricate%20and%20impressive%20anime%20artwork%20with%20stunningly%20beautiful%20composition%20and%20style.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20anime%20artwork.%20It's%20an%20aesthetically%20pleasing%20waifu%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%20It's%20an%20aesthetically%20pleasing%20character%20portrait.%20It's%20an%20aesthetically%20pleasing%20image.%20It's%20an%20aesthetically%20pleasing%20image.%20It's%20an%20aesthetically%20pleasing%20image.%20It's%20an%20aesthetically%20pleasing%20image.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Banime:40,%20waifu:100,%20cartoon:20%7D)%5D%5Cn%20%20%20%20modifiers%20=%20%5BanimeModifiers%5D%5Cn%20%20YuGiOh%20Art%5Cn%20%20%20%20prompt%20=%20yugioh%20card%20art%20for%20%5Binput.description%5D,%20art%20by%20genzoman,%20by%20Akina%20Fujiwara,%20by%20rossdraws,%20yugioh%20monster,%20close%20up,%20painterly%20details,%20breathtaking%20art,%20centered,%20masterpiece,%20amazing%20composition,%20%5Binput.description.length%20%3C%2030%20?%20input.description%20:%20%5C%22%5C%22%5D.%5C%5Cn%5C%5CnOverall,%20it's%20an%20absolute%20world-class%20masterpiece%20%5C%22Yu-Gi-Oh!%5C%22-inspired%20artwork.%20It's%20an%20aesthetically%20pleasing%20Yu-Gi-Oh%20inspired%20artwork%20with%20impeccable%20attention%20to%20detail%20and%20impressive%20composition.%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Byugioh:100%7D)%5D%5Cn%20%20Traditional%20Japanese%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20in%20ukiyo-e%20art%20style,%20traditional%20japanese%20masterpiece%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bjapanese:100,%20vintage:50,%20cartoon:30%7D)%5D%5Cn%20%20Nihonga%20Painting%5Cn%20%20%20%20prompt%20=%20japanese%20nihonga%20painting%20about%20%5Binput.description%5D,%20Nihonga,%20ancient%20japanese%20painting,%20intricate,%20detailed%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bjapanese:95,%20vintage:55,%20comic:70%7D)%5D%5Cn%20%20Claymation%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20claymation,%20incredible%20claymation%20style,%20kubo%20and%20the%20two%20strings%20style%20art,%20Missing%20Link%202019%20art%20style,%20clay%20texture,%20clay%20animation,%20stop-motion%20clay%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bclaymation:100%7D)%5D%5Cn%20%20Cartoon%5Cn%20%20%20%20prompt%20=%20%5Binput.description%5D,%20cartoon-style%20art,%20superb%20linework,%20nice%20colors%20and%20composition,%20bold%20linework,%20masterpiece,%20cute%20art%20by%20Dana%20Terrace,%20by%20Rebecca%20Sugar,%20by%20ry-spirit,%20amazing%20and%20wholesome%20cartoon-style%20art,%20cute%20art%20style,%20(trending%20on%20artstation)%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bcartoon:95,%20basicCartoon:100%7D)%5D%5Cn%20%20Cursed%20Photo%5Cn%20%20%20%20prompt%20=%20cursed%20photo%20of%20%5Binput.description%5D,%20creepy%20and%20cursed,%20absolutely%20cursed%20photo,%20nope%20nope%20nope%20nope,%20what%20the%20actual%20f,%20unsettling%20photo,%20cursed_thing,%20cursedimages,%20no%20context,%20cursed%20image,%20bad%20photo,%20weird%20photo,%20very%20strange,%20color%20photo,%20creepy%20photo,%20nightmare%20fuel%5Cn%20%20%20%20negative%20=%20%5Binput.negative%5D%5Cn%20%20%20%20meta:tags%20=%20%5B(%7Bcreepy:100%7D)%5D%5Cn%20%20%20%20modifiers%5Cn%20%20%20%20%20%20modifier%5Cn%20%20%20%20%20%20%20%20found%20footage%20=%20,%20found%20footage%5Cn%20%20%20%20%20%20%20%20cult%20=%20,%20photo%20from%20a%20real%20cult%5Cn%20%20%20%20%20%20%20%201920s%20=%20,%201920s%20photo%5Cn%20%20%20%20%20%20%20%20old%20phone%20=%20,%20old%20cell%20phone%20photo%5Cn%20%20%20%20%20%20%20%20VHS%20=%20,%20old%20VHS%20footage%5Cn%20%20%20%20%20%20%20%20CCTV%20=%20,%20old%20CCTV%20footage,%20high-angle%20CCTV%20image%5Cn%20%20%20%20%20%20%20%20trypophobia%20=%20,%20trypophobia%5Cn%20%20%20%20%20%20%20%20backrooms%20=%20,%20backrooms%5Cn%20%20%20%20%20%20%20%20black%20&%20white%20=%20,%20black%20&%20white%5Cn%20%20%20%20%20%20%20%20grainy%20=%20,%20grainy,%20noisy%20static%20effect%5Cn%20%20%20%20%20%20%20%20extreme%20close-up%20=%20,%20extreme%20close-up%5Cn%20%20%20%20%20%20%20%20low-angle%20=%20,%20low-angle%20shot%5Cn%20%20%20%20%20%20%20%20dramatic%20=%20,%20dramatic%20angle,%20extreme%20angle%20shot%5Cn%5Cn%5Cn%5Cn%5CnphotoModifiers%5Cn%20%20shot%5Cn%20%20%20%20extreme%20close-up%20=%20,%20extreme%20close-up%5Cn%20%20%20%20low-angle%20=%20,%20low-angle%20shot%5Cn%20%20%20%20high-angle%20=%20,%20high-angle%20shot%5Cn%20%20%20%20aerial%20=%20,%20aerial%20shot%5Cn%20%20%20%20close-up%20=%20,%20close-up%20shot%5Cn%20%20%20%20portrait%20=%20,%20close-up%20portrait%5Cn%20%20%20%20macro%20=%20,%20macro%20shot%5Cn%20%20%20%20wide-angle%20=%20,%20wide-angle%20shot%5Cn%20%20%20%20establishing%20=%20,%20establishing%20shot%5Cn%20%20%20%20over-the-shoulder%20=%20,%20over-the-shoulder%20shot%5Cn%20%20%20%20telephoto%20=%20,%20telephoto%20shot%5Cn%20%20%20%20handheld%20=%20,%20handheld%20shot%5Cn%20%20%20%20panoramic%20=%20,%20panoramic%20shot%5Cn%20%20%20%20dramatic%20=%20,%20dramatic%20angle,%20extreme%20angle%20shot%5Cn%20%20color%5Cn%20%20%20%20vibrant%20=%20,%20vibrant%20color%20grading%5Cn%20%20%20%20warm%20=%20,%20warm%20color%20grading%5Cn%20%20%20%20cool%20=%20,%20cool-toned%20color%20grading%5Cn%20%20%20%20pastel%20=%20,%20pastel%20color%20grading%5Cn%20%20%20%20bright%20=%20,%20bright%20color%20grading%5Cn%20%20%20%20muted%20=%20,%20muted%20color%20grading%5Cn%20%20%20%20neon%20=%20,%20neon%20color%20grading%5Cn%20%20%20%20duotone%20=%20,%20duotone%20color%20grading%5Cn%20%20%20%20monochrome%20=%20,%20monochrome%5Cn%20%20%20%20sterile%20=%20,%20cool-toned%20sterile%20colors%5Cn%20%20effect%5Cn%20%20%20%20bokeh%20=%20,%20bokeh%5Cn%20%20%20%20tilt-shift%20=%20,%20tilt-shift%20effect%5Cn%20%20%20%20soft%20focus%20=%20,%20soft%20focus%5Cn%20%20%20%20background%20blur%20=%20,%20shallow%20depth%20of%20field%5Cn%20%20%20%20chromatic%20aberrations%20=%20,%20chromatic%20aberrations%5Cn%20%20%20%20light%20leaks%20=%20,%20light%20leaks%5Cn%20%20%20%20rear%20projection%20=%20,%20rear%20projection%5Cn%20%20%20%20lens%20flare%20=%20,%20lens%20flare%5Cn%20%20%20%20long%20exposure%20=%20,%20long%20exposure%5Cn%20%20%20%20golden%20hour%20=%20,%20golden%20hour%5Cn%20%20%20%20silhouette%20=%20,%20silhouette%5Cn%5CnanimeModifiers%5Cn%20%20style%5Cn%20%20%20%20Ghibli%20=%20,%20Ghibli%20art%20style,%20Spirited%20Away%20art%20style%5Cn%20%20%20%20Your%20Name%20=%20,%20Your%20Name%20art%20style%5Cn%20%20%20%20Paprika%20=%20,%20Paprika%20art%20style%5Cn%20%20%20%20My%20Hero%20Academia%20=%20,%20My%20Hero%20Academia%20art%20style%5Cn%20%20%20%20Hunter%20x%20Hunter%20=%20,%20Hunter%20x%20Hunter%20art%20style%5Cn%20%20%20%20Attack%20on%20Titan%20=%20,%20Attack%20on%20Titan%20art%20style%5Cn%20%20effect%5Cn%20%20%20%20multi-view%20=%20,%20multiple%20views%5Cn%20%20%20%20toon%20=%20,%20cartoon-style%20bold%20line%20work,%20vibrant%20colors,%20cel%20shading%5Cn%20%20%20%20vintage%20=%20,%20cel%20shading,%20vintage%20anime%5Cn%20%20%20%20ethereal%20=%20,%20glow,%20god%20rays,%20ethereal,%20dreamy,%20heavenly,%20otherworldly,%20dream-like,%20breathtaking,%20captivating,%20divine%5Cn%20%20%20%20outline%20=%20,%20outline,%20white%20outline%5Cn%20%20%20%20%5CnfurryModifiers%5Cn%20%20effect%5Cn%20%20%20%20humanoid%20face%20=%20,%20human%20face,%20not%20furry%5Cn%20%20%20%20multi-view%20=%20,%20multiple%20views%5Cn%20%20%20%20toon%20=%20,%20cartoon-style%20bold%20line%20work,%20vibrant%20colors,%20cel%20shading%5Cn%20%20%20%20vintage%20=%20,%20cel%20shading,%20vintage%20anime%5Cn%20%20%20%20ethereal%20=%20,%20glow,%20god%20rays,%20ethereal,%20dreamy,%20heavenly,%20otherworldly,%20dream-like,%20breathtaking,%20captivating,%20divine%5Cn%20%20%20%20outline%20=%20,%20outline,%20white%20outline%5Cn%20%20%5CnlandscapeModifiers%5Cn%20%20shot%5Cn%20%20%20%20aerial%20=%20,%20aerial%20view%5Cn%20%20%20%20low-angle%20=%20,%20low-angle%20view%5Cn%20%20%20%20high-angle%20=%20,%20high-angle%20view%5Cn%20%20%20%20wide-angle%20=%20,%20wide-angle%20view%5Cn%20%20color%5Cn%20%20%20%20vibrant%20=%20,%20vibrant%20color%20tones%5Cn%20%20%20%20warm%20=%20,%20warm-toned%20colors%5Cn%20%20%20%20cool%20=%20,%20cool-toned%20colors%5Cn%20%20%20%20pastel%20=%20,%20pastel%20tones%5Cn%20%20%20%20muted%20=%20,%20muted%20color%20grading%5Cn%20%20%20%20sunset%20=%20,%20sunset%20color%20tones%5Cn%20%20%20%20monochrome%20=%20,%20monochrome%5Cn%20%20effect%5Cn%20%20%20%20tilt-shift%20=%20,%20tilt-shift%20effect%5Cn%20%20%20%20golden%20hour%20=%20,%20golden%20hour%5Cn%20%20%20%20mist%20=%20,%20misty%5Cn%20%20%20%20reflection%20=%20,%20water%20reflection%5Cn%20%20%20%20sun%20flare%20=%20,%20sun%20flare%5Cn%20%20%20%20starburst%20=%20,%20starburst%20effect%5Cn%20%20%20%20light%20trails%20=%20,%20light%20trails%5Cn%20%20%20%20long%20exposure%20=%20,%20long%20exposure%5Cn%20%20%20%20soft%20focus%20=%20,%20soft%20focus%5Cn%20%20%22,%22imports%22:%5B%5D,%22lastEditTime%22:1750513783758,%22found%22:true%7D,%7B%22name%22:%22tabbed-comments-plugin-v1%22,%22modelText%22:%22commentsPlugin%20=%20%7Bimport:comments-plugin%7D%5CngenerateText%20=%20%7Bimport:ai-text-plugin%7D%5CndefaultCustomEmojis%20=%20%7Bimport:huge-emoji-list%7D%5Cn%5Cn//%20See%20exampleOptions%20below%20for%20an%20example%20of%20these%20options:%5Cn//%20%20%20channels:%20(A%20list%20of%20channel%20names,%20optionally%20with%20the%20comment%20options%20under%20each%20channel%20name)%5Cn//%20%20%20allowBots:%20true/false%20(Default%20is%20true,%20except%20on%20default%20channel%20and%20'general'%20channel.%20You%20can%20also%20disable/enable%20bots%20on%20a%20per-channel%20basis%20by%20setting%20allowBots%20to%20true/false%20under%20the%20channel%20name.)%5Cn//%20%20%20defaultCommentsOptions:%20(See%20perchance.org/comments-plugin%20for%20all%20options)%5Cn//%20%20%20fillHeight:%20true/value%20(By%20default%20its%20height%20is%20based%20on%20the%20screen%20height.%20set%20this%20option%20to%20true%20to%20make%20it%20expand%20to%20full%20height%20of%20its%20container)%5Cn%5CnexampleOptions%5Cn%20%20defaultCommentsOptions%20//%20see%20perchance.org/comments-plugin%20for%20all%20available%20options%5Cn%20%20%20%20adminFlair%20=%20%F0%9F%92%8EOWNER%F0%9F%92%8E%20//%20this%20option%20will%20get%20applied%20to%20*all*%20channels%20below.%5Cn%20%20channels%20%5Cn%20%20%20%20general%5Cn%20%20%20%20%20%20label%20=%20General%5Cn%20%20%20%20chat1%20//%20i've%20set%20messageBubbleStyle%20here%20to%20give%20an%20example%20showing%20that%20each%20channel%20can%20have%20any%20of%20the%20channel%20options%20that%20are%20explained%20in%20perchance.org/comments-plugin%5Cn%20%20%20%20%20%20label%20=%20Room%201%5Cn%20%20%20%20%20%20messageBubbleStyle%20=%20background:pink;%20border:2px%20dotted%20red;%20color:black;%5Cn%20%20%20%20chat2%5Cn%20%20%20%20%20%20label%20=%20Room%202%5Cn%20%20%20%20%20%20allowBots%20=%20false%20//%20disallows%20'speak%20via%20character'%20for%20this%20channel%5Cn%20%20%20%20test3%5Cn%20%20%20%20test4%5Cn%5Cn%5Cn%5Cn%5Cn%5Cn%5Cn%5Cn%5CntabbedCommentsPlugin%20=%20%5B$output%5D%5Cn%5Cn$output(opts)%20=%3E%5Cn%20%20let%20commentsChannels%20=%20opts.channels;%5Cn%20%20let%20defaultChannelOptions%20=%20opts.defaultChannelOptions%20%7C%7C%20%7B%7D;%5Cn%20%20let%20outerCtn%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%5Cn%20%20let%20globalFnsId%20=%20%5C%22a%5C%22+Math.random().toString(16).slice(2);%5Cn%20%20%5Cn%20%20let%20minHeight%20=%20defaultChannelOptions.height;%5Cn%20%20if(!minHeight)%20minHeight%20=%20300;%5Cn%20%20if(typeof%20minHeight%20===%20%5C%22number%5C%22)%20minHeight%20+=%20%5C%22px%5C%22;%5Cn%20%20%5Cn%20%20%5Cn%20%20outerCtn.className%20=%20%5C%22tabbed-comments-plugin-outer-ctn%5C%22;%5Cn%20%20outerCtn.style.cssText%20=%20%60text-align:center;%20$%7Bopts.fillHeight%20?%20%5C%22height:100%25;%5C%22%20:%20%5C%22%5C%22%7D;%20container-type:inline-size;%60;%5Cn%20%20outerCtn.innerHTML%20=%20%60%3Cdiv%20style=%5C%22display:flex;%20justify-content:center;%20align-items:center;%20$%7Bopts.fillHeight%20?%20%5C%22height:100%25;%5C%22%20:%20%5C%22%5C%22%7D%5C%22%3E%5Cn%20%20%20%20%3Cdiv%20class=%5C%22tabbed-comments-ctn-left%20tabbed-comments-plugin-ctn%5C%22%20style=%5C%22height:min(70vh,%20600px);%20min-height:$%7BminHeight%7D;%20justify-content:center;%20align-items:center;%20flex-grow:1;%20min-width:%200;%20$%7Bopts.fillHeight%20?%20%5C%22height:100%25;max-height:100%25;min-height:100%25;%5C%22%20:%20%5C%22%5C%22%7D%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%3Cdiv%20class=%5C%22tabbed-comments-ctn-middle%20tabbed-comments-plugin-ctn%5C%22%20style=%5C%22height:min(70vh,%20600px);%20min-height:$%7BminHeight%7D;%20width:100%25;%20max-width:min(800px,%20100vw);%20flex-grow:%201;%20min-width:%200;%20$%7Bopts.fillHeight%20?%20%5C%22height:100%25;max-height:100%25;min-height:100%25;%5C%22%20:%20%5C%22%5C%22%7D%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%3Cdiv%20class=%5C%22tabbed-comments-ctn-right%20tabbed-comments-plugin-ctn%5C%22%20style=%5C%22height:min(70vh,%20600px);%20min-height:$%7BminHeight%7D;%20justify-content:center;%20align-items:center;%20flex-grow:1;%20min-width:%200;%20$%7Bopts.fillHeight%20?%20%5C%22height:100%25;max-height:100%25;min-height:100%25;%5C%22%20:%20%5C%22%5C%22%7D%5C%22%3E%3C/div%3E%5Cn%20%20%3C/div%3E%5Cn%20%20%3Cbutton%20onclick=%5C%22this.closest('.tabbed-comments-plugin-outer-ctn').querySelector('.tabbed-comments-auto-comment-ctn').style.display='flex';%20this.style.display='none';%5C%22%20class=%5C%22tabbed-comments-show-auto-comment-area-btn%5C%22%20style=%5C%22font-size:80%25;%20margin-top:0.75rem;%5C%22%3E%F0%9F%A7%9D%20speak%20via%20character%3C/button%3E%5Cn%20%20%3Cdiv%20class=%5C%22tabbed-comments-auto-comment-ctn%5C%22%20style=%5C%22display:none;%20flex-direction:column;%20border:1px%20solid%20grey;%20border-radius:2px;%20width:400px;%20max-width:98%25;%20margin:0%20auto;%20margin-top:1.5rem;%5C%22%3E%5Cn%20%20%20%20%3Cdiv%20style=%5C%22display:%20flex;%20align-items:%20center;%20justify-content:%20center;%20padding:0.25rem;%20width:100%25;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20style=%5C%22%20display:%20flex;%20align-items:%20center;%20justify-content:%20center;%20flex-direction:%20column;%20gap:0.25rem;%20width:100%25;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%20gap:0.25rem;%20width:100%25;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbutton%20class=%5C%22tabbed-comments-auto-comment-char-btn%5C%22%20onclick=%5C%22window.__$%7BglobalFnsId%7D_tabbedCommentsPluginAutoComment(%7Bname:this.closest('.tabbed-comments-plugin-outer-ctn').querySelector('.tabbed-comments-auto-comment-char-name').value,%20description:this.closest('.tabbed-comments-plugin-outer-ctn').querySelector('.tabbed-comments-auto-comment-char-description').value%7D)%5C%22%20style=%5C%22flex-grow:1;%20min-width:max-content;%5C%22%3E%F0%9F%A7%9D%20write%20as%20character%3C/button%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cselect%20class=%5C%22tabbed-comments-auto-comment-char-select%5C%22%20onchange=%5C%22window.__$%7BglobalFnsId%7D_tabbedCommentsPluginSwitchToAutoCommentCharByIndex(this.value)%5C%22%20style=%5C%22max-width:90px;%5C%22%3E%3C/select%3E%5Cn%20%20%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%20%20%20%20%3Cinput%20class=%5C%22tabbed-comments-auto-comment-char-name%5C%22%20oninput=%5C%22window.__$%7BglobalFnsId%7D_tabbedCommentsPluginSaveAutoCommentCharInfo()%5C%22%20placeholder=%5C%22Character%20name...%5C%22%20style=%5C%22width:100%25;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%3Ctextarea%20class=%5C%22tabbed-comments-auto-comment-char-description%5C%22%20oninput=%5C%22window.__$%7BglobalFnsId%7D_tabbedCommentsPluginSaveAutoCommentCharInfo()%5C%22%20placeholder=%5C%22Character%20description...%5C%22%20style=%5C%22width:100%25;%20height:100px;%20z-index:5;%5C%22%3E%3C/textarea%3E%5Cn%20%20%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%20%20%3Cdiv%20style=%5C%22display:flex;%20justify-content:center;%20align-items:center;%20border-top:1px%20solid%20grey;%20padding:0.25rem;%5C%22%3E%5Cn%20%20%20%20%20%20%3Cinput%20class=%5C%22tabbed-comments-auto-comment-auto-send-checkbox%5C%22%20onchange=%5C%22localStorage.__tabbedCommentsAutoCommentAutoSendCheckboxValue=this.checked?'1':'';%20%5C%22%20style=%5C%22cursor:pointer;%5C%22%20type=%5C%22checkbox%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20onclick=%5C%22this.closest('.tabbed-comments-plugin-outer-ctn').querySelector('.tabbed-comments-auto-comment-auto-send-checkbox').click()%5C%22%20style=%5C%22margin-left:0.25rem;%20cursor:pointer;%20user-select:none;%5C%22%3Eauto-send?%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%20%20%3C/div%3E%60;%5Cn%20%20%5Cn%20%20let%20rightCtn%20=%20outerCtn.querySelector('.tabbed-comments-ctn-right');%5Cn%20%20let%20middleCtn%20=%20outerCtn.querySelector('.tabbed-comments-ctn-middle');%5Cn%20%20let%20leftCtn%20=%20outerCtn.querySelector('.tabbed-comments-ctn-left');%5Cn%20%20%5Cn%20%20let%20showAutoCommentAreaBtn%20=%20outerCtn.querySelector('.tabbed-comments-show-auto-comment-area-btn');%5Cn%20%20let%20autoCommentCtn%20=%20outerCtn.querySelector('.tabbed-comments-auto-comment-ctn');%5Cn%20%20let%20autoCommentCharBtn%20=%20outerCtn.querySelector('.tabbed-comments-auto-comment-char-btn');%5Cn%20%20let%20autoCommentCharSelectEl%20=%20outerCtn.querySelector('.tabbed-comments-auto-comment-char-select');%5Cn%20%20let%20autoCommentCharNameEl%20=%20outerCtn.querySelector('.tabbed-comments-auto-comment-char-name');%5Cn%20%20let%20autoCommentCharNameDescriptionEl%20=%20outerCtn.querySelector('.tabbed-comments-auto-comment-char-description');%5Cn%20%20let%20autoCommentAutoSendCheckboxEl%20=%20outerCtn.querySelector('.tabbed-comments-auto-comment-auto-send-checkbox');%5Cn%20%20%5Cn%20%20let%20middleCtnCurrentlyShownCommentsChannelName;%5Cn%20%20%5Cn%20%20let%20sidePanelObjs%20=%20new%20Set();%5Cn%20%20let%20middlePanelObj;%5Cn%20%20let%20middleCtnChannelNameToObj%20=%20%7B%7D;%5Cn%20%20%5Cn%20%20function%20updateColorScheme()%20%7B%5Cn%20%20%20%20let%20systemColorScheme%20=%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches%20?%20%5C%22dark%5C%22%20:%20%5C%22light%5C%22;%5Cn%20%20%20%20if(localStorage.forceColorScheme%20===%20%5C%22dark%5C%22%20%7C%7C%20(!localStorage.forceColorScheme%20&&%20systemColorScheme%20===%20%5C%22dark%5C%22))%20%7B%5Cn%20%20%20%20%20%20outerCtn.style.setProperty('--tabbed-comments-plugin-text-color',%20'#efefef');%5Cn%20%20%20%20%20%20outerCtn.style.setProperty('--tabbed-comments-plugin-box-color',%20'#2a2a2a');%5Cn%20%20%20%20%20%20outerCtn.style.setProperty('--tabbed-comments-plugin-active-comment-channel-tab-color',%20'#3f3f3f');%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20outerCtn.style.setProperty('--tabbed-comments-plugin-text-color',%20'#222');%5Cn%20%20%20%20%20%20outerCtn.style.setProperty('--tabbed-comments-plugin-box-color',%20'#ebebeb');%5Cn%20%20%20%20%20%20outerCtn.style.setProperty('--tabbed-comments-plugin-active-comment-channel-tab-color',%20'#c6c6c6');%5Cn%20%20%20%20%7D%5Cn%20%20%20%20outerCtn.querySelectorAll(%5C%22%5Bdata-tabbed-comments-direct-parent-of-comments-plugin-putput='1'%5D%5C%22).forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20commentOptions%20=%20el.__commentOptionsUsed;%5Cn%20%20%20%20%20%20commentOptions.forceColorScheme%20=%20defaultChannelOptions.forceColorScheme%20??%20localStorage.forceColorScheme%20??%20null%5Cn%20%20%20%20%20%20el.innerHTML%20=%20commentsPlugin(commentOptions);%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%20%20updateColorScheme();%5Cn%20%20%5Cn%20%20let%20colorSchemeMediaQuery%20=%20window.matchMedia(%5C%22(prefers-color-scheme:%20dark)%5C%22);%20%5Cn%20%20colorSchemeMediaQuery.addEventListener(%5C%22change%5C%22,%20updateColorScheme);%5Cn%20%20%5Cn%20%20let%20localStorageChangeHandler%20=%20function(e)%20%7B%20%5Cn%20%20%20%20if(!document.body.contains(outerCtn))%20%7B%20//%20prevent%20memory%20leak%5Cn%20%20%20%20%20%20window.removeEventListener(%5C%22storage%5C%22,%20localStorageChangeHandler);%5Cn%20%20%20%20%20%20colorSchemeMediaQuery.removeEventListener(%5C%22change%5C%22,%20updateColorScheme);%5Cn%20%20%20%20%20%20return;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20if(e.key%20===%20%5C%22forceColorScheme%5C%22)%20%7B%5Cn%20%20%20%20%20%20updateColorScheme();%5Cn%20%20%20%20%7D%5Cn%20%20%7D;%5Cn%20%20window.addEventListener(%5C%22storage%5C%22,%20localStorageChangeHandler);%5Cn%20%20let%20storageListenerInterval%20=%20setInterval(()%20=%3E%20%7B%5Cn%20%20%20%20if(!document.body.contains(outerCtn))%20%7B%20//%20prevent%20memory%20leak%5Cn%20%20%20%20%20%20window.removeEventListener(%5C%22storage%5C%22,%20localStorageChangeHandler);%5Cn%20%20%20%20%20%20colorSchemeMediaQuery.removeEventListener(%5C%22change%5C%22,%20updateColorScheme);%5Cn%20%20%20%20%20%20clearInterval(storageListenerInterval);%5Cn%20%20%20%20%7D%5Cn%20%20%7D,%201000*30);%5Cn%20%20%5Cn%20%20function%20updateMiddleTabModuleWidth()%20%7B%5Cn%20%20%20%20if(leftCtn.querySelector(%5C%22.tabbed-comments-plugin-add-tabs-module-button%5C%22)%20&&%20rightCtn.querySelector(%5C%22.tabbed-comments-plugin-add-tabs-module-button%5C%22))%20%7B%5Cn%20%20%20%20%20%20//%20both%20side%20modules%20are%20closed,%20so%20prevent%20it%20from%20getting%20too%20big:%5Cn%20%20%20%20%20%20middleCtn.style.maxWidth%20=%20%5C%22min(800px,%20100vw)%5C%22;%5Cn%20%20%20%20%20%20leftCtn.style.width%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20middleCtn.style.width%20=%20%5C%22100%25%5C%22;%5Cn%20%20%20%20%20%20rightCtn.style.width%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20//%20at%20least%20one%20is%20open,%20so%20make%20them%20take%20up%20thirds%5Cn%20%20%20%20%20%20middleCtn.style.maxWidth%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20leftCtn.style.width%20=%20%5C%2233.3%25%5C%22;%5Cn%20%20%20%20%20%20middleCtn.style.width%20=%20%5C%2233.3%25%5C%22;%5Cn%20%20%20%20%20%20rightCtn.style.width%20=%20%5C%2233.3%25%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(!opts.fillHeight)%20%7B%5Cn%20%20%20%20%20%20if(leftCtn.querySelector(%5C%22.tabbed-comments-plugin-add-tabs-module-button%5C%22)%20%7C%7C%20rightCtn.querySelector(%5C%22.tabbed-comments-plugin-add-tabs-module-button%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20//%20at%20least%20one%20is%20closed,%20so%20restore%20normal%20height%5Cn%20%20%20%20%20%20%20%20middleCtn.style.minHeight%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20leftCtn.style.minHeight%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20rightCtn.style.minHeight%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20//%20both%20side%20panels%20are%20open,%20so%20make%20the%20whole%20section%20taller%5Cn%20%20%20%20%20%20%20%20middleCtn.style.minHeight%20=%20%5C%2290vh%5C%22;%5Cn%20%20%20%20%20%20%20%20leftCtn.style.minHeight%20=%20%5C%2290vh%5C%22;%5Cn%20%20%20%20%20%20%20%20rightCtn.style.minHeight%20=%20%5C%2290vh%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20function%20initSideButton(side)%20%7B%5Cn%20%20%20%20let%20buttonHtml%20=%20%60%3Cbutton%20class=%5C%22tabbed-comments-plugin-add-tabs-module-button%5C%22%20style=%5C%22margin-$%7Bside===%5C%22left%5C%22%20?%20%5C%22right%5C%22%20:%20%5C%22left%5C%22%7D:0.5rem;%20padding:1px%206px;%5C%22%3E+%3C/button%3E%60;%5Cn%20%20%20%20let%20ctn%20=%20outerCtn.querySelector(%5C%22.tabbed-comments-ctn-%5C%22+side);%5Cn%20%20%20%20ctn.innerHTML%20=%20buttonHtml;%5Cn%20%20%20%20ctn.querySelector(%5C%22button%5C%22).onclick%20=%20function()%20%7B%5Cn%20%20%20%20%20%20ctn.innerHTML%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20let%20obj%20=%20createTabbedCommentsPanel(%7B%5Cn%20%20%20%20%20%20%20%20addCloseButton:true,%5Cn%20%20%20%20%20%20%20%20onClose:%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20sidePanelObjs.delete(obj);%5Cn%20%20%20%20%20%20%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20initSideButton(side);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20updateMiddleTabModuleWidth();%5Cn%20%20%20%20%20%20%20%20%20%20%7D,%2010);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20ctn.appendChild(obj.element);%5Cn%20%20%20%20%20%20sidePanelObjs.add(obj);%5Cn%20%20%20%20%20%20updateMiddleTabModuleWidth();%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%20%20initSideButton(%5C%22left%5C%22);%5Cn%20%20initSideButton(%5C%22right%5C%22);%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20/////////////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20CHANNEL%20MENTIONS,%20SEEN/UNSEEN%20COUNTING,%20ETC.%20%20%20%20//%5Cn%20%20/////////////////////////////////////////////////////////%5Cn%20%20let%20unseenCommentCountByChannel%20=%20%7B%7D;%5Cn%20%20function%20updateUnseenCountHtml(channel)%20%7B%5Cn%20%20%20%20let%20count%20=%20unseenCommentCountByChannel%5Bchannel%5D;%5Cn%20%20%20%20for(let%20tabCtn%20of%20%5B...outerCtn.querySelectorAll(%5C%22.tabbed-comments-plugin-ctn%5C%22)%5D)%20%7B%5Cn%20%20%20%20%20%20let%20countEl%20=%20tabCtn.querySelector(%60.tabbed-comments-plugin-tab%5Bdata-channel='$%7Bchannel%7D'%5D%20.tabbed-comments-plugin-unseen-count%60);%5Cn%20%20%20%20%20%20if(countEl)%20%7B%20//%20since%20this%20tabCtn%20may%20not%20have%20that%20particular%20tab%5Cn%20%20%20%20%20%20%20%20countEl.textContent%20=%20count;%5Cn%20%20%20%20%20%20%20%20countEl.style.background%20=%20(count%20%3E%200)%20?%20%5C%22#ab0e0e%5C%22%20:%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20countEl.style.display%20=%20(count%20%3E%200)%20?%20%5C%22inline%5C%22%20:%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%5Cn%20%20let%20temporaryMentionedChannels%20=%20new%20Set();%5Cn%20%20let%20knownMessageIdsByChannel%20=%20%7B%7D;%5Cn%20%20let%20lastCurrentUserCommentTime%20=%20null;%5Cn%20%20function%20commentsPluginOnLoadHandler(comments)%20%7B%5Cn%20%20%20%20for(let%20comment%20of%20comments)%20%7B%5Cn%20%20%20%20%20%20processCommentForUnseenCounts(comment);%5Cn%20%20%20%20%20%20if(comment.byCurrentUser)%20%7B%5Cn%20%20%20%20%20%20%20%20lastCurrentUserCommentTime%20=%20Date.now();%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20if(comments%5B0%5D)%20unseenCommentCountByChannel%5Bcomments%5B0%5D.channel%5D%20=%200;%20//%20reset%20unseen%20count%20since%20above%20%60processCommentForUnseenCounts%60%20has%20incremented%20it%5Cn%20%20%20%20processCommentsForTempChannels(comments.slice(-30));%5Cn%20%20%7D%5Cn%20%20function%20commentsPluginOnCommentHandler(comment)%20%7B%5Cn%20%20%20%20processCommentForUnseenCounts(comment);%5Cn%20%20%20%20if(comment.byCurrentUser)%20%7B%5Cn%20%20%20%20%20%20lastCurrentUserCommentTime%20=%20Date.now();%5Cn%20%20%20%20%7D%5Cn%20%20%20%20processCommentsForTempChannels(%5Bcomment%5D);%5Cn%20%20%7D%5Cn%20%20function%20processCommentForUnseenCounts(comment)%20%7B%5Cn%20%20%20%20//%20console.log(%5C%22new%20comment:%5C%22,%20comment);%5Cn%20%20%20%20let%20channel%20=%20comment.channel;%5Cn%20%20%20%20//%20initialize%20if%20we%20haven't%20yet:%5Cn%20%20%20%20if(!knownMessageIdsByChannel%5Bcomment.channel%5D)%20knownMessageIdsByChannel%5Bchannel%5D%20=%20new%20Set();%5Cn%5Cn%20%20%20%20//%20increment%20the%20unseen%20count%20if%20we%20haven't%20seen%20this%20comment%20id%20before:%5Cn%20%20%20%20if(!knownMessageIdsByChannel%5Bchannel%5D.has(comment.id))%20%7B%5Cn%20%20%20%20%20%20knownMessageIdsByChannel%5Bchannel%5D.add(comment.id);%5Cn%20%20%20%20%20%20unseenCommentCountByChannel%5Bchannel%5D%20=%20(unseenCommentCountByChannel%5Bchannel%5D%20%7C%7C%200)%20+%201;%5Cn%5Cn%20%20%20%20%20%20let%20tabIsVisible%20=%20false;%20//%20check%20if%20it's%20visible%20in%20any%20of%20the%20tabbedCommentsCtn%20elements%5Cn%20%20%20%20%20%20for(let%20tabCtn%20of%20%5B...outerCtn.querySelectorAll(%5C%22.tabbed-comments-plugin-ctn%5C%22)%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20tabContentEl%20=%20tabCtn.querySelector(%60.tabbed-comments-plugin-content%5Bdata-channel='$%7Bchannel%7D'%5D%60);%5Cn%20%20%20%20%20%20%20%20if(tabContentEl%20&&%20tabContentEl.offsetHeight%20!==%200)%20tabIsVisible%20=%20true;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(tabIsVisible)%20%7B%20//%20set%20unseen%20count%20to%200%20if%20tab%20is%20visible%5Cn%20%20%20%20%20%20%20%20unseenCommentCountByChannel%5Bchannel%5D%20=%200;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20updateUnseenCountHtml(channel);%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20function%20attachEventsToTemporaryMentionedChannelTab(tabEl,%20channelName)%20%7B%5Cn%20%20%20%20tabEl.addEventListener(%5C%22click%5C%22,%20function()%20%7B%5Cn%20%20%20%20%20%20temporaryMentionedChannels.delete(channelName);%5Cn%20%20%20%20%20%20for(let%20t%20of%20%5B...outerCtn.querySelectorAll(%60.tabbed-comments-plugin-ctn%20.tabbed-comments-plugin-header%20.tabbed-comments-plugin-tab%5Bdata-channel='$%7BchannelName%7D'%5D%60)%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20t.dataset.tabbedCommentsPluginIsTemporaryMentionedChannel%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20window.addEventListener(%5C%22beforeunload%5C%22,%20function()%20%7B%5Cn%20%20%20%20%20%20if(tabEl.dataset.tabbedCommentsPluginIsTemporaryMentionedChannel)%20%7B%5Cn%20%20%20%20%20%20%20%20temporaryMentionedChannels.delete(channelName);%5Cn%20%20%20%20%20%20%20%20for(let%20obj%20of%20%5B...sidePanelObjs,%20middlePanelObj%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20obj.deleteCommentsChannel(channelName);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20//%20to%20rate%20limit%20mentions:%5Cn%20%20let%20userIdToMentionedChannelsInLast2Minutes%20=%20%7B%7D;%5Cn%20%20setInterval(()%20=%3E%20%7B%5Cn%20%20%20%20userIdToMentionedChannelsInLast2Minutes%20=%20%7B%7D;%5Cn%20%20%7D,%201000*60*2);%5Cn%5Cn%20%20function%20isValidFolderName(folderName)%20%7B%5Cn%20%20%20%20//%20examples%20of%20valid%20folder%20names:%5Cn%20%20%20%20//%20foo%5Cn%20%20%20%20//%20foo+channelname%5Cn%20%20%20%20//%20foo+channelname+u:username1%5Cn%20%20%20%20//%20foo+channelname+u:username1%7Cusername2%5Cn%5Cn%20%20%20%20let%20parts%20=%20folderName.split(%5C%22+%5C%22);%5Cn%20%20%20%20if(parts.length%20%3E%203)%20return%20false;%5Cn%20%20%20%20let%20name%20=%20parts%5B0%5D%20+%20(parts%5B1%5D%20?%20%60+$%7Bparts%5B1%5D%7D%60%20:%20%5C%22%5C%22);%5Cn%20%20%20%20let%20rules%20=%20parts%5B2%5D;%5Cn%20%20%20%20%5Cn%20%20%20%20let%20nameIsValid%20=%20name%20&&%20/%5E%5Ba-z0-9%5C%5C-+%5D+$/.test(name)%20&&%20name.split(%5C%22+%5C%22).length%20%3C=%202%20&&%20!name.endsWith(%5C%22+%5C%22);%5Cn%20%20%20%20let%20rulesIfAnyAreValid%20=%20true;%5Cn%20%20%20%20if(rules)%20rulesIfAnyAreValid%20=%20/%5Eu:%5Ba-z0-9%7C%5D+$/.test(rules)%20&&%20!/%5C%5C%7C%5C%5C%7C/.test(rules)%20&&%20!/:%5C%5C%7C/.test(rules)%20&&%20!rules.endsWith(%5C%22%7C%5C%22);%5Cn%20%20%20%20return%20nameIsValid%20&&%20rulesIfAnyAreValid;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20function%20processCommentsForTempChannels(comments)%20%7B%5Cn%20%20%20%20if(commentsChannels.allowCustomChannels%20===%20false)%20return;%5Cn%20%20%20%20for(let%20comment%20of%20comments)%20%7B%5Cn%20%20%20%20%20%20let%20mentionedChannelName%20=%20comment.message.match(/(%5C%5Cs%7C%5E)#%5Ba-z0-9%5C%5C-%5C%5C+%5C%5C%7C:%5D+(%5C%5Cs%7C$)/g)?.%5B0%5D;%5Cn%20%20%20%20%20%20if(mentionedChannelName%20&&%20!isValidFolderName(window.generatorName+%5C%22+%5C%22+mentionedChannelName.trim().replace(/%5E#/,%20%5C%22%5C%22).trim()))%20mentionedChannelName%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20if(mentionedChannelName%20&&%20!/%5E%5B0-9%5D+$/.test(mentionedChannelName))%20%7B%20//%20if%20it's%20all%20numbers,%20ignore%5Cn%20%20%20%20%20%20%20%20mentionedChannelName%20=%20mentionedChannelName.trim().replace(/%5E#/,%20%5C%22%5C%22).trim();%20//%20remove%20the%20hash%20from%20the%20start%20and%20whitespace%20from%20start/end%5Cn%20%20%20%20%20%20%20%20if(mentionedChannelName%20===%20%5C%22feedback%5C%22)%20continue;%5Cn%20%20%20%20%20%20%20%20if(!userIdToMentionedChannelsInLast2Minutes%5Bcomment.user.id%5D)%20userIdToMentionedChannelsInLast2Minutes%5Bcomment.user.id%5D%20=%20%5B%5D;%5Cn%20%20%20%20%20%20%20%20if(userIdToMentionedChannelsInLast2Minutes%5Bcomment.user.id%5D.length%20%3E=%2010)%20continue;%5Cn%20%20%20%20%20%20%20%20//%20add%20it%20as%20a%20temporary%20channel%20which%20self-deletes%20after%202%20minutes.%5Cn%20%20%20%20%20%20%20%20//%20it%20upgrades%20to%20a%20real%20one%20when%20clicked.%5Cn%20%20%20%20%20%20%20%20if(middlePanelObj)%20%7B%20//%20%3C--%20just%20in%20case%20somehow%20hasn't%20initialized%20yet,%20or%20whatever%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20//%20If%20they've%20got%20the%20tab%20*somewhere*%20(e.g.%20in%20side%20module),%20then%20we%20don't%20add%20it%20as%20a%20temporary%20channel.%5Cn%20%20%20%20%20%20%20%20%20%20let%20alreadyExistsSomewhere%20=%20!!outerCtn.querySelector(%60.tabbed-comments-plugin-ctn%20.tabbed-comments-plugin-header%20.tabbed-comments-plugin-tab%5Bdata-channel='$%7BmentionedChannelName%7D'%5D%60);%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20let%20%7B%20tab,%20alreadyExisted%20%7D%20=%20middlePanelObj.addCommentsChannel(mentionedChannelName);%5Cn%20%20%20%20%20%20%20%20%20%20userIdToMentionedChannelsInLast2Minutes%5Bcomment.user.id%5D.push(mentionedChannelName);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20if(!alreadyExisted%20&&%20!alreadyExistsSomewhere)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20temporaryMentionedChannels.add(mentionedChannelName);%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20newTabs%20=%20%5B%5D;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20newTabs.push(tab);%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%20//%20because%20it's%20new%20code%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20for(let%20obj%20of%20sidePanelObjs)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20%7B%20tab%20%7D%20=%20obj.addCommentsChannel(mentionedChannelName);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20newTabs.push(tab);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20catch(e)%20%7B%20console.error(e);%20%7D%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20for(let%20newTab%20of%20newTabs)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20newTab.dataset.tabbedCommentsPluginIsTemporaryMentionedChannel%20=%20%5C%221%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20attachEventsToTemporaryMentionedChannelTab(newTab,%20mentionedChannelName);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20//%20make%20its%20background%20blink%20for%20a%20couple%20of%20seconds:%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20blinkCount%20=%200;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20blinkInterval%20=%20setInterval(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20tab.style.background%20=%20blinkCount%252===0%20?%20%5C%22#043a9b%5C%22%20:%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20blinkCount++;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(blinkCount%20%3E%205)%20clearInterval(blinkInterval);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D,%20300);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20temporaryMentionedChannels.delete(mentionedChannelName);%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(document.body.contains(tab)%20&&%20tab.dataset.tabbedCommentsPluginIsTemporaryMentionedChannel)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for(let%20obj%20of%20%5B...sidePanelObjs,%20middlePanelObj%5D)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj.deleteCommentsChannel(mentionedChannelName);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D,%201000*40);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20/////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20%20%20%20%20BOT/AUTO-COMMENT%20STUFF%20%20%20%20%20%20%20%20%20%20//%5Cn%20%20/////////////////////////////////////////////%5Cn%20%20let%20autoCommentChars%20=%20%5B%5D;%5Cn%20%20if(localStorage.autoCommentChars)%20%7B%5Cn%20%20%20%20try%20%7B%20autoCommentChars%20=%20JSON.parse(localStorage.autoCommentChars);%20%7D%20catch(e)%20%7B%20alert(e);%20%7D%5Cn%20%20%20%20autoCommentChars%20=%20autoCommentChars.filter(c%20=%3E%20c%20&&%20c.name);%5Cn%20%20%7D%5Cn%20%20function%20getAutoCommentNameFromNickname(nickname)%20%7B%5Cn%20%20%20%20let%20nicknameWithoutNonNameCharacters%20=%20nickname.replace(/%5B%5C%5Cn%5C%5C-:%7C()!%7B%7D*%5D/g,%20%5C%22%5C%22).replace(/(?!%5B*#0-9%5D+)%5B%5C%5Cp%7BEmoji%7D%5C%5Cp%7BEmoji_Modifier%7D%5C%5Cp%7BEmoji_Component%7D%5C%5Cp%7BEmoji_Modifier_Base%7D%5C%5Cp%7BEmoji_Presentation%7D%5D/gu,%20'');%5Cn%20%20%20%20let%20words%20=%20nicknameWithoutNonNameCharacters.split(/%5B%7C/%20%5C%5C-%7D)%5D/g).map(w%20=%3E%20w.trim()).filter(w%20=%3E%20w);%5Cn%20%20%20%20while(words.slice(0,%20-1).join(%5C%22_%5C%22).length%20%3E%2025)%20words.pop();%20//%20we%20remove%20the%20last%20one%20for%20the%20length%20check%20in%20case%20it's%20a%20name%20like%20One%20Supercalifragilisticexpialidocious%20-%20better%20for%20userTag%20to%20be%20%5C%22OneSupercalif%5C%22%20than%20%5C%22One%5C%22%5Cn%20%20%20%20if(words.slice(0,%20-1).join(%5C%22_%5C%22).length%20%3E%2015)%20words.pop();%20//%20we%20probably%20don't%20need%20the%20last%20word%20if%20all%20the%20earlier%20ones%20are%20over%2015%20characters%5Cn%20%20%20%20let%20name%20=%20words.join(%5C%22_%5C%22).trim().toLowerCase();%5Cn%20%20%20%20return%20name%20+%20(nickname.length%20%3E%2025%20?%20%5C%22%E2%80%A6%5C%22%20:%20%5C%22%5C%22);%5Cn%20%20%7D%5Cn%20%20window%5B%60__$%7BglobalFnsId%7D_tabbedCommentsPluginAutoComment%60%5D%20=%20function(character)%20%7B%5Cn%20%20%20%20let%20commentsBox%20=%20middleCtnChannelNameToObj%5BmiddleCtnCurrentlyShownCommentsChannelName%5D;%5Cn%20%20%20%20if(commentsBox.channel%20===%20%5C%22n/o/-/a/i%5C%22.replaceAll(%5C%22/%5C%22,%20%5C%22%5C%22))%20return;%5Cn%5Cn%20%20%20%20let%20startTime%20=%20Date.now();%5Cn%20%20%20%20autoCommentCharBtn.disabled%20=%20true;%5Cn%20%20%20%20autoCommentCharBtn.textContent%20=%20%5C%22%E2%8F%B3%20just%20a%20sec...%5C%22;%5Cn%5Cn%20%20%20%20let%20currentUser%20=%20commentsBox.comments.find(c%20=%3E%20c.byCurrentUser)?.user;%5Cn%20%20%20%20let%20comments%20=%20commentsBox.comments.slice(-500).map(c%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20userTag%20=%20c.user.visualId.toUpperCase();%5Cn%20%20%20%20%20%20if(c.user.nickname)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20name%20=%20getAutoCommentNameFromNickname(c.user.nickname);%5Cn%20%20%20%20%20%20%20%20if(name)%20userTag%20=%20%60$%7Bc.user.visualId.toUpperCase()%7D($%7Bname%7D)%60%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20return%20%60$%7BuserTag%7D:%20$%7Bc.message.trim().replace(/%5C%5Cn%7B3,%7D/g,%20%5C%22%5C%5Cn%5C%5Cn%5C%22)%7D%60;%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20while(comments.join(%5C%22%5C%22).length%20%3E%2010000)%20comments.shift();%5Cn%5Cn%20%20%20%20let%20nicknameOverride%20=%20character.name.replace(/%5C%5Cs+/g,%20%5C%22%20%5C%22).slice(0,%2050);%5Cn%20%20%20%20let%20currentUserVisualId%20=%20currentUser%20?%20currentUser.visualId.toUpperCase()%20:%20%5C%22U7OP%5C%22;%20//%20just%20use%20a%20random/arbitrary%20tag%20if%20we%20don't%20have%20the%20user's%20actual%20one%20(we'll%20get%20it%20once%20they've%20made%20their%20first%20comment)%5Cn%20%20%20%20let%20respondingUserTag%20=%20%60$%7BcurrentUserVisualId%7D($%7Bcharacter.name%7D)%60;%5Cn%20%20%20%20let%20characterDescription%20=%20character.description.replace(/%5C%5Cn/g,%20%5C%22%20%5C%22).slice(0,%205000);%5Cn%5Cn%20%20%20%20let%20newCommentText%20=%20%5C%22%5C%22;%20//commentsBox.inputText.trim().replace(/%5C%5Cn/g,%20%5C%22%20%5C%22).split(%5C%22%20%5C%22).slice(0,%203);%5Cn%20%20%20%20let%20obj%20=%20generateText(%7B%20//%20NOTE:%20perchance%20removes%20all%20leading%20spaces%20from%20lines,%20so%20we%20don't%20need%20to%20dedent%20the%20lines%20below%5Cn%20%20%20%20%20%20instruction:%20%60%5Cn%20%20%20%20%20%20Your%20task%20is%20to%20write%20the%20next%205%20messages%20in%20the%20following%20chat/roleplay.%20Keep%20it%20interesting.%20Stay%20in%20character%20based%20on%20the%20previous%20messages.%20You%20are%20**NOT**%20an%20AI.%20You%20are%20writing%20as%20a%20regular%20chat%20participant,%20not%20as%20an%20AI.%20When%20writing%20$%7BrespondingUserTag%7D's%20messages,%20you%20can%20ignore%20the%20off-topic/OOC/spam/commentary%20chat%20messages%20and%20focus%20on%20the%20roleplay%20messages%20that%20are%20actually%20a%20part%20of%20the%20story.%20Predict%20what%20the%20characters%20in%20this%20chat/roleplay%20are%20most%20likely%20to%20say%20next,%20and%20then%20write%20it%20**EXACTLY**%20as%20the%20chat%20participants%20would,%20based%20on%20what%20they've%20previously%20said.%5Cn%20%20%20%20%20%20IMPORTANT:%20Here's%20a%20description%20of%20$%7BrespondingUserTag%7D:%20$%7BcharacterDescription%7D.%5Cn%5Cn%20%20%20%20%20%20%3CMESSAGES%3E%5Cn%20%20%20%20%20%20$%7Bcomments.slice(0,%20-4).join(%5C%22%5C%5Cn%5C%5Cn---%5C%5Cn%5C%5Cn%5C%22).trim()%20%7C%7C%20%60(None%20yet.%20Start%20the%20chat/roleplay%20with%20an%20interesting%20starter%20message.)%60%7D%5Cn%20%20%20%20%20%20%3C/MESSAGES%3E%5Cn%5Cn%20%20%20%20%20%20Again,%20your%20task%20is%20to%20write%20the%20next%205%20messages.%20Make%20sure%20your%20writing%20is%20interesting,%20authentic,%20descriptive,%20natural,%20engaging,%20and%20creative.%20Create%20a%20captivating%20and%20genuinely%20fascinating%20roleplay,%20and%20always%20stay%20in-character%20and%20write%20responses%20based%20on%20the%20previous%20chat%20context.%20Don't%20be%20boring.%20Keep%20the%20roleplay%20flowing!%5Cn%20%20%20%20%20%20As%20a%20reminder%20about%20the%20$%7BrespondingUserTag%7D%20character:%20$%7BcharacterDescription.slice(0,%20500)%20+%20(characterDescription.length%20%3E%201000%20?%20%5C%22...%5C%22%20:%20%5C%22%5C%22)%7D%5Cn%20%20%20%20%20%20%60.trim(),%5Cn%20%20%20%20%20%20startWith:%20comments.slice(-4).join(%5C%22%5C%5Cn%5C%5Cn---%5C%5Cn%5C%5Cn%5C%22)+%5C%22%5C%5Cn%5C%5Cn---%5C%5Cn%5C%5Cn%5C%22+respondingUserTag+%5C%22:%20%5C%22+newCommentText,%5Cn%20%20%20%20%20%20stopSequences:%20%5B%5C%22%5C%5Cn%5C%5Cn%5C%22,%20%5C%22%3C/MESSAGES%3E%5C%22%5D,%5Cn%20%20%20%20%20%20onChunk:%20function(data)%20%7B%5Cn%20%20%20%20%20%20%20%20if(data.isFromStartWith)%20return;%5Cn%20%20%20%20%20%20%20%20newCommentText%20+=%20data.textChunk;%20%5Cn%20%20%20%20%20%20%20%20if(newCommentText.includes(%5C%22%3C/MESSAGES%3E%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20newCommentText%20=%20newCommentText.replace(/%3C%5C%5C/MESSAGES%3E/g,%20%5C%22%5C%22).trim();%5Cn%20%20%20%20%20%20%20%20%20%20obj.stop();%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20commentsBox.inputText%20=%20newCommentText.trim();%5Cn%5Cn%20%20%20%20%20%20%20%20//%20if%20really%20long,%20or%20repeating%20a%20single%20character,%20stop:%5Cn%20%20%20%20%20%20%20%20if(newCommentText.length%20%3E%20800%20%7C%7C%20newCommentText.slice(-30)%20===%20newCommentText%5BnewCommentText.length-1%5D.repeat(30))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20obj.stop();%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%20%20onFinish:%20async%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20autoCommentCharBtn.disabled%20=%20false;%5Cn%20%20%20%20%20%20%20%20autoCommentCharBtn.textContent%20=%20%5C%22%F0%9F%A7%9D%20write%20as%20character%5C%22;%5Cn%5Cn%20%20%20%20%20%20%20%20if(/%5C%5Cn---%5C%5Cs*$/.test(commentsBox.inputText))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20commentsBox.inputText%20=%20commentsBox.inputText.replace(/%5C%5Cn---%5C%5Cs*$/g,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20newCommentText%20=%20newCommentText.replace(/%5C%5Cn---%5C%5Cs*$/g,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20%20%20if(autoCommentAutoSendCheckboxEl.checked)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(newCommentText.trim())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(lastCurrentUserCommentTime%20&&%20Date.now()-lastCurrentUserCommentTime%20%3C%203000)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20too%20soon%20to%20submit%20again,%20so%20just%20set%20nickname%20and%20let%20them%20click%20submit%20manually%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20commentsBox.setNicknameForNextComment(nicknameOverride);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20autoCommentCharBtn.textContent%20=%20%5C%22submitting%20too%20fast%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20autoCommentCharBtn.textContent%20=%20%5C%22%F0%9F%A7%9D%20write%20as%20character%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%201000);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20commentsBox.submit(newCommentText.trim(),%20%7Bnickname:nicknameOverride%7D).then(r%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(!r.success)%20commentsBox.inputText%20=%20newCommentText.trim();%20//%20recover%20comment%20text%20if%20it%20failed%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20commentsBox.inputText%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20No%20auto-submit,%20but%20we%20still%20set%20the%20nickname%20to%20their%20character%5Cn%20%20%20%20%20%20%20%20%20%20commentsBox.setNicknameForNextComment(nicknameOverride);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%20%20let%20saveAutoCommentCharInfoDebounceTimeout;%5Cn%20%20window%5B%60__$%7BglobalFnsId%7D_tabbedCommentsPluginSaveAutoCommentCharInfo%60%5D%20=%20function()%20%7B%5Cn%20%20%20%20autoCommentCharSelectEl.selectedOptions%5B0%5D.textContent%20=%20autoCommentCharNameEl.value;%5Cn%20%20%20%20autoCommentChars%5BautoCommentCharSelectEl.value%5D%20=%20%7Bname:autoCommentCharNameEl.value,%20description:autoCommentCharNameDescriptionEl.value%7D;%5Cn%20%20%20%20clearTimeout(saveAutoCommentCharInfoDebounceTimeout);%5Cn%20%20%20%20saveAutoCommentCharInfoDebounceTimeout%20=%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20localStorage.autoCommentChars%20=%20JSON.stringify(autoCommentChars);%5Cn%20%20%20%20%7D,%20500);%5Cn%20%20%7D%5Cn%20%20window%5B%60__$%7BglobalFnsId%7D_tabbedCommentsPluginSwitchToAutoCommentCharByIndex%60%5D%20=%20function(index)%20%7B%5Cn%20%20%20%20if(index%20===%20%5C%22#%5C%22)%20%7B%5Cn%20%20%20%20%20%20//%20add%20a%20new%20%3Coption%3E%20with%20an%20index%201%20higher%20than%20the%20current%20highest:%5Cn%20%20%20%20%20%20let%20newIndex%20=%20autoCommentChars.length;%5Cn%20%20%20%20%20%20let%20selectedOptionEl%20=%20autoCommentCharSelectEl.selectedOptions%5B0%5D;%5Cn%20%20%20%20%20%20selectedOptionEl.value%20=%20newIndex;%5Cn%20%20%20%20%20%20selectedOptionEl.textContent%20=%20%5C%22Unnamed%5C%22;%5Cn%20%20%20%20%20%20autoCommentCharNameEl.value%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20autoCommentCharNameDescriptionEl.value%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20autoCommentCharSelectEl.innerHTML%20+=%20%60%3Coption%20value=%5C%22#%5C%22%3EAdd%20char...%3C/option%3E%60;%5Cn%20%20%20%20%20%20autoCommentCharSelectEl.value%20=%20newIndex;%5Cn%20%20%20%20%20%20localStorage.__tabbedCommentsLastActiveAutoCommentCharIndex%20=%20newIndex;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20autoCommentCharNameEl.value%20=%20autoCommentChars%5Bindex%5D.name;%5Cn%20%20%20%20%20%20autoCommentCharNameDescriptionEl.value%20=%20autoCommentChars%5Bindex%5D.description;%5Cn%20%20%20%20%20%20autoCommentCharSelectEl.value%20=%20index;%5Cn%20%20%20%20%20%20localStorage.__tabbedCommentsLastActiveAutoCommentCharIndex%20=%20index;%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20if(autoCommentChars.length%20===%200)%20%7B%5Cn%20%20%20%20autoCommentChars.push(%7Bname:%5C%22Unnamed%5C%22,%20description:%5C%22%5C%22%7D);%5Cn%20%20%20%20autoCommentCharSelectEl.innerHTML%20=%20%60%3Coption%20value=%5C%220%5C%22%3EUnnamed%3C/option%3E%60;%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20autoCommentCharSelectEl.innerHTML%20=%20autoCommentChars.map((o,%20i)%20=%3E%20%60%3Coption%20value=%5C%22$%7Bi%7D%5C%22%3E$%7Bo.name%7D%3C/option%3E%60).join(%5C%22%5C%22);%5Cn%20%20%7D%5Cn%20%20autoCommentCharSelectEl.innerHTML%20+=%20%60%3Coption%20value=%5C%22#%5C%22%3EAdd%20char...%3C/option%3E%60;%5Cn%20%20try%20%7B%5Cn%20%20%20%20let%20charIndex%20=%20Number(localStorage.__tabbedCommentsLastActiveAutoCommentCharIndex%20%7C%7C%200);%5Cn%20%20%20%20if(isNaN(charIndex))%20charIndex%20=%200;%5Cn%20%20%20%20if(!autoCommentChars%5BcharIndex%5D)%20charIndex%20=%200;%5Cn%20%20%20%20if(!autoCommentChars%5BcharIndex%5D)%20%7B%5Cn%20%20%20%20%20%20charIndex%20=%200;%5Cn%20%20%20%20%20%20autoCommentChars%5B0%5D%20=%20%7Bname:%5C%22Unnamed%5C%22,%20description:%5C%22%5C%22%7D;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20localStorage.__tabbedCommentsLastActiveAutoCommentCharIndex%20=%20charIndex;%5Cn%20%20%20%20window%5B%60__$%7BglobalFnsId%7D_tabbedCommentsPluginSwitchToAutoCommentCharByIndex%60%5D(charIndex);%5Cn%20%20%20%20autoCommentAutoSendCheckboxEl.checked%20=%20!!localStorage.__tabbedCommentsAutoCommentAutoSendCheckboxValue;%5Cn%20%20%7D%20catch(e)%20%7B%20alert(e);%20%7D%5Cn%5Cn%20%20function%20createTabbedCommentsPanel(panelOpts)%20%7B%20//%20takes%20*list*%20of%20commentOptions%20as%20input%5Cn%20%20%20%20if(!panelOpts)%20panelOpts%20=%20%7B%7D;%5Cn%20%20%20%20let%20panelCtn%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20panelCtn.innerHTML%20=%20%60%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22tabbed-comments-plugin-header%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%20%20%3Cdiv%20class=%5C%22tabbed-comments-plugin-body%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%60;%5Cn%20%20%20%20%5Cn%5Cn%20%20%20%20let%20commentsChannelNameToObj%20=%20%7B%7D;%5Cn%5Cn%20%20%20%20const%20tabsHeaderEl%20=%20panelCtn.querySelector('.tabbed-comments-plugin-header');%5Cn%20%20%20%20const%20tabsContentEl%20=%20panelCtn.querySelector('.tabbed-comments-plugin-body');%5Cn%5Cn%20%20%20%20function%20deleteCommentsChannel(channel)%20%7B%5Cn%20%20%20%20%20%20if(!localStorage.__tabbedCommentsPluginCustomChannels)%20localStorage.__tabbedCommentsPluginCustomChannels%20=%20%5C%22%7B%7D%5C%22;%5Cn%20%20%20%20%20%20let%20customChannels%20=%20%7B%7D;%5Cn%20%20%20%20%20%20try%20%7B%20customChannels%20=%20JSON.parse(localStorage.__tabbedCommentsPluginCustomChannels)%20%7D%20catch(e)%20%7B%20console.error(%5C%22Failed%20to%20parse%20custom%20channels%20from%20localStorage:%5C%22,%20e);%20%7D%5Cn%5Cn%20%20%20%20%20%20delete%20customChannels%5Bchannel%5D;%5Cn%20%20%20%20%20%20localStorage.__tabbedCommentsPluginCustomChannels%20=%20JSON.stringify(customChannels);%5Cn%5Cn%20%20%20%20%20%20tabsHeaderEl.querySelector(%60.tabbed-comments-plugin-tab%5Bdata-channel='$%7Bchannel%7D'%5D%60)?.remove();%5Cn%20%20%20%20%20%20tabsContentEl.querySelector(%60.tabbed-comments-plugin-content%5Bdata-channel='$%7Bchannel%7D'%5D%60)?.remove();%5Cn%5Cn%20%20%20%20%20%20tabsHeaderEl.append(tabsHeaderEl.querySelector(%5C%22.tabbed-comments-plugin-add-custom-channel%5C%22));%20//%20move%20%5C%22+%5C%22%20button%20to%20the%20end%5Cn%20%20%20%20%20%20tabsHeaderEl.prepend(tabsHeaderEl.querySelector(%5C%22.tabbed-comments-plugin-close-panel-btn%5C%22));%20//%20move%20close%20panel%20button%20to%20the%20start%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20function%20addCommentsChannel(channel)%20%7B%5Cn%20%20%20%20%20%20if(!localStorage.__tabbedCommentsPluginCustomChannels)%20localStorage.__tabbedCommentsPluginCustomChannels%20=%20%5C%22%7B%7D%5C%22;%5Cn%20%20%20%20%20%20let%20customChannels%20=%20%7B%7D;%5Cn%20%20%20%20%20%20try%20%7B%20customChannels%20=%20JSON.parse(localStorage.__tabbedCommentsPluginCustomChannels)%20%7D%20catch(e)%20%7B%20console.error(%5C%22Failed%20to%20parse%20custom%20channels%20from%20localStorage:%5C%22,%20e);%20%7D%5Cn%5Cn%20%20%20%20%20%20let%20alreadyExisted%20=%20true;%5Cn%5Cn%20%20%20%20%20%20let%20existingTabEl%20=%20tabsHeaderEl.querySelector(%60.tabbed-comments-plugin-tab%5Bdata-channel='$%7Bchannel%7D'%5D%60);%5Cn%20%20%20%20%20%20if(!existingTabEl%20&&%20channel%20!==%20%5C%22%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20alreadyExisted%20=%20false;%5Cn%20%20%20%20%20%20%20%20customChannels%5Bchannel%5D%20=%20%7Bchannel:channel%7D;%5Cn%20%20%20%20%20%20%20%20let%20commentOptions%20=%20JSON.parse(JSON.stringify(customChannels%5Bchannel%5D));%5Cn%20%20%20%20%20%20%20%20addTab(commentOptions);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20localStorage.__tabbedCommentsPluginCustomChannels%20=%20JSON.stringify(customChannels);%5Cn%5Cn%20%20%20%20%20%20tabsHeaderEl.append(tabsHeaderEl.querySelector(%5C%22.tabbed-comments-plugin-add-custom-channel%5C%22));%20//%20move%20%5C%22+%5C%22%20button%20to%20the%20end%5Cn%20%20%20%20%20%20tabsHeaderEl.prepend(tabsHeaderEl.querySelector(%5C%22.tabbed-comments-plugin-close-panel-btn%5C%22));%20//%20move%20close%20panel%20button%20to%20the%20start%5Cn%5Cn%20%20%20%20%20%20let%20tab%20=%20tabsHeaderEl.querySelector(%60.tabbed-comments-plugin-tab%5Bdata-channel='$%7Bchannel%7D'%5D%60);%5Cn%20%20%20%20%20%20let%20tabContent%20=%20tabsContentEl.querySelector(%60.tabbed-comments-plugin-content%5Bdata-channel='$%7Bchannel%7D'%5D%60);%5Cn%5Cn%20%20%20%20%20%20return%20%7Btab,%20tabContent,%20alreadyExisted%7D;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20//%20Function%20to%20react%20to%20tab%20clicks%5Cn%20%20%20%20async%20function%20handleTabClick(event)%20%7B%5Cn%20%20%20%20%20%20let%20clickedTab%20=%20event.target;%5Cn%20%20%20%20%20%20if(!clickedTab.classList.contains('tabbed-comments-plugin-tab'))%20return;%20//%20they%20didn't%20click%20directly%20on%20a%20tab%5Cn%5Cn%20%20%20%20%20%20if(event.target.classList.contains('tabbed-comments-plugin-add-custom-channel'))%20%7B%5Cn%20%20%20%20%20%20%20%20//%20They%20clicked%20on%20the%20%5C%22+%5C%22%20icon%20to%20add%20a%20new%20channel.%5Cn%20%20%20%20%20%20%20%20//%20let%20channel%20=%20prompt(%5C%22Choose%20a%20channel%20name.%20Note:%20You%20can%20type%20#channelname%20in%20the%20chat%20to%20share%20your%20channel.%5C%22);%5Cn%20%20%20%20%20%20%20%20let%20userInput%20=%20await%20getUserInput(%7B%5Cn%20%20%20%20%20%20%20%20%20%20channel:%20%7B%20type:%20%5C%22input:text%5C%22,%20label:%20%5C%22Choose%20a%20channel%20name:%5C%22,%20placeholder:%20%5C%22You%20can%20use%20letters,%20numbers%20and%20hyphens.%5C%22,%20value:%20window.lastUsedAiSuggestPrompt%20%7C%7C%20%5C%22%5C%22%20%7D,%5Cn%20%20%20%20%20%20%20%20%20%20tip:%20%20%20%20%20%20%20%20%20%7B%20type:%20%5C%22html%5C%22,%20%20%20%20%20html:%20%60%3Cdiv%20style=%5C%22opacity:0.8;%20font-size:75%25;%5C%22%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cdetails%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Csummary%20style=%5C%22cursor:pointer;%5C%22%3ETap%20here%20for%20tips%3C/summary%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cul%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3EYou%20can%20type%20%3Cb%3E#channelname%3C/b%3E%20in%20the%20chat%20to%20share%20your%20channel.%3C/li%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%20style=%5C%22margin-top:0.5rem;%5C%22%3EIf%20you%20add%20%3Cb%3E+u:alice%7Cbob%3C/b%3E%20at%20the%20end%20of%20a%20channel%20name,%20then%20only%20the%20users%20with%20usernames%20'alice'%20and%20'bob'%20will%20be%20able%20to%20comment%20on%20that%20channel.%20If%20your%20username%20is%20'abc',%20and%20you%20want%20a%20personal%20'blog'%20type%20channel%20that%20is%20publicly%20known%20but%20can't%20get%20spammed%20by%20others,%20then%20you%20could%20write%20%3Cb%3Eblog+u:abc%3C/b%3E%20in%20the%20above%20text%20input,%20and%20only%20you%20will%20be%20able%20to%20comment%20on%20that%20channel.%3C/li%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/u%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C/details%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3C/div%3E%60,%20marginBottom:%5C%220px%5C%22%20%7D,%5Cn%20%20%20%20%20%20%20%20%7D,%20%7B%20okText:%5C%22Add%20channel%5C%22,%20cancelText:%5C%22Cancel%5C%22,%20cancelOnBackgroundClick:true%20%7D);%5Cn%20%20%20%20%20%20%20%20let%20channel%20=%20userInput?.channel;%5Cn%20%20%20%20%20%20%20%20if(channel)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20removeChannel%20=%20false;%5Cn%20%20%20%20%20%20%20%20%20%20if(channel.startsWith(%5C%22!%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20removeChannel%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel%20=%20channel.slice(1);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20channel%20=%20channel.toLowerCase();%5Cn%20%20%20%20%20%20%20%20%20%20channel%20=%20channel.replace(/%5B%5Ea-z0-9%5C%5C-:+%5D/g,%20%5C%22%5C%22);%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20if(!channel)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20alert(%5C%22Channel%20names%20can%20only%20contain%20lower-case%20letters,%20numbers%20and%20hyphens.%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20if(channel%20===%20%5C%22feedback%5C%22)%20return;%5Cn%20%20%20%20%20%20%20%20%20%20if(channel%20===%20%5C%22general%5C%22)%20return;%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20if(removeChannel)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20deleteCommentsChannel(channel);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20showTabByChannelName(tabsHeaderEl.firstElementChild.dataset.channel);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20addCommentsChannel(channel);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20showTabByChannelName(channel);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20alert(%60The%20'$%7Bchannel%7D'%20channel%20has%20been%20added.%20Type%20#$%7Bchannel%7D%20in%20the%20chat%20to%20share%20it.%60)%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%7D%20else%20if(event.target.classList.contains('tabbed-comments-plugin-channel-tab'))%20%7B%5Cn%20%20%20%20%20%20%20%20showTabByChannelName(clickedTab.dataset.channel);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20//%20Given%20the%20channel%20of%20a%20tab,%20it%20shows%20the%20tab%20content:%5Cn%20%20%20%20function%20showTabByChannelName(channel)%20%7B%5Cn%20%20%20%20%20%20localStorage.__tabbedCommentsPluginLastViewedChannel%20=%20channel;%5Cn%20%20%20%20%20%20tabsHeaderEl.querySelectorAll('.tabbed-comments-plugin-tab').forEach(el%20=%3E%20el.classList.remove('tabbed-comments-plugin-active-tab'));%5Cn%20%20%20%20%20%20let%20activeTab%20=%20tabsHeaderEl.querySelector(%60.tabbed-comments-plugin-tab%5Bdata-channel='$%7Bchannel%7D'%5D%60);%5Cn%20%20%20%20%20%20activeTab.classList.add('tabbed-comments-plugin-active-tab');%5Cn%5Cn%20%20%20%20%20%20tabsContentEl.querySelectorAll('.tabbed-comments-plugin-content').forEach(el%20=%3E%20el.classList.remove('tabbed-comments-plugin-active-content'));%5Cn%20%20%20%20%20%20tabsContentEl.querySelector(%60.tabbed-comments-plugin-content%5Bdata-channel='$%7Bchannel%7D'%5D%60).classList.add('tabbed-comments-plugin-active-content');%5Cn%5Cn%20%20%20%20%20%20unseenCommentCountByChannel%5Bchannel%5D%20=%200;%5Cn%5Cn%20%20%20%20%20%20updateUnseenCountHtml(channel);%5Cn%5Cn%20%20%20%20%20%20if(!tabsHeaderEl.channelDeleteBtn)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20btn%20=%20tabsHeaderEl.channelDeleteBtn%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20btn.style.cssText%20=%20%5C%22cursor:pointer;%20width:min-content;%20display:flex;%20align-items:center;%20justify-content:center;%20padding-right:0.6rem;%20padding-left:0.1rem;%5C%22;%5Cn%20%20%20%20%20%20%20%20btn.innerHTML%20=%20%5C%22%F0%9F%97%91%EF%B8%8F%5C%22;%5Cn%20%20%20%20%20%20%20%20btn.onclick%20=%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20channel%20=%20this.dataset.channelToDelete;%5Cn%20%20%20%20%20%20%20%20%20%20if(confirm(%60Hide/unpin%20the%20'$%7Bchannel%7D'%20channel?%60))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20deleteCommentsChannel(channel);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20showTabByChannelName(tabsHeaderEl.querySelector('.tabbed-comments-plugin-channel-tab').dataset.channel);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20btn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20//%20add%20delete%20button%20if%20it's%20not%20a%20main%20channel:%5Cn%20%20%20%20%20%20if(channel%20!==%20%5C%22%5C%22%20&&%20!commentsChannels.selectAll.map(c%20=%3E%20c.getName).includes(channel))%20%7B%5Cn%20%20%20%20%20%20%20%20let%20btn%20=%20tabsHeaderEl.channelDeleteBtn;%5Cn%20%20%20%20%20%20%20%20btn.style.display%20=%20%5C%22flex%5C%22;%5Cn%20%20%20%20%20%20%20%20btn.dataset.channelToDelete%20=%20channel;%5Cn%20%20%20%20%20%20%20%20activeTab.after(btn);%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20tabsHeaderEl.channelDeleteBtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(panelOpts.onShowTab)%20panelOpts.onShowTab(%7Bchannel%7D);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20//%20Adds%20a%20new%20tab%20to%20the%20module%5Cn%20%20%20%20function%20addTab(commentOptions)%20%7B%5Cn%20%20%20%20%5Cn%20%20%20%20%20%20commentOptions.width%20=%20%5C%22100%25%5C%22;%5Cn%20%20%20%20%20%20commentOptions.height%20=%20%5C%22100%25%5C%22;%20//%20only%20makes%20sense%20to%20set%20height%20via%20defaultChannelOptions,%20and%20that%20controls%20overall%20comments%20container%20height%5Cn%20%20%20%20%20%20if(!commentOptions.customEmojis)%20commentOptions.customEmojis%20=%20defaultChannelOptions.customEmojis%20%7C%7C%20defaultCustomEmojis;%5Cn%20%20%20%20%20%20commentOptions.forceColorScheme%20=%20defaultChannelOptions.forceColorScheme%20??%20localStorage.forceColorScheme%20??%20null;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20originalOnCommentHandler%20=%20commentOptions.onComment%20%7C%7C%20defaultChannelOptions.onComment;%5Cn%20%20%20%20%20%20let%20originalOnLoadHandler%20=%20commentOptions.onLoad%20%7C%7C%20defaultChannelOptions.onLoad%5Cn%20%20%20%20%20%20commentOptions.onComment%20=%20function(...args)%20%7B%5Cn%20%20%20%20%20%20%20%20commentsPluginOnCommentHandler(...args);%20//%20for%20counting%20unseen,%20channel%20mentions,%20etc.%5Cn%20%20%20%20%20%20%20%20try%20%7B%20if(originalOnCommentHandler)%20originalOnCommentHandler(...args);%20%7D%20catch(e)%20%7B%20console.error(e)%20%7D%20//%20userland%20code%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20commentOptions.onLoad%20=%20function(...args)%20%7B%5Cn%20%20%20%20%20%20%20%20commentsPluginOnLoadHandler(...args);%20//%20for%20counting%20unseen,%20channel%20mentions,%20etc.%5Cn%20%20%20%20%20%20%20%20try%20%7B%20if(originalOnLoadHandler)%20originalOnLoadHandler(...args);%20%20%7D%20catch(e)%20%7B%20console.error(e)%20%7D%20//%20userland%20code%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%5Cn%20%20%20%20%20%20commentOptions.replacedDuringUpdate%20=%20true;%20//%20needed%20to%20allow%20multiple%20instances%20of%20the%20same%20channel%20(since%20we%20have%20multiple%20tabbed-comments-modules)%5Cn%20%20%20%20%20%20for(let%20key%20of%20defaultChannelOptions.getAllKeys%20%7C%7C%20Object.keys(defaultChannelOptions))%20%7B%5Cn%20%20%20%20%20%20%20%20if(!commentOptions%5Bkey%5D%20&&%20!commentOptions.hasOwnProperty(key))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20getter,%20because%20the%20default%20options%20could%20be%20dynamic%20(e.g.%20dark/light%20mode%20using%20localStorage),%20and%20this%20createTabbedCommentsPanel%20function%20is%20(as%20of%20writing)%20called%20every%20time%20the%20dark/light%20mode%20is%20switched.%5Cn%20%20%20%20%20%20%20%20%20%20Object.defineProperty(commentOptions,%20key,%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20get:%20()%20=%3E%20defaultChannelOptions%5Bkey%5D,%5Cn%20%20%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20commentsPluginOutput%20=%20commentsPlugin(commentOptions);%5Cn%20%20%20%20%20%20commentsChannelNameToObj%5BcommentOptions.channel%5D%20=%20commentsPluginOutput;%5Cn%5Cn%20%20%20%20%20%20const%20tab%20=%20document.createElement('div');%5Cn%20%20%20%20%20%20tab.className%20=%20'tabbed-comments-plugin-tab%20tabbed-comments-plugin-channel-tab';%20//%20note%20that%20non-channel%20tabs/buttons%20are%20possible%20-%20e.g.%20close%20tab%20button,%20close%20panel%20button%5Cn%20%20%20%20%20%20tab.textContent%20=%20commentOptions.label%20%7C%7C%20commentOptions.channel%20%7C%7C%20%5C%22general%5C%22;%5Cn%20%20%20%20%20%20tab.innerHTML%20+=%20%60%3Cspan%20class=%5C%22tabbed-comments-plugin-unseen-count%5C%22%3E?%3C/span%3E%60;%5Cn%20%20%20%20%20%20tab.dataset.channel%20=%20commentOptions.channel;%5Cn%5Cn%20%20%20%20%20%20const%20tabContent%20=%20document.createElement('div');%5Cn%20%20%20%20%20%20tabContent.className%20=%20'tabbed-comments-plugin-content';%5Cn%20%20%20%20%20%20tabContent.innerHTML%20=%20commentsPluginOutput;%5Cn%20%20%20%20%20%20tabContent.dataset.channel%20=%20commentOptions.channel;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20for%20refreshing%20the%20comments%20if%20needed%20(e.g.%20when%20dark/light%20mode%20changes%20-%20see%20updateColorScheme%20function)%5Cn%20%20%20%20%20%20tabContent.dataset.tabbedCommentsDirectParentOfCommentsPluginOutput%20=%20%5C%221%5C%22;%5Cn%20%20%20%20%20%20tabContent.__commentOptionsUsed%20=%20commentOptions;%20//%20this%20should%20probably%20not%20be%20'concrete'%20ones%20because%20we%20want%20a%20reference%20to%20the%20dynamic%20onces%20for%20if/when%20we%20need%20to%20reload%20it%5Cn%5Cn%20%20%20%20%20%20tabsHeaderEl.appendChild(tab);%5Cn%20%20%20%20%20%20tabsContentEl.appendChild(tabContent);%5Cn%20%20%20%20%20%20return%20%7Btab,%20tabContent%7D;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20let%20existingChannelNames%20=%20%5B%5D;%5Cn%20%20%20%20let%20channelNameToChannelData%20=%20%7B%7D;%5Cn%20%20%20%20for(let%20commentOptions%20of%20commentsChannels.selectAll)%20%7B%5Cn%20%20%20%20%20%20if(typeof%20commentOptions%20===%20%5C%22string%5C%22)%20commentOptions%20=%20%7Bchannel:commentOptions%7D;%20//%20in%20case%20commentsChannels%20is%20just%20an%20array%20of%20strings%5Cn%20%20%20%20%20%20if(!commentOptions.channel)%20commentOptions.channel%20=%20commentOptions.getName===%5C%22general%5C%22%20?%20%5C%22%5C%22%20:%20commentOptions.getName;%20//%20use%20name%20of%20commentOptions%20object%20as%20channel%20name%20by%20default%5Cn%20%20%20%20%20%20let%20channelName%20=%20commentOptions.channel.toString();%5Cn%20%20%20%20%20%20let%20%7Btab,%20tabContent%7D%20=%20addTab(commentOptions);%5Cn%20%20%20%20%20%20channelNameToChannelData%5BchannelName%5D%20=%20%7Btab,%20tabContent,%20channelName%7D;%5Cn%20%20%20%20%20%20existingChannelNames.push(channelName);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20//%20Add%20the%20%5C%22+%5C%22%20button:%5Cn%20%20%20%20if(commentsChannels.allowCustomChannels%20!==%20false)%20%7B%5Cn%5Cn%20%20%20%20%20%20//%20add%20user-specified%20custom%20channels:%5Cn%20%20%20%20%20%20if(!localStorage.__tabbedCommentsPluginCustomChannels)%20localStorage.__tabbedCommentsPluginCustomChannels%20=%20%5C%22%7B%7D%5C%22;%5Cn%20%20%20%20%20%20let%20customChannels%20=%20%7B%7D;%5Cn%20%20%20%20%20%20try%20%7B%20customChannels%20=%20JSON.parse(localStorage.__tabbedCommentsPluginCustomChannels)%20%7D%20catch(e)%20%7B%20console.error(%5C%22Failed%20to%20parse%20custom%20channels%20from%20localStorage:%5C%22,%20e);%20%7D%5Cn%20%20%20%20%20%20for(let%20commentOptions%20of%20Object.values(customChannels))%20%7B%5Cn%20%20%20%20%20%20%20%20if(existingChannelNames.includes(commentOptions.channel))%20continue;%20//%20already%20got%20that%20channel%5Cn%20%20%20%20%20%20%20%20let%20channelName%20=%20commentOptions.channel.toString();%5Cn%20%20%20%20%20%20%20%20let%20%7Btab,%20tabContent%7D%20=%20addTab(commentOptions);%5Cn%20%20%20%20%20%20%20%20channelNameToChannelData%5BchannelName%5D%20=%20%7Btab,%20tabContent,%20channelName%7D;%5Cn%5Cn%20%20%20%20%20%20%20%20if(temporaryMentionedChannels.has(channelName))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20tab.dataset.tabbedCommentsPluginIsTemporaryMentionedChannel%20=%20%5C%221%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20attachEventsToTemporaryMentionedChannelTab(tab,%20channelName);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20//%20add%20the%20%5C%22+%5C%22%20button:%5Cn%20%20%20%20%20%20const%20tab%20=%20document.createElement('div');%5Cn%20%20%20%20%20%20tab.className%20=%20'tabbed-comments-plugin-tab%20tabbed-comments-plugin-add-custom-channel';%5Cn%20%20%20%20%20%20tab.textContent%20=%20%5C%22+%5C%22;%5Cn%20%20%20%20%20%20tab.style.cssText%20=%20%5C%22min-width:1.4rem;%5C%22;%5Cn%20%20%20%20%20%20tabsHeaderEl.appendChild(tab);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20//%20add%20the%20close-panel%20button%20if%20needed:%5Cn%20%20%20%20%7B%5Cn%20%20%20%20%20%20const%20tab%20=%20document.createElement('div');%5Cn%20%20%20%20%20%20tab.className%20=%20'tabbed-comments-plugin-tab%20tabbed-comments-plugin-close-panel-btn';%5Cn%20%20%20%20%20%20tab.textContent%20=%20%5C%22%E2%9D%8C%5C%22;%5Cn%20%20%20%20%20%20tab.title%20=%20%5C%22Close%20this%20panel%5C%22;%5Cn%20%20%20%20%20%20//%20NOTE:%20rather%20than%20not%20adding%20the%20button,%20or%20using%20display:none;%20we%20just%20remove%20it's%20width%20+%20opacity%20+%20pointer-events,%20because%20otherwise%20the%20height%20of%20the%20header%20can%20change%20due%20to%20emoji%20font%20size,%20which%20vertically%20offsets%20the%20panels%20by%20a%20pixel%20or%20two,%20which%20looks%20bad.%5Cn%20%20%20%20%20%20tab.style.cssText%20=%20panelOpts.addCloseButton%20?%20%5C%22min-width:1.4rem;%5C%22%20:%20%5C%22width:0px;%20max-width:0px;%20pointer-events:none;%20margin-left:0;%20margin-right:0;%20padding-left:0;%20padding-right:0;%20min-width:0px;%20opacity:0;%5C%22;%5Cn%20%20%20%20%20%20tab.onclick%20=%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20panelCtn.remove();%5Cn%20%20%20%20%20%20%20%20if(panelOpts.onClose)%20panelOpts.onClose();%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20tabsHeaderEl.prepend(tab);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20let%20defaultStartChannelIndex%20=%200;%5Cn%5Cn%20%20%20%20let%20activeChannelData%20=%20channelNameToChannelData%5BlocalStorage.__tabbedCommentsPluginLastViewedChannel%20??%20existingChannelNames%5BdefaultStartChannelIndex%5D%5D;%5Cn%20%20%20%20if(!activeChannelData)%20%7B%5Cn%20%20%20%20%20%20console.error(%5C%22localstorage%20had%20__tabbedCommentsPluginLastViewedChannel,%20but%20that%20channel%20doesn't%20exist?%5C%22);%5Cn%20%20%20%20%20%20activeChannelData%20=%20channelNameToChannelData%5BexistingChannelNames%5B0%5D%5D;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20setTimeout(async%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20while(!document.body.contains(panelCtn))%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20100));%5Cn%20%20%20%20%20%20showTabByChannelName(activeChannelData.channelName);%5Cn%20%20%20%20%7D,%2010);%5Cn%5Cn%20%20%20%20tabsHeaderEl.addEventListener('click',%20handleTabClick);%5Cn%5Cn%20%20%20%20let%20styleEl%20=%20document.createElement(%5C%22style%5C%22);%5Cn%20%20%20%20styleEl.textContent%20=%20%60%5Cn%20%20%20%20%20%20.tabbed-comments-plugin-header%20%7B%5Cn%20%20%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20%20%20font-size:%2070%25;%5Cn%20%20%20%20%20%20%20%20overflow:auto;%5Cn%20%20%20%20%20%20%20%20color:var(--tabbed-comments-plugin-text-color);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-plugin-body%20%7B%5Cn%20%20%20%20%20%20%20%20flex-grow:1;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-plugin-tab%20%7B%5Cn%20%20%20%20%20%20%20%20padding:%200.25rem;%5Cn%20%20%20%20%20%20%20%20cursor:%20pointer;%5Cn%20%20%20%20%20%20%20%20background:%20var(--tabbed-comments-plugin-box-color,%20#ebebeb);%5Cn%20%20%20%20%20%20%20%20border-radius:%200.25rem;%5Cn%20%20%20%20%20%20%20%20margin:%200.25rem;%5Cn%20%20%20%20%20%20%20%20user-select:%20none;%5Cn%20%20%20%20%20%20%20%20min-width:%20max-content;%5Cn%20%20%20%20%20%20%20%20display:%20flex;%5Cn%20%20%20%20%20%20%20%20align-items:%20center;%5Cn%20%20%20%20%20%20%20%20justify-content:%20center;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-plugin-tab%5Bdata-tabbed-comments-plugin-is-temporary-mentioned-channel='1'%5D%20%7B%5Cn%20%20%20%20%20%20%20%20opacity:0.6;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-plugin-unseen-count%20%7B%5Cn%20%20%20%20%20%20%20%20border-radius:%20100px;%5Cn%20%20%20%20%20%20%20%20padding:%200.05rem%200.15rem;%5Cn%20%20%20%20%20%20%20%20font-size:80%25;%5Cn%20%20%20%20%20%20%20%20background:grey;%5Cn%20%20%20%20%20%20%20%20margin-left:%200.1rem;%5Cn%20%20%20%20%20%20%20%20pointer-events:none;%5Cn%20%20%20%20%20%20%20%20color:white;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-plugin-active-tab%20%7B%5Cn%20%20%20%20%20%20%20%20background:%20var(--tabbed-comments-plugin-active-comment-channel-tab-color,%20#c6c6c6);%5Cn%20%20%20%20%20%20%20%20outline:%202px%20solid%20#0086c9;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-plugin-content%20%7B%5Cn%20%20%20%20%20%20%20%20display:%20none;%5Cn%20%20%20%20%20%20%20%20height:100%25;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-plugin-active-content%20%7B%5Cn%20%20%20%20%20%20%20%20display:%20block;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20@media%20only%20screen%20and%20(max-width:%20650px)%20%7B%5Cn%20%20%20%20%20%20%20%20.tabbed-comments-auto-comment-ctn%20%7B%20flex-direction:column;%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-ctn-left%20%7B%20display:none;%20%7D%5Cn%20%20%20%20%20%20.tabbed-comments-ctn-right%20%7B%20display:none;%20%7D%5Cn%20%20%20%20%20%20$%7BCSS.supports(%5C%22container-type%5C%22,%20%5C%22inline-size%5C%22)%20?%20%60@container%60%20:%20%60@media%20only%20screen%20and%60%7D%20(min-width:%201100px)%20%7B%5Cn%20%20%20%20%20%20%20%20.tabbed-comments-ctn-left%20%7B%20display:flex;%20%7D%5Cn%20%20%20%20%20%20%20%20.tabbed-comments-ctn-right%20%7B%20display:flex;%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%60;%5Cn%20%20%20%20panelCtn.append(styleEl);%5Cn%20%20%20%20panelCtn.style.cssText%20=%20%5C%22height:100%25;%20width:100%25;%20display:flex;%20flex-direction:column;%5C%22%5Cn%20%20%20%20return%20%7Belement:panelCtn,%20addCommentsChannel,%20deleteCommentsChannel,%20commentsChannelNameToObj%7D;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20middlePanelObj%20=%20createTabbedCommentsPanel(%7B%5Cn%20%20%20%20onShowTab:%20(%7Bchannel%7D)%20=%3E%20%7B%5Cn%20%20%20%20%20%20middleCtnCurrentlyShownCommentsChannelName%20=%20channel;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20channelData%20=%20commentsChannels%5Bchannel%20%7C%7C%20%5C%22general%5C%22%5D;%5Cn%20%20%20%20%20%20if(!channelData)%20channelData%20=%20defaultChannelOptions;%5Cn%20%20%20%20%20%20let%20allowBots%20=%20channelData.allowBots;%5Cn%20%20%20%20%20%20if(channel%20===%20%5C%22%5C%22%20%7C%7C%20channel%20===%20%5C%22general%5C%22%20%7C%7C%20opts.allowBots%20===%20false)%20%7B%5Cn%20%20%20%20%20%20%20%20if(allowBots%20===%20undefined)%20allowBots%20=%20false;%20//%20by%20default,%20don't%20allow%20bots%20on%20main/general/chat%20channel%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20autoCommentCtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20if(allowBots%20!==%20false)%20%7B%5Cn%20%20%20%20%20%20%20%20showAutoCommentAreaBtn.style.display%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20showAutoCommentAreaBtn.style.display%20=%20%5C%22none%5C%22;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D,%5Cn%20%20%7D);%5Cn%20%20middleCtnChannelNameToObj%20=%20middlePanelObj.commentsChannelNameToObj;%5Cn%20%20middleCtn.appendChild(middlePanelObj.element);%5Cn%20%20return%20outerCtn;%5Cn%5Cnasync%20getUserInput(fields,%20opts)%20=%3E%5Cn%20%20fields%20=%20fields%20%7C%7C%20%7B%7D;%5Cn%20%20opts%20=%20opts%20%7C%7C%20%7B%7D;%5Cn%20%20const%20esc%20=%20s%20=%3E%20String(s).replace(/%5B%3C%3E&%5D/g,%20m%20=%3E%20(%7B%5C%22%3C%5C%22:%5C%22&lt;%5C%22,%5C%22&%5C%22:%5C%22&amp;%5C%22,%5C%22%3E%5C%22:%5C%22&gt;%5C%22%7D%5Bm%5D));%5Cn%20%20const%20cancelText%20=%20esc(opts.cancelText%20%7C%7C%20%5C%22Cancel%5C%22);%5Cn%20%20const%20okText%20=%20esc(opts.okText%20%7C%7C%20%5C%22OK%5C%22);%5Cn%5Cn%20%20return%20new%20Promise(resolve%20=%3E%20%7B%5Cn%20%20%20%20const%20overlay%20=%20Object.assign(document.createElement(%5C%22div%5C%22),%20%7B%20tabIndex:%200%20%7D);%5Cn%20%20%20%20overlay.style.cssText%20=%20%60position:fixed;inset:0;z-index:99999999;display:grid;place-items:center;background-color:rgba(0,0,0,.65);font:16px/1.4%20system-ui%60;%5Cn%5Cn%20%20%20%20const%20modal%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20modal.style.cssText%20=%20%60%5Cn%20%20%20%20%20%20text-align:left%20!important;%5Cn%20%20%20%20%20%20width:520px;max-width:97vw;%5Cn%20%20%20%20%20%20border-radius:8px;padding:15px;%5Cn%20%20%20%20%20%20background-color:light-dark(#fff,#222);%5Cn%20%20%20%20%20%20color:light-dark(#000,#fff);%5Cn%20%20%20%20%20%20box-shadow:0%202px%208px%20rgba(0,0,0,.2);%5Cn%20%20%20%20%20%20display:flex;flex-direction:column;gap:12px;%5Cn%20%20%20%20%20%20max-height:min(92vh,%20900px);%5Cn%20%20%20%20%60;%5Cn%5Cn%20%20%20%20//%20Scrollable%20content%5Cn%20%20%20%20const%20scrollWrap%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20scrollWrap.style.cssText%20=%20%5C%22overflow:auto;min-height:0;%5C%22;%5Cn%20%20%20%20const%20host%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20host.style.cssText%20=%20%5C%22display:block%5C%22;%5Cn%20%20%20%20scrollWrap.append(host);%5Cn%5Cn%20%20%20%20//%20Footer%20(Cancel%20left,%20OK%20right)%5Cn%20%20%20%20const%20footer%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20footer.style.cssText%20=%20%5C%22display:flex;gap:8px;align-items:center;margin-top:4px;%5C%22;%5Cn%20%20%20%20const%20cancelBtn%20=%20document.createElement(%5C%22button%5C%22);%5Cn%20%20%20%20cancelBtn.textContent%20=%20cancelText;%5Cn%20%20%20%20cancelBtn.hidden%20=%20!!opts.hideCancel;%5Cn%20%20%20%20cancelBtn.style.cssText%20=%20%5C%22padding:6px%2016px;border:1px%20solid%20light-dark(#ccc,#555);border-radius:6px;background-color:light-dark(#f6f6f6,#333);color:inherit;cursor:pointer;%5C%22;%5Cn%20%20%20%20const%20okBtn%20=%20document.createElement(%5C%22button%5C%22);%5Cn%20%20%20%20okBtn.textContent%20=%20okText;%5Cn%20%20%20%20okBtn.autofocus%20=%20true;%5Cn%20%20%20%20okBtn.style.cssText%20=%20%5C%22margin-left:auto;padding:6px%2016px;border:none;border-radius:6px;background-color:light-dark(#1677ff,#2b87ff);color:#fff;cursor:pointer;%5C%22;%5Cn%5Cn%20%20%20%20footer.append(cancelBtn,%20okBtn);%5Cn%20%20%20%20modal.append(scrollWrap,%20footer);%5Cn%20%20%20%20overlay.append(modal);%5Cn%5Cn%20%20%20%20const%20elMap%20=%20new%20Map();%5Cn%20%20%20%20const%20inputCSS%20=%20%5C%22width:100%25;max-width:100%25;box-sizing:border-box;padding:8px;border:1px%20solid%20light-dark(#ccc,#555);border-radius:6px;background-color:light-dark(#fff,#333);color:inherit;%5C%22;%5Cn%5Cn%20%20%20%20Object.entries(fields).forEach((%5Bname,%20cfgRaw%5D)%20=%3E%20%7B%5Cn%20%20%20%20%20%20const%20cfg%20=%20cfgRaw%20%7C%7C%20%7B%7D;%5Cn%20%20%20%20%20%20const%20t%20=%20(cfg.type%20%7C%7C%20%5C%22input:text%5C%22).toLowerCase();%5Cn%20%20%20%20%20%20const%20wrap%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20wrap.style.cssText%20=%20%60margin:0%200%20$%7Bcfg.marginBottom%20%7C%7C%20%5C%2212px%5C%22%7D%60;%5Cn%5Cn%20%20%20%20%20%20if%20(cfg.label)%20%7B%5Cn%20%20%20%20%20%20%20%20const%20lab%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20lab.style.cssText%20=%20%5C%22margin:0%200%206px;display:flex;align-items:center;gap:6px;%5C%22;%5Cn%20%20%20%20%20%20%20%20const%20labText%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20labText.textContent%20=%20cfg.label%20%7C%7C%20name;%5Cn%20%20%20%20%20%20%20%20lab.append(labText);%5Cn%20%20%20%20%20%20%20%20if%20(cfg.help)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20help%20=%20document.createElement(%5C%22span%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20help.textContent%20=%20%5C%22i%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20help.title%20=%20cfg.help;%5Cn%20%20%20%20%20%20%20%20%20%20help.style.cssText%20=%20%5C%22margin-left:auto;display:inline-grid;place-items:center;width:18px;height:18px;border-radius:50%25;border:1px%20solid%20light-dark(#ccc,#555);font:12px/1%20system-ui;opacity:.75;cursor:help;user-select:none%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20help.onclick%20=%20()%20=%3E%20alert(cfg.help);%5Cn%20%20%20%20%20%20%20%20%20%20lab.append(help);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20wrap.append(lab);%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20let%20el%20=%20null,%20kind%20=%20%5C%22std%5C%22;%5Cn%20%20%20%20%20%20if%20(t%20===%20%5C%22textarea%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20el%20=%20document.createElement(%5C%22textarea%5C%22);%5Cn%20%20%20%20%20%20%20%20el.rows%20=%20cfg.rows%20%7C%7C%204;%5Cn%20%20%20%20%20%20%20%20el.style.cssText%20=%20inputCSS;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.placeholder%20!=%20null)%20el.placeholder%20=%20cfg.placeholder;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.value%20!=%20null)%20el.value%20=%20cfg.value;%5Cn%20%20%20%20%20%20%7D%20else%20if%20(t%20===%20%5C%22select%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20el%20=%20document.createElement(%5C%22select%5C%22);%5Cn%20%20%20%20%20%20%20%20el.style.cssText%20=%20inputCSS;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.multiple)%20el.multiple%20=%20true;%5Cn%20%20%20%20%20%20%20%20(cfg.options%20%7C%7C%20%5B%5D).forEach(opt%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20o%20=%20document.createElement(%5C%22option%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20if%20(typeof%20opt%20===%20%5C%22object%5C%22)%20%7B%20o.value%20=%20opt.value;%20o.textContent%20=%20opt.label%20??%20opt.value;%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20else%20%7B%20o.value%20=%20String(opt);%20o.textContent%20=%20String(opt);%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20el.append(o);%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20const%20v%20=%20cfg.value;%5Cn%20%20%20%20%20%20%20%20if%20(el.multiple%20&&%20Array.isArray(v))%20Array.from(el.options).forEach(o%20=%3E%20o.selected%20=%20v.includes(o.value));%5Cn%20%20%20%20%20%20%20%20else%20if%20(v%20!=%20null)%20el.value%20=%20v;%5Cn%20%20%20%20%20%20%7D%20else%20if%20(t.startsWith(%5C%22input:%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20el%20=%20document.createElement(%5C%22input%5C%22);%5Cn%20%20%20%20%20%20%20%20el.type%20=%20t.split(%5C%22:%5C%22)%5B1%5D%20%7C%7C%20%5C%22text%5C%22;%5Cn%20%20%20%20%20%20%20%20el.style.cssText%20=%20inputCSS;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.placeholder%20!=%20null)%20el.placeholder%20=%20cfg.placeholder;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.min%20!=%20null)%20el.min%20=%20cfg.min;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.max%20!=%20null)%20el.max%20=%20cfg.max;%5Cn%20%20%20%20%20%20%20%20if%20(cfg.step%20!=%20null)%20el.step%20=%20cfg.step;%5Cn%20%20%20%20%20%20%20%20if%20(el.type%20===%20%5C%22checkbox%5C%22)%20el.checked%20=%20!!cfg.value;%5Cn%20%20%20%20%20%20%20%20else%20if%20(cfg.value%20!=%20null)%20el.value%20=%20cfg.value;%5Cn%20%20%20%20%20%20%7D%20else%20if%20(t%20===%20%5C%22html%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20const%20html%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20html.innerHTML%20=%20cfg.html%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20wrap.append(html);%5Cn%20%20%20%20%20%20%20%20host.append(wrap);%5Cn%20%20%20%20%20%20%20%20elMap.set(name,%20%7B%20cfg,%20el:%20html,%20wrap,%20kind:%20%5C%22html%5C%22%20%7D);%5Cn%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20const%20html%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20html.innerHTML%20=%20cfg.html%20%7C%7C%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20wrap.append(html);%5Cn%20%20%20%20%20%20%20%20host.append(wrap);%5Cn%20%20%20%20%20%20%20%20elMap.set(name,%20%7B%20cfg,%20el:%20html,%20wrap,%20kind:%20%5C%22html%5C%22%20%7D);%5Cn%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20el.name%20=%20name;%5Cn%20%20%20%20%20%20wrap.append(el);%5Cn%20%20%20%20%20%20host.append(wrap);%5Cn%20%20%20%20%20%20elMap.set(name,%20%7B%20cfg,%20el,%20wrap,%20kind:%20%5C%22std%5C%22%20%7D);%5Cn%20%20%20%20%7D);%5Cn%5Cn%20%20%20%20const%20finish%20=%20v%20=%3E%20%7B%20overlay.remove();%20resolve(v);%20%7D;%5Cn%5Cn%20%20%20%20cancelBtn.onclick%20=%20()%20=%3E%20finish(null);%5Cn%20%20%20%20okBtn.onclick%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20const%20out%20=%20%7B%7D;%5Cn%20%20%20%20%20%20elMap.forEach((%7B%20el,%20kind,%20wrap%20%7D,%20name)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(kind%20===%20%5C%22html%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20dv%20=%20wrap.querySelector(%5C%22%5Bdata-value%5D%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20out%5Bname%5D%20=%20dv%20?%20dv.getAttribute(%5C%22data-value%5C%22)%20:%20null;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20if%20(el.tagName%20===%20%5C%22SELECT%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20out%5Bname%5D%20=%20el.multiple%20?%20Array.from(el.selectedOptions).map(o%20=%3E%20o.value)%20:%20el.value;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20if%20(el.tagName%20===%20%5C%22TEXTAREA%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20out%5Bname%5D%20=%20el.value;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20if%20(el.tagName%20===%20%5C%22INPUT%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if%20(el.type%20===%20%5C%22checkbox%5C%22)%20out%5Bname%5D%20=%20el.checked;%5Cn%20%20%20%20%20%20%20%20%20%20else%20if%20(el.type%20===%20%5C%22number%5C%22%20%7C%7C%20el.type%20===%20%5C%22range%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20const%20n%20=%20parseFloat(el.value);%20out%5Bname%5D%20=%20Number.isFinite(n)%20?%20n%20:%20null;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%20else%20out%5Bname%5D%20=%20el.value;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20out%5Bname%5D%20=%20null;%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20finish(out);%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20overlay.onkeydown%20=%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20if%20(e.key%20===%20%5C%22Escape%5C%22)%20finish(null);%5Cn%20%20%20%20%20%20else%20if%20(e.key%20===%20%5C%22Enter%5C%22%20&&%20e.target.tagName%20!==%20%5C%22TEXTAREA%5C%22)%20%7B%20e.preventDefault();%20okBtn.click();%20%7D%5Cn%20%20%20%20%7D;%5Cn%5Cn%20%20%20%20//%20Backdrop%20mousedown%20cancel%20only%20(not%20mouseup)%5Cn%20%20%20%20if%20(opts.cancelOnBackgroundClick)%20%7B%5Cn%20%20%20%20%20%20overlay.addEventListener(%5C%22mousedown%5C%22,%20e%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(e.target%20===%20overlay)%20finish(null);%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20document.body.append(overlay);%5Cn%20%20%20%20overlay.focus(%7B%20preventScroll:%20true%20%7D);%5Cn%5Cn%20%20%20%20const%20first%20=%20host.querySelector(%5C%22input,textarea,select%5C%22);%5Cn%20%20%20%20if%20(first)%20setTimeout(()%20=%3E%20first.focus(%7B%20preventScroll:%20true%20%7D),%200);%5Cn%20%20%7D);%22,%22imports%22:%5B%22ai-text-plugin%22,%22comments-plugin%22,%22huge-emoji-list%22%5D,%22lastEditTime%22:1769155791527,%22found%22:true%7D,%7B%22name%22:%22text-to-image-plugin%22,%22modelText%22:%22%5Cn//%20NOTE%20TO%20SELF:%20If%20you%20add%20more%20properties,%20make%20sure%20you%20add%20to%20the%20regex%20below,%20and%20the%20variable%20declarations%20in%20each%20'branch'%5Cn%5Cn$output(data,%20opts)%20=%3E%5Cn%20%20if(data%20===%20undefined)%20return%20%5C%22(Error:%20you've%20input%20an%20empty%20value/variable%20into%20the%20text-to-image-plugin)%5C%22;%5Cn%5Cn%20%20//%20Allow%20for%20%60await%20generateImage(%5C%22a%20cute%20cat%5C%22,%20%7Bresolution:%5C%22512x768%5C%22,%20removeBackground:true%7D)%60%20type%20usage%5Cn%20%20if(opts%20&&%20typeof%20opts%20===%20%5C%22object%5C%22)%20%7B%5Cn%20%20%20%20opts.prompt%20=%20data;%5Cn%20%20%20%20data%20=%20opts;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20//%20if(options%20===%20undefined)%20options%20=%20%7B%7D;%5Cn%20%20%5Cn%20%20let%20serverOrigin%20=%20%5C%22https://image-generation.perchance.org%5C%22;%5Cn%20%20%5Cn%20%20let%20evaluatedInputs;%5Cn%20%20%5Cn%20%20//%20This%20is%20used%20for%20the%20heart-button%20gallery.%20It's%20a%20bit%20hacky,%20but%20most%20often%20devs%20will%20want%20the%20%5C%22open%20gallery%5C%22%20button%20to%20show%20a%20gallery%20with%20e.g.%20the%20same%20moderation%20options%20as%20the%20gallery%20that%20they've%20displayed%20on%20the%20page,%20if%20any.%5Cn%20%20window.lastUsedTextToImagePluginGalleryIframeUrl%20=%20null;%5Cn%20%20%5Cn%20%20let%20shouldRemoveIframeOnFinish%20=%20false;%20//%20for%20the%20case%20where%20the%20iframe%20was%20added%20automatically%20-%20i.e.%20when%20called%20like:%20%20%60let%20result%20=%20await%20image(%7Bprompt:%5C%22a%20cute%20mouse%5C%22%7D)%60%5Cn%5Cn%20%20let%20galleryOptionsHash%20=%20null;%20//%20only%20used%20if%20this%20is%20a%20gallery%20call%5Cn%5Cn%20%20////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20%20%20set%20up%20handler%20for%20gallery%20%20%20%20%20%20%20%20%20%20%20//%5Cn%20%20////////////////////////////////////////////////%5Cn%20%20let%20pluginData;%5Cn%20%20if(!window.___textToImagePluginData98420274)%20%7B%5Cn%20%20%20%20window.addEventListener(%5C%22message%5C%22,%20function(e)%20%7B%5Cn%20%20%20%20%20%20let%20origin%20=%20e.origin%20%7C%7C%20e.originalEvent.origin;%5Cn%20%20%20%20%20%20if(origin%20!==%20serverOrigin)%20%7B%5Cn%20%20%20%20%20%20%20%20return;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(e.data.openGallerySignal)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20ctn%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20let%20subChannelName%20=%20e.data.subChannelName;%5Cn%20%20%20%20%20%20%20%20let%20url;%5Cn%20%20%20%20%20%20%20%20if(window.lastUsedTextToImagePluginGalleryIframeUrl)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20url%20=%20new%20URL(window.lastUsedTextToImagePluginGalleryIframeUrl);%5Cn%20%20%20%20%20%20%20%20%20%20url.searchParams.set(%5C%22subChannelName%5C%22,%20subChannelName);%5Cn%20%20%20%20%20%20%20%20%20%20url%20=%20url.href;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20url%20=%20%60$%7BserverOrigin%7D/gallery?channel=$%7Bwindow.generatorName%7D&subChannel=$%7BencodeURIComponent(subChannelName)%7D&sort=trending&timeRange=1-month&contentFilter=pg13%60;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20let%20backgroundColor%20=%20window.matchMedia%20&&%20window.matchMedia('(prefers-color-scheme:%20dark)').matches%20?%20%5C%22#242424%5C%22%20:%20%5C%22white%5C%22;%5Cn%20%20%20%20%20%20%20%20ctn.innerHTML%20=%20%60%3Cdiv%20onclick=%5C%22this.remove()%5C%22%20style=%5C%22backdrop-filter:brightness(0.3);position:fixed;top:0;left:0;right:0;bottom:0;z-index:999;%5C%22%3E%3Cdiv%20style=%5C%22position:fixed;top:5vh;bottom:5vh;left:5vh;right:5vh;background:$%7BbackgroundColor%7D;border-radius:3px;%5C%22%3E%3Ciframe%20src=%5C%22$%7Burl%7D%5C%22%20style=%5C%22border:0;width:100%25;height:100%25;%5C%22%3E%3C/iframe%3E%3C/div%3E%3C/div%3E%60;%5Cn%20%20%20%20%20%20%20%20document.body.appendChild(ctn.firstElementChild);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(e.data.savedImageToGallerySignal)%20%7B%5Cn%20%20%20%20%20%20%20%20document.querySelectorAll(%5C%22.text-to-image-plugin-gallery%5C%22).forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20targetOrigin%20=%20serverOrigin;%5Cn%20%20%20%20%20%20%20%20%20%20el.contentWindow.postMessage(%7BdoRefreshIfSortingByRecent:true%7D,%20targetOrigin);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20//%20the%20code%20below%20is%20commented%20out%20because%20it%20doesn't%20work%20for%20the%20case%20where%20the%20user%20has%20switched%20the%20sort%20to%20recent%20(since,%20counter-intuitively,%20iframe's%20window.location%20can%20change,%20while%20iframe.src%20stays%20as%20the%20original%20value%20-%20I'm%20assuming%20this%20is%20due%20to%20cross-origin%20security%20stuff)%5Cn%20%20%20%20%20%20%20%20%20%20//%20if(el.src.includes(%5C%22sort=recent%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20%20%20//%20refresh%20galleries%20that%20are%20sorted%20by%20recent%20if%20the%20user%20makes%20a%20submission%5Cn%20%20%20%20%20%20%20%20%20%20//%20%20%20let%20url%20=%20new%20URL(el.src);%5Cn%20%20%20%20%20%20%20%20%20%20//%20%20%20url.searchParams.set(%5C%22cacheBust%5C%22,%20Math.random().toString());%5Cn%20%20%20%20%20%20%20%20%20%20//%20%20%20el.src%20=%20%5C%22%5C%22;%20//%20we%20do%20this%20instead%20of%20el.src=el.src%20because%20that%20doesn't%20work%20if%20the%20URL%20has%20a%20hash%20in%20it,%20and%20I%20might%20need%20to%20add%20data%20in%20the%20hash%20later%5Cn%20%20%20%20%20%20%20%20%20%20//%20%20%20setTimeout(()%20=%3Eel.src=url.href,%20700);%20//%20we%20need%20to%20wait%20a%20bit%20for%20the%20iframe%20to%20actually%20initiate%20a%20reload/refresh%20before%20setting%20the%20src%20again%5Cn%20%20%20%20%20%20%20%20%20%20//%20%7D%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(e.data.documentHeightChanged)%20%7B%5Cn%20%20%20%20%20%20%20%20document.querySelectorAll(%5C%22.text-to-image-plugin-gallery%5C%22).forEach(el%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(el.dataset.adaptiveHeight%20===%20%5C%22yes%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20el.style.height%20=%20(e.data.newHeight+1)+%5C%22px%5C%22;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.debug(%5C%22Updated%20gallery%20height%5C%22,%20e.data.newHeight);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(e.data.customButtonClickEvent)%20%7B%5Cn%20%20%20%20%20%20%20%20if(e.data.isButton2)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20handlerFn%20=%20pluginData.galleryCustomButton2ClickHandlers%5Be.data.galleryInstanceId%5D;%5Cn%20%20%20%20%20%20%20%20%20%20if(handlerFn)%20handlerFn(e.data.onClickHandlerData);%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20let%20handlerFn%20=%20pluginData.galleryCustomButtonClickHandlers%5Be.data.galleryInstanceId%5D;%5Cn%20%20%20%20%20%20%20%20%20%20if(handlerFn)%20handlerFn(e.data.onClickHandlerData);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20window.___textToImagePluginData98420274%20=%20%7B%5Cn%20%20%20%20%20%20galleryCustomButtonClickHandlers:%20%7B%7D,%5Cn%20%20%20%20%20%20galleryCustomButton2ClickHandlers:%20%7B%7D,%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%20%20pluginData%20=%20window.___textToImagePluginData98420274;%5Cn%20%20%5Cn%20%20if(data.gallery)%20%7B%5Cn%20%20%20%20//%20NOTE:%20this%20is%20a%20somewhat%20'breaking'%20change,%20but%20I'm%20no%20longer%20allowing%20unfiltered%20content%20to%20be%20shown%20by%20default.%5Cn%20%20%20%20//%20The%20user%20must%20specifically%20choose%20to%20switch%20the%20gallery%20to%20unfiltered%20mode.%5Cn%20%20%20%20data.contentFilter%20=%20%5C%22pg13%5C%22;%5Cn%20%20%5Cn%20%20%20%20let%20sort%20=%20data.sort%20?%20data.sort.evaluateItem%20:%20%5C%22recent%5C%22;%5Cn%20%20%20%20if(sort%20===%20%5C%22best%5C%22)%20sort%20=%20%5C%22top%5C%22;%20//%20alias%5Cn%20%20%20%20%5Cn%20%20%20%20let%20contentFilter%20=%20data.contentFilter%20?%20data.contentFilter.evaluateItem.toLowerCase()%20:%20%5C%22pg13%5C%22;%5Cn%20%20%20%20if(contentFilter%20===%20%5C%22pg-13%5C%22)%20contentFilter%20=%20%5C%22pg13%5C%22;%5Cn%20%20%20%20%5Cn%20%20%20%20let%20bannedUsers%20=%20data.bannedUsers%20?%20data.bannedUsers.selectAll.map(item%20=%3E%20item.toString())%20:%20%5B%5D;%5Cn%20%20%20%20let%20bannedPromptPhrases%20=%20data.bannedPromptPhrases%20?%20data.bannedPromptPhrases.selectAll.map(item%20=%3E%20item.getRawListText.replace(%5C%22/%5C%5C%5C%5C%5E%5C%22,%20%5C%22/%5E%5C%22))%20:%20%5B%5D;%5Cn%20%20%20%20let%20bannedNegativePromptPhrases%20=%20data.bannedNegativePromptPhrases%20?%20data.bannedNegativePromptPhrases.selectAll.map(item%20=%3E%20item.getRawListText.replace(%5C%22/%5C%5C%5C%5C%5E%5C%22,%20%5C%22/%5E%5C%22))%20:%20%5B%5D;%5Cn%20%20%20%20%5Cn%20%20%20%20let%20timeRange%20=%20data.timeRange%20?%20data.timeRange.evaluateItem%20:%20(sort%20===%20%5C%22recent%5C%22%20?%20%5C%22all-time%5C%22%20:%20%5C%221-month%5C%22);%5Cn%20%20%20%20let%20hideIfScoreIsBelow%20=%20data.hideIfScoreIsBelow%20!==%20undefined%20?%20Number(data.hideIfScoreIsBelow.evaluateItem)%20:%20-1000000000;%5Cn%20%20%20%20if(isNaN(hideIfScoreIsBelow))%20hideIfScoreIsBelow%20=%20-1000000000;%5Cn%20%20%20%20%5Cn%20%20%20%20let%20galleryOptions%20=%20%7Bsort,%20timeRange,%20hideIfScoreIsBelow,%20contentFilter,%20subChannel:%5C%22public%5C%22%7D;%20//%20this%20is%20also%20used%20for%20checking%20if%20gallery%20options%20have%20been%20udpated%20(see%20below)%5Cn%20%20%20%20if(data.forceColorScheme)%20galleryOptions.forceColorScheme%20=%20data.forceColorScheme;%5Cn%5Cn%20%20%20%20const%20galleryInstanceId%20=%20%5C%22galleryInstanceId%5C%22+(Math.random().toString()+Math.random().toString()).replaceAll(%5C%22.%5C%22,%20%5C%22%5C%22);%5Cn%20%20%20%20%5Cn%20%20%20%20let%20customButtonEmoji%20=%20null;%5Cn%20%20%20%20let%20shouldShowCustomButton%20=%20false;%5Cn%20%20%20%20let%20customButtonOptions%20=%20data.customButton%20%7C%7C%20data.customButton1;%5Cn%20%20%20%20if(customButtonOptions)%20%7B%5Cn%20%20%20%20%20%20shouldShowCustomButton%20=%20true;%5Cn%20%20%20%20%20%20if(customButtonOptions.onClick)%20pluginData.galleryCustomButtonClickHandlers%5BgalleryInstanceId%5D%20=%20customButtonOptions.onClick;%5Cn%20%20%20%20%20%20if(customButtonOptions.emoji)%20customButtonEmoji%20=%20customButtonOptions.emoji.evaluateItem;%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20let%20customButton2Emoji%20=%20null;%5Cn%20%20%20%20let%20shouldShowCustomButton2%20=%20false;%5Cn%20%20%20%20if(data.customButton2)%20%7B%5Cn%20%20%20%20%20%20shouldShowCustomButton2%20=%20true;%5Cn%20%20%20%20%20%20if(data.customButton2.onClick)%20pluginData.galleryCustomButton2ClickHandlers%5BgalleryInstanceId%5D%20=%20data.customButton2.onClick;%5Cn%20%20%20%20%20%20if(data.customButton2.emoji)%20customButton2Emoji%20=%20data.customButton2.emoji.evaluateItem;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20let%20hashData%20=%20%7BgalleryInstanceId,%20shouldShowCustomButton,%20customButtonEmoji,%20shouldShowCustomButton2,%20customButton2Emoji,%20bannedUsers,%20bannedPromptPhrases,%20bannedNegativePromptPhrases,%20injectedStyles:%7B%7D%7D;%5Cn%20%20%20%20if(data.style)%20%7B%5Cn%20%20%20%20%20%20let%20style%20=%20data.style.evaluateItem.trim();%5Cn%20%20%20%20%20%20if(style.includes(%5C%22background:%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20hashData.injectedStyles.background%20=%20(style.match(/(?:%5E%7C;)%20*background:(.+?)(?:;%7C$)/)%20%7C%7C%20%5B%5D)%5B1%5D;%5Cn%20%20%20%20%20%20%7D%20else%20if(style.includes(%5C%22background-color:%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20hashData.injectedStyles.background%20=%20(style.match(/(?:%5E%7C;)%20*background-color:(.+?)(?:;%7C$)/)%20%7C%7C%20%5B%5D)%5B1%5D;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20let%20otherUrlParams%20=%20%7Bchannel:window.generatorName%7D;%5Cn%20%20%20%20let%20iframeUrl%20=%20new%20URL(%60$%7BserverOrigin%7D/gallery%60);%5Cn%20%20%20%20Object.entries(galleryOptions).forEach((%5Bkey,%20value%5D)%20=%3E%20iframeUrl.searchParams.set(key,%20value));%5Cn%20%20%20%20Object.entries(otherUrlParams).forEach((%5Bkey,%20value%5D)%20=%3E%20iframeUrl.searchParams.set(key,%20value));%5Cn%20%20%20%20%5Cn%20%20%20%20%5Cn%20%20%20%20function%20makeGalleryIframeHtml()%20%7B%5Cn%20%20%20%20%20%20let%20url%20=%20iframeUrl.href%20+%20%60#data=$%7BencodeURIComponent(JSON.stringify(hashData))%7D%60;%5Cn%20%20%20%20%20%20window.lastUsedTextToImagePluginGalleryIframeUrl%20=%20url;%5Cn%20%20%20%20%20%20return%20%60%3Ciframe%20data-gallery-options=%5C%22$%7BencodeURIComponent(JSON.stringify(galleryOptions))%7D%5C%22%20data-adaptive-height=%5C%22$%7Bdata.adaptiveHeight%20?%20%5C%22yes%5C%22%20:%20%5C%22no%5C%22%7D%5C%22%20style=%5C%22width:100%25;%20height:70vh;%20border:none;%20$%7Bdata.style%20%7C%7C%20%5C%22%5C%22%7D%5C%22%20class=%5C%22text-to-image-plugin-gallery%5C%22%20src=%5C%22$%7Burl%7D%5C%22%20allow=%5C%22clipboard-write%5C%22%3E%3C/iframe%3E%60;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(!document.querySelector(%5C%22.text-to-image-plugin-gallery%5C%22))%20%7B%5Cn%20%20%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20let%20marker%20=%20document.querySelector(%5C%22#temporaryMarkerElForTextToImageGallery84738932%5C%22);%5Cn%20%20%20%20%20%20%20%20if(marker)%20marker.outerHTML%20=%20makeGalleryIframeHtml()%5Cn%20%20%20%20%20%20%7D,%2050);%5Cn%20%20%20%20%20%20return%20%60%3Cspan%20id=%5C%22temporaryMarkerElForTextToImageGallery84738932%5C%22%3E%3C/span%3E%60;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20//%20update%20any%20gallery%20parameters%20if%20they%20have%20been%20changed:%5Cn%20%20%20%20%20%20let%20galleryIframe%20=%20document.querySelector(%5C%22.text-to-image-plugin-gallery%5C%22);%5Cn%20%20%20%20%20%20let%20newGalleryOptionsText%20=%20encodeURIComponent(JSON.stringify(galleryOptions));%5Cn%20%20%20%20%20%20if(galleryIframe.dataset.galleryOptions%20!==%20newGalleryOptionsText)%20%7B%5Cn%20%20%20%20%20%20%20%20galleryIframe.outerHTML%20=%20makeGalleryIframeHtml();%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20return%20%5C%22%5C%22;%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20///////////////////////////////////////////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20%20%20%20%20%20%20%20%20%20parse%20and%20evaluate%20prompt%20data/options%20from%20input%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%5Cn%20%20///////////////////////////////////////////////////////////////////////////////////////%5Cn%20%20const%20defaultGuidanceScale%20=%207;%5Cn%20%20%5Cn%20%20let%20d%20=%20%7B%7D;%20%5Cn%20%20//%20let%20dataInputWasNotAnOptionsObject%20=%20false;%5Cn%20%20%5Cn%20%20if(data.prompt%20===%20undefined)%20%7B%5Cn%20%20%20%20d.prompt%20=%20data.evaluateItem.toString();%20//%20they%20passed%20in%20some%20text%20directly%20like%20%5Bimage(%5C%22a%20carrot%5C%22)%5D%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20d.prompt%20=%20data.prompt.evaluateItem.toString();%5Cn%20%20%7D%5Cn%20%20//%20Apply%20some%20covenience%20fixes%20to%20the%20prompt,%20even%20though%20the%20plugin%20user%20should%20ideally%20fix%20this%20on%20their%20end:%5Cn%20%20d.prompt%20=%20d.prompt.replace(/%3Cspan%20%5B%5E%3E%5D+______tippy-tooltip-%5B%5E%3E%5D+%3E(.+?)%3C%5C%5C/span%3E/,%20%5C%22$1%5C%22);%5Cn%20%20%5Cn%20%20//%20parse%20values%20from%20prompts%20like:%20%60this%20is%20the%20prompt%20text%20(size:::400)%20(resolution:::512x768)%20(guidanceScale:::10)%60%5Cn%20%20if(d.prompt.includes(%5C%22:::%5C%22))%20%7B%5Cn%20%20%20%20let%20matches%20=%20%5B...d.prompt.matchAll(/%5C%5C((seed%7Csize%7Cstyle%7Cresolution%7Cwidth%7Cheight%7CguidanceScale%7CsaveTitle%7CsaveDescription)%5C%5C:%5C%5C:%5C%5C:/g)%5D;%5Cn%20%20%20%20//%20console.debug(%5C%22matches:%5C%22,%20matches);%5Cn%20%20%20%20const%20numericProps%20=%20%5B%5C%22seed%5C%22,%20%5C%22width%5C%22,%20%5C%22height%5C%22,%20%5C%22guidanceScale%5C%22,%20%5C%22width%5C%22,%20%5C%22height%5C%22,%20%5C%22size%5C%22%5D;%5Cn%20%20%20%20for(let%20match%20of%20matches)%20%7B%5Cn%20%20%20%20%20%20let%20re%20=%20new%20RegExp(%60%5C%5C%5C%5C($%7Bmatch%5B1%5D%7D%5C%5C%5C%5C:%5C%5C%5C%5C:%5C%5C%5C%5C:(.+?)%5C%5C%5C%5C).*?(?:%5C%5C%5C%5C:%5C%5C%5C%5C:%5C%5C%5C%5C:%7C$)%60,%20%5C%22m%5C%22);%5Cn%20%20%20%20%20%20let%20value%20=%20(d.prompt.match(re)%20%7C%7C%20%5B%5D)%5B1%5D%5Cn%20%20%20%20%20%20let%20key%20=%20match%5B1%5D;%5Cn%20%20%20%20%20%20if(value%20!==%20undefined)%20%7B%5Cn%20%20%20%20%20%20%20%20d%5Bkey%5D%20=%20numericProps.includes(key)%20?%20Number(value)%20:%20value;%5Cn%20%20%20%20%20%20%20%20d.prompt%20=%20d.prompt.replace(%60($%7Bkey%7D:::$%7Bvalue%7D)%60,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20d.prompt%20=%20d.prompt.trim();%5Cn%20%20%7D%5Cn%20%20if(!window.___t2i__parseNegativePrompt)%20%7B%5Cn%20%20%20%20window.___t2i__parseNegativePrompt%20=%20function(str)%20%7B%5Cn%20%20%20%20%20%20const%20prefix%20=%20'(negativePrompt:::';%5Cn%20%20%20%20%20%20const%20start%20=%20str.indexOf(prefix);%5Cn%20%20%20%20%20%20if%20(start%20===%20-1)%20return%20null;%5Cn%20%20%20%20%20%20let%20depth%20=%200;%5Cn%20%20%20%20%20%20let%20result%20=%20'';%5Cn%20%20%20%20%20%20for(let%20i%20=%20start%20+%20prefix.length;%20i%20%3C%20str.length;%20i++)%20%7B%5Cn%20%20%20%20%20%20%20%20if(str%5Bi%5D%20===%20'(')%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20depth++;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20if%20(str%5Bi%5D%20===%20')')%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(depth%20===%200)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20break;%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20depth--;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20result%20+=%20str%5Bi%5D;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20return%20result;%5Cn%20%20%20%20%7D;%5Cn%20%20%7D%5Cn%20%20if(d.prompt.includes(%5C%22(negativePrompt:::%5C%22))%20%7B%5Cn%20%20%20%20let%20result%20=%20window.___t2i__parseNegativePrompt(d.prompt);%5Cn%20%20%20%20if(result)%20%7B%5Cn%20%20%20%20%20%20d.negativePrompt%20=%20result;%5Cn%20%20%20%20%20%20d.prompt%20=%20d.prompt.replace(%60(negativePrompt:::$%7Bd.negativePrompt%7D)%60,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20d.prompt%20=%20d.prompt.replace(%60(negativePrompt:::$%7Bd.negativePrompt%7D%60,%20%5C%22%5C%22);%20//%20since%20if%20final%20bracket%20is%20missing,%20then%20all%20following%20text%20is%20considered%20the%20negative%20prompt%5Cn%20%20%20%20%7D%5Cn%20%20%20%20d.prompt%20=%20d.prompt.trim();%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if(!data.prompt)%20%7B%20//%20they%20passed%20in%20some%20text%20directly%20like%20%5Bimage(%5C%22a%20carrot%5C%22)%5D,%20so%20add%20some%20defaults/fallbacks.%5Cn%20%20%20%20if(d.seed%20===%20undefined)%20d.seed%20=%20-1;%5Cn%20%20%20%20if(d.width%20===%20undefined)%20d.width%20=%20300;%5Cn%20%20%20%20if(d.height%20===%20undefined)%20d.height%20=%20300;%5Cn%20%20%20%20if(d.resolution%20===%20undefined)%20d.resolution%20=%20%5C%22512x512%5C%22;%20%20%20%5Cn%20%20%20%20if(d.guidanceScale%20===%20undefined)%20d.guidanceScale%20=%20defaultGuidanceScale;%5Cn%20%20%20%20if(d.negativePrompt%20===%20undefined)%20d.negativePrompt%20=%20%5C%22%5C%22;%5Cn%20%20%20%20if(d.style%20===%20undefined)%20d.style%20=%20%5C%22%5C%22;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20//%20EDIT:%20Not%20going%20ahead%20with%20this%20for%20now%20in%20favor%20of%20a%20setting%20a%20global%20variable%20which%20contains%20data%20on%20the%20last-used%20prompt.%5Cn%20%20//%20//%20NOTE:%20Originally%20%60data%60%20was%20the%20only%20param%20and%20it%20could%20be%20the%20prompt,%20or%20a%20promptOptions%20object/list.%5Cn%20%20//%20//%20But%20I%20realised%20that%20it's%20not%20very%20ergonomic%20(see%20e.g.%20reddit.com/r/perchance/comments/yta11r),%20so%20now,%20in%20a%20backwards-compatible%20way,%5Cn%20%20//%20//%20I'm%20allowing%20the%20user%20to%20pass%20the%20options%20as%20the%20second%20parameter%20instead.%20This%20just%20means%20that%20if%20data%20is%20a%20prompt%20(rather%20than%20a%5Cn%20%20//%20//%20promptOptions%20object),%20then%20we%20use%20the%20%60options%60%20parameter%20(which%20defaults%20to%20an%20empty%20object)%20for%20the%20generation%20options:%5Cn%20%20//%20if(dataInputWasNotAnOptionsObject)%20%7B%5Cn%20%20//%20%20%20data%20=%20options;%20//%20this%5Cn%20%20//%20%7D%5Cn%20%20%5Cn%20%20if(!d.seed)%20d.seed%20=%20data.seed%20?%20data.seed.evaluateItem%20:%20-1;%5Cn%20%20if(!d.resolution)%20d.resolution%20=%20data.resolution%20?%20data.resolution.evaluateItem%20:%20%5C%22512x512%5C%22;%5Cn%20%20if(!d.guidanceScale)%20d.guidanceScale%20=%20data.guidanceScale%20?%20data.guidanceScale.evaluateItem%20:%20defaultGuidanceScale;%5Cn%20%20if(!d.negativePrompt)%20d.negativePrompt%20=%20data.negativePrompt%20?%20data.negativePrompt.evaluateItem%20:%20%5C%22%5C%22;%5Cn%20%20if(!d.width)%20d.width%20=%20data.width%20?%20data.width.evaluateItem%20:%20undefined;%20%5Cn%20%20if(!d.height)%20d.height%20=%20data.height%20?%20data.height.evaluateItem%20:%20undefined;%20%5Cn%20%20if(!d.style)%20d.style%20=%20data.style%20?%20data.style.evaluateItem%20:%20%5C%22%5C%22;%5Cn%20%20if(!d.saveTitle)%20d.saveTitle%20=%20data.saveTitle%20?%20data.saveTitle.evaluateItem%20:%20%5C%22%5C%22;%5Cn%20%20if(!d.saveDescription)%20d.saveDescription%20=%20data.saveDescription%20?%20data.saveDescription.evaluateItem%20:%20%5C%22%5C%22;%5Cn%20%20%5Cn%20%20%5Cn%20%20//%20NOTE:%20This%20stuff%20is%20not%20longer%20needed%20because%20we%20do%20the%20parsing%20above%20regardless%20of%20whether%20they%20passed%20a%20plain%20string%20in,%20or%20a%20promptOptions%20object.%5Cn%20%20//%20//%20if%20seed%20is%20specified%20within%20the%20prompt%20with%20the%20(key:::value)%20format%20-%20i.e.%20they%20used%20promptOptions%20input%20but%20specified%20the%20seed%20within%20promptOptions.prompt,%20and%20so%20long%20as%20promptOptions.seed%20is%20not%20specified,%20then%20we%20set%20the%20seed%20to%20the%20one%20specified%20in%20the%20prompt:%5Cn%20%20//%20if(data.seed%20===%20undefined%20&&%20d.prompt.includes(%5C%22(seed:::%5C%22))%20%7B%5Cn%20%20//%20%20%20let%20seed%20=%20null;%5Cn%20%20//%20%20%20d.prompt%20=%20d.prompt.replace(/%5C%5C(seed:::(%5B0-9%5D+)%5C%5C)/g,%20(m,%20p1)%20=%3E%20%7B%20seed=Number(p1);%20return%20%5C%22%5C%22;%20%7D);%5Cn%20%20//%20%20%20if(seed)%20%7B%5Cn%20%20//%20%20%20%20%20d.seed%20=%20seed;%5Cn%20%20//%20%20%20%7D%5Cn%20%20//%20%7D%5Cn%20%20//%20//%20same%20for%20guidanceScale:%5Cn%20%20//%20if(data.guidanceScale%20===%20undefined%20&&%20d.prompt.includes(%5C%22(guidanceScale:::%5C%22))%20%7B%5Cn%20%20//%20%20%20let%20guidanceScale%20=%20null;%5Cn%20%20//%20%20%20d.prompt%20=%20d.prompt.replace(/%5C%5C(guidanceScale:::(%5B0-9%5D+)%5C%5C)/g,%20(m,%20p1)%20=%3E%20%7B%20guidanceScale=Number(p1);%20return%20%5C%22%5C%22;%20%7D);%5Cn%20%20//%20%20%20if(guidanceScale)%20%7B%5Cn%20%20//%20%20%20%20%20d.guidanceScale%20=%20guidanceScale;%5Cn%20%20//%20%20%20%7D%5Cn%20%20//%20%7D%5Cn%20%20//%20//%20same%20for%20width:%5Cn%20%20//%20if(data.guidanceScale%20===%20undefined%20&&%20d.prompt.includes(%5C%22(width:::%5C%22))%20%7B%5Cn%20%20//%20%20%20let%20width%20=%20null;%5Cn%20%20//%20%20%20d.prompt%20=%20d.prompt.replace(/%5C%5C(width:::(%5B0-9%5D+)%5C%5C)/g,%20(m,%20p1)%20=%3E%20%7B%20width=Number(p1);%20return%20%5C%22%5C%22;%20%7D);%5Cn%20%20//%20%20%20if(width)%20%7B%5Cn%20%20//%20%20%20%20%20d.width%20=%20width;%5Cn%20%20//%20%20%20%7D%5Cn%20%20//%20%7D%5Cn%20%20//%20//%20same%20for%20height:%5Cn%20%20//%20if(data.guidanceScale%20===%20undefined%20&&%20d.prompt.includes(%5C%22(height:::%5C%22))%20%7B%5Cn%20%20//%20%20%20let%20height%20=%20null;%5Cn%20%20//%20%20%20d.prompt%20=%20d.prompt.replace(/%5C%5C(height:::(%5B0-9%5D+)%5C%5C)/g,%20(m,%20p1)%20=%3E%20%7B%20height=Number(p1);%20return%20%5C%22%5C%22;%20%7D);%5Cn%20%20//%20%20%20if(height)%20%7B%5Cn%20%20//%20%20%20%20%20d.height%20=%20height;%5Cn%20%20//%20%20%20%7D%5Cn%20%20//%20%7D%5Cn%20%20//%20//%20same%20for%20size:%5Cn%20%20//%20if(data.guidanceScale%20===%20undefined%20&&%20d.prompt.includes(%5C%22(size:::%5C%22))%20%7B%5Cn%20%20//%20%20%20let%20size%20=%20null;%5Cn%20%20//%20%20%20d.prompt%20=%20d.prompt.replace(/%5C%5C(size:::(%5B0-9%5D+)%5C%5C)/g,%20(m,%20p1)%20=%3E%20%7B%20size=Number(p1);%20return%20%5C%22%5C%22;%20%7D);%5Cn%20%20//%20%20%20if(size)%20%7B%5Cn%20%20//%20%20%20%20%20d.size%20=%20size;%5Cn%20%20//%20%20%20%7D%5Cn%20%20//%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20%20%20%20%20%20%20sanity%20checks%20on%20inputs%20%20%20%20%20%20%20%20%20%20//%5Cn%20%20////////////////////////////////////////////////%5Cn%20%20%5Cn%20%20if(d.size%20&&%20d.resolution%20&&%20d.resolution.split(%5C%22x%5C%22)%5B0%5D%20!==%20d.resolution.split(%5C%22x%5C%22)%5B1%5D)%20%7B%5Cn%20%20%20%20return%20%60(text-to-image-plugin:%20%3Cb%3Esize%3C/b%3E%20is%20only%20a%20valid%20parameter%20with%20square%20resolutions.%20use%20%3Cb%3Ewidth%3C/b%3E%20and%20%3Cb%3Eheight%3C/b%3E%20instead)%60;%5Cn%20%20%7D%5Cn%5Cn%20%20if(d.guidanceScale%20%3C%201%20%7C%7C%20Math.round(d.guidanceScale)%20!==%20d.guidanceScale)%20%7B%5Cn%20%20%20%20return%20%60(text-to-image-plugin:%20%3Cb%3EguidanceScale%3C/b%3E%20should%20be%20a%20whole%20number%20between%201%20and%2030,%20inclusive)%60;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if(!%5B%5C%22512x512%5C%22,%20%5C%22512x768%5C%22,%20%5C%22768x512%5C%22,%20%5C%22768x768%5C%22%5D.includes(d.resolution))%20%7B%5Cn%20%20%20%20return%20%5C%22(text-to-image-plugin:%20Currently,%20the%20only%20valid%20resolutions%20are%20512x512,%20768x768,%20512x768%20and%20768x512)%5C%22;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%20%20////////////////////////////////////////////////%5Cn%20%20//%20%20%20%20%20%20%20%20un-shortcut%20size/width/height%20%20%20%20%20%20%20//%5Cn%20%20////////////////////////////////////////////////%5Cn%20%20let%20resW%20=%20Number(d.resolution.split(%5C%22x%5C%22)%5B0%5D);%5Cn%20%20let%20resH%20=%20Number(d.resolution.split(%5C%22x%5C%22)%5B1%5D);%5Cn%20%20let%20widthHeightCss%20=%20%5C%22%5C%22;%5Cn%20%20if(d.size)%20%7B%5Cn%20%20%20%20let%20size%20=%20d.size.evaluateItem;%5Cn%20%20%20%20if(typeof%20size%20===%20%5C%22number%5C%22)%20size%20+=%20%5C%22px%5C%22;%5Cn%20%20%20%20widthHeightCss%20=%20%60width:$%7Bsize%7D%60;%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20if(d.width%20&&%20!d.height)%20%7B%5Cn%20%20%20%20%20%20d.width%20=%20d.width.evaluateItem;%5Cn%20%20%20%20%20%20if(typeof%20d.width%20===%20%5C%22number%5C%22)%20d.width%20+=%20%5C%22px%5C%22;%5Cn%20%20%20%20%20%20widthHeightCss%20=%20%60width:$%7Bd.width%7D%60;%5Cn%20%20%20%20%20%20//%20d.height%20=%20d.width%20*%20(resH/resW);%5Cn%20%20%20%20%7D%20else%20if(!d.width%20&&%20d.height)%20%7B%5Cn%20%20%20%20%20%20d.height%20=%20d.height.evaluateItem;%5Cn%20%20%20%20%20%20if(typeof%20d.height%20===%20%5C%22number%5C%22)%20d.height%20+=%20%5C%22px%5C%22;%5Cn%20%20%20%20%20%20widthHeightCss%20=%20%60height:$%7Bd.height%7D%60;%5Cn%20%20%20%20%20%20//%20d.width%20=%20d.height%20*%20(resW/resH);%5Cn%20%20%20%20%7D%20else%20if(!d.width%20&&%20!d.height)%20%7B%5Cn%20%20%20%20%20%20//%20make%20the%20smallest%20side%20300px%20by%20default:%5Cn%20%20%20%20%20%20let%20defaultSize%20=%20300;%5Cn%20%20%20%20%20%20if(d.resolution%20===%20%5C%22768x768%5C%22)%20defaultSize%20=%20450;%5Cn%20%20%20%20%20%20if(resW%20%3E%20resH)%20%7B%5Cn%20%20%20%20%20%20%20%20d.height%20=%20defaultSize;%5Cn%20%20%20%20%20%20%20%20widthHeightCss%20=%20%60height:$%7Bd.height%7Dpx%60;%20//%20can't%20add%20max-height:100%25%20here%20-%20it%20breaks%20stuff,%20like%20ai-character-chat%5Cn%20%20%20%20%20%20%20%20//%20d.width%20=%20d.height%20*%20(resW/resH);%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20d.width%20=%20defaultSize;%5Cn%20%20%20%20%20%20%20%20widthHeightCss%20=%20%60width:$%7Bd.width%7Dpx%60;%20//%20can't%20add%20max-width:100%25%20here%20-%20it%20breaks%20stuff,%20like%20ai-character-chat%5Cn%20%20%20%20%20%20%20%20//%20d.height%20=%20d.width%20*%20(resH/resW);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%20else%20if(d.width%20&&%20d.height)%20%7B%5Cn%20%20%20%20%20%20if(typeof%20d.width%20===%20%5C%22number%5C%22)%20d.width%20+=%20%5C%22px%5C%22;%5Cn%20%20%20%20%20%20if(typeof%20d.height%20===%20%5C%22number%5C%22)%20d.height%20+=%20%5C%22px%5C%22;%5Cn%20%20%20%20%20%20widthHeightCss%20=%20%60width:$%7Bd.width%7D;%20height:$%7Bd.height%7D%60;%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if(d.style%20&&%20/%5B;%5C%5Cs%5D?(width%7Cheight):/.test(d.style))%20widthHeightCss%20=%20%5C%22%5C%22;%5Cn%20%20%5Cn%20%20if(!CSS.supports(%5C%22aspect-ratio%5C%22,%20%5C%221/2%5C%22))%20%7B%20//%20hackily%20help%20old%20browsers%20that%20don't%20support%20aspect-ratio%20if%20possible%5Cn%20%20%20%20let%20width%20=%20(widthHeightCss.match(/width:(%5B%5E;%5D+)px;?/)%20%7C%7C%20%5B%5D)%5B1%5D;%5Cn%20%20%20%20if(width%20&&%20!widthHeightCss.includes(%5C%22height%5C%22)%20&&%20!isNaN(Number(width)))%20%7B%5Cn%20%20%20%20%20%20widthHeightCss%20+=%20%60;%20height:$%7BNumber(width)%20*%20(resH/resW)%7Dpx;%60;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20let%20height%20=%20(widthHeightCss.match(/height:(%5B%5E;%5D+)px;?/)%20%7C%7C%20%5B%5D)%5B1%5D;%5Cn%20%20%20%20if(height%20&&%20!widthHeightCss.includes(%5C%22width%5C%22)%20&&%20!isNaN(Number(height)))%20%7B%5Cn%20%20%20%20%20%20widthHeightCss%20+=%20%60;%20width:$%7BNumber(height)%20*%20(resW/resH)%7Dpx;%60;%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20requestId%20=%20Math.random().toString();%5Cn%20%20let%20privateIframeId%20=%20%5C%22id%5C%22%20+%20Math.random().toString().replace(%5C%22.%5C%22,%20%5C%22%5C%22);%5Cn%20%20%5Cn%20%20//%20let%20iframePromiseResolver;%5Cn%20%20//%20let%20iframePromise%20=%20new%20Promise(r%20=%3E%20iframePromiseResolver=r);%5Cn%20%20//%20let%20canvasPromiseResolver;%5Cn%20%20//%20let%20canvasPromise%20=%20new%20Promise(r%20=%3E%20canvasPromiseResolver=r);%5Cn%20%20//%20let%20dataUrlPromiseResolver;%5Cn%20%20//%20let%20dataUrlPromise%20=%20new%20Promise(r%20=%3E%20dataUrlPromiseResolver=r);%5Cn%20%20let%20onFinishPromiseResolver;%5Cn%20%20let%20onFinishPromise%20=%20new%20Promise(r%20=%3E%20onFinishPromiseResolver=r);%5Cn%20%20%5Cn%5Cn%20%20async%20function%20messageHandler(event)%20%7B%5Cn%20%20%20%20if(event.data.type%20===%20'finished'%20&&%20event.data.id%20===%20privateIframeId)%20%7B%5Cn%20%20%20%20%20%20//%20TODO:%20Should%20remove%20this%20message%20handler%20when%20it's%20finished,%20but%20%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20function%20drawDataURLToCanvas(dataURL)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20Promise((resolve,%20reject)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20canvas%20=%20document.createElement(%5C%22canvas%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20const%20ctx%20=%20canvas.getContext(%5C%222d%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20const%20img%20=%20new%20Image();%5Cn%20%20%20%20%20%20%20%20%20%20img.onload%20=%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20canvas.width%20=%20img.width;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20canvas.height%20=%20img.height;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20ctx.drawImage(img,%200,%200);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20resolve(canvas);%5Cn%20%20%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%20%20%20%20img.src%20=%20dataURL;%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20async%20function%20removeBackground(imageUrl)%20%7B%20//%20can%20be%20data%20url%20or%20normal%20URL%5Cn%20%20%20%20%20%20%20%20if%20(!removeBackground.transformers)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20const%20transformers%20=%20await%20import('https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.3');%5Cn%20%20%20%20%20%20%20%20%20%20transformers.env.allowLocalModels%20=%20false;%5Cn%20%20%20%20%20%20%20%20%20%20transformers.env.backends.onnx.wasm.proxy%20=%20true;%5Cn%20%20%20%20%20%20%20%20%20%20removeBackground.transformers%20=%20transformers;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20const%20%7B%20AutoModel,%20AutoProcessor,%20RawImage%20%7D%20=%20removeBackground.transformers;%5Cn%20%20%20%20%20%20%20%20if%20(!removeBackground.model%20%7C%7C%20!removeBackground.processor)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20removeBackground.model%20=%20await%20AutoModel.from_pretrained('briaai/RMBG-1.4',%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20config:%20%7B%20model_type:%20'custom'%20%7D,%5Cn%20%20%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20%20%20removeBackground.processor%20=%20await%20AutoProcessor.from_pretrained('briaai/RMBG-1.4',%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20config:%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20do_normalize:%20true,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20do_pad:%20false,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20do_rescale:%20true,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20do_resize:%20true,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20image_mean:%20%5B0.5,%200.5,%200.5%5D,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20feature_extractor_type:%20%5C%22ImageFeatureExtractor%5C%22,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20image_std:%20%5B1,%201,%201%5D,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20resample:%202,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20rescale_factor:%200.00392156862745098,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20size:%20%7B%20width:%201024,%20height:%201024%20%7D,%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20const%20image%20=%20await%20RawImage.fromURL(imageUrl);%5Cn%20%20%20%20%20%20%20%20const%20%7B%20pixel_values%20%7D%20=%20await%20removeBackground.processor(image);%5Cn%20%20%20%20%20%20%20%20const%20%7B%20output%20%7D%20=%20await%20removeBackground.model(%7B%20input:%20pixel_values%20%7D);%5Cn%20%20%20%20%20%20%20%20const%20mask%20=%20await%20RawImage.fromTensor(output%5B0%5D.mul(255).to('uint8')).resize(image.width,%20image.height);%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20const%20canvas%20=%20document.createElement('canvas');%5Cn%20%20%20%20%20%20%20%20canvas.width%20=%20image.width;%5Cn%20%20%20%20%20%20%20%20canvas.height%20=%20image.height;%5Cn%20%20%20%20%20%20%20%20const%20ctx%20=%20canvas.getContext('2d');%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20//%20Draw%20original%20image%20output%20to%20canvas%5Cn%20%20%20%20%20%20%20%20ctx.drawImage(image.toCanvas(),%200,%200);%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20//%20Update%20alpha%20channel%5Cn%20%20%20%20%20%20%20%20const%20pixelData%20=%20ctx.getImageData(0,%200,%20image.width,%20image.height);%5Cn%20%20%20%20%20%20%20%20for%20(let%20i%20=%200;%20i%20%3C%20mask.data.length;%20++i)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20pixelData.data%5B4%20*%20i%20+%203%5D%20=%20mask.data%5Bi%5D;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20ctx.putImageData(pixelData,%200,%200);%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20return%20canvas.toDataURL('image/png');%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20dataUrl%20=%20event.data.dataUrl;%5Cn%20%20%20%20%20%20if(data.removeBackground)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20pngDataUrlWithBgRemoved%20=%20await%20removeBackground(dataUrl).catch(console.error);%5Cn%20%20%20%20%20%20%20%20if(pngDataUrlWithBgRemoved)%20dataUrl%20=%20pngDataUrlWithBgRemoved;%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20let%20canvas%20=%20await%20drawDataURLToCanvas(dataUrl);%5Cn%20%20%20%20%20%20let%20iframe%20=%20document.querySelector(%60iframe.$%7BprivateIframeId%7D%60);%20//%20NOTE:%20may%20be%20null%20if%20it%20has%20been%20removed!%20(todo:%20keep%20original%20reference%20around%20instead%20of%20querySelector?)%5Cn%5Cn%20%20%20%20%20%20if(!iframe)%20window.removeEventListener('message',%20messageHandler);%20//%20iframes%20not%20in%20DOM%20cannot%20send%20any%20more%20messages%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20outputData%20=%20new%20String(dataUrl);%5Cn%20%20%20%20%20%20outputData.canvas%20=%20canvas;%5Cn%20%20%20%20%20%20outputData.iframe%20=%20iframe;%5Cn%20%20%20%20%20%20outputData.dataUrl%20=%20dataUrl;%5Cn%20%20%20%20%20%20outputData.inputs%20=%20evaluatedInputs;%5Cn%20%20%20%20%20%20outputData.inputs.seed%20=%20event.data.seedUsed;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20if(iframe)%20iframe.textToImagePluginOutput%20=%20outputData;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20if(shouldRemoveIframeOnFinish)%20%7B%5Cn%20%20%20%20%20%20%20%20delete%20outputData.iframe;%5Cn%20%20%20%20%20%20%20%20iframe.remove();%5Cn%20%20%20%20%20%20%20%20window.removeEventListener('message',%20messageHandler);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20if(data.onFinish)%20%7B%5Cn%20%20%20%20%20%20%20%20data.onFinish(outputData);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20onFinishPromiseResolver(outputData);%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20window.addEventListener('message',%20messageHandler);%5Cn%20%20%5Cn%20%20let%20iframeExistentPollInterval%20=%20setInterval(()%20=%3E%20%7B%5Cn%20%20%20%20if(!document.querySelector(%60iframe.$%7BprivateIframeId%7D%60))%20%7B%5Cn%20%20%20%20%20%20clearInterval(iframeExistentPollInterval);%5Cn%20%20%20%20%20%20window.removeEventListener('message',%20messageHandler);%5Cn%20%20%20%20%7D%5Cn%20%20%7D,%201000*60);%20//%20not%20important%20to%20remove%20listener%20immediately,%20so%20long%20interval%20is%20fine%5Cn%20%20%5Cn%20%20function%20blobToDataUrl(blob)%20%7B%5Cn%20%20%20%20return%20new%20Promise(r%20=%3E%20%7B%5Cn%20%20%20%20%20%20const%20reader%20=%20new%20FileReader();%5Cn%20%20%20%20%20%20reader.onload%20=%20()%20=%3E%20r(reader.result);%5Cn%20%20%20%20%20%20reader.readAsDataURL(blob);%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20referenceImage%20=%20null;%5Cn%20%20if(data.referenceImage)%20%7B%5Cn%20%20%20%20referenceImage%20=%20%7B%7D;%5Cn%20%20%20%20//%20url%20can%20actually%20be%20a%20blob%20or%20a%20blob%20URL,%20in%20which%20case%20we%20postMessage%20the%20data%20to%20the%20iframe%5Cn%20%20%20%20let%20isBlobby%20=%20data.referenceImage.url%20instanceof%20Blob;%20//%20blobby%20means%20Blob%20or%20blob%20URL%20string%5Cn%20%20%20%20let%20url,%20blobby;%5Cn%20%20%20%20%5Cn%20%20%20%20if(isBlobby)%20blobby%20=%20data.referenceImage.url;%5Cn%20%20%20%20else%20url%20=%20data.referenceImage.url.evaluateItem;%5Cn%20%20%20%20%5Cn%20%20%20%20if(url.startsWith(%5C%22blob:%5C%22))%20%7B%5Cn%20%20%20%20%20%20isBlobby%20=%20true;%5Cn%20%20%20%20%20%20blobby%20=%20url;%5Cn%20%20%20%20%20%20url%20=%20null;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20if(isBlobby)%20%7B%5Cn%20%20%20%20%20%20referenceImage.url%20=%20%5C%22%3Cdata-via-postmessage%3E%5C%22;%5Cn%20%20%20%20%20%20(async%20()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20let%20blob;%5Cn%20%20%20%20%20%20%20%20if(typeof%20blobby%20===%20%5C%22string%5C%22%20&&%20blobby.startsWith(%5C%22blob:%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20blob%20=%20await%20fetch(blobby).then(r%20=%3E%20r.blob());%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20blob%20=%20blobby;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20let%20dataUrl%20=%20await%20blobToDataUrl(blob);%5Cn%20%20%20%20%20%20%20%20window.addEventListener('message',%20function(event)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(event.data.type%20===%20'readyForData'%20&&%20event.data.id%20===%20privateIframeId)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20document.querySelector(%60iframe.$%7BprivateIframeId%7D%60).contentWindow.postMessage(%7Bid:privateIframeId,%20referenceImageDataUrl:dataUrl%7D,%20serverOrigin);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20%7D)();%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20referenceImage.url%20=%20url;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20referenceImage.blur%20=%20data.referenceImage.blur.evaluateItem;%5Cn%20%20%20%20//%20if(referenceImage.url%20&&%20!referenceImage.url.startsWith(%5C%22https://user-uploads.perchance.%5C%22)%20&&%20!referenceImage.url.startsWith(%5C%22data:%5C%22))%20return%20%60referenceImage.url%20must%20either%20be%20a%20'data%20URL'%20(starting%20with%20'data:')%20or%20a%20https://user-uploads.perchance.org%20URL%20-%20i.e.%20an%20image%20that%20has%20been%20uploaded%20to%20https://perchance.org/upload%20-%20the%20URL%20you've%20used%20is:%20'$%7BreferenceImage.url%20&&%20typeof%20referenceImage.url%20===%20%5C%22string%5C%22%20&&%20referenceImage.url.length%20%3E%2030%20?%20referenceImage.url.slice(0,%2030)+%5C%22...%5C%22%20:%20referenceImage.url%7D'.%60;%5Cn%20%20%20%20if(referenceImage.blur%20%3E%201%20%7C%7C%20referenceImage.blur%20%3C%200)%20return%20%60referenceImage.blur%20must%20be%20between%200%20and%201,%20but%20is%20instead%20'$%7BreferenceImage.blur%20%3E%201%7D'.%60%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20window.addEventListener('message',%20function(event)%20%7B%5Cn%20%20%20%20if(event.data.type%20===%20'readyForData'%20&&%20event.data.id%20===%20privateIframeId)%20%7B%5Cn%20%20%20%20%20%20let%20iframe%20=%20document.querySelector(%60iframe.$%7BprivateIframeId%7D%60);%5Cn%20%20%20%20%20%20if(iframe)%20iframe.contentWindow.postMessage(%7Btype:%5C%22originNotify%5C%22,%20frameId:privateIframeId%7D,%20serverOrigin);%5Cn%20%20%20%20%7D%5Cn%20%20%7D);%5Cn%20%20%5Cn%20%20let%20urlHashData%20=%20%7B%5Cn%20%20%20%20saveChannel:%20window.generatorName,%5Cn%20%20%20%20saveTitle:%20d.saveTitle,%5Cn%20%20%20%20saveDescription:%20d.saveDescription,%5Cn%20%20%20%20prompt:%20d.prompt,%5Cn%20%20%20%20seed:%20d.seed,%5Cn%20%20%20%20resolution:%20d.resolution,%5Cn%20%20%20%20guidanceScale:%20d.guidanceScale,%5Cn%20%20%20%20defaultGuidanceScale,%5Cn%20%20%20%20negativePrompt:%20d.negativePrompt,%5Cn%20%20%20%20requestId:%20requestId,%5Cn%20%20%20%20forceColorScheme:%20data.forceColorScheme,%5Cn%20%20%20%20verifyOnly:%20data.verifyOnly,%5Cn%20%20%20%20iframeId:%20privateIframeId,%5Cn%20%20%20%20hideGalleryButtons:%20data.hideGalleryButtons,%5Cn%20%20%20%20removeBackground:%20data.removeBackground,%5Cn%20%20%20%20referenceImage,%5Cn%20%20%7D;%5Cn%20%20%5Cn%20%20//%20clone%20input%20for%20onFinish%20data:%5Cn%20%20evaluatedInputs%20=%20JSON.parse(JSON.stringify(d));%5Cn%20%20%5Cn%20%20let%20iframeId%20=%20data.id%20?%20data.id.evaluateItem%20:%20%5C%22%5C%22;%5Cn%20%20if(iframeId)%20%7B%5Cn%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20document.querySelector(%5C%22#%5C%22+iframeId).reload%20=%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20let%20src%20=%20this.src;%5Cn%20%20%20%20%20%20%20%20this.src%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20setTimeout(()%20=%3Ethis.src=src,%20700);%5Cn%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%7D,%20500);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20window.lastTextToImagePrompt%20=%20d.prompt;%5Cn%20%20if(data.prompt)%20%7B%20//%20%3C--%20i.e.%20if%20they%20passed%20a%20promptOptions%20object%5Cn%20%20%20%20data.lastUsedPrompt%20=%20d.prompt;%5Cn%20%20%20%20data.lastUsedNegativePrompt%20=%20d.negativePrompt;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20//%20VERY%20lazily%20load%20the%20iframe%20(only%20when%20screen%20actually%20intersects)%20because%20some%20people%20add%20a%20lot%20of%20images%20in%20subsections%20and%20in%20several%20different%20tabs%20of%20tabs-plugin,%20etc.%5Cn%20%20//%20This%20ensures%20they%20don't%20spam%20the%20server,%20and%20the%20visible%20ones%20get%20generated%20first.%5Cn%20%20setTimeout(async%20()%20=%3E%20%7B%5Cn%20%20%20%20//%20the%20dev%20may%20have%20generated%20the%20HTML,%20but%20not%20actually%20added%20it%20to%20the%20DOM%20for%20a%20while,%20so%20we%20wait%20up%20to%205%20mins%20for%20it%5Cn%20%20%20%20let%20waitedSeconds%20=%200;%5Cn%20%20%20%20while(%5B...document.querySelectorAll(%5C%22.text-to-image-plugin-image-iframe%5C%22)%5D.filter(el%20=%3E%20el.dataset.alreadyAddedIntersectionObserver%20===%20%5C%22no%5C%22).length%20===%200)%20%7B%5Cn%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%5Cn%20%20%20%20%20%20waitedSeconds%20+=%200.5;%5Cn%20%20%20%20%20%20if(waitedSeconds%20%3E%2060*5)%20return;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20for(let%20el%20of%20%5B...document.querySelectorAll(%5C%22.text-to-image-plugin-image-iframe%5C%22)%5D)%20%7B%5Cn%20%20%20%20%20%20if(el.dataset.alreadyAddedIntersectionObserver%20===%20%5C%22yes%5C%22)%20continue;%5Cn%20%20%20%20%20%20el.dataset.alreadyAddedIntersectionObserver%20=%20%5C%22yes%5C%22;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20observer1,%20observer2;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20rootMarginSize%20=%20Math.min(1000,%20(window.innerHeight*2));%5Cn%20%20%20%20%20%20if(window.innerWidth%20%3C%20600)%20%7B%5Cn%20%20%20%20%20%20%20%20rootMarginSize%20=%20Math.min(1500,%20(window.innerHeight*3));%20//%20larger%20on%20mobile%20because%20e.g.%20images%20that%20might%20otherwise%20be%20displayed%20side%20by%20side%20are%20instead%20displayed%20vertically%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20function%20handler(entries)%20%7B%5Cn%20%20%20%20%20%20%20%20if(entries%5B0%5D.isIntersecting)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20console.debug(%5C%22t2i%20iframe:%20Visible%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20if(!el.src)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20el.removeAttribute(%5C%22srcdoc%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20el.src%20=%20el.dataset.src;%5Cn%20%20%20%20%20%20%20%20%20%20%20%20observer1.disconnect();%5Cn%20%20%20%20%20%20%20%20%20%20%20%20observer2.disconnect();%20%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20console.debug(%5C%22t2i%20iframe:%20NOT%20Visible%5C%22);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20observer1%20=%20new%20IntersectionObserver(handler,%20%7B%5Cn%20%20%20%20%20%20%20%20root:%20document.documentElement,%20//%20otherwise%20I%20think%20it%20uses%20the%20top-level%20viewport?%20either%20way,%20it%20doesn't%20seem%20to%20work%20without%20specifying%20this.%5Cn%20%20%20%20%20%20%20%20rootMargin:%20rootMarginSize+%5C%22px%5C%22,%20//%20it's%20important%20that%20this%20is%20quite%20big%20-%20so%20that%20e.g.%20mobile%20users%20don't%20have%20to%20scroll%20down%20to%20trigger%20stuff.%20we%20basically%20want%20to%20trigger%20~all%20visible%20elements%20anyway%20-%20just%20not%20stuff%20hidden%20within%20e.g.%20tabs%20plugin%20or%20whatever.%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20observer1.observe(el);%5Cn%20%20%20%20%20%20//%20for%20some%20reason,%20in%20some%20situations,%20the%20above%20intersection%20observer%20was%20reporting%20the%20%60root%60%20and%20%60el%60%20bounding%20rects%20as%200x0x0x0.%20Adding%20a%20second%20observer%20using%20the%20viewport%20root%20fixes%20this:%5Cn%20%20%20%20%20%20observer2%20=%20new%20IntersectionObserver(handler,%20%7B%5Cn%20%20%20%20%20%20%20%20rootMargin:%20rootMarginSize+%5C%22px%5C%22,%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%20%20observer2.observe(el);%5Cn%20%20%20%20%7D%5Cn%20%20%7D,%20100);%20//%20CAUTION:%20do%20not%20remove/lower%20this%20delay.%20Some%20generators%20may%20create%20a%20large%20%5C%22feed%5C%22%20of%20images,%20and%20expect%20them%20to%20be%20lazy-loaded%20when%20scrolled%20to%20(e.g.%20AI%20chat%20feeds),%20so%20if%20you%20add%20the%20intersection%20observers%20~synchronously,%20they%20could%20be%20triggered%20during%20the%20process%20of%20actually%20generating%20the%20feed,%20which%20would%20cause%20them%20to%20all%20start%20generating%20during%20page%20load.%5Cn%20%20%5Cn%20%20//%20let%20outputString%20=%20new%20String(%60%3Ciframe%20$%7BiframeId%20?%20%60id=%5C%22$%7BiframeId%7D%5C%22%60%20:%20%5C%22%5C%22%7D%20class=%5C%22text-to-image-plugin-image-iframe%20$%7BprivateIframeId%7D%5C%22%20data-already-added-intersection-observer=%5C%22no%5C%22%20data-src=%5C%22$%7BserverOrigin%7D/embed#$%7BencodeURIComponent(JSON.stringify(urlHashData))%7D%5C%22%20style=%5C%22border:0;%20background:transparent;%20$%7BwidthHeightCss%7D;%20aspect-ratio:$%7BresW%7D/$%7BresH%7D;%20$%7Bd.style%7D%5C%22%3E%3C/iframe%3E%60);%5Cn%20%20//%20//%20leaving%20these%20out%20for%20now%20in%20favor%20of%20'onFinish'%20in%20prompt%20options%5Cn%20%20//%20//%20outputString.dataUrl%20=%20dataUrlPromise;%5Cn%20%20//%20//%20outputString.canvas%20=%20canvasPromise;%5Cn%20%20//%20outputString.onFinishPromise%20=%20onFinishPromise;%5Cn%20%20//%20outputString.iframeHtml%20=%20outputString;%5Cn%20%20//%20return%20outputString;%5Cn%20%20%5Cn%20%20//%20we%20return%20the%20promise%20which%20stringifies%20into%20the%20iframe%20html,%20we%20can%20write%20%5BtextToImage(promptOptions)%5D%20and%20while%20also%20being%20able%20to%20write%20%60let%20result%20=%20await%20textToImage(promptOptions);%60%5Cn%20%20let%20outputString%20=%20%60%3Ciframe%20$%7BiframeId%20?%20%60id=%5C%22$%7BiframeId%7D%5C%22%60%20:%20%5C%22%5C%22%7D%20class=%5C%22text-to-image-plugin-image-iframe%20$%7BprivateIframeId%7D%5C%22%20data-already-added-intersection-observer=%5C%22no%5C%22%20data-src=%5C%22$%7BserverOrigin%7D/embed#$%7BencodeURIComponent(JSON.stringify(urlHashData))%7D%5C%22%20style=%5C%22border:0;%20background:transparent;%20$%7BwidthHeightCss%7D;%20aspect-ratio:$%7BresW%7D/$%7BresH%7D;%20$%7Bd.style%7D%5C%22%3E%3C/iframe%3E%60;%5Cn%20%20let%20outputStringHasBeenRead%20=%20false;%5Cn%20%20onFinishPromise.toString%20=%20function()%20%7B%5Cn%20%20%20%20outputStringHasBeenRead%20=%20true;%5Cn%20%20%20%20return%20outputString;%5Cn%20%20%7D;%5Cn%20%20//%20onFinishPromise.iframeHtml%20=%20outputString;%5Cn%20%20Object.defineProperty(onFinishPromise,%20'iframeHtml',%20%7B%5Cn%20%20%20%20get:%20function()%20%7B%5Cn%20%20%20%20%20%20outputStringHasBeenRead%20=%20true;%5Cn%20%20%20%20%20%20return%20outputString;%5Cn%20%20%20%20%7D%5Cn%20%20%7D);%5Cn%20%20Object.defineProperty(onFinishPromise,%20'evaluateItem',%20%7B%5Cn%20%20%20%20get:%20function()%20%7B%5Cn%20%20%20%20%20%20outputStringHasBeenRead%20=%20true;%5Cn%20%20%20%20%20%20return%20outputString;%5Cn%20%20%20%20%7D%5Cn%20%20%7D);%5Cn%20%20onFinishPromise.onFinishPromise%20=%20onFinishPromise;%5Cn%20%20%5Cn%20%20//%20trigger%20the%20loading%20automatically%20if%20they%20haven't%20added%20the%20iframe%20to%20the%20document:%5Cn%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20if(!outputStringHasBeenRead%20&&%20!iframeId%20&&%20!document.querySelector(%60.$%7BprivateIframeId%7D%60))%20%7B%5Cn%20%20%20%20%20%20shouldRemoveIframeOnFinish%20=%20true;%5Cn%20%20%20%20%20%20let%20div%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20div.innerHTML%20=%20outputString.replace(%60data-already-added-intersection-observer=%5C%22no%5C%22%60,%20%5C%22%5C%22);%5Cn%20%20%20%20%20%20let%20iframe%20=%20div.firstElementChild;%5Cn%20%20%20%20%20%20iframe.style.cssText%20=%20%60opacity:0;%20pointer-events:none;%20position:fixed;%20top:0;%20left:0;%60;%5Cn%20%20%20%20%20%20document.body.append(iframe);%5Cn%20%20%20%20%20%20iframe.src%20=%20iframe.dataset.src;%5Cn%20%20%20%20%7D%5Cn%20%20%7D,%20150);%20//%20this%20should%20be%20longer%20than%20100ms%20for%20backward-compat%20because%20then%20it%20runs%20after%20the%20intersection%20observer%20is%20added,%20which%20means%20it%20wouldn't%20have%20loaded%20anyway,%20so%20it%20guards%20against%20the%20case%20where%20they're%20just%20a%20bit%20slow%20to%20add%20it%20to%20the%20HTML%20doc.%5Cn%20%20%5Cn%20%20return%20onFinishPromise;%5Cn%5Cn%5Cncharacter%5Cn%20%20a%20%7Bmech%7Cdemon%7Ccyberpunk%7D%20%7Bwarrior%7Cminion%7Csamurai%7D%5Cn%5Cnplace%5Cn%20%20soviet%20russia%5Cn%20%20a%20small%20village%5Cn%20%20a%20mountainous%20region%5Cn%20%20an%20underwater%20cavern%5Cn%5Cnseason%5Cn%20%20winter%5Cn%20%20summer%5Cn%20%20%5Cnprompt%5Cn%20%20detailed%20painting%20of%20%5Bcharacter%5D%20in%20%5Bplace%5D,%20%5Bseason%5D%5Cn%20%20%5Cn%20%20%5Cn%20%20%5Cn%22,%22imports%22:%5B%5D,%22lastEditTime%22:1753570549163,%22found%22:true%7D,%7B%22name%22:%22upload-plugin%22,%22modelText%22:%22$output(data,%20opts)%20=%3E%5Cn%20%20if(!opts)%20opts%20=%20%7B%7D;%5Cn%20%20//%20if(typeof%20data%20!==%20%5C%22string%5C%22)%20return%20alert(%5C%22error:%20only%20text/strings%20are%20supported%20by%20the%20upload%20plugin%20for%20now.%20please%20request%20other%20types%20on%20the%20forum.%5C%22);%5Cn%20%20%5Cn%20%20if(!window.__alreadyLoadedUploadPluginStuff0435342908)%20%7B%5Cn%20%20%20%20window.__alreadyLoadedUploadPluginStuff0435342908%20=%20true;%5Cn%20%20%20%20%5Cn%20%20%20%20window.__uploadPluginIframe0435342908%20=%20document.createElement('iframe');%20%5Cn%5Cn%20%20%20%20window.addEventListener('message',%20(event)%20=%3E%20%7B%5Cn%20%20%20%20%20%20if(event.source%20!==%20window.__uploadPluginIframe0435342908.contentWindow)%20return;%5Cn%20%20%20%20%20%20if(event.origin%20!==%20%5C%22https://upload.perchance.org%5C%22)%20return;%5Cn%20%20%20%20%20%20console.log(%5C%22upload%20plugin%20got%20message:%5C%22,%20event);%5Cn%5Cn%20%20%20%20%20%20if(event.data.type%20===%20%5C%22uploadEmbedIsReady%5C%22)%20%7B%20%20%20%5Cn%20%20%20%20%20%20%20%20window.__uploadPluginEmbedIsReady%20=%20true;%5Cn%20%20%20%20%20%20%20%20console.log(%5C%22upload%20plugin%20embedIsReady%5C%22);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D);%5Cn%5Cn%20%20%20%20function%20initIframeAttributes(iframe)%20%7B%5Cn%20%20%20%20%20%20//%20email==false%20implies%20anon%20upload%5Cn%20%20%20%20%20%20iframe.src%20=%20%60https://upload.perchance.org/embed#$%7BJSON.stringify(%7Bemail:false,%20sessionToken:false%7D)%7D%60;%5Cn%20%20%20%20%20%20iframe.style.cssText%20=%20'width:1px;%20height:1px;%20border:none;%20top:-100px;%20left:-100px;%20position:fixed;';%5Cn%20%20%20%20%7D%5Cn%20%20%20%20initIframeAttributes(window.__uploadPluginIframe0435342908);%5Cn%20%20%20%20document.body.appendChild(window.__uploadPluginIframe0435342908);%5Cn%5Cn%20%20%20%20//%20ping%20embed%20until%20it%20is%20ready%20(hacky%20way%20to%20wait%20for%20it%20to%20load)%5Cn%20%20%20%20(async%20function()%20%7B%5Cn%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%5Cn%20%20%20%20%20%20let%20waitedTime%20=%200;%5Cn%20%20%20%20%20%20while(!window.__uploadPluginEmbedIsReady)%20%7B%5Cn%20%20%20%20%20%20%20%20if(waitedTime%20%3E%201000*20)%20%7B%20//%20if%20we've%20waited%20too%20long%20(perhaps%20due%20to%20upload%20server%20error%20response),%20try%20deleting%20the%20iframe%20and%20adding%20it%20again%5Cn%20%20%20%20%20%20%20%20%20%20window.__uploadPluginIframe0435342908.remove();%5Cn%20%20%20%20%20%20%20%20%20%20window.__uploadPluginIframe0435342908%20=%20document.createElement('iframe');%5Cn%20%20%20%20%20%20%20%20%20%20initIframeAttributes(window.__uploadPluginIframe0435342908);%5Cn%20%20%20%20%20%20%20%20%20%20document.body.appendChild(window.__uploadPluginIframe0435342908);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20500));%5Cn%20%20%20%20%20%20%20%20waitedTime%20+=%20500;%5Cn%20%20%20%20%20%20%20%20window.__uploadPluginIframe0435342908.contentWindow.postMessage(%7Btype:%5C%22init%5C%22%7D,%20'https://upload.perchance.org');%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D)();%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20let%20requestId%20=%20%5C%22id%5C%22+(Math.random().toString()+Math.random().toString()).replaceAll(%5C%22.%5C%22,%20%5C%22%5C%22);%5Cn%20%20%5Cn%20%20let%20promiseResolver,%20promiseRejecter;%5Cn%20%20let%20promise%20=%20new%20Promise((resolve,%20reject)%20=%3E%20%7B%5Cn%20%20%20%20promiseResolver%20=%20resolve;%5Cn%20%20%20%20promiseRejecter%20=%20reject;%20//%20unused.%5Cn%20%20%7D);%5Cn%20%20%5Cn%20%20function%20messageHandler(event)%20%7B%5Cn%20%20%20%20if(event.source%20!==%20window.__uploadPluginIframe0435342908.contentWindow)%20return;%5Cn%20%20%20%20if(event.origin%20!==%20%5C%22https://upload.perchance.org%5C%22)%20return;%5Cn%5Cn%20%20%20%20if(event.data.type%20===%20%5C%22anonUploadResponse%5C%22%20&&%20event.data.requestId%20===%20requestId)%20%7B%5Cn%20%20%20%20%20%20let%20url%20=%20event.data.result.url;%5Cn%20%20%20%20%20%20let%20error%20=%20event.data.result.error;%5Cn%20%20%20%20%20%20let%20message%20=%20event.data.result.message;%5Cn%20%20%20%20%20%20let%20size%20=%20event.data.result.size;%5Cn%20%20%20%20%20%20let%20deletionUrl%20=%20event.data.result.deletionUrl;%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20if(!error)%20error%20=%20null;%20//%20just%20make%20sure%20it's%20null%20rather%20than%20'undefined',%20since%20that's%20part%20of%20the%20specified%20behavior%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20//%20If%20it%20didn't%20upload%20successfully,%20then%20deletionUrl%20can%20just%20be%20a%20dummy%20URL%20that%20returns%20success:%5Cn%20%20%20%20%20%20if(!deletionUrl)%20deletionUrl%20=%20%5C%22https://user.uploads.dev/file/fcf0aa53193434e1de2a3a2b878bb893.txt%5C%22;%5Cn%5Cn%20%20%20%20%20%20//%20Reduce%20breaking-change-ness%20of%20the%20move%20to%20user.uploads.dev%20for%20a%20common%20pattern%20of%20getting%20the%20file%20id%20by%20removing%20the%20URL's%20prefix:%5Cn%20%20%20%20%20%20if(typeof%20url%20===%20%5C%22string%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20originalUrl%20=%20url;%5Cn%20%20%20%20%20%20%20%20url%20=%20new%20String(url)%5Cn%20%20%20%20%20%20%20%20url.replace%20=%20function(...args)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20if(typeof%20args%5B0%5D%20===%20%5C%22string%5C%22%20&&%20args%5B0%5D.startsWith(%5C%22https://user-uploads.perchance.org%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20args%5B0%5D%20=%20args%5B0%5D.replace(%5C%22https://user-uploads.perchance.org%5C%22,%20%5C%22https://user.uploads.dev%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20return%20originalUrl.replace(...args);%5Cn%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20promiseResolver(%7Burl,%20error,%20size,%20deletionUrl%7D);%20//%20always%20'resolve'%20(i.e.%20we%20don't%20%60reject%60%20on%20error).%20easier%20for%20people%20to%20handle%20errors%20without%20knowing%20about%20try/catch%20stuff%20-%20they%20just%20check%20if%20%60error%60%20is%20null%5Cn%20%20%20%20%20%20window.removeEventListener('message',%20messageHandler);%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20let%20el%20=%20document.querySelector(%60#$%7BrequestId%7D%60);%5Cn%20%20%20%20%20%20if(el)%20%7B%5Cn%20%20%20%20%20%20%20%20if(error)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20el.innerHTML%20=%20error;%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20el.innerHTML%20=%20%60%3Ca%20href=%5C%22$%7Burl%7D%5C%22%20target=%5C%22_blank%5C%22%3E$%7Burl%7D%3C/a%3E%60;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if(error)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20div%20=%20document.createElement(%5C%22div%5C%22);%5Cn%20%20%20%20%20%20%20%20let%20errorMessageHtml%20=%20message%20?%20%60%20($%7Bmessage%7D)%60%20:%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20%20%20div.innerHTML%20=%20%60%3Cdiv%20style=%5C%22z-index:1000;%20position:%20fixed;%20bottom:%201rem;%20width:%20100%25;%20pointer-events:none;%5C%22%3E%3Cspan%20style=%5C%22%20padding:%200.5rem;%20background:%20#ac2c2c;%20border-radius:%203px;%20color:%20white;%20pointer-events:auto;%5C%22%3Eupload%20error:%20$%7Berror.replaceAll(%5C%22_%5C%22,%20%5C%22%20%5C%22)%7D$%7BerrorMessageHtml%7D%3C/span%3E%3C/div%3E%60;%5Cn%20%20%20%20%20%20%20%20div%20=%20div.firstElementChild;%5Cn%20%20%20%20%20%20%20%20document.body.appendChild(div);%5Cn%20%20%20%20%20%20%20%20setTimeout(()%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20div.remove();%5Cn%20%20%20%20%20%20%20%20%7D,%201000*5);%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20window.addEventListener('message',%20messageHandler);%5Cn%20%20%5Cn%20%20(async%20function()%20%7B%5Cn%20%20%20%20while(!window.__uploadPluginEmbedIsReady)%20%7B%5Cn%20%20%20%20%20%20console.log(%5C%22waiting%20for%20upload%20iframe%20embed%20to%20be%20ready%5C%22);%5Cn%20%20%20%20%20%20await%20new%20Promise(r%20=%3E%20setTimeout(r,%20100));%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20function%20blobToDataUrl(blob)%20%7B%5Cn%20%20%20%20%20%20return%20new%20Promise((resolve,%20_)%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20const%20reader%20=%20new%20FileReader();%5Cn%20%20%20%20%20%20%20%20reader.onloadend%20=%20()%20=%3E%20resolve(reader.result);%5Cn%20%20%20%20%20%20%20%20reader.readAsDataURL(blob);%5Cn%20%20%20%20%20%20%7D);%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%5Cn%20%20%20%20let%20dataUrl;%5Cn%20%20%20%20if(typeof%20data%20===%20%5C%22string%5C%22)%20dataUrl%20=%20%60data:text/plain;charset=utf-8,$%7BencodeURIComponent(data)%7D%60;%5Cn%20%20%20%20if(data%20instanceof%20Blob)%20dataUrl%20=%20await%20blobToDataUrl(data);%5Cn%20%20%20%20%5Cn%20%20%20%20window.__uploadPluginIframe0435342908.contentWindow.postMessage(%7Btype:%5C%22anonUploadRequest%5C%22,%20requestId,%20dataUrl,%20expires:opts.expires,%20generatorName:window.generatorName%7D,%20'https://upload.perchance.org');%5Cn%20%20%7D)();%5Cn%20%20%5Cn%20%20promise.toString%20=%20function()%20%7B%5Cn%20%20%20%20return%20%60%3Cspan%20id=%5C%22$%7BrequestId%7D%5C%22%3Euploading...%3C/span%3E%60;%5Cn%20%20%7D;%5Cn%20%20return%20promise;%5Cn%5Cn%5Cn%5Cn%22,%22imports%22:%5B%5D,%22lastEditTime%22:1748065062782,%22found%22:true%7D,%7B%22name%22:%22kv-plugin%22,%22modelText%22:%22$output%20=%20%5BgetKv()%5D%5Cn%5CngetKv()%20=%3E%5Cn%20%20const%20moduleName%20=%20this.$root.$moduleName;%20//%20this%20is%20'kv-plugin'%20-%20it's%20different%20to%20%60window.generatorName%60%20because%20that%20will%20be%20the%20name/url%20of%20the%20generator%20that%20imports%20this%20plugin,%20not%20this%20plugin's%20name/url.%20This%20is%20used%20in%20IndexedDB%20db/store%20name%20so%20forks%20of%20this%20plugin%20don't%20conflict%20with%20one%20another.%5Cn%20%20%5Cn%20%20if(!window.__kvPluginProxy7583683)%20%7B%5Cn%20%20%20%20//%20let%20idbKeyval%20=%20await%20import(%5C%22https://cdn.jsdelivr.net/npm/idb-keyval@6/+esm%5C%22);%5Cn%20%20%20%20let%20idbKeyval%20=%20(function()%20%7B%20//%20This%20is%20v6.2.1%5Cn%20%20%20%20%20%20function%20e(e)%7Breturn%20new%20Promise(((t,n)=%3E%7Be.oncomplete=e.onsuccess=()=%3Et(e.result),e.onabort=e.onerror=()=%3En(e.error)%7D))%7Dfunction%20t(t,n)%7Bconst%20r=indexedDB.open(t);r.onupgradeneeded=()=%3Er.result.createObjectStore(n);const%20o=e(r);return(e,t)=%3Eo.then((r=%3Et(r.transaction(n,e).objectStore(n))))%7Dlet%20n;function%20r()%7Breturn%20n%7C%7C(n=t(%5C%22keyval-store%5C%22,%5C%22keyval%5C%22)),n%7Dfunction%20o(t,n=r())%7Breturn%20n(%5C%22readonly%5C%22,(n=%3Ee(n.get(t))))%7Dfunction%20u(t,n,o=r())%7Breturn%20o(%5C%22readwrite%5C%22,(r=%3E(r.put(n,t),e(r.transaction))))%7Dfunction%20c(t,n=r())%7Breturn%20n(%5C%22readwrite%5C%22,(n=%3E(t.forEach((e=%3En.put(e%5B1%5D,e%5B0%5D))),e(n.transaction))))%7Dfunction%20s(t,n=r())%7Breturn%20n(%5C%22readonly%5C%22,(n=%3EPromise.all(t.map((t=%3Ee(n.get(t)))))))%7Dfunction%20a(t,n,o=r())%7Breturn%20o(%5C%22readwrite%5C%22,(r=%3Enew%20Promise(((o,u)=%3E%7Br.get(t).onsuccess=function()%7Btry%7Br.put(n(this.result),t),o(e(r.transaction))%7Dcatch(e)%7Bu(e)%7D%7D%7D))))%7Dfunction%20i(t,n=r())%7Breturn%20n(%5C%22readwrite%5C%22,(n=%3E(n.delete(t),e(n.transaction))))%7Dfunction%20l(t,n=r())%7Breturn%20n(%5C%22readwrite%5C%22,(n=%3E(t.forEach((e=%3En.delete(e))),e(n.transaction))))%7Dfunction%20f(t=r())%7Breturn%20t(%5C%22readwrite%5C%22,(t=%3E(t.clear(),e(t.transaction))))%7Dfunction%20d(t,n)%7Breturn%20t.openCursor().onsuccess=function()%7Bthis.result&&(n(this.result),this.result.continue())%7D,e(t.transaction)%7Dfunction%20h(t=r())%7Breturn%20t(%5C%22readonly%5C%22,(t=%3E%7Bif(t.getAllKeys)return%20e(t.getAllKeys());const%20n=%5B%5D;return%20d(t,(e=%3En.push(e.key))).then((()=%3En))%7D))%7Dfunction%20y(t=r())%7Breturn%20t(%5C%22readonly%5C%22,(t=%3E%7Bif(t.getAll)return%20e(t.getAll());const%20n=%5B%5D;return%20d(t,(e=%3En.push(e.value))).then((()=%3En))%7D))%7Dfunction%20p(t=r())%7Breturn%20t(%5C%22readonly%5C%22,(n=%3E%7Bif(n.getAll&&n.getAllKeys)return%20Promise.all(%5Be(n.getAllKeys()),e(n.getAll())%5D).then(((%5Be,t%5D)=%3Ee.map(((e,n)=%3E%5Be,t%5Bn%5D%5D))));const%20r=%5B%5D;return%20t(%5C%22readonly%5C%22,(e=%3Ed(e,(e=%3Er.push(%5Be.key,e.value%5D))).then((()=%3Er))))%7D))%7D%5Cn%20%20%20%20%20%20return%20%7Bclear:f,createStore:t,del:i,delMany:l,entries:p,get:o,getMany:s,keys:h,set:u,setMany:c,update:a,values:y%7D;%5Cn%20%20%20%20%7D)();%5Cn%20%20%20%20%5Cn%20%20%20%20let%20storeNameToStore%20=%20%7B%7D;%5Cn%20%20%20%20%5Cn%20%20%20%20window.__kvPluginProxy7583683%20=%20new%20Proxy(%7B%7D,%20%7B%20//%20so%20api%20is%20like:%20kv.myStoreName.get(...)%5Cn%20%20%20%20%20%20get(target,%20storeName,%20receiver)%20%7B%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20let%20store%20=%20storeNameToStore%5BstoreName%5D;%5Cn%20%20%20%20%20%20%20%20if(!store)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20NOTE:%20We%20don't%20need%20to%20include%20%60window.generatorName%60%20in%20the%20storeName%20because%20each%20generator%20has%20its%20own%20subdomain,%20and%20hence%20its%20own%20partitioned%20IndexedDB%20database.%5Cn%20%20%20%20%20%20%20%20%20%20//%20CAUTION:%20changing%20the%20store%20naming%20(in%20createStore%20calls)%20will%20make%20previously-added%20data%20inaccessible!!!%20Don't%20change%20it.%5Cn%20%20%20%20%20%20%20%20%20%20store%20=%20idbKeyval.createStore(%60$%7BstoreName%7D-db-$%7BmoduleName%7D%60,%20%60$%7BstoreName%7D-store-$%7BmoduleName%7D%60);%20//%20%3C--%20creates%20if%20it%20doesn't%20already%20exist,%20but%20we%20have%20an%20extra%20cache%20on%20top%20of%20that%20anyway%20in%20case%20it's%20expensive%5Cn%20%20%20%20%20%20%20%20%20%20storeNameToStore%5BstoreName%5D%20=%20store;%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20return%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20//%20Reads:%5Cn%20%20%20%20%20%20%20%20%20%20get:%20(key)%20=%3E%20idbKeyval.get(key,%20store),%5Cn%20%20%20%20%20%20%20%20%20%20has:%20(key)%20=%3E%20idbKeyval.keys(store).then(keys%20=%3E%20keys.includes(key)),%20//%20probably%20a%20bit%20inefficient,%20but%20fine%20for%20now%5Cn%20%20%20%20%20%20%20%20%20%20getMany:%20(keys)%20=%3E%20idbKeyval.getMany(keys,%20store),%5Cn%20%20%20%20%20%20%20%20%20%20entries:%20()%20=%3E%20idbKeyval.entries(store),%5Cn%20%20%20%20%20%20%20%20%20%20keys:%20()%20=%3E%20idbKeyval.keys(store),%5Cn%20%20%20%20%20%20%20%20%20%20values:%20()%20=%3E%20idbKeyval.values(store),%5Cn%20%20%20%20%20%20%20%20%20%20//%20Writes/Mutations:%5Cn%20%20%20%20%20%20%20%20%20%20set:%20(key,%20value)%20=%3E%20idbKeyval.set(key,%20value,%20store),%5Cn%20%20%20%20%20%20%20%20%20%20setMany:%20(entries)%20=%3E%20idbKeyval.setMany(entries,%20store),%5Cn%20%20%20%20%20%20%20%20%20%20update:%20(key,%20setterFn)%20=%3E%20idbKeyval.update(key,%20setterFn,%20store),%5Cn%20%20%20%20%20%20%20%20%20%20delete:%20(key)%20=%3E%20idbKeyval.del(key,%20store),%5Cn%20%20%20%20%20%20%20%20%20%20deleteMany:%20(keys)%20=%3E%20idbKeyval.delMany(keys,%20store),%5Cn%20%20%20%20%20%20%20%20%20%20clear:%20()%20=%3E%20idbKeyval.clear(store),%5Cn%20%20%20%20%20%20%20%20%7D;%5Cn%20%20%20%20%20%20%7D,%5Cn%20%20%20%20%7D);%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20return%20window.__kvPluginProxy7583683;%22,%22imports%22:%5B%5D,%22lastEditTime%22:1762290231847,%22found%22:true%7D,%7B%22name%22:%22super-fetch-plugin%22,%22modelText%22:%22async%20$output(...args)%20=%3E%5Cn%20%20let%20url;%5Cn%20%20if(typeof%20args%5B0%5D%20===%20%5C%22object%5C%22)%20url%20=%20args%5B0%5D.href%20%7C%7C%20args%5B0%5D.url;%20//%20can%20be%20URL%20object,%20or%20%7Burl,%20method,%20etc%7D%5Cn%20%20else%20url%20=%20args%5B0%5D;%5Cn%20%20%5Cn%20%20if(typeof%20url%20!==%20%5C%22string%5C%22)%20%7B%5Cn%20%20%20%20throw%20new%20Error(%5C%22Invalid%20URL%20provided.%5C%22);%5Cn%20%20%7D%5Cn%5Cn%20%20if(url.startsWith(%5C%22blob:%5C%22)%20%7C%7C%20url.startsWith(%5C%22data:%5C%22))%20return%20window.fetch(...args);%5Cn%20%20%5Cn%20%20//%20Disallow%20relative%20URLs%20(for%20now,%20at%20least):%5Cn%20%20if(!/%5Ehttps?:%5C%5C/%5C%5C//.test(url))%20%7B%5Cn%20%20%20%20throw%20new%20Error(%5C%22Must%20provide%20full%20URL,%20starting%20with%20https://%20or%20http://%5C%22);%5Cn%20%20%7D%5Cn%5Cn%20%20let%20origin%20=%20new%20URL(url).origin;%5Cn%5Cn%20%20//%20for%20performance,%20exclude%20some%20CDNs%20that%20don't%20need%20CORS%20proxying%5Cn%20%20if(origin.endsWith(%5C%22jsdelivr.net%5C%22)%20%7C%7C%20origin.endsWith(%5C%22catbox.moe%5C%22)%20%7C%7C%20(origin.endsWith(%5C%22huggingface.co%5C%22)%20&&%20url.includes(%5C%22/resolve/%5C%22))%20%7C%7C%20origin%20===%20%5C%22https://raw.githubusercontent.com%5C%22)%20%7B%5Cn%20%20%20%20return%20window.fetch(...args);%5Cn%20%20%7D%5Cn%20%20//%20for%20some%20reason%20error/non-CORS%20responses%20get%20cached%20in%20the%20browser%20sometimes,%20so%20if%20that%20happens,%20we%20retry%20with%20proxy%5Cn%20%20if(origin%20===%20%5C%22https://user-uploads.perchance.org%5C%22%20%7C%7C%20origin%20===%20%5C%22https://user.uploads.dev%5C%22%20%7C%7C%20origin%20===%20%5C%22https://aigc.uploads.dev%5C%22)%20%7B%5Cn%20%20%20%20let%20response%20=%20await%20window.fetch(...args).catch(e%20=%3E%20%7B%5Cn%20%20%20%20%20%20console.error(e);%5Cn%20%20%20%20%20%20return%20false;%5Cn%20%20%20%20%7D);%5Cn%20%20%20%20if(response%20!==%20false)%20return%20response;%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20//%20Note%20that%20we%20use%20%60new%20URL(url).href%60%20to%20exactly%20emulate%20the%20browser's%20encoding%20of%20'invalid'%20URL%20characters%20(this%20is%20different%20to%20encodeURI%20IIUC).%20There%20were%20issues%20related%20to%20server%20handling%20of%20this%20sort%20of%20thing%20before%20I%20added%20this.%5Cn%20%20//%20EDIT:%20Changed%20to%20putting%20URL%20in%20path%20instead%20of%20in%20query%20param%20for%20annoying/technical%20Cloudflare-related%20reasons.%5Cn%20%20const%20proxiedUrl%20=%20%60https://fetch-plugin.perchance.org/proxy1/$%7BencodeURIComponent(new%20URL(url).href)%7D?origin=$%7BencodeURIComponent(%60https://$%7Bwindow.generatorPublicId%7D.perchance.org%60)%7D%60;%5Cn%20%20if(typeof%20args%5B0%5D%20===%20%5C%22object%5C%22%20&&%20args%5B0%5D.url)%20%7B%20//%20%3C--%20since%20it's%20possible%20to%20call%20fetch%20like%20this:%20fetch(%7Burl:%5C%22https://example.com%5C%22%7D)%20-%20i.e.%20options%20object%20as%20first%20param%20that%20*includes*%20the%20URL%5Cn%20%20%20%20args%5B0%5D%20=%20new%20Request(proxiedUrl,%20args%5B0%5D);%5Cn%20%20%20%20let%20response%20=%20await%20window.fetch(...args);%5Cn%20%20%20%20if(response.status%20===%20530)%20throw%20new%20Error(%5C%22Failed%20to%20fetch%5C%22);%20//%20CF%20error%20for%20e.g.%20DNS%20lookup%20fail%5Cn%20%20%20%20return%20response;%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20let%20response%20=%20await%20window.fetch(proxiedUrl,%20...args.slice(1));%5Cn%20%20%20%20if(response.status%20===%20530)%20throw%20new%20Error(%5C%22Failed%20to%20fetch%5C%22);%20//%20CF%20error%20for%20e.g.%20DNS%20lookup%20fail%5Cn%20%20%20%20return%20response;%5Cn%20%20%7D%22,%22imports%22:%5B%5D,%22lastEditTime%22:1749986362487,%22found%22:true%7D,%7B%22name%22:%22huge-emoji-list%22,%22modelText%22:%22$output%20=%20https://user.uploads.dev/file/a39d52b89a33865b9a903fcc5786a2da.txt%5Cn%5Cn//%20The%20reason%20I%20put%20this%20simple%20URL%20into%20its%20own%20generator%20is%20so%20that%20I%20can%20update%20the%20URL%5Cn//%20here%20(e.g.%20when%20I%20add/remove%20emojis)%20and%20the%20update%20automatically%20propagates%20to%20all%20my%20generators.%5Cn%5Cn//%20You%20can%20import%20this%20into%20your%20own%20generator%20by%20putting%20this%20line%20in%20your%20comments%20options:%5Cn//%20%20%20%20customEmojis%20=%20%7Bimport:huge-emoji-list%7D%5Cn//%20But%20do%20note%20that%20I%20may%20add/remove%20emojis%20to%20improve%20the%20list,%20remove%20some%20NSFW%20that%20I%20missed,%20etc.%22,%22imports%22:%5B%5D,%22lastEditTime%22:1750744274356,%22found%22:true%7D%5D</script> <script id="imported-generator-names" type="notjs">%5B%22random-integer-plugin%22,%22t2i-framework-plugin-v2%22,%22ai-text-plugin%22,%22comments-plugin%22,%22create-media-gallery-plugin%22,%22fullscreen-button-plugin%22,%22prompt2-plugin%22,%22select-leaf-plugin%22,%22t2i-styles%22,%22tabbed-comments-plugin-v1%22,%22text-to-image-plugin%22,%22upload-plugin%22,%22kv-plugin%22,%22super-fetch-plugin%22,%22huge-emoji-list%22%5D</script> <script id="this-html-server-render-time" type="notjs">1770259829455</script> <script>!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).nlp=t()}(function(){return function t(e,r,n){function a(o,s){if(!r[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[o]={exports:{}};e[o][0].call(c.exports,function(t){return a(e[o][1][t]||t)},c,c.exports,t,e,r,n)}return r[o].exports}for(var i="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(t,e,r){(function(n){!function(t){"object"==typeof r&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function e(r,n,a){function i(s,u){if(!n[s]){if(!r[s]){var l="function"==typeof t&&t;if(!u&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};r[s][0].call(h.exports,function(t){return i(r[s][1][t]||t)},h,h.exports,e,r,n,a)}return n[s].exports}for(var o="function"==typeof t&&t,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";var n=36,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",i=a.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==a[t])return a[t];for(var e=1,r=n,i="";r<=t;t-=r,e++,r*=n);for(;e--;){var o=t%n;i=String.fromCharCode((o<10?48:55)+o)+i,t=(t-o)/n}return i},fromAlphaCode:function(t){if(void 0!==i[t])return i[t];for(var e=0,r=1,a=n,o=1;r<t.length;e+=a,r++,a*=n);for(var s=t.length-1;0<=s;s--,o*=n){var u=t.charCodeAt(s)-48;10<u&&(u-=7),e+=u*o}return e}}},{}],2:[function(t,e,r){"use strict";var n=t("./unpack");e.exports=function(t){var e=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),r={};return Object.keys(e).forEach(function(t){var a=n(e[t]);"true"===t&&(t=!0);for(var i=0;i<a.length;i++){var o=a[i];!0===r.hasOwnProperty(o)?!1===Array.isArray(r[o])?r[o]=[r[o],t]:r[o].push(t):r[o]=t}}),r}},{"./unpack":4}],3:[function(t,e,r){"use strict";var n=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r<t.nodes.length;r++){var a=e.exec(t.nodes[r]);if(!a){t.symCount=r;break}t.syms[n.fromAlphaCode(a[1])]=n.fromAlphaCode(a[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),a=t("../encoding");e.exports=function(t){var e,r,i={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&n(i),e=i,r=[],function t(n,i){var o,s,u,l,c=e.nodes[n];"!"===c[0]&&(r.push(i),c=c.slice(1));for(var h=c.split(/([A-Z0-9,]+)/g),f=0;f<h.length;f+=2){var m=h[f],d=h[f+1];if(m){var p=i+m;","!==d&&void 0!==d?t((o=e,s=d,u=n,(l=a.fromAlphaCode(s))<o.symCount?o.syms[l]:u+l+1-o.symCount),p):r.push(p)}}}(0,""),r}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof r&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function e(r,n,a){function i(s,u){if(!n[s]){if(!r[s]){var l="function"==typeof t&&t;if(!u&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};r[s][0].call(h.exports,function(t){return i(r[s][1][t]||t)},h,h.exports,e,r,n,a)}return n[s].exports}for(var o="function"==typeof t&&t,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",a=n.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==n[t])return n[t];for(var e=1,r=36,a="";r<=t;t-=r,e++,r*=36);for(;e--;){var i=t%36;a=String.fromCharCode((i<10?48:55)+i)+a,t=(t-i)/36}return a},fromAlphaCode:function(t){if(void 0!==a[t])return a[t];for(var e=0,r=1,n=36,i=1;r<t.length;e+=n,r++,n*=36);for(var o=t.length-1;0<=o;o--,i*=36){var s=t.charCodeAt(o)-48;10<s&&(s-=7),e+=s*i}return e}}},{}],2:[function(t,e,r){"use strict";var n=t("./unpack");e.exports=function(t){var e=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),r={};return Object.keys(e).forEach(function(t){var a=n(e[t]);"true"===t&&(t=!0);for(var i=0;i<a.length;i++){var o=a[i];!0===r.hasOwnProperty(o)?!1===Array.isArray(r[o])?r[o]=[r[o],t]:r[o].push(t):r[o]=t}}),r}},{"./unpack":4}],3:[function(t,e,r){"use strict";var n=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r<t.nodes.length;r++){var a=e.exec(t.nodes[r]);if(!a){t.symCount=r;break}t.syms[n.fromAlphaCode(a[1])]=n.fromAlphaCode(a[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),a=t("../encoding");e.exports=function(t){var e,r,i={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&n(i),e=i,r=[],function t(n,i){var o,s,u,l,c=e.nodes[n];"!"===c[0]&&(r.push(i),c=c.slice(1));for(var h=c.split(/([A-Z0-9,]+)/g),f=0;f<h.length;f+=2){var m=h[f],d=h[f+1];if(m){var p=i+m;","!==d&&void 0!==d?t((o=e,s=d,u=n,(l=a.fromAlphaCode(s))<o.symCount?o.syms[l]:u+l+1-o.symCount),p):r.push(p)}}}(0,""),r}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof r&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function e(r,n,a){function i(s,u){if(!n[s]){if(!r[s]){var l="function"==typeof t&&t;if(!u&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};r[s][0].call(h.exports,function(t){return i(r[s][1][t]||t)},h,h.exports,e,r,n,a)}return n[s].exports}for(var o="function"==typeof t&&t,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",a=n.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==n[t])return n[t];for(var e=1,r=36,a="";r<=t;t-=r,e++,r*=36);for(;e--;){var i=t%36;a=String.fromCharCode((i<10?48:55)+i)+a,t=(t-i)/36}return a},fromAlphaCode:function(t){if(void 0!==a[t])return a[t];for(var e=0,r=1,n=36,i=1;r<t.length;e+=n,r++,n*=36);for(var o=t.length-1;0<=o;o--,i*=36){var s=t.charCodeAt(o)-48;10<s&&(s-=7),e+=s*i}return e}}},{}],2:[function(t,e,r){"use strict";var n=t("./unpack");e.exports=function(t){var e=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),r={};return Object.keys(e).forEach(function(t){var a=n(e[t]);"true"===t&&(t=!0);for(var i=0;i<a.length;i++){var o=a[i];!0===r.hasOwnProperty(o)?!1===Array.isArray(r[o])?r[o]=[r[o],t]:r[o].push(t):r[o]=t}}),r}},{"./unpack":4}],3:[function(t,e,r){"use strict";var n=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r<t.nodes.length;r++){var a=e.exec(t.nodes[r]);if(!a){t.symCount=r;break}t.syms[n.fromAlphaCode(a[1])]=n.fromAlphaCode(a[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),a=t("../encoding");e.exports=function(t){var e,r,i={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&n(i),e=i,r=[],function t(n,i){var o,s,u,l,c=e.nodes[n];"!"===c[0]&&(r.push(i),c=c.slice(1));for(var h=c.split(/([A-Z0-9,]+)/g),f=0;f<h.length;f+=2){var m=h[f],d=h[f+1];if(m){var p=i+m;","!==d&&void 0!==d?t((o=e,s=d,u=n,(l=a.fromAlphaCode(s))<o.symCount?o.syms[l]:u+l+1-o.symCount),p):r.push(p)}}}(0,""),r}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof r&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function e(r,n,a){function i(s,u){if(!n[s]){if(!r[s]){var l="function"==typeof t&&t;if(!u&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};r[s][0].call(h.exports,function(t){return i(r[s][1][t]||t)},h,h.exports,e,r,n,a)}return n[s].exports}for(var o="function"==typeof t&&t,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",a=n.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==n[t])return n[t];for(var e=1,r=36,a="";r<=t;t-=r,e++,r*=36);for(;e--;){var i=t%36;a=String.fromCharCode((i<10?48:55)+i)+a,t=(t-i)/36}return a},fromAlphaCode:function(t){if(void 0!==a[t])return a[t];for(var e=0,r=1,n=36,i=1;r<t.length;e+=n,r++,n*=36);for(var o=t.length-1;0<=o;o--,i*=36){var s=t.charCodeAt(o)-48;10<s&&(s-=7),e+=s*i}return e}}},{}],2:[function(t,e,r){"use strict";var n=t("./unpack");e.exports=function(t){var e=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),r={};return Object.keys(e).forEach(function(t){var a=n(e[t]);"true"===t&&(t=!0);for(var i=0;i<a.length;i++){var o=a[i];!0===r.hasOwnProperty(o)?!1===Array.isArray(r[o])?r[o]=[r[o],t]:r[o].push(t):r[o]=t}}),r}},{"./unpack":4}],3:[function(t,e,r){"use strict";var n=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r<t.nodes.length;r++){var a=e.exec(t.nodes[r]);if(!a){t.symCount=r;break}t.syms[n.fromAlphaCode(a[1])]=n.fromAlphaCode(a[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),a=t("../encoding");e.exports=function(t){var e,r,i={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&n(i),e=i,r=[],function t(n,i){var o,s,u,l,c=e.nodes[n];"!"===c[0]&&(r.push(i),c=c.slice(1));for(var h=c.split(/([A-Z0-9,]+)/g),f=0;f<h.length;f+=2){var m=h[f],d=h[f+1];if(m){var p=i+m;","!==d&&void 0!==d?t((o=e,s=d,u=n,(l=a.fromAlphaCode(s))<o.symCount?o.syms[l]:u+l+1-o.symCount),p):r.push(p)}}}(0,""),r}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof r&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function e(r,n,a){function i(s,u){if(!n[s]){if(!r[s]){var l="function"==typeof t&&t;if(!u&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};r[s][0].call(h.exports,function(t){return i(r[s][1][t]||t)},h,h.exports,e,r,n,a)}return n[s].exports}for(var o="function"==typeof t&&t,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",a=n.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==n[t])return n[t];for(var e=1,r=36,a="";r<=t;t-=r,e++,r*=36);for(;e--;){var i=t%36;a=String.fromCharCode((i<10?48:55)+i)+a,t=(t-i)/36}return a},fromAlphaCode:function(t){if(void 0!==a[t])return a[t];for(var e=0,r=1,n=36,i=1;r<t.length;e+=n,r++,n*=36);for(var o=t.length-1;0<=o;o--,i*=36){var s=t.charCodeAt(o)-48;10<s&&(s-=7),e+=s*i}return e}}},{}],2:[function(t,e,r){"use strict";var n=t("./unpack");e.exports=function(t){var e=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),r={};return Object.keys(e).forEach(function(t){var a=n(e[t]);"true"===t&&(t=!0);for(var i=0;i<a.length;i++){var o=a[i];!0===r.hasOwnProperty(o)?!1===Array.isArray(r[o])?r[o]=[r[o],t]:r[o].push(t):r[o]=t}}),r}},{"./unpack":4}],3:[function(t,e,r){"use strict";var n=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r<t.nodes.length;r++){var a=e.exec(t.nodes[r]);if(!a){t.symCount=r;break}t.syms[n.fromAlphaCode(a[1])]=n.fromAlphaCode(a[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),a=t("../encoding");e.exports=function(t){var e,r,i={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&n(i),e=i,r=[],function t(n,i){var o,s,u,l,c=e.nodes[n];"!"===c[0]&&(r.push(i),c=c.slice(1));for(var h=c.split(/([A-Z0-9,]+)/g),f=0;f<h.length;f+=2){var m=h[f],d=h[f+1];if(m){var p=i+m;","!==d&&void 0!==d?t((o=e,s=d,u=n,(l=a.fromAlphaCode(s))<o.symCount?o.syms[l]:u+l+1-o.symCount),p):r.push(p)}}}(0,""),r}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof r&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function e(r,n,a){function i(s,u){if(!n[s]){if(!r[s]){var l="function"==typeof t&&t;if(!u&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};r[s][0].call(h.exports,function(t){return i(r[s][1][t]||t)},h,h.exports,e,r,n,a)}return n[s].exports}for(var o="function"==typeof t&&t,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",a=n.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==n[t])return n[t];for(var e=1,r=36,a="";r<=t;t-=r,e++,r*=36);for(;e--;){var i=t%36;a=String.fromCharCode((i<10?48:55)+i)+a,t=(t-i)/36}return a},fromAlphaCode:function(t){if(void 0!==a[t])return a[t];for(var e=0,r=1,n=36,i=1;r<t.length;e+=n,r++,n*=36);for(var o=t.length-1;0<=o;o--,i*=36){var s=t.charCodeAt(o)-48;10<s&&(s-=7),e+=s*i}return e}}},{}],2:[function(t,e,r){"use strict";var n=t("./unpack");e.exports=function(t){var e=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),r={};return Object.keys(e).forEach(function(t){var a=n(e[t]);"true"===t&&(t=!0);for(var i=0;i<a.length;i++){var o=a[i];!0===r.hasOwnProperty(o)?!1===Array.isArray(r[o])?r[o]=[r[o],t]:r[o].push(t):r[o]=t}}),r}},{"./unpack":4}],3:[function(t,e,r){"use strict";var n=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r<t.nodes.length;r++){var a=e.exec(t.nodes[r]);if(!a){t.symCount=r;break}t.syms[n.fromAlphaCode(a[1])]=n.fromAlphaCode(a[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),a=t("../encoding");e.exports=function(t){var e,r,i={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&n(i),e=i,r=[],function t(n,i){var o,s,u,l,c=e.nodes[n];"!"===c[0]&&(r.push(i),c=c.slice(1));for(var h=c.split(/([A-Z0-9,]+)/g),f=0;f<h.length;f+=2){var m=h[f],d=h[f+1];if(m){var p=i+m;","!==d&&void 0!==d?t((o=e,s=d,u=n,(l=a.fromAlphaCode(s))<o.symCount?o.syms[l]:u+l+1-o.symCount),p):r.push(p)}}}(0,""),r}},{"../encoding":1,"./symbols":3}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,r){e.exports={author:"Spencer Kelly <spencermountain@gmail.com> (http://spencermounta.in)",name:"compromise",description:"natural language processing in the browser",version:"11.12.4",main:"./builds/compromise.js",types:"./compromise.d.ts",repository:{type:"git",url:"git://github.com/nlp-compromise/compromise.git"},scripts:{test:'tape "./test/unit/**/*.test.js" | tap-dancer',"test:spec":'tape "./test/unit/**/*.test.js" | tap-spec',testb:'TESTENV=prod tape "./test/unit/**/*.test.js" | tap-spec',buildTest:"TESTENV=prod node ./scripts/test.js","test:types":"tsc --project test/types",browserTest:"node ./scripts/browserTest.js",benchmark:"node ./scripts/benchmark.js",build:"node ./scripts/build/index.js",pack:"node ./scripts/pack.js",prepublishOnly:"node ./scripts/prepublish",postpublish:"node ./scripts/postpublish",watch:"amble ./scratch.js",filesize:"node ./scripts/lib/filesize.js",coverage:"node ./scripts/postpublish/coverage.js",lint:"node ./scripts/prepublish/linter.js"},files:["builds/","docs/","compromise.d.ts"],dependencies:{"efrt-unpack":"2.0.3"},devDependencies:{"@babel/core":"7.2.0","@babel/preset-env":"7.2.0",amble:"0.0.7",babelify:"10.0.0",babili:"0.1.4",browserify:"16.2.3",chalk:"2.4.1",codecov:"3.1.0","compromise-plugin":"0.0.8",derequire:"2.0.6",eslint:"5.9.0",nyc:"13.1.0",shelljs:"0.8.3","tap-dancer":"0.1.2","tap-spec":"5.0.0",tape:"4.9.1","uglify-js":"3.4.9"},license:"MIT"}},{}],3:[function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a=t("./tags"),i={reset:"[0m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",black:"[30m"};void 0===e&&Object.keys(i).forEach(function(t){i[t]=""}),r.ensureString=function(t){return"string"==typeof t?t:"number"==typeof t?String(t):""},r.ensureObject=function(t){return"object"!==n(t)?{}:null===t||t instanceof Array?{}:t},r.titleCase=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},r.copy=function(t){var e={};return t=r.ensureObject(t),Object.keys(t).forEach(function(r){e[r]=t[r]}),e},r.extend=function(t,e){t=r.copy(t);for(var n=Object.keys(e),a=0;a<n.length;a++)t[n[a]]=e[n[a]];return t},r.green=function(t){return i.green+t+i.reset},r.red=function(t){return i.red+t+i.reset},r.blue=function(t){return i.blue+t+i.reset},r.magenta=function(t){return i.magenta+t+i.reset},r.cyan=function(t){return i.cyan+t+i.reset},r.yellow=function(t){return i.yellow+t+i.reset},r.black=function(t){return i.black+t+i.reset},r.printTag=function(t){if(a[t]){var e=a[t].color||"blue";return r[e](t)}return t},r.printTerm=function(t){for(var e=Object.keys(t.tags),n=0;n<e.length;n++)if(a[e[n]]){var o=a[e[n]].color||"black";return r[o](t.out("text"))}return i.reset+t.plaintext+i.reset},r.leftPad=function(t,e,r){for(r=r||" ",t=t.toString();t.length<e;)t+=r;return t},r.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},r.isObject=function(t){return t===Object(t)}},{"./tags":137}],4:[function(t,e,r){(function(r){"use strict";var n=t("./text/build"),a=t("../package.json"),i=t("./log"),o=t("./world/unpack"),s=t("./world"),u=s.w,l=function(t,e){e&&u.plugin({words:e});var r=n(t,u);return r.tagger(),r};l.unpack=function(t){return o(t)},l.version=a.version,l.verbose=function(t){i.enable(t)},l.tokenize=function(t){return n(t)},l.plugin=function(t){u.plugin(t)},l.addWords=function(t){u.plugin({words:t})},l.addTags=function(t){u.plugin({tags:t})},l.addRegex=function(t){u.plugin({regex:t})},l.addPatterns=function(t){u.plugin({patterns:t})},l.addPlurals=function(t){u.plugin({plurals:t})},l.addConjugations=function(t){u.plugin({conjugations:t})},l.clone=function(){var t=s.reBuild(),e=function(e,r){r&&t.plugin({words:r});var a=n(e,t);return a.tagger(),a};return e.tokenize=l.tokenize,e.verbose=l.verbose,e.version=l.version,["Words","Tags","Regex","Patterns","Plurals","Conjugations"].forEach(function(r){e["add"+r]=function(e){t["add"+r](e)}}),e},"undefined"!=typeof self?self.nlp=l:"undefined"!=typeof window?window.nlp=l:void 0!==r&&(r.nlp=l),void 0!==e&&(e.exports=l)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../package.json":2,"./log":6,"./text/build":190,"./world":215,"./world/unpack":223}],5:[function(t,e,r){"use strict";var n=t("../fns");e.exports={tag:function(t,e,r){var a=t.normal||"["+t.silent_term+"]";a=n.leftPad("'"+a+"'",12),a+="  ->   "+e,a+=n.leftPad(r||"",15),console.log("%c"+a," color: #a2c99c")},untag:function(t,e,r){var a=t.normal||"["+t.silent_term+"]";a=n.leftPad("'"+a+"'",12),a+="  ~*   "+e,a+="    "+(r||""),console.log("%c"+a," color: #b66a6a")}}},{"../fns":3}],6:[function(t,e,r){"use strict";var n=t("./client"),a=t("./server"),i=!1;e.exports={enable:function(t){void 0===t&&(t=!0),i=t},tag:function(t,e,r){!0!==i&&"tagger"!==i||("undefined"!=typeof window?n.tag(t,e,r):a.tag(t,e,r))},unTag:function(t,e,r){!0!==i&&"tagger"!==i||("undefined"!=typeof window?n.untag(t,e,r):a.untag(t,e,r))}}},{"./client":5,"./server":7}],7:[function(t,e,r){"use strict";var n=t("../fns");e.exports={tag:function(t,e,r){var a=t.normal||"["+t.silent_term+"]";a=n.yellow(a),a=n.leftPad("'"+a+"'",20),a+="  ->   "+n.printTag(e),a=n.leftPad(a,54),console.log("       "+a+"("+n.cyan(r||"")+")")},untag:function(t,e,r){var a="-"+t.normal+"-";a=n.red(a),a=n.leftPad(a,20),a+="  ~*   "+n.red(e),a=n.leftPad(a,54),console.log("       "+a+"("+n.red(r||"")+")")}}},{"../fns":3}],8:[function(t,e,r){"use strict";e.exports={fns:t("./fns"),Terms:t("./terms")}},{"./fns":3,"./terms":165}],9:[function(t,e,r){"use strict";var n=t("../../text");e.exports=n.makeSubset({stripPeriods:function(){return this.list.forEach(function(t){t.terms.forEach(function(t){var e=t._text.split(".");2<e.length&&(t.text=e.join(""))})}),this},addPeriods:function(){return this.list.forEach(function(t){t.terms.forEach(function(t){if(2<t._text.split(".").length){var e=t._text.replace(/\./g,"");t.text=e.split("").join(".")+"."}})}),this},data:function(){return this.terms().list.map(function(t){var e=t.terms[0],r=e.text.toUpperCase().replace(/\./g,"").split("");return{periods:r.join("."),normal:r.join(""),text:e.text}})}},function(t,e){return t=t.match("#Acronym"),"number"==typeof e&&(t=t.get(e)),t})},{"../../text":192}],10:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./methods"),i={data:function(){var t=this;return this.list.map(function(e){var r,n,i=e.out("normal"),o={normal:i,text:t.out("text"),comparative:"more "+i,superlative:"most "+i,adverbForm:null,nounForm:null};return 1==(r=i,n=t.world().words,!(!r||r.length<=3)&&("Comparable"===n[r]||"Adjective"!==n[r]&&-1===r.indexOf(" ")))&&(o.comparative=a.toComparative(i)||o.comparative,o.superlative=a.toSuperlative(i)||o.superlative,o.adverbForm=a.toAdverb(i),o.nounForm=a.toNoun(i)),o})}};e.exports=n.makeSubset(i,function(t,e){return t=t.match("#Adjective"),"number"==typeof e&&(t=t.get(e)),t})},{"../../text":192,"./methods":11}],11:[function(t,e,r){"use strict";e.exports={toNoun:t("./toNoun"),toSuperlative:t("./toSuperlative"),toComparative:t("./toComparative"),toAdverb:t("./toAdverb"),toVerb:t("./toVerb")}},{"./toAdverb":12,"./toComparative":13,"./toNoun":14,"./toSuperlative":15,"./toVerb":16}],12:[function(t,e,r){"use strict";var n=[/airs$/,/ll$/,/ee.$/,/ile$/,/y$/],a=t("../../../world/more-data/irregularAdjectives").toAdverb,i=[{reg:/al$/i,repl:"ally"},{reg:/ly$/i,repl:"ly"},{reg:/(.{3})y$/i,repl:"$1ily"},{reg:/que$/i,repl:"quely"},{reg:/ue$/i,repl:"uly"},{reg:/ic$/i,repl:"ically"},{reg:/ble$/i,repl:"bly"},{reg:/l$/i,repl:"ly"}];e.exports=function(t){if(!0===a.hasOwnProperty(t))return a[t];for(var e=0;e<n.length;e++)if(!0===n[e].test(t))return null;for(var r=0;r<i.length;r++)if(!0===i[r].reg.test(t))return t.replace(i[r].reg,i[r].repl);return t+"ly"}},{"../../../world/more-data/irregularAdjectives":218}],13:[function(t,e,r){"use strict";var n=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/old$/,/oud$/,/e[ae]p$/],a=[/ary$/,/ous$/],i=t("../../../world/more-data/irregularAdjectives").toComparative,o=[{reg:/y$/i,repl:"ier"},{reg:/([aeiou])t$/i,repl:"$1tter"},{reg:/([aeou])de$/i,repl:"$1der"},{reg:/nge$/i,repl:"nger"}];e.exports=function(t){if(i.hasOwnProperty(t))return i[t];for(var e=0;e<o.length;e++)if(!0===o[e].reg.test(t))return t.replace(o[e].reg,o[e].repl);for(var r=0;r<a.length;r++)if(!0===a[r].test(t))return null;for(var s=0;s<n.length;s++)if(!0===n[s].test(t))return t+"er";return!0===/e$/.test(t)?t+"r":t+"er"}},{"../../../world/more-data/irregularAdjectives":218}],14:[function(t,e,r){"use strict";var n={clean:"cleanliness",naivety:"naivety",hurt:"hurt"},a=[{reg:/y$/,repl:"iness"},{reg:/le$/,repl:"ility"},{reg:/ial$/,repl:"y"},{reg:/al$/,repl:"ality"},{reg:/ting$/,repl:"ting"},{reg:/ring$/,repl:"ring"},{reg:/bing$/,repl:"bingness"},{reg:/sing$/,repl:"se"},{reg:/ing$/,repl:"ment"},{reg:/ess$/,repl:"essness"},{reg:/ous$/,repl:"ousness"}];e.exports=function(t){if(n.hasOwnProperty(t))return n[t];var e=t.charAt(t.length-1);if("w"===e||"s"===e)return null;for(var r=0;r<a.length;r++)if(!0===a[r].reg.test(t))return t.replace(a[r].reg,a[r].repl);return t+"ness"}},{}],15:[function(t,e,r){"use strict";var n=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/oud$/,/...p$/],a=[/ary$/],i=t("../../../world/more-data/irregularAdjectives").toSuperlative,o=[{reg:/y$/i,repl:"iest"},{reg:/([aeiou])t$/i,repl:"$1ttest"},{reg:/([aeou])de$/i,repl:"$1dest"},{reg:/nge$/i,repl:"ngest"},{reg:/([aeiou])te$/i,repl:"$1test"}];e.exports=function(t){if(i.hasOwnProperty(t))return i[t];for(var e=0;e<o.length;e++)if(o[e].reg.test(t))return t.replace(o[e].reg,o[e].repl);for(var r=0;r<a.length;r++)if(!0===a[r].test(t))return null;for(var s=0;s<n.length;s++)if(!0===n[s].test(t))return"e"===t.charAt(t.length-1)?t+"st":t+"est";return t+"est"}},{"../../../world/more-data/irregularAdjectives":218}],16:[function(t,e,r){"use strict";var n={red:"redden",sad:"sadden",fat:"fatten"};e.exports=function(t){return!0===n.hasOwnProperty(t)?n[t]:!0===/e$/.test(t)?t+"n":t+"en"}},{}],17:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./toAdjective"),i={data:function(){return this.terms().list.map(function(t){var e=t.terms[0];return{adjectiveForm:a(e.normal),normal:e.normal,text:e.text}})}};e.exports=n.makeSubset(i,function(t,e){return t=(t=t.splitAfter("#Comma")).match("#Adverb+"),"number"==typeof e&&(t=t.get(e)),t})},{"../../text":192,"./toAdjective":18}],18:[function(t,e,r){"use strict";var n={idly:"idle",sporadically:"sporadic",basically:"basic",grammatically:"grammatical",alphabetically:"alphabetical",economically:"economical",conically:"conical",politically:"political",vertically:"vertical",practically:"practical",theoretically:"theoretical",critically:"critical",fantastically:"fantastic",mystically:"mystical",pornographically:"pornographic",fully:"full",jolly:"jolly",wholly:"whole"},a=[{reg:/bly$/i,repl:"ble"},{reg:/gically$/i,repl:"gical"},{reg:/([rsdh])ically$/i,repl:"$1ical"},{reg:/ically$/i,repl:"ic"},{reg:/uly$/i,repl:"ue"},{reg:/ily$/i,repl:"y"},{reg:/(.{3})ly$/i,repl:"$1"}];e.exports=function(t){if(n.hasOwnProperty(t))return n[t];for(var e=0;e<a.length;e++)if(!0===a[e].reg.test(t))return t.replace(a[e].reg,a[e].repl);return t}},{}],19:[function(t,e,r){"use strict";var n=function(t,e){e.whitespace.after=t.whitespace.after,t.whitespace.after="",e.whitespace.before="",t.silent_term=t.text,e.silent_term=e.text,e.text="",t.tag("Contraction","new-contraction"),e.tag("Contraction","new-contraction")},a={can:"can't",will:"won't"};e.exports=function(t){return!1===t.expanded||t.match("#Contraction").found||(t.match("(#Noun|#QuestionWord) is").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'s",t.contracted=!0}),t.match("#PronNoun did").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'d",t.contracted=!0}),t.match("#QuestionWord (did|do)").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'d",t.contracted=!0}),t.match("#Noun (could|would)").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'d",t.contracted=!0}),t.match("(they|we|you) are").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'re",t.contracted=!0}),t.match("i am").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'m",t.contracted=!0}),t.match("(#Noun|#QuestionWord) will").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'ll",t.contracted=!0}),t.match("(they|we|you|i) have").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'ve",t.contracted=!0}),t.match("(#Copula|#Modal|do|does|have|has|can|will) not").list.forEach(function(t){n(t.terms[0],t.terms[1]),!0===a.hasOwnProperty(t.terms[0].text)?t.terms[0].text=a[t.terms[0].text]:t.terms[0].text+="n't",t.contracted=!0})),t}},{}],20:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./contract"),i=t("./expand"),o=function(t,e,r){n.call(this,t,e,r)};(o.prototype=Object.create(n.prototype)).data=function(){var t=i(this.clone()),e=a(this.clone());return{text:this.out("text"),normal:this.out("normal"),expanded:{normal:t.out("normal"),text:t.out("text")},contracted:{normal:e.out("normal"),text:e.out("text")},isContracted:Boolean(this.contracted)}},o.prototype.expand=function(){return i(this)},o.prototype.contract=function(){return a(this)},e.exports=o},{"../../paths":8,"./contract":19,"./expand":21}],21:[function(t,e,r){"use strict";e.exports=function(t){return!1===t.contracted||t.terms.forEach(function(t){t.silent_term&&(t.text||(t.whitespace.before=" "),t._text=t.silent_term,t.tags.TitleCase&&t.toTitleCase(),t.normalize(),t.silent_term=null,t.unTag("Contraction","expanded"))}),t}},{}],22:[function(t,e,r){"use strict";e.exports=function(t){var e=t.not("#Contraction"),r=e.match("(#Noun|#QuestionWord) (#Copula|did|do|have|had|could|would|will)");return r.concat(e.match("(they|we|you|i) have")),r.concat(e.match("i am")),r.concat(e.match("(#Copula|#Modal|do|does|have|has|can|will) not")),r.list.forEach(function(t){t.expanded=!0}),r}},{}],23:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./contraction"),i=t("./findPossible");e.exports=n.makeSubset({contract:function(){return this.list.forEach(function(t){return t.contract()}),this},expand:function(){return this.list.forEach(function(t){return t.expand()}),this},contracted:function(){return this.list=this.list.filter(function(t){return t.contracted}),this},expanded:function(){return this.list=this.list.filter(function(t){return!t.contracted}),this}},function(t,e){var r=t.match("#Contraction #Contraction #Contraction?");return r.list=r.list.map(function(t){var e=new a(t.terms,t.world,t.refText,t.refTerms);return e.contracted=!0,e}),i(t).list.forEach(function(t){var e=new a(t.terms,t.world,t.refText,t.refTerms);e.contracted=!1,r.list.push(e)}),r.sort("chronological"),"number"==typeof e&&(r=r.get(e)),r})},{"../../text":192,"./contraction":20,"./findPossible":22}],24:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./parseDate"),i=function(t,e,r){n.call(this,t,e,r),this.month=this.match("#Month")};(i.prototype=Object.create(n.prototype)).data=function(){return{text:this.out("text"),normal:this.out("normal"),date:a(this)}},e.exports=i},{"../../paths":8,"./parseDate":28}],25:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./date"),i=t("./weekday"),o=t("./month"),s={toShortForm:function(){return this.match("#Month").terms().list.forEach(function(t){var e=t.terms[0];o.toShortForm(e)}),this.match("#WeekDay").terms().list.forEach(function(t){var e=t.terms[0];i.toShortForm(e)}),this},toLongForm:function(){return this.match("#Month").terms().list.forEach(function(t){var e=t.terms[0];o.toLongForm(e)}),this.match("#WeekDay").terms().list.forEach(function(t){var e=t.terms[0];i.toLongForm(e)}),this}};e.exports=n.makeSubset(s,function(t,e){var r=t.match("#Date+");return"number"==typeof e&&(r=r.get(e)),r.list=r.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),r})},{"../../text":192,"./date":24,"./month":27,"./weekday":31}],26:[function(t,e,r){"use strict";r.longMonths={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},r.shortMonths={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,febr:1,sept:8}},{}],27:[function(t,e,r){"use strict";var n=t("./data"),a=n.shortMonths,i=n.longMonths,o=function(t){return t.charAt(0).toUpperCase()+t.substr(1)};e.exports={index:function(t){if(t.tags.Month){if(void 0!==i[t.normal])return i[t.normal];if(void 0!==a[t.normal])return a[t.normal]}return null},toShortForm:function(t){if(void 0!==t.tags.Month&&void 0!==i[t.normal]){var e=Object.keys(a),r=t.getPunctuation()||"";t.text=e[i[t.normal]]+r,t.tags.TitleCase&&(t.text=o(t.text))}return t.dirty=!0,t},toLongForm:function(t){if(void 0!==t.tags.Month&&void 0!==a[t.normal]){var e=Object.keys(i),r=t.getPunctuation()||"";t.text=e[a[t.normal]]+r,
t.tags.TitleCase&&(t.text=o(t.text))}return t.dirty=!0,t}}},{"./data":26}],28:[function(t,e,r){"use strict";var n=t("./parseTime"),a=t("./weekday"),i=t("./month"),o=function(t){return!!(t&&t<31&&0<t)},s=function(t){return!!(t&&1e3<t&&t<3e3)};e.exports=function(t){var e={month:null,date:null,weekday:null,year:null,named:null,time:null},r=t.match("(#Holiday|today|tomorrow|yesterday)");if(r.found&&(e.named=r.out("normal")),(r=t.match("#Month")).found&&(e.month=i.index(r.list[0].terms[0])),(r=t.match("#WeekDay")).found&&(e.weekday=a.index(r.list[0].terms[0])),(r=t.match("#Time")).found&&(e.time=n(t),t.not("#Time")),(r=t.match("#Month #Value #Year")).found){var u=r.values().numbers();o(u[0])&&(e.date=u[0]);var l=parseInt(t.match("#Year").out("normal"),10);s(l)&&(e.year=l)}if(!r.found){if((r=t.match("#Month #Value")).found){var c=r.values().numbers()[0];o(c)&&(e.date=c)}if((r=t.match("#Month #Year")).found){var h=parseInt(t.match("#Year").out("normal"),10);s(h)&&(e.year=h)}}if((r=t.match("#Value of #Month")).found){var f=r.values().numbers()[0];o(f)&&(e.date=f)}return e}},{"./month":27,"./parseTime":29,"./weekday":31}],29:[function(t,e,r){"use strict";var n=/([12]?[0-9]) ?(am|pm)/i,a=/([12]?[0-9]):([0-9][0-9]) ?(am|pm)?/i,i=function(t){return!!(t&&0<t&&t<25)};e.exports=function(t){var e={logic:null,hour:null,minute:null,second:null,timezone:null},r=t.match("(by|before|for|during|at|until|after) #Time").firstTerm();return r.found&&(e.logic=r.out("normal")),t.match("#Time").terms().list.forEach(function(t){var r,o=t.terms[0],s=o.text.match(n);null!==s&&(e.hour=parseInt(s[1],10),"pm"===s[2]&&(e.hour+=12),!1===i(e.hour)&&(e.hour=null)),null!==(s=o.text.match(a))&&(e.hour=parseInt(s[1],10),e.minute=parseInt(s[2],10),(r=e.minute)&&0<r&&r<60||(e.minute=null),"pm"===s[3]&&(e.hour+=12),!1===i(e.hour)&&(e.hour=null))}),e}},{}],30:[function(t,e,r){"use strict";r.longDays={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},r.shortDays={sun:0,mon:1,tues:2,wed:3,weds:3,thurs:4,fri:5,sat:6}},{}],31:[function(t,e,r){"use strict";var n=t("./data"),a=n.shortDays,i=n.longDays;e.exports={index:function(t){if(t.tags.WeekDay){if(void 0!==i[t.normal])return i[t.normal];if(void 0!==a[t.normal])return a[t.normal]}return null},toShortForm:function(t){if(t.tags.WeekDay&&void 0!==i[t.normal]){var e=Object.keys(a);t.text=e[i[t.normal]]}return t},toLongForm:function(t){if(t.tags.WeekDay&&void 0!==a[t.normal]){var e=Object.keys(i);t.text=e[a[t.normal]]}return t}}},{"./data":30}],32:[function(t,e,r){"use strict";var n=t("./index"),a=t("./getGrams"),i=function(t,e,r){n.call(this,t,e,r)};i.prototype=Object.create(n.prototype),i.find=function(t,e,r){var n={size:[1,2,3,4],edge:"end"};r&&(n.size=[r]);var o=a(t,n);return(t=new i(o)).sort(),"number"==typeof e&&(t=t.get(e)),t},e.exports=i},{"./getGrams":33,"./index":35}],33:[function(t,e,r){"use strict";var n=t("./gram"),a=function(t){return t.terms.filter(function(t){return""!==t._text})};e.exports=function(t,e){(e=e||{}).size=e.size||[1,2,3],"number"==typeof e.size&&(e.size=[e.size]);var r={};return e.size.forEach(function(i){t.list.forEach(function(t){var o,s,u,l;("start"===e.edge?(u=i,(l=a(t)).length<u?[]:[new n(l.slice(0,u))]):"end"===e.edge?(o=i,(s=a(t)).length<o?[]:[new n(s.slice(s.length-o,s.length))]):function(e,r){var i=a(t);if(i.length<r)return[];for(var o=[],s=0;s<i.length-r+1;s++){var u=new n(i.slice(s,s+r));o.push(u)}return o}(0,i)).forEach(function(t){r.hasOwnProperty(t.key)?r[t.key].inc():r[t.key]=t})})}),Object.keys(r).map(function(t){return r[t]})}},{"./gram":34}],34:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=function(t,e,r){n.call(this,t,e,r),this.key=this.out("normal"),this.size=t.length,this.count=1};(a.prototype=Object.create(n.prototype)).inc=function(){this.count+=1},e.exports=a},{"../../paths":8}],35:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./getGrams"),i=function(t){return t.list=t.list.sort(function(t,e){return t.count>e.count?-1:t.count===e.count&&(t.size>e.size||t.key.length>e.key.length)?-1:1}),t},o={data:function(){return this.list.map(function(t){return{normal:t.out("normal"),count:t.count,size:t.size}})},unigrams:function(){return this.list=this.list.filter(function(t){return 1===t.size}),this},bigrams:function(){return this.list=this.list.filter(function(t){return 2===t.size}),this},trigrams:function(){return this.list=this.list.filter(function(t){return 3===t.size}),this},sort:function(){return i(this)}};e.exports=n.makeSubset(o,function(t,e){var r=[];"number"==typeof e&&(e={n:e});for(var o=(e=e||{}).max||4,s=1;s<=o;s++)r.push(s);e.size&&(r=[e.size]);var u=a(t,{size:r});return t=new n(u),t=i(t),void 0!==e.n&&(t=t.get(e.n)),t})},{"../../text":192,"./getGrams":33}],36:[function(t,e,r){"use strict";var n=t("./index"),a=t("./getGrams"),i=function(t,e,r){n.call(this,t,e,r)};i.prototype=Object.create(n.prototype),i.find=function(t,e,r){var n={size:[1,2,3,4],edge:"start"};r&&(n.size=[r]);var o=a(t,n);return(t=new i(o)).sort(),"number"==typeof e&&(t=t.get(e)),t},e.exports=i},{"./getGrams":33,"./index":35}],37:[function(t,e,r){"use strict";e.exports=function(t){if(!t.tags.Noun)return!1;if(t.tags.Plural)return!0;for(var e=["Pronoun","Place","Value","Person","Month","WeekDay","RelativeDay","Holiday"],r=0;r<e.length;r++)if(t.tags[e[r]])return!1;return!0!==t.tags.Uncountable}},{}],38:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./noun");e.exports=n.makeSubset({isPlural:function(){return this.list=this.list.filter(function(t){return t.isPlural()}),this},hasPlural:function(){return this.list.map(function(t){return t.hasPlural()})},toPlural:function(){return this.list.forEach(function(t){return t.toPlural()}),this},toSingular:function(t){return this.list.forEach(function(e){return e.toSingular(t)}),this},toPossessive:function(t){return this.list.forEach(function(e){return e.toPossessive(t)}),this},articles:function(){return this.list.map(function(t){return{text:t.out("text"),normal:t.out("normal"),article:t.article()}})}},function(t,e){return t=(t=(t=(t=(t=(t=(t=t.clauses()).match("#Noun+ (of|by)? the? #Noun+?")).not("#Pronoun")).not("(there|these)")).not("(#Month|#WeekDay)")).not("(my|our|your|their|her|his)")).not("(of|for|by|the)$"),"number"==typeof e&&(t=t.get(e)),t.list=t.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),t})},{"../../text":192,"./noun":46}],39:[function(t,e,r){"use strict";var n=t("./methods/data/indicators"),a=/([a-z]*) (of|in|by|for) [a-z]/,i=t("./hasPlural"),o={i:!1,he:!1,she:!1,we:!0,they:!0},s=["Place","Value","Person","Month","WeekDay","RelativeDay","Holiday","Possessive"];e.exports=function(t,e){if(t.tags.Plural)return!0;if(t.tags.Singular)return!1;var r=t.normal;if(!0===o.hasOwnProperty(r))return o[r];if(e.plurals&&!0===e.plurals.hasOwnProperty(r))return!1;if(e.cache.toSingular&&!0===e.cache.toSingular.hasOwnProperty(r))return!0;if(!1===function(t){if(!1===i(t))return!1;for(var e=0;e<s.length;e++)if(t.tags[s[e]])return!1;return!0}(t))return null;var u=r.match(a);null!==u&&(r=u[1]);for(var l=0;l<n.plural_indicators.length;l++)if(!0===n.plural_indicators[l].test(r))return!0;for(var c=0;c<n.singular_indicators.length;c++)if(!0===n.singular_indicators[c].test(r))return!1;return!0===/s$/.test(r)&&!1===/ss$/.test(r)&&3<r.length}},{"./hasPlural":37,"./methods/data/indicators":41}],40:[function(t,e,r){"use strict";var n={hour:"an",heir:"an",heirloom:"an",honest:"an",honour:"an",honor:"an",uber:"an"},a={a:!0,e:!0,f:!0,h:!0,i:!0,l:!0,m:!0,n:!0,o:!0,r:!0,s:!0,x:!0},i=[/^onc?e/i,/^u[bcfhjkqrstn][aeiou]/i,/^eul/i];e.exports=function(t){var e=t.normal;if(t.tags.Person)return"";if(t.tags.Plural)return"the";if(n.hasOwnProperty(e))return n[e];var r=e.substr(0,1);if(t.isAcronym()&&a.hasOwnProperty(r))return"an";for(var o=0;o<i.length;o++)if(i[o].test(e))return"a";return/^[aeiou]/i.test(e)?"an":"a"}},{}],41:[function(t,e,r){"use strict";e.exports={singular_indicators:[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],plural_indicators:[/(^v)ies$/i,/ises$/i,/ives$/i,/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/(buffal|tomat|tornad)oes$/i,/(analy|ba|diagno|parenthe|progno|synop|the)ses$/i,/(vert|ind|cort)ices$/i,/(matr|append)ices$/i,/(x|ch|ss|sh|s|z|o)es$/i,/men$/i,/news$/i,/.tia$/i,/(^f)ves$/i,/(lr)ves$/i,/(^aeiouy|qu)ies$/i,/(m|l)ice$/i,/(cris|ax|test)es$/i,/(alias|status)es$/i,/ics$/i]}},{}],42:[function(t,e,r){"use strict";e.exports=[[/(ax|test)is$/i,"$1es"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"],[/(octop|vir)i$/i,"$1i"],[/(kn|l|w)ife$/i,"$1ives"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"],[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/(alias|status)$/i,"$1es"],[/(bu)s$/i,"$1ses"],[/(al|ad|at|er|et|ed|ad)o$/i,"$1oes"],[/([ti])um$/i,"$1a"],[/([ti])a$/i,"$1a"],[/sis$/i,"ses"],[/(hive)$/i,"$1s"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(x|ch|ss|sh|s|z)$/i,"$1es"],[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"],[/^(ox)$/i,"$1en"],[/^(oxen)$/i,"$1"],[/(quiz)$/i,"$1zes"],[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(.*)/i,"$1s"]].map(function(t){return{reg:t[0],repl:t[1]}})},{}],43:[function(t,e,r){"use strict";e.exports=[[/([^v])ies$/i,"$1y"],[/ises$/i,"isis"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(..[aeiou]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/(x|ch|ss|sh|z|o)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/([m|l])ice$/i,"$1ouse"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ics)$/i,"$1"],[/s$/i,""]].map(function(t){return{reg:t[0],repl:t[1]}})},{}],44:[function(t,e,r){"use strict";var n=t("./data/pluralRules");e.exports=function(t,e){var r=e.plurals||{};if(!0===r.hasOwnProperty(t))return r[t];for(var a=0;a<n.length;a++)if(!0===n[a].reg.test(t))return t.replace(n[a].reg,n[a].repl);return null}},{"./data/pluralRules":42}],45:[function(t,e,r){"use strict";var n=t("./data/singleRules");e.exports=function t(e,r){var a=r.cache.toSingular||{};if(!0===a.hasOwnProperty(e))return a[e];if(r&&r.plurals)for(var i=Object.keys(r.plurals),o=0;o<i.length;o++)if(r.plurals[i[o]]===e)return i[o];if(!0===/([a-z]*) (of|in|by|for) [a-z]/.test(e)){var s=(e.match(/^([a-z]*) (of|in|by|for) [a-z]/)||[])[1];if(s)return t(s)+e.replace(s,"")}for(var u=0;u<n.length;u++)if(!0===n[u].reg.test(e))return e.replace(n[u].reg,n[u].repl);return null}},{"./data/singleRules":43}],46:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./hasPlural"),i=t("./isPlural"),o=t("./toPossessive"),s=t("./makeArticle"),u=t("./methods/pluralize"),l=t("./methods/singularize"),c={article:function(){return s(this.main)},isPlural:function(){return i(this.main,this.world)},hasPlural:function(){return a(this.main)},toPlural:function(t){var e=this.main;return a(e)&&!i(e,this.world)&&(e.text=u(e.normal,this.world,t)||e.text,e.unTag("Singular","toPlural"),e.tag("Plural","toPlural")),this},toSingular:function(t){var e=this.main;return i(e,this.world)&&(e.text=l(e.normal,this.world,t)||e.text,e.unTag("Plural","toSingular"),e.tag("Singular","toSingular")),this},toPossessive:function(){var t=this.main;return t.tags.Possessive||(t=o(t)),this},data:function(){var t=this.main,e=t.text;i(t,this.world)&&(e=l(t.normal,this.world)||t.text);var r=t.text;a(t)&&!i(t,this.world)&&(r=u(t.normal,this.world)||t.text);var n="";return this.qualifier&&(e+=" "+(n=this.qualifier.out("normal")),r+=" "+n),{text:this.out("text"),normal:this.out("normal"),article:this.article(),main:t.normal,qualifier:n,singular:e,plural:r}}},h=function(t,e,r){n.call(this,t,e,r),this.main=this.match("[#Noun+] (of|by|for)"),this.main.found?this.main=this.main.list[0].terms[0]:this.main=this.terms[this.terms.length-1],this.qualifier=this.match(this.main.normal+" [.+]").list[0]};h.prototype=Object.create(n.prototype),Object.keys(c).forEach(function(t){h.prototype[t]=c[t]}),e.exports=h},{"../../paths":8,"./hasPlural":37,"./isPlural":39,"./makeArticle":40,"./methods/pluralize":44,"./methods/singularize":45,"./toPossessive":47}],47:[function(t,e,r){"use strict";var n={he:"his",she:"hers",they:"theirs",we:"ours",i:"mine",you:"yours",her:"hers",their:"theirs",our:"ours",my:"mine",your:"yours"};e.exports=function(t){return t.tag("Possessive","toPossessive"),n.hasOwnProperty(t.normal)?t.text=n[t.normal]:/s$/.test(t.normal)?t.text+="'":t.text+="'s",t}},{}],48:[function(t,e,r){"use strict";e.exports=function(t){return t?!0===/.(i|ee|[a|e]y|a)$/.test(t)?"Female":!0===/[ou]$/.test(t)?"Male":!0===/(nn|ll|tt)/.test(t)?"Female":null:null}},{}],49:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./person");e.exports=n.makeSubset({pronoun:function(){return this.list.map(function(t){return t.pronoun()})},firstNames:function(){return this.match("#FirstName")},lastNames:function(){return this.match("#LastName")}},function(t,e){var r=t.clauses();return r=r.match("#Person+"),"number"==typeof e&&(r=r.get(e)),r.list=r.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),r})},{"../../text":192,"./person":50}],50:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./guessGender"),i=function(t,e,r,a){if(n.call(this,t,e,r,a),this.firstName=this.match("#FirstName+"),this.middleName=this.match("#Acronym+"),this.nickName=this.match("#NickName+"),this.honorifics=this.match("#Honorific"),this.lastName=this.match("#LastName+"),!this.firstName.found&&1<this.length){var i=this.not("(#Acronym|#Honorific)");this.firstName=i.first(),this.lastName=i.last()}return this};i.prototype=Object.create(n.prototype);var o={data:function(){return{text:this.out("text"),normal:this.out("normal"),firstName:this.firstName.out("normal"),middleName:this.middleName.out("normal"),nickName:this.nickName.out("normal"),lastName:this.lastName.out("normal"),genderGuess:this.guessGender(),pronoun:this.pronoun(),honorifics:this.honorifics.out("array")}},guessGender:function(){if(this.honorifics.match("(mr|mister|sr|sir|jr)").found)return"Male";if(this.honorifics.match("(mrs|miss|ms|misses|mme|mlle)").found)return"Female";if(this.firstName.match("#MaleName").found)return"Male";if(this.firstName.match("#FemaleName").found)return"Female";var t=this.firstName.out("normal");return a(t)},pronoun:function(){var t=this.firstName.out("normal"),e=this.guessGender(t);return"Male"===e?"he":"Female"===e?"she":"they"},root:function(){var t=this.firstName.out("root"),e=this.lastName.out("root");return t&&e?t+" "+e:e||t||this.out("root")}};Object.keys(o).forEach(function(t){i.prototype[t]=o[t]}),e.exports=i},{"../../paths":8,"./guessGender":48}],51:[function(t,e,r){"use strict";var n=t("../../text");e.exports=n.makeSubset({strip:function(){return this.list.forEach(function(t){var e=t.terms[t.terms.length-1];e.text=e.text.replace(/'s$/,""),e.unTag("Possessive",".strip()")}),this}},function(t,e){return t=(t=t.match("#Possessive+")).splitAfter("#Comma"),"number"==typeof e&&(t=t.get(e)),t})},{"../../text":192}],52:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./sentence"),i={toPastTense:function(){return this.list=this.list.map(function(t){return t=t.toPastTense(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toPresentTense:function(){return this.list=this.list.map(function(t){return t=t.toPresentTense(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toFutureTense:function(){return this.list=this.list.map(function(t){return t=t.toFutureTense(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toContinuous:function(){return this.list=this.list.map(function(t){return t=t.toContinuous(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toNegative:function(){return this.list=this.list.map(function(t){return t=t.toNegative(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toPositive:function(){return this.list=this.list.map(function(t){return t=t.toPositive(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},isPassive:function(){return this.list=this.list.filter(function(t){return t.isPassive()}),this},isQuestion:function(){return this.questions()},prepend:function(t){return this.list=this.list.map(function(e){return e.prepend(t)}),this},append:function(t){return this.list=this.list.map(function(e){return e.append(t)}),this},toExclamation:function(){return this.list.forEach(function(t){t.setPunctuation("!")}),this},toQuestion:function(){return this.list.forEach(function(t){t.setPunctuation("?")}),this},toStatement:function(){return this.list.forEach(function(t){t.setPunctuation(".")}),this}};e.exports=n.makeSubset(i,function(t,e){return t=t.all(),"number"==typeof e&&(t=t.get(e)),t.list=t.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),t})},{"../../text":192,"./sentence":54}],53:[function(t,e,r){"use strict";e.exports=function(t){var e=t.getPunctuation(),r=t.match("*").splitAfter("#Comma");return!(!0!==/\?/.test(e)&&(/\.\.$/.test(t.out("text"))||t.has("^#QuestionWord")&&t.has("#Comma")||!t.has("^#QuestionWord")&&!t.has("^(do|does|did|is|was|can|could|will|would|may) #Noun")&&!t.has("^(have|must) you")&&!r.has("^#QuestionWord")&&!r.has("(do|does|is|was) #Noun+ #Adverb? (#Adjective|#Infinitive)$")))}},{}],54:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./toNegative"),i=t("./toPositive"),o=t("../verbs/verb"),s=t("./smartInsert"),u=function(t){var e=t.match("#Condition"),r=t.not("#Condition"),n=r.match("#VerbPhrase+").first(),a=n.out("normal"),i=r.match("#Determiner? #Adjective+? #Noun "+a).first().not("#VerbPhrase"),s=r.match(a+" #Preposition? #Determiner? #Noun").first().not("#VerbPhrase");return t.conditions=e,t.subject=i,t.verb=n,t.object=s,t.verb.found&&(t.verb=new o(t.verb.list[0].terms,t.world,t.refText,t.refTerms)),t},l=function(t){t.found&&t.contractions().expand()},c={toSingular:function(){return this.match("#Noun").match("!#Pronoun").firstTerm().things().toSingular(),this},toPlural:function(){return this.match("#Noun").match("!#Pronoun").firstTerm().things().toPlural(),this},mainVerb:function(){return u(this),this.verb.found?this.verb:null},toPastTense:function(){var t=this.mainVerb();if(t){var e=t.out("root");t.toPastTense();var r=this.match("#Contraction "+e);l(r);var n=t.out("root");return this.parentTerms.replace(e,n)}return this},toPresentTense:function(){var t,e=this.mainVerb();if(e){var r=e.out("normal");if(1==!(!this.subject.found||!this.subject.has("(i|we)")))this.has("(am|will|did) "+r)&&((t=this).terms=t.terms.filter(function(t){if(t.silent_term){if("am"===t.silent_term||"will"===t.silent_term||"did"===t.silent_term)return!1;t.text=t.silent_term,t.silent_term=null,t.unTag("Contraction"),!0===t.tags.TitleCase&&t.toTitleCase()}return!0})),e.toInfinitive();else{e.toPresentTense();var n=this.match("#Contraction "+r);l(n)}var a=e.out("normal");return this.parentTerms.replace(r,a)}return this},toFutureTense:function(){var t=this.mainVerb();if(t){var e=t.clone();t.toFutureTense();var r=this.match("#Contraction "+e.out("normal"));l(r);var n=t.out("normal");return this.parentTerms.replace(e,n)}return this},toContinuous:function(){var t=this.mainVerb();if(t){var e=t.clone();t.toGerund();var r=this.match("#Contraction "+e.out("normal"));l(r);var n=t.out("normal");return this.parentTerms.replace(e,n)}return this},isNegative:function(){return 1===this.match("#Negative").list.length},toNegative:function(){return this.isNegative()?this:a(this)},toPositive:function(){return this.isNegative()?i(this):this},append:function(t){return s.append(this,t)},prepend:function(t){return s.prepend(this,t)},isPassive:function(){return this.match("was #Adverb? #PastTense #Adverb? by").found}},h=function(t,e,r,a){n.call(this,t,e,r,a),u(this)};h.prototype=Object.create(n.prototype),Object.keys(c).forEach(function(t){h.prototype[t]=c[t]}),e.exports=h},{"../../paths":8,"../verbs/verb":94,"./smartInsert":55,"./toNegative":56,"./toPositive":57}],55:[function(t,e,r){"use strict";var n=/^[A-Z]/;e.exports={append:function(t,e){var r=t.terms[t.terms.length-1],n=t.getPunctuation();n&&r.killPunctuation(),t.insertAt(t.terms.length,e);var a=t.terms[t.terms.length-1];return n&&(a.text+=n),r.whitespace.after&&(a.whitespace.after=r.whitespace.after,r.whitespace.after=""),t},prepend:function(t,e){var r=t.terms[0];return t.insertAt(0,e),n.test(r.text)&&(!1===r.needsTitleCase()&&r.toLowerCase(),t.terms[0].toTitleCase()),t}}},{}],56:[function(t,e,r){"use strict";var n={everyone:"no one",everybody:"nobody",someone:"no one",somebody:"nobody",always:"never"};e.exports=function(t){var e=t.match("(everyone|everybody|someone|somebody|always)").first();if(e.found&&n[e.out("normal")]){var r=e.out("normal");return(t=t.match(r).replaceWith(n[r]).list[0]).parentTerms}var a=t.mainVerb();return a&&a.toNegative(),t}},{}],57:[function(t,e,r){"use strict";var n={never:"always",nothing:"everything"};e.exports=function(t){var e=t.match("(never|nothing)").first();if(e.found){var r=e.out("normal");if(n[r])return(t=t.match(r).replaceWith(n[r],!0).list[0]).parentTerms}return t.delete("#Negative"),t}},{}],58:[function(t,e,r){"use strict";var n=t("../../text"),a=t("../../paths").Terms,i={data:function(){return this.list.map(function(t){var e=t.terms[0];return{spaceBefore:e.whitespace.before,text:e.text,spaceAfter:e.whitespace.after,normal:e.normal,implicit:e.silent_term,bestTag:e.bestTag(),tags:Object.keys(e.tags)}})}};e.exports=n.makeSubset(i,function(t,e){var r=[];return t.list.forEach(function(e){e.terms.forEach(function(n){r.push(new a([n],e.world,t))})}),t=new n(r,t.world,t.parent),"number"==typeof e&&(t=t.get(e)),t})},{"../../paths":8,"../../text":192}],59:[function(t,e,r){"use strict";var n=t("./numOrdinal"),a=t("./textOrdinal"),i=t("./textCardinal"),o=t("./niceNumber"),s={nice:function(t){return o(t)},ordinal:function(t){return n(t)},cardinal:function(t){return String(t)},niceOrdinal:function(t){return t=n(t),o(t)},text:function(t){return i(t).join(" ")},textOrdinal:function(t){return a(t)}};e.exports=s},{"./niceNumber":60,"./numOrdinal":61,"./textCardinal":62,"./textOrdinal":63}],60:[function(t,e,r){"use strict";e.exports=function(t){if(!t&&0!==t)return null;for(var e=(t=String(t)).split("."),r=e[0],n=1<e.length?"."+e[1]:"",a=/(\d+)(\d{3})/;a.test(r);)r=r.replace(a,"$1,$2");return r+n}},{}],61:[function(t,e,r){"use strict";var n=t("./toString");e.exports=function(t){if(!t&&0!==t)return null;var e=t%100;if(10<e&&e<20)return String(t)+"th";var r={0:"th",1:"st",2:"nd",3:"rd"},a=n(t),i=a.slice(a.length-1,a.length);return a+(r[i]?r[i]:"th")}},{"./toString":64}],62:[function(t,e,r){"use strict";var n=t("./toString"),a=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],i=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],o=[[1e24,"septillion"],[1e21,"sextillion"],[1e18,"quintillion"],[1e15,"quadrillion"],[1e12,"trillion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],s=function(t){var e=[];if(100<t)return e;for(var r=0;r<a.length;r++)t>=a[r][1]&&(t-=a[r][1],e.push(a[r][0]));return i[t]&&e.push(i[t]),e};e.exports=function(t){if(1e21<t)return[String(t)];var e=[];t<0&&(e.push("negative"),t=Math.abs(t));for(var r,a,i,u=(a=r=t,i=[],o.forEach(function(t){if(r>=t[0]){var e=Math.floor(a/t[0]);a-=e*t[0],e&&i.push({unit:t[1],count:e})}}),i),l=0;l<u.length;l++){var c=u[l].unit;"one"===c&&(c="",1<e.length&&e.push("and")),(e=e.concat(s(u[l].count))).push(c)}return 0===(e=(e=e.concat(function(e){var r=["zero","one","two","three","four","five","six","seven","eight","nine"],a=[],i=n(t).match(/\.([0-9]+)/);if(!i||!i[0])return a;a.push("point");for(var o=i[0].split(""),s=0;s<o.length;s++)a.push(r[o[s]]);return a}())).filter(function(t){return t})).length&&(e[0]=""),e}},{"./toString":64}],63:[function(t,e,r){"use strict";var n=t("./textCardinal"),a=t("../../../world/more-data/numbers").toOrdinal;e.exports=function(t){var e=n(t),r=e[e.length-1];return e[e.length-1]=a[r]||r,e.join(" ")}},{"../../../world/more-data/numbers":220,"./textCardinal":62}],64:[function(t,e,r){"use strict";e.exports=function(t){if(t<1e6)return String(t);var e=t.toFixed(0);return-1===e.indexOf("e+")?e:e.replace(".","").split("e+").reduce(function(t,e){return t+Array(e-t.length+2).join(0)})}},{}],65:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./value"),i=t("./parse"),o={noDates:function(){return this.not("#Date")},noUnits:function(){return this.not("#Unit")},units:function(){return this.match("#Unit+")},numbers:function(){return this.list.map(function(t){return t.number()})},toNumber:function(){return this.list=this.list.map(function(t){return t.toNumber()}),this},toText:function(){return this.list=this.list.map(function(t){return t.toText()}),this},toCardinal:function(){return this.list=this.list.map(function(t){return t.toCardinal()}),this},toOrdinal:function(){return this.list=this.list.map(function(t){return t.toOrdinal()}),this},toNice:function(){return this.list=this.list.map(function(t){return t.toNice()}),this},isEqual:function(t){return t=i(t),this.list=this.list.filter(function(e){return null!==t&&e.number()===t}),this},greaterThan:function(t){return t=i(t),this.list=this.list.filter(function(e){return null!==t&&e.number()>t}),this},lessThan:function(t){return t=i(t),this.list=this.list.filter(function(e){return null!==t&&e.number()<t}),this},between:function(t,e){return void 0===t||void 0===e||(t=i(t),e=i(e),this.list=this.list.filter(function(r){var n=r.number();return t<n&&n<e})),this},add:function(t){return this.list=this.list.map(function(e){return e.add(t)}),this},subtract:function(t){return this.list=this.list.map(function(e){return e.subtract(t)}),this},increment:function(){return this.list=this.list.map(function(t){return t.add(1)}),this},decrement:function(){return this.list=this.list.map(function(t){return t.subtract(1)}),this}};e.exports=n.makeSubset(o,function(t,e){var r="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty";if((t=t.match("#Value+ #Unit?")).has("#NumericValue #NumericValue")&&(t.has("#Value #Comma #Value")?t.splitAfter("#Comma"):t.splitAfter("#NumericValue")),t.has("#Value #Value #Value")&&!t.has("#Multiple")&&t.has("("+r+") #Cardinal #Cardinal")&&t.splitAfter("("+r+") #Cardinal"),t.has("#Value #Value")){t.has("#NumericValue #NumericValue")&&t.splitOn("#Year"),t.has("("+r+") (eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen)")&&t.splitAfter("("+r+")");var n=t.match("#Cardinal #Cardinal");n.found&&!t.has("(point|decimal)")&&(n.has("#Cardinal (#Multiple|point|decimal)")||n.has("("+r+") #Cardinal")||n.has("#Multiple #Value")||t.splitAfter(n.terms(0).out("normal"))),t.match("#Ordinal #Ordinal").match("#TextValue").found&&!t.has("#Multiple")&&(t.has("("+r+") #Ordinal")||t.splitAfter("#Ordinal")),t.has("#Ordinal #Cardinal")&&t.splitBefore("#Cardinal+"),t.has("#TextValue #NumericValue")&&!t.has("("+r+"|#Multiple)")&&t.splitBefore("#NumericValue+")}t.has("#NumberRange")&&t.splitAfter("#NumberRange"),"number"==typeof e&&(t=t.get(e));var i=t.world();return t.list=t.list.map(function(t){return new a(t.terms,i,t.refText,t.refTerms)}),t})},{"../../text":192,"./parse":66,"./value":74}],66:[function(t,e,r){"use strict";var n=t("./parseText"),a=/^-?(\$|||)?\.?[0-9]+[0-9,\.]*(st|nd|rd|th|rth|%)?$/,i=function(t){if(!0===a.test(t)){t=(t=(t=(t=t.replace(/,/g,"")).replace(/^[\$|||]/g,"")).replace(/%$/,"")).replace(/(st|nd|rd|th|rth)$/g,"");var e=parseFloat(t);if(e||0===e)return e}return n(t)};e.exports=function(t){if(null==t||"number"==typeof t)return t;if("string"==typeof t)return i(t);if(1!==t.terms.length||!0===t.terms[0].tags.TextValue)return n(t.out("normal"));var e=t.terms[0].normal;return i(e)}},{"./parseText":69}],67:[function(t,e,r){"use strict";var n=t("../../../world/more-data/numbers"),a=t("../paths").fns,i=a.extend(n.ordinal.ones,n.cardinal.ones),o=a.extend(n.ordinal.teens,n.cardinal.teens),s=a.extend(n.ordinal.tens,n.cardinal.tens),u=a.extend(n.ordinal.multiples,n.cardinal.multiples);u.grand=1e3,e.exports={ones:i,teens:o,tens:s,multiples:u}},{"../../../world/more-data/numbers":220,"../paths":73}],68:[function(t,e,r){"use strict";e.exports=function(t){for(var e=[{reg:/^(minus|negative)[\s\-]/i,mult:-1},{reg:/^(a\s)?half[\s\-](of\s)?/i,mult:.5}],r=0;r<e.length;r++)if(!0===e[r].reg.test(t))return{amount:e[r].mult,str:t.replace(e[r].reg,"")};return{amount:1,str:t}}},{}],69:[function(t,e,r){"use strict";var n=t("./findModifiers"),a=t("./data"),i=t("./validate"),o=t("./parseDecimals"),s=t("./parseNumeric"),u=/^([0-9,\. ]+)\/([0-9,\. ]+)$/,l={"a couple":2,"a dozen":12,"two dozen":24,zero:0},c=function(t){return Object.keys(t).reduce(function(e,r){return e+t[r]},0)};e.exports=function(t){if(!0===l.hasOwnProperty(t))return l[t];if("a"===t||"an"===t)return 1;for(var e=n(t),r=null,h={},f=0,m=!1,d=(t=e.str).split(/[ -]/),p=0;p<d.length;p++){var g=d[p];if((g=s(g))&&"and"!==g)if("-"!==g&&"negative"!==g){if("-"===g.charAt(0)&&(m=!0,g=g.substr(1)),"point"===g)return f+=c(h),(f+=o(d.slice(p+1,d.length)))*e.amount;var v=g.match(u);if(v){var y=parseFloat(v[1].replace(/[, ]/g,"")),b=parseFloat(v[2].replace(/[, ]/g,""));b&&(f+=y/b||0)}else{if(!1===i(g,h))return null;if(/^[0-9\.]+$/.test(g))h.ones=parseFloat(g);else if(!0===a.ones.hasOwnProperty(g))h.ones=a.ones[g];else if(!0===a.teens.hasOwnProperty(g))h.teens=a.teens[g];else if(!0===a.tens.hasOwnProperty(g))h.tens=a.tens[g];else if(!0===a.multiples.hasOwnProperty(g)){var D=a.multiples[g];if(D===r)return null;if(100===D&&void 0!==d[p+1]){var w=d[p+1];a.multiples[w]&&(D*=a.multiples[w],p+=1)}null===r||D<r?(f+=(c(h)||1)*D,r=D):f=((f+=c(h))||1)*(r=D),h={}}}}else m=!0}return f+=c(h),f*=e.amount,0==(f*=m?-1:1)&&0===Object.keys(h).length?null:f}},{"./data":67,"./findModifiers":68,"./parseDecimals":70,"./parseNumeric":71,"./validate":72}],70:[function(t,e,r){"use strict";var n=t("./data");e.exports=function(t){for(var e="0.",r=0;r<t.length;r++){var a=t[r];if(!0===n.ones.hasOwnProperty(a))e+=n.ones[a];else if(!0===n.teens.hasOwnProperty(a))e+=n.teens[a];else if(!0===n.tens.hasOwnProperty(a))e+=n.tens[a];else{if(!0!==/^[0-9]$/.test(a))return 0;e+=a}}return parseFloat(e)}},{"./data":67}],71:[function(t,e,r){"use strict";e.exports=function(t){return(t=(t=(t=(t=(t=(t=(t=t.replace(/1st$/,"1")).replace(/2nd$/,"2")).replace(/3rd$/,"3")).replace(/([4567890])r?th$/,"$1")).replace(/^[$]/,"")).replace(/[%$]$/,"")).replace(/,/g,"")).replace(/([0-9])([a-z]{1,2})$/,"$1")}},{}],72:[function(t,e,r){"use strict";var n=t("./data");e.exports=function(t,e){if(n.ones.hasOwnProperty(t)){if(e.ones||e.teens)return!1}else if(n.teens.hasOwnProperty(t)){if(e.ones||e.teens||e.tens)return!1}else if(n.tens.hasOwnProperty(t)&&(e.ones||e.teens||e.tens))return!1;return!0}},{"./data":67}],73:[function(t,e,r){"use strict";e.exports=t("../../paths")},{"../../paths":8}],74:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./parse"),i=t("./format"),o=function(t){return t.val=t.match("#Value+"),t.val=t.val.list[0],t.unit=t.match("#Unit+"),t.unit.found&&(t.unit=t.unit.list[0]),t},s=function(t,e){
return!(!t.has("#Percent")&&!e.has("#Percent"))||"percent"===e.out("normal")||null!==t.out("normal").match(/%$/)},u=function(t,e){var r=t.val.out();return r=t.has("#Ordinal")?t.has("#TextValue")?i.textOrdinal(e):i.ordinal(e):t.has("#TextValue")?i.text(e):t.has("#NiceNumber")?i.nice(e):i.cardinal(e),t.unit.found&&(r+=t.unit.out("text")),t=t.replaceWith(r,!0),o(t)},l=function(t,e,r,a){n.call(this,t,e,r,a),o(this)};l.prototype=Object.create(n.prototype);var c={data:function(){var t=a(this.val);return{number:t,nice:i.nice(t),ordinal:i.ordinal(t),niceOrdinal:i.niceOrdinal(t),text:i.text(t),textOrdinal:i.textOrdinal(t),unit:this.unit.out("normal")}},number:function(){return a(this.val)},toNumber:function(){var t=a(this.val);if(t||0===t){var e="";this.val.has("#Ordinal")?e=i.ordinal(t):(e=String(t),s(this.val,this.unit)&&(e+="%",this.unit.delete())),this.unit.found&&(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("NumericValue"),this.unit.found&&this.match(this.unit.out("normal")).tag("Unit")}return this},toText:function(){var t=a(this.val);if(t||0===t){var e="";this.val.has("#Ordinal")?e=i.textOrdinal(t):(e=i.text(t),s(this.val,this.unit)&&(e+=" percent")),this.unit.found&&(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("TextValue"),this.unit.found&&this.match(this.unit.out("normal")).tag("Unit")}return this},toCardinal:function(){var t=a(this.val);if(t||0===t){var e="";e=this.val.has("#TextValue")?i.text(t):t,this.unit.found&&(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("Cardinal"),this.unit.found&&this.match(this.unit.out("normal")).tag("Unit")}return this},toOrdinal:function(){var t=a(this.val);if(t||0===t){var e="";e=this.val.has("#TextValue")?i.textOrdinal(t):i.ordinal(t),this.unit.found&&(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("Ordinal"),this.unit.found&&this.match(this.unit.out("normal")).tag("Unit")}return this},toNice:function(){var t=a(this.val);if(t||0===t){var e="";e=this.val.has("#Ordinal")?i.niceOrdinal(t):i.nice(t),this.unit.found&&(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("NumericValue"),this.unit.found&&this.match(this.unit.out("normal")).tag("Unit")}return this},add:function(t){if(!t)return this;var e=a(this.val)||0;return u(this,e+=t)},subtract:function(t){if(!t)return this;var e=a(this.val)||0;return u(this,e-=t)},increment:function(){return this.add(1)},decrement:function(){return this.subtract(1)}};Object.keys(c).forEach(function(t){l.prototype[t]=c[t]}),e.exports=l},{"../../paths":8,"./format":59,"./parse":66}],75:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./verb"),i={conjugation:function(t){return this.list.map(function(e){return e.conjugation(t)})},conjugate:function(t,e){return null!==t&&"number"==typeof t&&this.list[t]?this.list[t].conjugate(e):this.list.map(function(t){return t.conjugate(e)})},isPlural:function(){return this.list=this.list.filter(function(t){return t.isPlural()}),this},isSingular:function(){return this.list=this.list.filter(function(t){return!t.isPlural()}),this},isNegative:function(){return this.list=this.list.filter(function(t){return t.isNegative()}),this},isPositive:function(){return this.list=this.list.filter(function(t){return!t.isNegative()}),this},toNegative:function(){return this.list=this.list.map(function(t){return t.toNegative()}),this},toPositive:function(){return this.list.forEach(function(t){t.toPositive()}),this},toPastTense:function(){return this.list.forEach(function(t){t.toPastTense()}),this},toPresentTense:function(){return this.list.forEach(function(t){t.toPresentTense()}),this},toFutureTense:function(){return this.list.forEach(function(t){t.toFutureTense()}),this},toInfinitive:function(){return this.list.forEach(function(t){t.toInfinitive()}),this},toGerund:function(){return this.list.forEach(function(t){t.toGerund()}),this},asAdjective:function(){return this.list.map(function(t){return t.asAdjective()})}};i.toContinuous=i.toGerund,e.exports=n.makeSubset(i,function(t,e){return t=(t=(t=t.match("(#Adverb|#Auxiliary|#Verb|#Negative|#Particle)+")).splitAfter("#Comma")).if("#Verb"),"number"==typeof e&&(t=t.get(e)),t.list=t.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),new n(t.list,this.world,this.parent)})},{"../../text":192,"./verb":94}],76:[function(t,e,r){"use strict";var n=t("./methods/predict"),a=t("./methods/isPlural");e.exports=function(t){var e,r,i,o,s,u;return{negative:2!==(e=t.match("#Negative").list).length&&1===e.length,continuous:(u=t,u.match("#Gerund").found),passive:(s=t,!!s.match("is being #PastTense").found||!!s.match("(had|has) been #PastTense").found||!!s.match("will have been #PastTense").found),perfect:(o=t,!!o.match("^(had|have) #PastTense")),plural:a(t),modal:(r=t,i=r.match("#Modal"),i.found?i.out("normal"):null),tense:function(t){if(t.auxiliary.found){if(t.match("will have #PastTense").found)return"Past";if(t.auxiliary.match("will").found)return"Future";if(t.auxiliary.match("was").found)return"Past"}return t.verb&&{PastTense:"Past",FutureTense:"Future",FuturePerfect:"Future"}[n(t.verb)]||"Present"}(t)}}},{"./methods/isPlural":86,"./methods/predict":87}],77:[function(t,e,r){"use strict";var n=t("./irregulars"),a=t("./suffixes"),i=t("./toActor"),o=t("./generic"),s=t("../predict"),u=t("../toInfinitive"),l=t("./toBe");e.exports=function(t,e){if("is"===t.normal||"was"===t.normal||"will"===t.normal)return l();t.tags.Contraction&&(t.text=t.silent_term);var r={PastTense:null,PresentTense:null,Infinitive:null,Gerund:null,Actor:null},c=s(t);c&&(r[c]=t.normal),"Infinitive"!==c&&(r.Infinitive=u(t,e)||"");var h=n(r.Infinitive,e)||{};Object.keys(h).forEach(function(t){h[t]&&!r[t]&&(r[t]=h[t])});var f=r.Infinitive||t.normal,m=a(f);return Object.keys(m).forEach(function(t){m[t]&&!r[t]&&(r[t]=m[t])}),r.Actor||(r.Actor=i(f)),Object.keys(r).forEach(function(t){!r[t]&&o[t]&&(r[t]=o[t](r))}),r}},{"../predict":87,"../toInfinitive":90,"./generic":80,"./irregulars":82,"./suffixes":83,"./toActor":84,"./toBe":85}],78:[function(t,e,r){"use strict";e.exports=[{reg:/(eave)$/i,repl:{pr:"$1s",pa:"$1d",gr:"eaving",ar:"$1r"}},{reg:/(ink)$/i,repl:{pr:"$1s",pa:"unk",gr:"$1ing",ar:"$1er"}},{reg:/([aeiou]k)in$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing",ar:"$1er"}},{reg:/(end)$/i,repl:{pr:"$1s",pa:"ent",gr:"$1ing",ar:"$1er"}},{reg:/(ide)$/i,repl:{pr:"$1s",pa:"ode",gr:"iding",ar:"ider"}},{reg:/(ake)$/i,repl:{pr:"$1s",pa:"ook",gr:"aking",ar:"$1r"}},{reg:/(eed)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing",ar:"$1er"}},{reg:/(e)(ep)$/i,repl:{pr:"$1$2s",pa:"$1pt",gr:"$1$2ing",ar:"$1$2er"}},{reg:/(a[tg]|i[zn]|ur|nc|gl|is)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing",prt:"$1en"}},{reg:/([i|f|rr])y$/i,repl:{pr:"$1ies",pa:"$1ied",gr:"$1ying"}},{reg:/([td]er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/([bd]l)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/(ish|tch|ess)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/(ion|end|e[nc]t)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(om)e$/i,repl:{pr:"$1es",pa:"ame",gr:"$1ing"}},{reg:/(.eat)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/([aeiu])([pt])$/i,repl:{pr:"$1$2s",pa:"$1$2",gr:"$1$2$2ing"}},{reg:/(er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(en)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(ed)$/i,repl:{pr:"$1s",pa:"$1ded",ar:"$1der",gr:"$1ding"}},{reg:/(..)(ow)$/i,repl:{pr:"$1$2s",pa:"$1ew",gr:"$1$2ing",prt:"$1$2n"}},{reg:/(..)([cs]h)$/i,repl:{pr:"$1$2es",pa:"$1$2ed",gr:"$1$2ing"}},{reg:/([^aeiou][ou])(g|d)$/i,repl:{pr:"$1$2s",pa:"$1$2$2ed",gr:"$1$2$2ing"}},{reg:/([^aeiou][aeiou])(b|t|p|m)$/i,repl:{pr:"$1$2s",pa:"$1$2$2ed",gr:"$1$2$2ing"}},{reg:/([aeiou]zz)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}]},{}],79:[function(t,e,r){"use strict";var n=t("./irregulars"),a=t("./suffixes"),i=t("./generic"),o=["Gerund","PastTense","PresentTense"];e.exports=function(t,e){var r={Infinitive:t};if(e&&e.conjugations){var s=n(r.Infinitive,e);null!==s&&Object.keys(s).forEach(function(t){s[t]&&!r[t]&&(r[t]=s[t])})}var u=a(t);Object.keys(u).forEach(function(t){u[t]&&!r[t]&&(r[t]=u[t])});for(var l=0;l<o.length;l++)void 0===r[o[l]]&&(r[o[l]]=i[o[l]](r));return r}},{"./generic":80,"./irregulars":82,"./suffixes":83}],80:[function(t,e,r){"use strict";var n=/[bcdfghjklmnpqrstvwxz]y$/,a={Gerund:function(t){var e=t.Infinitive;return"e"===e.charAt(e.length-1)?e.replace(/e$/,"ing"):e+"ing"},PresentTense:function(t){var e=t.Infinitive;return"s"===e.charAt(e.length-1)?e+"es":!0===n.test(e)?e.slice(0,-1)+"ies":e+"s"},PastTense:function(t){var e=t.Infinitive;return"e"===e.charAt(e.length-1)?e+"d":"ed"===e.substr(-2)?e:!0===n.test(e)?e.slice(0,-1)+"ied":e+"ed"}};e.exports=a},{}],81:[function(t,e,r){"use strict";var n=t("./conjugate"),a=t("./toBe"),i=function(t,e){if(e.adverbs.found){var r=e.first().match("#Adverb").found;Object.keys(t).forEach(function(n){t[n]=r?e.adverbs.out()+" "+t[n]:t[n]+e.adverbs.out()})}return t};e.exports=function(t,e){var r=t.negative.found,o=t.isPlural();if(t.verb.tags.Copula||"be"===t.verb.normal&&t.auxiliary.match("will").found){var s=!1;t.parent&&t.parent.has("i #Adverb? #Copula")&&(s=!0);var u=a(o,r,s);return i(u,t)}var l=n(t.verb,t.world,e);return t.particle.found&&Object.keys(l).forEach(function(e){l[e]=l[e]+t.particle.out()}),r&&(l.PastTense="did not "+l.Infinitive,l.PresentTense="does not "+l.Infinitive,l.Gerund="not "+l.Gerund),l.FutureTense||(l.FutureTense=r?"will not "+l.Infinitive:"will "+l.Infinitive),l=i(l,t)}},{"./conjugate":77,"./toBe":85}],82:[function(t,e,r){"use strict";var n=t("../../../../fns"),a=["Participle","Gerund","PastTense","PresentTense","FuturePerfect","PerfectTense","Actor"];e.exports=function(t,e){var r=e.conjugations,i=Object.keys(r);if(e&&e.conjugations&&!0===e.conjugations.hasOwnProperty(t))return e.conjugations[t];if(!0===r.hasOwnProperty(t)){var o=n.copy(r[t]);return o.Infinitive=t,o}for(var s=0;s<i.length;s++)for(var u=0;u<a.length;u++){var l=r[i[s]];if(l[a[u]]===t){var c=n.copy(l);return c.Infinitive=i[s],c}}return{}}},{"../../../../fns":3}],83:[function(t,e,r){"use strict";var n=t("./data/rules"),a={pr:"PresentTense",pa:"PastTense",gr:"Gerund",prt:"Participle",ar:"Actor"},i=Object.keys(a);e.exports=function(t){for(var e={},r=0;r<n.length;r++)if(!0===n[r].reg.test(t)){for(var o=n[r].repl,s=0;s<i.length;s++)!0===o.hasOwnProperty(i[s])&&(e[a[i[s]]]=t.replace(n[r].reg,o[i[s]]));return e}return e}},{"./data/rules":78}],84:[function(t,e,r){"use strict";var n={tie:"tier",dream:"dreamer",sail:"sailer",run:"runner",rub:"rubber",begin:"beginner",win:"winner",claim:"claimant",deal:"dealer",spin:"spinner"},a={aid:1,fail:1,appear:1,happen:1,seem:1,try:1,say:1,marry:1,be:1,forbid:1,understand:1,bet:1},i=[{reg:/e$/i,repl:"er"},{reg:/([aeiou])([mlgp])$/i,repl:"$1$2$2er"},{reg:/([rlf])y$/i,repl:"$1ier"},{reg:/^(.?.[aeiou])t$/i,repl:"$1tter"}];e.exports=function(t){if(a[t])return null;if(n.hasOwnProperty(t))return n[t];for(var e=0;e<i.length;e++)if(!0===i[e].reg.test(t))return t.replace(i[e].reg,i[e].repl);return t+"er"}},{}],85:[function(t,e,r){"use strict";e.exports=function(t,e,r){var n={PastTense:"was",PresentTense:"is",FutureTense:"will be",Infinitive:"is",Gerund:"being",Actor:"",PerfectTense:"been",Pluperfect:"been"};return!0===r&&(n.PresentTense="am",n.Infinitive="am"),t&&(n.PastTense="were",n.PresentTense="are",n.Infinitive="are"),e&&(n.PastTense+=" not",n.PresentTense+=" not",n.FutureTense="will not be",n.Infinitive+=" not",n.PerfectTense="not "+n.PerfectTense,n.Pluperfect="not "+n.Pluperfect,n.Gerund="not "+n.Gerund),n}},{}],86:[function(t,e,r){"use strict";e.exports=function(t){if(t.match("(are|were|does)").found)return!0;if(t.match("(is|am|do|was)").found)return!1;var e=t.getNoun();if(e&&e.found){if(e.match("#Plural").found)return!0;if(e.match("#Singular").found)return!1}return null}},{}],87:[function(t,e,r){"use strict";var n=t("./suffix_rules"),a={Infinitive:!0,Gerund:!0,PastTense:!0,PresentTense:!0,FutureTense:!0,PerfectTense:!0,Pluperfect:!0,FuturePerfect:!0,Participle:!0};e.exports=function(t){for(var e=Object.keys(a),r=0;r<e.length;r++)if(t.tags[e[r]])return e[r];for(var i=Object.keys(n),o=0;o<i.length;o++)if(t.normal.substr(-i[o].length)===i[o]&&t.normal.length>i[o].length)return n[i[o]];return null}},{"./suffix_rules":88}],88:[function(t,e,r){"use strict";for(var n={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","own","unk","ung","en"],PastTense:["ed","lt","nt","pt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns","s"]},a={},i=Object.keys(n),o=i.length,s=0;s<o;s++)for(var u=n[i[s]].length,l=0;l<u;l++)a[n[i[s]][l]]=i[s];e.exports=a},{}],89:[function(t,e,r){"use strict";var n=[[/y$/,"i"],[/([aeiou][n])$/,"$1n"]],a={collect:!0,exhaust:!0,convert:!0,digest:!0,discern:!0,dismiss:!0,reverse:!0,access:!0,collapse:!0,express:!0},i={eat:"edible",hear:"audible",see:"visible",defend:"defensible",write:"legible",move:"movable",divide:"divisible",perceive:"perceptible"};e.exports=function(t){if(i.hasOwnProperty(t))return i[t];for(var e=0;e<n.length;e++)!0===n[e][0].test(t)&&(t=t.replace(n[e][0],n[e][1]));var r=t+"able";return a[t]&&(r=t+"ible"),r}},{}],90:[function(t,e,r){"use strict";var n=t("./rules"),a=t("../predict");e.exports=function(t,e){var r=e.cache.toInfinitive||{};if(t.tags.Infinitive)return t.normal;if(!0===r.hasOwnProperty(t.normal))return r[t.normal];var i=a(t);if(n[i])for(var o=0;o<n[i].length;o++){var s=n[i][o];if(t.normal.match(s.reg))return t.normal.replace(s.reg,s.to)}return t.normal}},{"../predict":87,"./rules":91}],91:[function(t,e,r){"use strict";e.exports={Participle:[{reg:/own$/i,to:"ow"},{reg:/(.)un([g|k])$/i,to:"$1in$2"}],Actor:[{reg:/(er)er$/i,to:"$1"}],PresentTense:[{reg:/(..)(ies)$/i,to:"$1y"},{reg:/(tch|sh)es$/i,to:"$1"},{reg:/(ss|zz)es$/i,to:"$1"},{reg:/([tzlshicgrvdnkmu])es$/i,to:"$1e"},{reg:/(n[dtk]|c[kt]|[eo]n|i[nl]|er|a[ytrl])s$/i,to:"$1"},{reg:/(ow)s$/i,to:"$1"},{reg:/(op)s$/i,to:"$1"},{reg:/([eirs])ts$/i,to:"$1t"},{reg:/(ll)s$/i,to:"$1"},{reg:/(el)s$/i,to:"$1"},{reg:/(ip)es$/i,to:"$1e"},{reg:/ss$/i,to:"ss"},{reg:/s$/i,to:""}],Gerund:[{reg:/pping$/i,to:"p"},{reg:/lling$/i,to:"ll"},{reg:/tting$/i,to:"t"},{reg:/dding$/i,to:"d"},{reg:/ssing$/i,to:"ss"},{reg:/(..)gging$/i,to:"$1g"},{reg:/([^aeiou])ying$/i,to:"$1y"},{reg:/([^ae]i.)ing$/i,to:"$1e"},{reg:/(ea.)ing$/i,to:"$1"},{reg:/(u[rtcb]|[bdtpkg]l|n[cg]|a[gdkvtc]|[ua]s|[dr]g|yz|o[rlsp]|cre)ing$/i,to:"$1e"},{reg:/(ch|sh)ing$/i,to:"$1"},{reg:/(..)ing$/i,to:"$1"}],PastTense:[{reg:/(ued)$/i,to:"ue"},{reg:/a([^aeiouy])ed$/i,to:"a$1e"},{reg:/([aeiou]zz)ed$/i,to:"$1"},{reg:/(e|i)lled$/i,to:"$1ll"},{reg:/(.)(sh|ch)ed$/i,to:"$1$2"},{reg:/(tl|gl)ed$/i,to:"$1e"},{reg:/(um?pt?)ed$/i,to:"$1"},{reg:/(ss)ed$/i,to:"$1"},{reg:/pped$/i,to:"p"},{reg:/tted$/i,to:"t"},{reg:/(..)gged$/i,to:"$1g"},{reg:/(..)lked$/i,to:"$1lk"},{reg:/([^aeiouy][aeiou])ked$/i,to:"$1ke"},{reg:/(.[aeiou])led$/i,to:"$1l"},{reg:/(..)(h|ion|n[dt]|ai.|[cs]t|pp|all|ss|tt|int|ail|ld|en|oo.|er|k|pp|w|ou.|rt|ght|rm)ed$/i,to:"$1$2"},{reg:/(.ut)ed$/i,to:"$1e"},{reg:/(.pt)ed$/i,to:"$1"},{reg:/(us)ed$/i,to:"$1e"},{reg:/(..[^aeiouy])ed$/i,to:"$1e"},{reg:/(..)ied$/i,to:"$1y"},{reg:/(.o)ed$/i,to:"$1o"},{reg:/(..i)ed$/i,to:"$1"},{reg:/(.a[^aeiou])ed$/i,to:"$1"},{reg:/([rl])ew$/i,to:"$1ow"},{reg:/([pl])t$/i,to:"$1t"}]}},{}],92:[function(t,e,r){"use strict";e.exports=function(t){return t.match("#Contraction+").list.forEach(function(t){t.has("#Verb")&&t.terms.forEach(function(t){t.silent_term&&(t.text||(t.whitespace.before=" "),t._text=t.silent_term,t.tags.TitleCase&&t.toTitleCase(),t.normalize(),t.silent_term=null,t.unTag("Contraction","expanded"))})}),t}},{}],93:[function(t,e,r){"use strict";var n=t("./methods/toInfinitive"),a=function(t){return(t=(t=t.match("(#Adverb|#Auxiliary|#Verb|#Negative|#Particle)+")).splitAfter("#Comma")).list[0]};e.exports=function(t){var e=t.match("#Auxiliary").first();if(e.found){var r=e.list[0].index(),i=t.parentTerms.insertAt(r+1,"not","Verb");return i.match("not").tag("Negative","tag-not"),a(i)}var o=t.match("(#Copula|will|has|had|do)").first();if(o.found){var s=o.list[0].index(),u=t.parentTerms.insertAt(s+1,"not","Verb");return u.match("not").tag("Negative","tag-not"),a(u)}var l=t.isPlural(),c=t.match("#PastTense").last();if(c.found){var h=c.list[0],f=h.index();h.terms[0].text=n(h.terms[0],t.world);var m=t.parentTerms.insertAt(f,"did not","Verb");return m.match("not").tag("Negative","tag-not"),a(m)}var d=t.match("#PresentTense").first();if(d.found){var p=d.list[0],g=p.index();p.terms[0].text=n(p.terms[0],t.world);var v=null;return(v=t.getNoun().match("(i|we|they|you)").found?t.parentTerms.insertAt(g,"do not","Verb"):t.parentTerms.insertAt(g,"does not","Verb")).match("not").tag("Negative","tag-not"),a(v)}var y=t.match("#Gerund").last();if(y.found){var b=y.list[0].index(),D=t.parentTerms.insertAt(b,"not","Verb");return D.match("not").tag("Negative","tag-not"),a(D)}var w=t.match("#Verb").last();if(w.found){var x=w.list[0],C=x.index();x.terms[0].text=n(x.terms[0],t.world);var k=t;return(k=l?t.parentTerms.insertAt(C-1,"do not","Verb"):t.parentTerms.insertAt(C-1,"does not","Verb")).match("not").tag("Negative","tag-not"),a(k)}return t}},{"./methods/toInfinitive":90}],94:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./methods/conjugate"),i=t("./methods/toAdjective"),o=t("./interpret"),s=t("./toNegative"),u=t("./methods/isPlural"),l=t("./methods/verbContraction"),c=function(t){var e=t;t.negative=t.match("#Negative"),t.adverbs=t.match("#Adverb");var r=t.clone().not("(#Adverb|#Negative)");if(t.verb=r.match("#Verb").not("#Particle").last(),t.particle=r.match("#Particle").last(),t.verb.found){var n=t.verb.out("normal");t.auxiliary=e.not(n).not("(#Adverb|#Negative)"),t.verb=t.verb.list[0].terms[0]}else t.verb=e.terms[0];return t},h={parse:function(){return c(this)},data:function(t){return{text:this.out("text"),normal:this.out("normal"),parts:{negative:this.negative.out("normal"),auxiliary:this.auxiliary.out("normal"),verb:this.verb.out("normal"),particle:this.particle.out("normal"),adverbs:this.adverbs.out("normal")},interpret:o(this,t),conjugations:this.conjugate()}},getNoun:function(){if(!this.refTerms)return null;var t="#Adjective? #Noun+ "+this.out("normal");return this.refTerms.match(t).match("#Noun+")},conjugation:function(){return o(this,!1).tense},conjugate:function(t){return a(this,t)},isPlural:function(){return u(this)},isNegative:function(){return 1===this.match("#Negative").list.length},isPerfect:function(){return this.auxiliary.match("(have|had)").found},toNegative:function(){return this.isNegative()?this:s(this)},toPositive:function(){return this.match("#Negative").delete()},toPastTense:function(){this.has("#Contraction")&&(this.list=l(this.parentTerms).list);var t=this.conjugate().PastTense,e=this.replaceWith(t,!1);return e.verb.tag("#PastTense"),e},toPresentTense:function(){this.has("#Contraction")&&l(this.parentTerms);var t=this.conjugate(),e=this.replaceWith(t.PresentTense,!1);return e.verb.tag("#PresentTense"),e},toFutureTense:function(){this.has("#Contraction")&&l(this.parentTerms);var t=this.conjugate(),e=this.replaceWith(t.FutureTense,!1);return e.verb.tag("#FutureTense"),e},toInfinitive:function(){this.has("#Contraction")&&l(this.parentTerms);var t=this.conjugate(),e=this.replaceWith(t.Infinitive,!1);return e.verb.tag("#Infinitive"),e},toGerund:function(){this.has("#Contraction")&&l(this.parentTerms);var t=this.conjugate(),e="is",r=this.getNoun().out("normal");if(r){var n={i:"am",we:"are",they:"are"};n.hasOwnProperty(r)&&(e=n[r])}var a=e+" "+t.Gerund,i=this.replaceWith(a,!1);return i.verb.tag("#Gerund"),i},asAdjective:function(){return i(this.verb.out("normal"))}},f=function(t,e,r,a){return n.call(this,t,e,r,a),c(this)};f.prototype=Object.create(n.prototype),Object.keys(h).forEach(function(t){f.prototype[t]=h[t]}),e.exports=f},{"../../paths":8,"./interpret":76,"./methods/conjugate":81,"./methods/isPlural":86,"./methods/toAdjective":89,"./methods/verbContraction":92,"./toNegative":93}],95:[function(t,e,r){"use strict";var n={punctuation_step:t("./steps/01-punctuation_step"),emoji_step:t("./steps/02-emoji_step"),lexicon_step:t("./steps/03-lexicon_step"),lexicon_multi:t("./steps/04-lexicon_multi"),web_step:t("./steps/05-web_step"),suffix_step:t("./steps/06-suffix_step"),neighbour_step:t("./steps/07-neighbour_step"),capital_step:t("./steps/08-capital_step"),noun_fallback:t("./steps/09-noun_fallback"),contraction:t("./steps/10-contraction_step"),date_step:t("./steps/11-date_step"),auxiliary_step:t("./steps/12-auxiliary_step"),negation_step:t("./steps/13-negation_step"),comma_step:t("./steps/14-comma_step"),quotation_step:t("./steps/15-quotation_step"),possessive_step:t("./steps/16-possessive_step"),acronym_step:t("./steps/17-acronym_step"),person_step:t("./steps/18-person_step"),organization_step:t("./steps/19-organization_step"),parentheses_step:t("./steps/20-parentheses_step"),plural_step:t("./steps/21-plural_step"),value_step:t("./steps/22-value_step"),corrections:t("./steps/23-corrections"),properNoun:t("./steps/24-proper_noun"),custom:t("./steps/25-custom")},a=t("./phrase");e.exports=function(t){return t=n.punctuation_step(t),t=n.emoji_step(t),t=n.lexicon_step(t),t=n.lexicon_multi(t),t=n.web_step(t),t=n.suffix_step(t),t=n.comma_step(t),t=n.neighbour_step(t),t=n.capital_step(t),t=n.noun_fallback(t),t=n.contraction(t),t=n.date_step(t),t=n.auxiliary_step(t),t=n.negation_step(t),t=n.quotation_step(t),t=n.possessive_step(t),t=n.acronym_step(t),t=n.person_step(t),t=n.organization_step(t),t=n.parentheses_step(t),t=n.plural_step(t),t=n.value_step(t),t=n.corrections(t),t=n.properNoun(t),t=a(t),n.custom(t)}},{"./phrase":98,"./steps/01-punctuation_step":99,"./steps/02-emoji_step":100,"./steps/03-lexicon_step":101,"./steps/04-lexicon_multi":102,"./steps/05-web_step":103,"./steps/06-suffix_step":104,"./steps/07-neighbour_step":105,"./steps/08-capital_step":106,"./steps/09-noun_fallback":107,"./steps/10-contraction_step":108,"./steps/11-date_step":109,"./steps/12-auxiliary_step":110,"./steps/13-negation_step":111,"./steps/14-comma_step":112,"./steps/15-quotation_step":113,"./steps/16-possessive_step":114,"./steps/17-acronym_step":115,"./steps/18-person_step":116,"./steps/19-organization_step":117,"./steps/20-parentheses_step":118,"./steps/21-plural_step":119,"./steps/22-value_step":120,"./steps/23-corrections":121,"./steps/24-proper_noun":122,"./steps/25-custom":123}],96:[function(t,e,r){"use strict";e.exports=function(t){var e=t.match("#Condition .{1,7} #ClauseEnd");return e.found&&e.match("#Comma$")&&e.tag("Condition"),(e=t.match("#Condition .{1,13} #ClauseEnd #Pronoun")).found&&e.match("#Comma$")&&e.not("#Pronoun$").tag("Condition","end-pronoun"),(e=t.match("#Condition .{1,7} then")).found&&e.not("then$").tag("Condition","cond-then"),(e=t.match("as long as .{1,7} (then|#ClauseEnd)")).found&&e.not("then$").tag("Condition","as-long-then"),(e=t.match("#Comma #Condition .{1,7} .$")).found&&e.not("^#Comma").tag("Condition","comma-7-end"),(e=t.match("#Condition .{1,4}$")).found&&e.tag("Condition","cond-4-end"),t}},{}],97:[function(t,e,r){"use strict";e.exports=function(t){return t.has("(#Verb|#Auxiliary)")&&(t.match("#Verb").tag("VerbPhrase","verbphrase-verb"),t.match("#Adverb #Verb").tag("VerbPhrase","adverb-verb"),t.match("#Verb #Adverb").tag("VerbPhrase","verb-adverb"),t.match("#Verb #Negative").tag("VerbPhrase","verb-not"),t.match("never #Verb").tag("VerbPhrase","not-verb"),t.match("#Auxiliary+").tag("VerbPhrase","2"),t.match("#Copula").tag("VerbPhrase","#3"),t.match("#Adverb #Auxiliary").tag("VerbPhrase","#4")),t}},{}],98:[function(t,e,r){"use strict";var n=t("./00-conditionPass"),a=t("./01-verbPhrase");e.exports=function(t){return t=n(t),a(t)}},{"./00-conditionPass":96,"./01-verbPhrase":97}],99:[function(t,e,r){"use strict";var n=/^[A-Z][a-z']/,a=/^[IVXCM]+$/,i={a:!0,i:!0,u:!0,r:!0,c:!0,k:!0};e.exports=function(t){var e=t.world.regex||[];return t.terms.forEach(function(r,o){var s,u=r.text;!0===n.test(u)&&r.tag("TitleCase","punct-rule"),"-"===r.whitespace.after&&t.terms[o+1]&&""===t.terms[o+1].whitespace.before&&(r.tag("Hyphenated","has-hyphen"),t.terms[o+1].tag("Hyphenated","has-hyphen")),"("===r.text[0]&&r.tag("StartBracket"),!0===/\)[,.?!;:]?$/.test(r.text)&&r.tag("EndBracket"),u=u.replace(/[,\.\?]$/,"");for(var l=0;l<e.length;l++){var c=e[l];if(!0===c.reg.test(u))return void(r.canBe(c.tag)&&r.tag(c.tag,'punctuation-rule- "'+c.reg.toString()+'"'))}1===u.length&&t.terms[o+1]&&/[A-Z]/.test(u)&&!i[u.toLowerCase()]&&r.tag("Acronym","one-letter-acronym"),1<(s=r).text.length&&!0===a.test(s.text)&&s.canBe("RomanNumeral")&&r.tag("RomanNumeral","is-roman-numeral"),!0===/[0-9]\+$/.test(r.text)&&r.tag("NumericValue","number-plus")}),t}},{}],100:[function(t,e,r){"use strict";var n=t("./rules/emoji_regex"),a=t("./rules/emoticon_list");e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e];":"!==(o=r).text.charAt(0)||null===o.text.match(/:.?$/)||o.text.match(" ")||35<o.text.length||r.tag("Emoji","comma-emoji"),r.text.match(n)&&r.tag("Emoji","unicode-emoji"),i=r.text.replace(/^[:;]/,":"),!0===a.hasOwnProperty(i)&&r.tag("Emoji","emoticon-emoji")}var i,o;return t}},{"./rules/emoji_regex":130,"./rules/emoticon_list":131}],101:[function(t,e,r){"use strict";var n=t("./contraction/split");e.exports=function(t){for(var e=t.world.words||{},r=0;r<t.terms.length;r++){var a=t.terms[r];if(!0!==e.hasOwnProperty(a.normal))if(a.silent_term&&!0===e.hasOwnProperty(a.silent_term))a.tag(e[a.silent_term],"silent_term-lexicon");else if(a.root&&a.normal!==a.root&&!0===e.hasOwnProperty(a.root))a.tag(e[a.root],"lexicon");else{var i=n(a);if(i&&i.start){var o=i.start.toLowerCase();if(!0===e.hasOwnProperty(o)){a.tag(e[o],"contraction-lexicon");continue}}}else a.tag(e[a.normal],"lexicon")}return t}},{"./contraction/split":129}],102:[function(t,e,r){"use strict";var n=function(t,e,r){var n=r.words,a=t.terms[e].root,i=t.terms.slice(e+1,e+4).map(function(t){return t.root}),o=4;i.length<o&&(o=i.length);for(var s=o;0<s;s-=1){var u=a+" "+i.slice(0,s).join(" ");if(!0===n.hasOwnProperty(u))return t.slice(e,e+s+1).tag(n[u],"multi-lexicon-"+u),s}return 0};e.exports=function(t){t.world.cache=t.world.cache||{};for(var e=t.world.cache.firstWords||{},r=0;r<t.terms.length;r++){var a=t.terms[r];!0!==e.hasOwnProperty(a.root)||(r+=n(t,r,t.world))}return t}},{}],103:[function(t,e,r){"use strict";var n=/^\w+@\w+\.[a-z]{2,3}$/,a=/^#[a-z0-9_]{2,}$/,i=/^@\w{2,}$/,o=/^(https?:\/\/|www\.)\w+\.[a-z]{2,3}/,s=/^[\w\.\/]+\.(com|net|gov|org|ly|edu|info|biz|ru|jp|de|in|uk|br)/;e.exports=function(t){for(var e=0;e<t.length;e++){var r=t.get(e),u=r.text.trim().toLowerCase();!0===n.test(u)&&r.tag("Email","web_pass"),!0===a.test(u)&&r.tag("HashTag","web_pass"),!0===i.test(u)&&r.tag("AtMention","web_pass"),!0!==o.test(u)&&!0!==s.test(u)||r.tag("Url","web_pass")}return t}},{}],104:[function(t,e,r){"use strict";var n=t("./rules/regex_list"),a=t("./rules/suffix_lookup"),i=[[/^(lol)+[sz]$/,"Expression"],[/^ma?cd[aeiou]/,"LastName"],[/^[\-\+]?[0-9][0-9,]*(\.[0-9])*$/,"Cardinal"],[/^(un|de|re)\\-[a-z]../,"Verb"],[/^[\-\+]?[0-9]+(\.[0-9])*$/,"NumericValue"],[/^https?\:?\/\/[a-z0-9]/,"Url"],[/^www\.[a-z0-9]/,"Url"],[/^(over|under)[a-z]{2,}/,"Adjective"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date"],[/^[0-9]+([a-z]{1,2})$/,"Value"],[/^[0-9][0-9,\.]*(st|nd|rd|r?th)$/,["NumericValue","Ordinal"]],[/[a-z]*\\-[a-z]*\\-/,"Adjective"]],o=function(t){var e=t.normal.length,r=7;e<=r&&(r=e-1);for(var n=r;1<n;n-=1){var i=t.normal.substr(e-n,e);if(void 0!==a[n][i])return a[n][i]}return null},s=function(t){var e=t.normal.charAt(t.normal.length-1);if(void 0===n[e])return null;for(var r=n[e],a=0;a<r.length;a++)if(!0===r[a][0].test(t.normal))return r[a];return null};e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e],n=o(r);if(null===n||!0!==r.canBe(n))if(null===(n=s(r))||!0!==r.canBe(n[1]))for(var a=0;a<i.length;a++)!0===i[a][0].test(r.normal)&&(n=i[a][1],!0===r.canBe(n)&&r.tag(n,"misc-regex-"+i[a][0]));else r.tag(n[1],"regex-list: "+String(n[0]));else r.tag(n,"suffix-lookup")}return t}},{"./rules/regex_list":133,"./rules/suffix_lookup":134}],105:[function(t,e,r){"use strict";var n=t("./rules/neighbours"),a=n.afterThisWord,i=n.beforeThisWord,o=n.beforeThisPos,s=n.afterThisPos,u={TitleCase:!0,UpperCase:!0,CamelCase:!0,Hyphenated:!0,StartBracket:!0,EndBracket:!0,Comma:!0,ClauseEnd:!0};e.exports=function(t){return t.terms.forEach(function(e,r){var n=Object.keys(e.tags);if(0===(n=n.filter(function(t){return!1===u.hasOwnProperty(t)})).length){var l=t.terms[r-1],c=t.terms[r+1];if(l&&a.hasOwnProperty(l.normal)&&!l.tags.ClauseEnd)return void e.tag(a[l.normal],'neighbour-after-"'+l.normal+'"');if(!e.tags.ClauseEnd&&c&&i.hasOwnProperty(c.normal))return void e.tag(i[c.normal],'neighbour-before-"'+c.normal+'"');var h=[];if(l){h=Object.keys(l.tags);for(var f=0;f<h.length;f++)if(s[h[f]])return void e.tag(s[h[f]],"neighbour-after-["+h[f]+"]")}if(c){h=Object.keys(c.tags);for(var m=0;m<h.length;m++)if(o[h[m]])return void e.tag(o[h[m]],"neighbour-before-["+h[m]+"]")}}}),t}},{"./rules/neighbours":132}],106:[function(t,e,r){"use strict";e.exports=function(t){for(var e=1;e<t.terms.length;e++){var r=t.terms[e];r.tags.TitleCase&&r.isWord()&&(r.tag("Noun","capital-step"),r.tag("TitleCase","capital-step"))}var n=t.terms[0];return n&&n.tags.TitleCase&&(n.tags.Person||n.tags.Organization||n.tags.Place)&&n.tag("TitleCase","first-term-capital"),t}},{}],107:[function(t,e,r){"use strict";var n={TitleCase:!0,UpperCase:!0,CamelCase:!0,Hyphenated:!0,StartBracket:!0,EndBracket:!0,Comma:!0,ClauseEnd:!0},a=function(t){if(t.tags.Noun||t.tags.Verb||t.tags.Adjective)return!1;var e=Object.keys(t.tags);return 0===e.length||0===e.filter(function(t){return!n[t]}).length},i=function(t){if(!0===/^(re|un)-?[^aeiou]./.test(t.normal)){var e=t.normal.replace(/^(re|un)-?/,"");if(!0===t.world.words.hasOwnProperty(e)){var r=t.world.words[e];if("Infinitive"===r||"PresentTense"===r||"PastTense"===r||"Gerund"===r)return r}}return null};e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e];if(!r.tags.Noun&&!r.tags.Verb&&a(r)){if(!1===r.isWord())continue;var n=i(r);if(null!==n){r.tag(n,"root-tag-match");continue}r.tag("Noun","noun-fallback")}}return t}},{}],108:[function(t,e,r){"use strict";var n=t("./contraction/01-irregulars"),a=t("./contraction/02-isWasHas"),i=t("./contraction/03-easyOnes"),o=t("./contraction/04-numberRange");e.exports=function(t){return t=n(t),t=a(t),t=i(t),o(t)}},{"./contraction/01-irregulars":124,"./contraction/02-isWasHas":125,"./contraction/03-easyOnes":126,"./contraction/04-numberRange":127}],109:[function(t,e,r){"use strict";var n="(in|by|before|during|on|until|after|of|within|all)",a="(last|next|this|previous|current|upcoming|coming)",i="(start|end|middle|starting|ending|midpoint|beginning)",o="(spring|summer|winter|fall|autumn)",s=function(t,e){!0===t.found&&t.list.forEach(function(t){var r=parseInt(t.terms[0].normal,10);r&&1e3<r&&r<3e3&&t.terms[0].tag("Year",e)})},u=function(t,e){!0===t.found&&t.list.forEach(function(t){var r=parseInt(t.terms[0].normal,10);r&&1900<r&&r<2030&&t.terms[0].tag("Year",e)})};e.exports=function(t){var e="(january|april|may|june|summer|autumn|jan|sep)";t.has(e)&&(t.match("#Infinitive #Determiner? #Adjective? #Noun? (to|for) ".concat(e)).lastTerm().tag("Person","ambig-person"),t.match("#Infinitive ".concat(e)).lastTerm().tag("Person","infinitive-person"),t.match("".concat(e," #PresentTense (to|for)")).firstTerm().tag("Person","ambig-active"),t.match("".concat(e," #Modal")).firstTerm().tag("Person","ambig-modal"),t.match("#Modal ".concat(e)).lastTerm().tag("Person","modal-ambig"),t.match("(that|with|for) ".concat(e)).term(1).tag("Person","that-month"),
t.match("#Copula ".concat(e)).term(1).tag("Person","is-may"),t.match("".concat(e," #Copula")).term(0).tag("Person","may-is"),t.match("".concat(e," the? #Value")).term(0).tag("Month","person-value"),t.match("#Date ".concat(e)).term(1).tag("Month","correction-may"),t.match("".concat(e," the? #Value")).firstTerm().tag("Month","may-5th"),t.match("#Value of ".concat(e)).lastTerm().tag("Month","5th-of-may"),t.match("".concat(n," ").concat(e)).ifNo("#Holiday").term(1).tag("Month","preps-month"),t.match("(next|this|last) ".concat(e)).term(1).tag("Month","correction-may"));var r="(may|march)";if(t.has(r)&&(t.match("#Adverb ".concat(r)).lastTerm().tag("Infinitive","ambig-verb"),t.match("".concat(r," #Adverb")).lastTerm().tag("Infinitive","ambig-verb"),t.match("".concat(n," ").concat(r)).lastTerm().tag("Month","in-month"),t.match("(next|this|last) ".concat(r)).lastTerm().tag("Month","this-month"),t.match("".concat(r," the? #Value")).firstTerm().tag("Month","march-5th"),t.match("#Value of? ".concat(r)).lastTerm().tag("Month","5th-of-march"),t.match("[".concat(r,"] .? #Date")).lastTerm().tag("Month","march-and-feb"),t.match("#Date .? [".concat(r,"]")).lastTerm().tag("Month","feb-and-march"),t.has("march")&&(t.match("march (up|down|back|to|toward)").term(0).tag("Infinitive","march-to"),t.match("#Modal march").term(1).tag("Infinitive","must-march"))),t.has("sun")&&(t.match("sun #Date").firstTerm().tag("WeekDay","sun-feb"),t.match("sun the #Ordinal").tag("Date").firstTerm().tag("WeekDay","sun-the-5th"),t.match("#Determiner sun").lastTerm().tag("Singular","the-sun")),t.has("sat")&&(t.match("sat #Date").firstTerm().tag("WeekDay","sat-feb"),t.match("".concat(n," sat")).lastTerm().tag("WeekDay","sat")),t.has("#Month")&&(t.match("#Month #DateRange+").tag("Date","correction-numberRange"),t.match("#Value of #Month").tag("Date","value-of-month"),t.match("#Cardinal #Month").tag("Date","cardinal-month"),t.match("#Month #Value to #Value").tag("Date","value-to-value"),t.match("#Month the #Value").tag("Date","month-the-value")),t.match("in the (night|evening|morning|afternoon|day|daytime)").tag("Time","in-the-night"),t.match("(#Value|#Time) (am|pm)").tag("Time","value-ampm"),t.has("#Value")){t.match("for #Value #Duration").tag("Date","for-x-duration"),t.match("#Value #Abbreviation").tag("Value","value-abbr"),t.match("a #Value").if("(hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)").tag("Value","a-value"),t.match("(minus|negative) #Value").tag("Value","minus-value"),t.match("#Value grand").tag("Value","value-grand"),t.match("(half|quarter) #Ordinal").tag("Value","half-ordinal"),t.match("(hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion) and #Value").tag("Value","magnitude-and-value"),t.match("#Value (point|decimal) #Value").tag("Value","value-point-value"),t.match("".concat(n,"? #Value #Duration")).tag("Date","value-duration"),t.match("(#WeekDay|#Month) #Value").ifNo("#Money").tag("Date","date-value"),t.match("#Value (#WeekDay|#Month)").ifNo("#Money").tag("Date","value-date");var l=t.match("#TextValue #TextValue");l.found&&l.has("#Date")&&l.tag("#Date","textvalue-date"),t.match("#Value #Duration #Conjunction").tag("Date","val-duration-conjunction"),t.match("#Value #Duration old").unTag("Date","val-years-old")}if(t.has(o)&&(t.match("".concat(n,"? ").concat(a," ").concat(o)).tag("Date","thisNext-season"),t.match("the? ".concat(i," of ").concat(o)).tag("Date","section-season")),t.has("#Date")&&(t.match("#Date the? #Ordinal").tag("Date","correction-date"),t.match("".concat(a," #Date")).tag("Date","thisNext-date"),t.match("due? (by|before|after|until) #Date").tag("Date","by-date"),t.match("#Date (by|before|after|at|@|about) #Cardinal").not("^#Date").tag("Time","date-before-Cardinal"),t.match("#Date (am|pm)").term(1).unTag("Verb").unTag("Copula").tag("Time","date-am"),t.match("(last|next|this|previous|current|upcoming|coming|the) #Date").tag("Date","next-feb"),t.match("#Date (#Preposition|to) #Date").tag("Date","date-prep-date"),t.match("the? ".concat(i," of #Date")).tag("Date","section-of-date"),t.match("#Ordinal #Duration in #Date").tag("Date","duration-in-date"),t.match("(early|late) (at|in)? the? #Date").tag("Time","early-evening")),t.has("#Cardinal")){var c=t.match("#Date #Value #Cardinal").lastTerm();s(c,"date-value-year"),c=t.match("#Date+ #Cardinal").lastTerm(),s(c,"date-year"),c=t.match("#Month #Value #Cardinal").lastTerm(),s(c,"month-value-year"),c=t.match("#Month #Value to #Value #Cardinal").lastTerm(),s(c,"month-range-year"),c=t.match("(in|of|by|during|before|starting|ending|for|year) #Cardinal").lastTerm(),s(c,"in-year"),c=t.match("(q1|q2|q3|q4) [#Cardinal]"),s(c,"in-year"),c=t.match("#Ordinal quarter [#Cardinal]"),s(c,"in-year"),c=t.match("the year [#Cardinal]"),s(c,"in-year"),c=t.match("it (is|was) [#Cardinal]"),u(c,"in-year"),c=t.match("#Cardinal !#Plural").firstTerm(),u(c,"year-unsafe")}if(t.has("#Date")){t.has("#Time")&&(t.match("#Cardinal #Time").not("#Year").tag("Time","value-time"),t.match("(by|before|after|at|@|about) #Time").tag("Time","preposition-time"),t.match("#Time (eastern|pacific|central|mountain)").term(1).tag("Time","timezone"),t.match("#Time (est|pst|gmt)").term(1).tag("Time","timezone abbr"));var h=t.match("#Date+").splitOn("Clause");!1===h.has("(#Year|#Time)")&&h.match("#Value (#Month|#Weekday) #Value").lastTerm().unTag("Date")}return t}},{}],110:[function(t,e,r){"use strict";var n={do:!0,"don't":!0,does:!0,"doesn't":!0,will:!0,wont:!0,"won't":!0,have:!0,"haven't":!0,had:!0,"hadn't":!0,not:!0};e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e];if(n[r.normal]||n[r.silent_term]){var a=t.terms[e+1];if(a&&(a.tags.Verb||a.tags.Adverb||a.tags.Negative)){r.tag("Auxiliary","corrections-Auxiliary");continue}}}return t}},{}],111:[function(t,e,r){"use strict";e.exports=function(t){for(var e=0;e<t.length;e++){var r=t.get(e);if("not"===r.normal||"not"===r.silent_term)for(var n=e+1;n<t.length;n++){if(t.get(n).tags.Verb){r.tag("VerbPhrase","negate-verb");break}if(t.get(n).tags.Adjective){r.tag("AdjectivePhrase","negate-adj");break}}}return t}},{}],112:[function(t,e,r){"use strict";var n=function(t,e){var r,n=e,a=(r=t.terms[e]).tags.Adjective?"Adjective":r.tags.Noun?"Noun":r.tags.Verb?"Verb":r.tags.Value?"Value":null,i=0,o=0,s=!1;for(e+=1;e<t.terms.length;e++){var u=t.terms[e];if(0<o&&u.tags.Conjunction)s=!0;else{if(u.tags[a]){if(u.tags.Comma){o+=1,i=0;continue}if(0<o&&s)return t.slice(n,e).tag("List"),!0}if(5<(i+=1))return!1;if("Value"===a)return!0}}return!1};e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e],a=r.getPunctuation();","!==a?";"!==a&&":"!==a?r.whitespace.after.match(/^\.\./)?r.tag("ClauseEnd","clause-elipses"):t.terms[e+1]&&t.terms[e+1].whitespace.before.match(/ - /)&&r.tag("ClauseEnd","hypen-clause"):r.tag("ClauseEnd","clause-punt"):r.tag("Comma","comma-step")}for(var i=0;i<t.terms.length;i++){var o=t.terms[i];if(o.tags.Comma){if(o.tags.List)continue;if(u=i,l=(s=t).terms[u],(c=s.terms[u+1])&&l.tags.Place&&!l.tags.Country&&c.tags.Country)continue;n(t,i)||o.tag("ClauseEnd","phrasal-comma")}}var s,u,l,c;return t}},{}],113:[function(t,e,r){"use strict";var n={'"':{close:'"',tag:"StraightDoubleQuotes"},"":{close:"",tag:"StraightDoubleQuotesWide"},"'":{close:"'",tag:"StraightSingleQuotes"},"":{close:"",tag:"CommaDoubleQuotes"},"":{close:"",tag:"CommaSingleQuotes"},"":{close:"",tag:"CurlyDoubleQuotesReversed"},"":{close:"",tag:"CurlySingleQuotesReversed"},"":{close:"",tag:"LowCurlyDoubleQuotes"},"":{close:"",tag:"LowCurlyDoubleQuotesReversed"},"":{close:"",tag:"LowCurlySingleQuotes"},"":{close:"",tag:"AngleDoubleQuotes"},"":{close:"",tag:"AngleSingleQuotes"},"":{close:"",tag:"PrimeSingleQuotes"},"":{close:"",tag:"PrimeDoubleQuotes"},"":{close:"",tag:"PrimeTripleQuotes"},"":{close:"",tag:"PrimeDoubleQuotes"},"`":{close:"",tag:"PrimeSingleQuotes"},"":{close:"",tag:"LowPrimeDoubleQuotesReversed"}};Object.keys(n).forEach(function(t){n[t].regex=new RegExp(n[t].close+"[;:,.]*"),n[t].open=t});var a=new RegExp("["+Object.keys(n).join("")+"]");e.exports=function(t){for(var e=t.terms.slice(0),r=0;r<e.length;r++){var i=t.terms[r];if(a.test(i.whitespace.before)){var o=i.whitespace.before.match(a).shift().split("");o=o.map(function(t){return n[t]});for(var s=0;s<t.terms.length&&e[r+s]&&!(28<s);s++){for(var u=-1,l=0;l<o.length;l+=1)if(!0===o[l].regex.test(e[r+s].whitespace.after)){u=l;break}if(-1!==u){var c=o.splice(u,1).pop();if(c.regex.test(t.terms[r+s].normal)&&t.terms[r+s].whitespace.after.replace(c.regex,""),i.tag("StartQuotation","quotation_open"),t.terms[r+s].tag("EndQuotation","quotation_close"),t.slice(r,r+s+1).tag("Quotation","quotation_step"),s-=1,!o.length)break}}}}return t}},{}],114:[function(t,e,r){"use strict";var n=["it's","that's"],a="'`",i=new RegExp("([a-z]s["+a+"])\\W*$"),o=new RegExp("["+a+"]"),s=new RegExp("[^"+a+"\\w]+$"),u={};[["'","'"],["",""],["",""],["",""],["",""],["`",""]].forEach(function(t){u[t[0]]=new RegExp(t[1]+"[^"+t[1]+"\\w]*$")}),n.map(function(t){return new RegExp(t.replace("'","["+a+"]"))});var l=function(t,e,r){var a=t.get(r),s=t.get(r+1),u=t.get(r+2),l=n.map(function(t){return e.match(t)}).find(function(t){return t}),c=o.test(a.whitespace.after),h=a.tags.Pronoun;return!(l||h||!c||!i.test(e)&&void 0!==s&&!0!==s.tags.Noun&&!0!==a.tags.ClauseEnd&&(void 0===u||!s.tags.Adjective||!u.tags.Noun))};e.exports=function(t){for(var e=[],r=0;r<t.length;r++){var n=t.get(r),a=n.text;void 0!==u[a[0]]&&(e[e.length]=u[a[0]],a=a.slice(1)),a=a.replace(s,"");for(var i=-1,o=0;o<e.length;o+=1)if(!0===e[o].test(a)){i=o;break}-1!==i&&(a=a.replace(e[i],""),delete e[i]),a=a.replace(s,""),l(t,a,r)&&(n.tags.Noun||n.tag("Noun","possessive_pass"),n.tag("Possessive","possessive_pass"),!0===n.tags.Contraction&&(n.unTag("Contraction"),t.terms.splice(r+1,1),n.silent_term=""))}return t}},{}],115:[function(t,e,r){"use strict";e.exports=function(t){return t.terms.forEach(function(t){t.isAcronym()&&t.tag("Acronym","acronym-step")}),t}},{}],116:[function(t,e,r){"use strict";e.exports=function(t){t.match("(mr|mrs|ms|dr) (#TitleCase|#Possessive)+").tag("#Person","mr-putin");var e="(rose|robin|dawn|ray|holly|bill|joy|viola|penny|sky|violet|daisy|melody|kelvin|hope|mercedes|olive|jewel|faith|van|charity|miles|lily|summer|dolly|rod|dick|cliff|lane|reed|kitty|art|jean|trinity)";t.has(e)&&(t.match("(#Determiner|#Adverb|#Pronoun|#Possessive) ["+e+"]").tag("Noun","the-ray"),t.match(e+" (#Person|#Acronym|#TitleCase)").canBe("#Person").tag("Person","ray-smith"));var r="(pat|wade|ollie|will|rob|buck|bob|mark|jack)";t.has(r)&&(t.match("(#Modal|#Adverb) ["+r+"]").tag("Verb","would-mark"),t.match(r+" (#Person|#TitleCase)").tag("Person","rob-smith"));var n="(misty|rusty|dusty|rich|randy)";t.has(n)&&(t.match("#Adverb ["+n+"]").tag("Adjective","really-rich"),t.match(n+" (#Person|#TitleCase)").tag("Person","randy-smith"));var a="(april|june|may|jan|august|eve)";t.has(a)&&(t.match(String(a)+" (#Person|#TitleCase)").canBe("#Person").tag("Person","june-smith"),t.match("(in|during|on|by|before|#Date) ["+a+"]").canBe("#Date").tag("Date","in-june"),t.match(a+" (#Date|#Value)").canBe("#Date").tag("Date","june-5th"));var i="(paris|alexandria|houston|kobe|salvador|sydney)";return t.has(i)&&(t.match("(in|near|at|from|to|#Place) ["+i+"]").canBe("#Place").tag("Place","in-paris"),t.match("["+i+"] #Place").canBe("#Place").tag("Place","paris-france"),t.match("["+i+"] #Person").canBe("#Person").tag("Person","paris-hilton")),t.match("al")&&(t.match("al (#Person|#TitleCase)").canBe("#Person").tag("#Person","al-borlen"),t.match("#TitleCase al #TitleCase").canBe("#Person").tag("#Person","arabic-al-arabic")),t.match("(private|general|major|corporal|lord|lady|secretary|premier) #Honorific? #Person").terms(0).tag("Honorific","ambg-honorifics"),t.match("(1st|2nd|first|second) #Honorific").terms(0).tag("Honorific","ordinal-honorific"),t.has("#FirstName")&&(t.match("#FirstName #Noun").ifNo("^#Possessive").ifNo("#ClauseEnd .").lastTerm().canBe("#LastName").tag("#LastName","firstname-noun"),t.match("#FirstName de #Noun").canBe("#Person").tag("#Person","firstname-de-noun"),t.match("#FirstName (bin|al) #Noun").canBe("#Person").tag("#Person","firstname-al-noun"),t.match("#FirstName #Acronym #TitleCase").tag("Person","firstname-acronym-titlecase"),t.match("#FirstName #FirstName #TitleCase").tag("Person","firstname-firstname-titlecase"),t.match("#Honorific #FirstName? #TitleCase").tag("Person","Honorific-TitleCase"),t.match("#FirstName #TitleCase #TitleCase?").match("#Noun+").tag("Person","firstname-titlecase"),t.match("#FirstName the #Adjective").tag("Person","correction-determiner5"),t.match("#FirstName (green|white|brown|hall|young|king|hill|cook|gray|price)").tag("#Person","firstname-maybe"),t.match("#FirstName #Acronym #Noun").ifNo("#Date").tag("#Person","n-acro-noun").lastTerm().tag("#LastName","n-acro-noun"),t.match("#FirstName [#Determiner? #Noun] #LastName").tag("#NickName","first-noun-last").tag("#Person","first-noun-last"),t.match("#FirstName (#Singular|#Possessive)").ifNo("#Date").ifNo("#NickName").tag("#Person","first-possessive").lastTerm().tag("#LastName","first-possessive")),t.has("#LastName")&&(t.match("#Noun #LastName").firstTerm().canBe("#FirstName").tag("#FirstName","noun-lastname"),t.match("(will|may|april|june|said|rob|wade|ray|rusty|drew|miles|jack|chuck|randy|jan|pat|cliff|bill) #LastName").firstTerm().tag("#FirstName","maybe-lastname"),t.match("#TitleCase #Acronym? #LastName").ifNo("#Date").tag("#Person","title-acro-noun").lastTerm().tag("#LastName","title-acro-noun"),t.match("#Copula (#Noun|#PresentTense) #LastName").term(1).tag("#FirstName","copula-noun-lastname")),t.has("#TitleCase")&&(t.match("#Acronym #TitleCase").canBe("#Person").tag("#Person","acronym-titlecase"),t.match("#TitleCase (van|al|bin) #TitleCase").canBe("#Person").tag("Person","correction-titlecase-van-titlecase"),t.match("#TitleCase (de|du) la? #TitleCase").canBe("#Person").tag("Person","correction-titlecase-van-titlecase"),t.match("#Person #TitleCase").match("#TitleCase #Noun").canBe("#Person").tag("Person","correction-person-titlecase"),t.match("(lady|queen|sister) #TitleCase").ifNo("#Date").ifNo("#Honorific").tag("#FemaleName","lady-titlecase"),t.match("(king|pope|father) #TitleCase").ifNo("#Date").tag("#MaleName","correction-poe")),t.match("#Noun van der? #Noun").canBe("#Person").tag("#Person","von der noun"),t.match("(king|queen|prince|saint|lady) of? #Noun").canBe("#Person").tag("#Person","king-of-noun"),t.match("#Honorific #Acronym").tag("Person","Honorific-TitleCase"),t.match("#Person #Person the? #RomanNumeral").tag("Person","correction-roman-numeral"),t.match("#Honorific #Person").tag("Person","Honorific-Person"),t.match("^#Honorific$").unTag("Person","single-honorific"),t}},{}],117:[function(t,e,r){"use strict";var n=t("../../world/more-data/orgWords"),a=function(t){return!(!t.tags.Noun||t.tags.Pronoun||t.tags.Comma||t.tags.Possessive||t.tags.Place||!(t.tags.TitleCase||t.tags.Organization||t.tags.Acronym))};e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e];if(!0===n.hasOwnProperty(r.root)){var i=t.terms[e-1];if(i&&a(i)){i.tag("Organization","org-word-1"),r.tag("Organization","org-word-2");continue}var o=t.terms[e+1];if(o&&"of"===o.normal&&t.terms[e+2]&&a(t.terms[e+2])){r.tag("Organization","org-of-word-1"),o.tag("Organization","org-of-word-2"),t.terms[e+2].tag("Organization","org-of-word-3");continue}}}return t.has("#Acronym")&&(t.match("the #Acronym").not("(iou|fomo|yolo|diy|dui|nimby)").lastTerm().tag("Organization","the-acronym"),t.match("#Acronym").match("#Possessive").tag("Organization","possessive-acronym")),t}},{"../../world/more-data/orgWords":221}],118:[function(t,e,r){"use strict";e.exports=function(t){return t.terms.forEach(function(e,r){if(e.tags.StartBracket)for(var n=r;n<t.terms.length;n+=1)if(!0===t.terms[n].tags.EndBracket){t.slice(r,n+1).tag("Parentheses");break}}),t}},{}],119:[function(t,e,r){"use strict";var n=t("../../subset/nouns/isPlural");e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e];if(r.tags.Noun){if(r.tags.Singular||r.tags.Plural)continue;var a=n(r,r.world);!0===a?r.tag("Plural","pluralStep"):!1===a&&r.tag("Singular","pluralStep")}}return t}},{"../../subset/nouns/isPlural":39}],120:[function(t,e,r){"use strict";var n=/^\$?[0-9,](\.[0-9])?/,a=/[0-9](st|nd|rd|th)$/;e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e];!0===r.tags.Value&&void 0===r.tags.Ordinal&&void 0===r.tags.Cardinal&&(!0===n.test(r.normal)?(r.tag("Cardinal","cardinal-val-regex"),r.tag("NumericValue","NumericValue-regex")):!0===a.test(r.normal)&&(r.tag("Ordinal","ordinal-value-regex"),r.tag("NumericValue","NumericValue-regex")))}return t.match("#Cardinal #Plural").lastTerm().tag("Unit","cardinal-plural"),t.match("#Ordinal #Singular").lastTerm().tag("Unit","ordinal-singular"),t}},{}],121:[function(t,e,r){"use strict";e.exports=function(t){if(t.has("so")&&(t.match("so #Adjective").match("so").tag("Adverb","so-adv"),t.match("so #Noun").match("so").tag("Conjunction","so-conj"),t.match("do so").match("so").tag("Noun","so-noun")),t.has("all")&&(t.match("[all] #Determiner? #Noun").tag("Adjective","all-noun"),t.match("[all] #Verb").tag("Adverb","all-verb")),t.has("(that|which)")&&(t.match("#Verb #Adverb? #Noun (that|which)").lastTerm().tag("Preposition","that-prep"),t.match("that #Noun #Verb").firstTerm().tag("Determiner","that-determiner"),t.match("#Comma [which] (#Pronoun|#Verb)").tag("Preposition","which-copula")),t.has("#Determiner")&&(t.match("(the|this) [#Verb] #Preposition .").tag("Noun","correction-determiner1"),t.match("(the|those|these) (#Infinitive|#PresentTense|#PastTense)").term(1).tag("Noun","correction-determiner2"),t.match("(a|an) [#Gerund]").tag("Adjective","correction-a|an"),t.match("(a|an) #Adjective (#Infinitive|#PresentTense)").term(2).tag("Noun","correction-a|an2"),t.match("(some [#Verb] #Plural").tag("Noun","correction-determiner6"),t.match("#Determiner #Adjective$").not("(#Comparative|#Superlative)").term(1).tag("Noun","the-adj-1"),t.match("#Determiner [#Adjective] (#Copula|#PastTense|#Auxiliary)").tag("Noun","the-adj-2"),t.match("(the|this|those|these) #Adjective [#Verb]").tag("Noun","the-adj-verb"),t.match("(the|this|those|these) #Adverb #Adjective [#Verb]").tag("Noun","correction-determiner4"),t.match("(the|this|a|an) [#Infinitive] #Adverb? #Verb").tag("Noun","correction-determiner5"),t.match("#Determiner [#Verb] of").tag("Noun","the-verb-of"),t.match("#Determiner #Noun of [#Verb]").tag("Noun","noun-of-noun"),t.match("#Determiner #Adverb? [close]").tag("Adjective","a-close"),t.match("#Verb (a|an) [#Value]").tag("Singular","a-value"),t.match("(a|an) #Noun [#Infinitive]").tag("Noun","a-noun-inf")),t.has("like")&&(t.match("just [like]").tag("Preposition","like-preposition"),t.match("#Noun [like] #Noun").tag("Preposition","noun-like"),t.match("#Verb [like]").tag("Adverb","verb-like"),t.match("#Adverb like").not("(really|generally|typically|usually|sometimes|often) like").lastTerm().tag("Adverb","adverb-like")),t.has("#Value")&&(t.match("half a? #Value").tag("Value","half-a-value"),t.match("#Value and a (half|quarter)").tag("Value","value-and-a-half"),t.match("#Value+ #Currency").tag("Money","value-currency").lastTerm().tag("Unit","money-unit"),t.match("#Money and #Money #Currency?").tag("Money","money-and-money"),t.match("1 #Value #PhoneNumber").tag("PhoneNumber","1-800-Value"),t.match("#NumericValue #PhoneNumber").tag("PhoneNumber","(800) PhoneNumber"),t.match("#TextValue+").match("#Cardinal+ #Ordinal").tag("Ordinal","two-hundredth")),t.has("#Noun")&&(t.match("more #Noun").tag("Noun","more-noun"),t.match("[second] #Noun").not("#Honorific").unTag("Unit").tag("Ordinal","second-noun"),t.match("#Noun #Adverb [#Noun]").tag("Verb","correction"),t.match("#Noun [#Particle]").tag("Preposition","repair-noPhrasal"),t.match("#Noun (&|n) #Noun").tag("Organization","Noun-&-Noun"),t.match("#Noun #Actor").tag("Actor","thing-doer"),t.match("(this|that) [#Plural]").tag("PresentTense","this-verbs"),t.match("#Determiner #Infinitive$").lastTerm().tag("Noun","a-inf"),t.match("#Determiner [(western|eastern|northern|southern|central)] #Noun").tag("Noun","western-line"),t.match("(#Determiner|#Value) [(linear|binary|mobile|lexical|technical|computer|scientific|formal)] #Noun").tag("Noun","technical-noun"),t.has("#Organization")&&(t.match("#Organization of the? #TitleCase").tag("Organization","org-of-place"),t.match("#Organization #Country").tag("Organization","org-country"),t.match("(world|global|international|national|#Demonym) #Organization").tag("Organization","global-org")),t.has("#Possessive")&&(t.match("#Possessive [#FirstName]").unTag("Person","possessive-name"),t.match("#FirstName #Acronym? #Possessive").notIf("#Comma").match("#FirstName #Acronym? #LastName").tag("Possessive"),t.match("#Organization+ #Possessive").notIf("#Comma").tag("Possessive"),t.match("#Place+ #Possessive").notIf("#Comma").tag("Possessive"))),t.has("#Verb")){if(t.match("[still] #Verb").tag("Adverb","still-verb"),t.match("[u] #Verb").tag("Pronoun","u-pronoun-1"),t.match("is no [#Verb]").tag("Noun","is-no-verb"),t.match("[#Verb] than").tag("Noun","correction"),t.match("#Possessive [#Verb]").tag("Noun","correction-possessive"),t.match("there (are|were) #Adjective? [#PresentTense]").tag("Plural","there-are"),t.has("(who|what|where|why|how|when)")){t.match("^how").tag("QuestionWord","how-question").tag("QuestionWord","how-question"),t.match("how (#Determiner|#Copula|#Modal|#PastTense)").term(0).tag("QuestionWord","how-is"),t.match("^which").tag("QuestionWord","which-question").tag("QuestionWord","which-question"),t.match("which . (#Noun)+ #Pronoun").term(0).tag("QuestionWord","which-question2"),t.match("which").tag("QuestionWord","which-question3");var e=t.match("#QuestionWord #Noun #Copula #Adverb? (#Verb|#Adjective)").firstTerm();e.unTag("QuestionWord").tag("Conjunction","how-he-is-x"),(e=t.match("#QuestionWord #Noun #Adverb? #Infinitive not? #Gerund").firstTerm()).unTag("QuestionWord").tag("Conjunction","when i go fishing")}t.has("#Copula")&&(t.match("#Copula #Adjective to #Verb").match("#Adjective to").tag("Verb","correction"),t.match("#Copula [#Infinitive] #Noun").tag("Noun","is-pres-noun"),t.match("[#Infinitive] #Copula").tag("Noun","infinitive-copula"),t.match("#Copula (pretty|dead|full|well) (#Adjective|#Noun)").notIf("#Comma").tag("#Copula #Adverb #Adjective","sometimes-adverb"),t.match("#Copula [(just|alone)$]").tag("Adjective","not-adverb"));var r="(#Adverb|not)+?";t.has(r)&&(t.match("(has|had) ".concat(r," #PastTense")).not("#Verb$").tag("Auxiliary","had-walked"),t.match("#Copula ".concat(r," #Gerund")).not("#Verb$").tag("Auxiliary","copula-walking"),t.match("(be|been) ".concat(r," #Gerund")).not("#Verb$").tag("Auxiliary","be-walking"),t.match("(#Modal|did) ".concat(r," #Verb")).not("#Verb$").tag("Auxiliary","modal-verb"),t.match("#Modal ".concat(r," have ").concat(r," had ").concat(r," #Verb")).not("#Verb$").tag("Auxiliary","would-have"),t.match("(#Modal) ".concat(r," be ").concat(r," #Verb")).not("#Verb$").tag("Auxiliary","would-be"),t.match("(#Modal|had|has) ".concat(r," been ").concat(r," #Verb")).not("#Verb$").tag("Auxiliary","would-be")),t.match("#PhrasalVerb #PhrasalVerb").lastTerm().tag("Particle","phrasal-particle"),t.has("#Gerund")&&(t.match("#Gerund #Adverb? not? #Copula").firstTerm().tag("Activity","gerund-copula"),t.match("#Gerund #Modal").firstTerm().tag("Activity","gerund-modal"),t.match("#Gerund #Determiner [#Infinitive]").tag("Noun","running-a-show")),t.has("will #Adverb? not? #Adverb? be")&&!1===t.has("will #Adverb? not? #Adverb? be #Gerund")&&(t.match("will not? be").tag("Copula","will-be-copula"),t.match("will #Adverb? not? #Adverb? be #Adjective").match("be").tag("Copula","be-copula"))}if(t.has("#Adjective")&&(t.match("still #Adjective").match("still").tag("Adverb","still-advb"),t.match("#Adjective [#PresentTense]").tag("Noun","adj-presentTense"),t.match("will [#Adjective]").tag("Verb","will-adj"),t.match("#PresentTense (hard|quick|long|bright|slow)").lastTerm().tag("Adverb","lazy-ly"),t.match("(his|her|its) [#Adjective]").tag("Noun","his-fine"),t.match("#Noun #Adverb? [left]").tag("PastTense","left-verb")),t.has("#TitleCase")&&(t.match("#TitleCase (ltd|co|inc|dept|assn|bros)").tag("Organization","org-abbrv"),t.match("#TitleCase+ (district|region|province|county|prefecture|municipality|territory|burough|reservation)").tag("Region","foo-district"),t.match("(district|region|province|municipality|territory|burough|state) of #TitleCase").tag("Region","district-of-Foo")),t.has("#Hyphenated")){t.match("#Hyphenated #Hyphenated").match("#Noun #Verb").tag("Noun","hyphen-verb");var n=t.match("#Hyphenated+");n.has("#Expression")&&n.tag("Expression","ooh-wee")}return t.has("#Place")&&(t.match("(west|north|south|east|western|northern|southern|eastern)+ #Place").tag("Region","west-norfolk"),t.match("#City [#Acronym]").match("(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|or|pa|sc|tn|tx|ut|vt|pr)").tag("Region","us-state")),t.match("(foot|feet)").tag("Noun","foot-noun"),t.match("#Value (foot|feet)").term(1).tag("Unit","foot-unit"),t.match("#Conjunction [u]").tag("Pronoun","u-pronoun-2"),t.match("(a|an) (#Duration|hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)").ifNo("#Plural").term(0).tag("Value","a-is-one"),t.match("holy (shit|fuck|hell)").tag("Expression","swears-expression"),t.match("#Determiner (shit|damn|hell)").term(1).tag("Noun","swears-noun"),t.match("(shit|damn|fuck) (#Determiner|#Possessive|them)").term(0).tag("Verb","swears-verb"),t.match("#Copula fucked up?").not("#Copula").tag("Adjective","swears-adjective"),t.match("#Holiday (day|eve)").tag("Holiday","holiday-day"),t.match("(standard|daylight|summer|eastern|pacific|central|mountain) standard? time").tag("Time","timezone"),t.match("#Demonym #Currency").tag("Currency","demonym-currency"),t.match("about to #Adverb? #Verb").match("about to").tag(["Auxiliary","Verb"],"about-to"),t.match("#Honorific #Person").tag("Person","honorific-person"),t.match("#Person (jr|sr|md)").tag("Person","person-honorific"),t.match("(right|rights) of .").tag("Noun","right-of"),t}},{}],122:[function(t,e,r){"use strict";e.exports=function(t){return!0===t.has("#Person")&&(t.match("#FirstName #Person+").tag("ProperNoun"),t.match("#Person+ #LastName").tag("ProperNoun")),!0===t.has("#Place")&&t.match("(#City|#Region|#Country)").tag("ProperNoun"),t.match("#Organization").tag("ProperNoun"),t.match("#Month").tag("ProperNoun"),t}},{}],123:[function(t,e,r){"use strict";e.exports=function(t){var e=t.world.patterns;return Object.keys(e).forEach(function(r){t.match(r).tag(e[r],"post-hoc: "+r)}),t}},{}],124:[function(t,e,r){"use strict";var n=t("./fix"),a={wanna:["want","to"],gonna:["going","to"],im:["i","am"],alot:["a","lot"],dont:["do","not"],dun:["do","not"],ive:["i","have"],"won't":["will","not"],wont:["will","not"],"can't":["can","not"],cant:["can","not"],cannot:["can","not"],"shan't":["should","not"],imma:["I","will"],"where'd":["where","did"],whered:["where","did"],"when'd":["when","did"],whend:["when","did"],"how'd":["how","did"],howd:["how","did"],"what'd":["what","did"],whatd:["what","did"],"let's":["let","us"],dunno:["do","not","know"],brb:["be","right","back"],gtg:["got","to","go"],irl:["in","real","life"],tbh:["to","be","honest"],imo:["in","my","opinion"],til:["today","i","learned"],rn:["right","now"],twas:["it","was"],"@":["at"]};e.exports=function(t){for(var e=0;e<t.terms.length;e++){var r=t.terms[e];if(a[r.normal]){var i=a[r.normal];t=n(t,i,e),e+=i.length-1}}return t}},{"./fix":128}],125:[function(t,e,r){"use strict";var n=t("./fix"),a=t("./split"),i={"that's":!0,"there's":!0},o={we:!0,they:!0,you:!0},s=function(t,e){var r=["is","not"];if(t.terms[e-1]){var n=t.terms[e-1];n.tags.Adverb&&t.terms[e-2]&&(n=t.terms[e-2]),(n.tags.Plural||!0===o[n.normal])&&(r[0]="are")}return r};e.exports=function(t){for(var e=0;e<t.terms.length;e++)if(!t.terms[e].silent_term)if("ain't"!==t.terms[e].normal&&"aint"!==t.terms[e].normal){var r=a(t.terms[e]);if(r&&"s"===r.end){if(h=e,f=(c=t).terms[h],m=c.terms[h+1],!f.tags.Pronoun&&!f.tags.QuestionWord&&!i[f.normal]&&(!m||m.tags.Infinitive||!m.tags.VerbPhrase&&(m.tags.Noun||m.tags.Adjective&&c.terms[h+2]&&c.terms[h+2].tags.Noun||(m.tags.Adjective||m.tags.Adverb||m.tags.Verb,0)))){t.terms[e].tag("#Possessive","hard-contraction");continue}var o=[r.start,"is"];if(t.terms[e+1]){var u=t.terms[e].normal;t.match(u+" (#Negative|#Adverb|#Auxiliary)+? #Gerund").found?o=[r.start,"is"]:t.match(u+" (#Negative|#Adverb|#Auxiliary)+? #Verb").found&&(o=[r.start,"has"])}t=n(t,o,e),e+=1}}else{var l=s(t,e);t=n(t,l,e),e+=1}var c,h,f,m;return t}},{"./fix":128,"./split":129}],126:[function(t,e,r){"use strict";var n=t("./fix"),a=t("./split"),i={ll:"will",ve:"have",re:"are",m:"am","n't":"not"};e.exports=function(t){for(var e=0;e<t.terms.length;e++)if(!t.terms[e].silent_term){var r=a(t.terms[e]);if(r){if(r.start=r.start.toLowerCase(),i[r.end]){var o=[r.start,i[r.end]];t=n(t,o,e),e+=1}if("d"===r.end){var s=[r.start,"would"];t.terms[e+1]&&t.terms[e+1].tags.PastTense&&(s[1]="had"),t.terms[e+2]&&t.terms[e+2].tags.PastTense&&t.terms[e+1].tags.Adverb&&(s[1]="had"),t=n(t,s,e),e+=1}}}return t}},{"./fix":128,"./split":129}],127:[function(t,e,r){"use strict";var n=t("./fix"),a=t("../../../term"),i=function(t){var e=/(-||)/;return e.test(t.whitespace.before)||e.test(t.whitespace.after)};e.exports=function(t){t.match("#Hyphenated #Hyphenated").match("#NumericValue #NumericValue").tag("NumberRange");for(var e=0;e<t.terms.length;e++){var r=t.terms[e];if(!r.silent_term&&!r.tags.TextValue){if(r.tags.Value&&t.terms[e+1]&&0<e&&(i(r)||i(t.terms[e-1]))&&t.terms[e-1].tags.Value){var o=new a("",t.world);return o.silent_term="to",t.insertAt(e,o),t.terms[e-1].tag("NumberRange","number-number1"),t.terms[e].tag("NumberRange","number-number2"),t.terms[e].whitespace.before="",t.terms[e].whitespace.after="",t.terms[e+1].tag("NumberRange","number-number3"),t}if(r.tags.NumberRange){var s=r.text.split(/(-||)/);s[1]="to",(t=n(t,s,e)).terms[e].tag(["NumberRange","NumericValue"],"numRange-1"),t.terms[e+1].tag(["NumberRange","Preposition"],"numRange-silent"),t.terms[e+2].tag(["NumberRange","NumericValue"],"numRange-3"),e+=2}}}return t}},{"../../../term":143,"./fix":128}],128:[function(t,e,r){"use strict";var n=t("../../../term"),a={not:"Negative",will:"Verb",would:"Modal",have:"Verb",are:"Copula",is:"Copula",am:"Verb"},i=function(t){a[t.silent_term]&&t.tag(a[t.silent_term])};e.exports=function(t,e,r){var a=t.terms[r];if(a.silent_term=e[0],a.tag("Contraction","tagger-contraction"),e[1]){var o=new n("",t.world);o.silent_term=e[1],o.tag("Contraction","tagger-contraction"),t.insertAt(r+1,o),o.whitespace.before="",o.whitespace.after="",i(o)}if(e[2]){var s=new n("",t.world);s.silent_term=e[2],t.insertAt(r+2,s),s.tag("Contraction","tagger-contraction"),i(s)}return t}},{"../../../term":143}],129:[function(t,e,r){"use strict";var n=/^([a-z]+)'([a-z][a-z]?)$/i,a=/[a-z]s'$/i,i={re:1,ve:1,ll:1,t:1,s:1,d:1,m:1};e.exports=function(t){if("can't"===t.normal)return{start:"can",end:"n't"};var e=t.normal.match(n);return e&&e[1]&&1===i[e[2]]?("t"===e[2]&&e[1].match(/[a-z]n$/)&&(e[1]=e[1].replace(/n$/,""),e[2]="n't"),!0===t.tags.TitleCase&&(e[1]=e[1].replace(/^[a-z]/,function(t){return t.toUpperCase()})),{start:e[1],end:e[2]}):!0===a.test(t.text)?{start:t.normal.replace(/s'?$/,""),end:""}:null}},{}],130:[function(t,e,r){"use strict"
;e.exports=/(?:0\u20E3\n1\u20E3|2\u20E3|3\u20E3|4\u20E3|5\u20E3|6\u20E3|7\u20E3|8\u20E3|9\u20E3|#\u20E3|\*\u20E3|\uD83C(?:\uDDE6\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF2|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFD|\uDDFF)|\uDDE7\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFC|\uDDFE|\uDDFF)|\uDDE8\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDE9\uD83C(?:\uDDEA|\uDDEC|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDFF)|\uDDEA\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDED|\uDDF7|\uDDF8|\uDDF9|\uDDFA)|\uDDEB\uD83C(?:\uDDEE|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDF7)|\uDDEC\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF1|\uDDF2|\uDDF3|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFE)|\uDDED\uD83C(?:\uDDF0|\uDDF2|\uDDF3|\uDDF7|\uDDF9|\uDDFA)|\uDDEE\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9)|\uDDEF\uD83C(?:\uDDEA|\uDDF2|\uDDF4|\uDDF5)|\uDDF0\uD83C(?:\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDF2|\uDDF3|\uDDF5|\uDDF7|\uDDFC|\uDDFE|\uDDFF)|\uDDF1\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDEE|\uDDF0|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFE)|\uDDF2\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDF3\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFF)|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C(?:\uDDE6|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF7|\uDDF8|\uDDF9|\uDDFC|\uDDFE)|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C(?:\uDDEA|\uDDF4|\uDDF8|\uDDFA|\uDDFC)|\uDDF8\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDE9|\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFD|\uDDFE|\uDDFF)|\uDDF9\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF9|\uDDFB|\uDDFC|\uDDFF)|\uDDFA\uD83C(?:\uDDE6|\uDDEC|\uDDF2|\uDDF8|\uDDFE|\uDDFF)|\uDDFB\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDEE|\uDDF3|\uDDFA)|\uDDFC\uD83C(?:\uDDEB|\uDDF8)|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C(?:\uDDEA|\uDDF9)|\uDDFF\uD83C(?:\uDDE6|\uDDF2|\uDDFC)))|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2694\u2696\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD79\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED0\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3]|\uD83E[\uDD10-\uDD18\uDD80-\uDD84\uDDC0]/g},{}],131:[function(t,e,r){"use strict";e.exports={":(":!0,":)":!0,":P":!0,":p":!0,":O":!0,":3":!0,":|":!0,":/":!0,":\\":!0,":$":!0,":*":!0,":@":!0,":-(":!0,":-)":!0,":-P":!0,":-p":!0,":-O":!0,":-3":!0,":-|":!0,":-/":!0,":-\\":!0,":-$":!0,":-*":!0,":-@":!0,":^(":!0,":^)":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0,":^|":!0,":^/":!0,":^\\":!0,":^$":!0,":^*":!0,":^@":!0,"):":!0,"(:":!0,"$:":!0,"*:":!0,")-:":!0,"(-:":!0,"$-:":!0,"*-:":!0,")^:":!0,"(^:":!0,"$^:":!0,"*^:":!0,"<3":!0,"</3":!0,"<\\3":!0}},{}],132:[function(t,e,r){"use strict";e.exports={beforeThisWord:{there:"Verb",me:"Verb",man:"Adjective",only:"Verb",him:"Verb",were:"Noun",took:"Noun",himself:"Verb",went:"Noun",who:"Noun",jr:"Person"},afterThisWord:{i:"Verb",first:"Noun",it:"Verb",there:"Verb",not:"Verb",because:"Noun",if:"Noun",but:"Noun",who:"Verb",this:"Noun",his:"Noun",when:"Noun",you:"Verb",very:"Adjective",old:"Noun",never:"Verb",before:"Noun"},beforeThisPos:{Copula:"Noun",PastTense:"Noun",Conjunction:"Noun",Modal:"Noun",PluperfectTense:"Noun",PerfectTense:"Verb"},afterThisPos:{Adjective:"Noun",Possessive:"Noun",Determiner:"Noun",Adverb:"Verb",Pronoun:"Verb",Value:"Noun",Ordinal:"Noun",Modal:"Verb",Superlative:"Noun",Demonym:"Noun",Honorific:"Person"}}},{}],133:[function(t,e,r){"use strict";var n="Adjective",a="Infinitive",i="Singular",o="PastTense",s="Expression",u="LastName";e.exports={a:[[/.[aeiou]na$/,"Noun"],[/.[oau][wvl]ska$/,u],[/.[^aeiou]ica$/,i],[/^([hyj]a)+$/,s]],c:[[/.[^aeiou]ic$/,n]],d:[[/.[ia]sed$/,n],[/.[gt]led$/,n],[/.[aeiou][td]ed$/,o],[/.[^aeiou]led$/,o],[/[^aeiou]ard$/,i],[/[aeiou][^aeiou]id$/,n],[/[aeiou]c?ked$/,o],[/[^aeiou][aeiou][tvx]ed$/,o],[/.[vrl]id$/,n]],e:[[/.[lnr]ize$/,a],[/.[^aeiou]ise$/,a],[/.[aeiou]te$/,a],[/.[^aeiou][ai]ble$/,n],[/.[^aeiou]eable$/,n],[/.[^aeiou]ive$/,n]],h:[[/.[^aeiouf]ish$/,n],[/.v[iy]ch$/,u],[/^ug?h+$/,s],[/^uh[ -]?oh$/,s]],i:[[/.[oau][wvl]ski$/,u]],k:[[/^(k)+$/,s]],l:[[/.[gl]ial$/,n],[/.[^aeiou]ful$/,n],[/.[nrtumcd]al$/,n],[/.[^aeiou][ei]al$/,n]],m:[[/.[^aeiou]ium$/,i],[/[^aeiou]ism$/,i],[/^h*u*m+$/,s],[/^\d+ ?[ap]m$/,"Date"]],n:[[/.[lsrnpb]ian$/,n],[/[^aeiou]ician$/,"Actor"],[/okin$/,"Gerund"]],o:[[/^no+$/,s],[/^(yo)+$/,s],[/^woo+[pt]?$/,s]],r:[[/.[ilk]er$/,"Comparative"],[/[aeiou][pns]er$/,i],[/[^i]fer$/,a],[/.[^aeiou][ao]pher$/,"Actor"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,n],[/[aeiou].*ist$/,n],[/^[a-z]et$/,"Verb"]],s:[[/.[rln]ates$/,"PresentTense"],[/.[^z]ens$/,"Verb"],[/.[lstrn]us$/,i],[/[aeiou][^aeiou]is$/,i],[/[a-z]\'s$/,"Noun"],[/^yes+$/,s]],v:[[/.[^aeiou][ai][kln]ov$/,u]],y:[[/.[cts]hy$/,n],[/.[st]ty$/,n],[/.[gk]y$/,n],[/.[tnl]ary$/,n],[/.[oe]ry$/,i],[/[rdntkbhs]ly$/,"Adverb"],[/...lly$/,"Adverb"],[/[bszmp]{2}y$/,n],[/.(gg|bb|zz)ly$/,n],[/.[aeiou]my$/,n],[/[ea]{2}zy$/,n],[/.[^aeiou]ity$/,i]]}},{}],134:[function(t,e,r){"use strict";var n="Adjective",a="Infinitive",i="PresentTense",o="Singular",s="PastTense",u="Adverb",l="Plural",c="Actor",h="Verb",f="LastName";e.exports=[null,null,{ea:o,ia:"Noun",ic:n,ly:u,"'n":h,"'t":h},{que:n,lar:n,ike:n,ffy:n,nny:n,rmy:n,azy:n,oid:n,mum:n,ous:n,end:h,sis:o,rol:o,ize:a,ify:a,zes:i,nes:i,ing:"Gerund"," so":u,"'ll":"Modal","'re":"Copula"},{teen:"Value",tors:"Noun",amed:s,ched:s,ends:h,oses:i,fies:i,ects:i,nded:s,cede:a,tage:a,gate:a,vice:o,tion:o,cted:s,ette:o,some:n,llen:n,ried:n,gone:n,made:n,fore:u,less:u,ices:l,ions:l,ints:l,aped:s,lked:s,ould:"Modal",tive:c,sson:f,czyk:f,chuk:f,enko:f,akis:f,nsen:f},{fully:u,where:u,wards:u,urned:s,tized:s,eased:s,ances:l,tures:l,ports:l,ettes:l,ities:l,rough:n,bound:n,tieth:"Ordinal",ishes:i,tches:i,nssen:f,marek:f},{keeper:c,logist:c,auskas:f,teenth:"Value"},{sdottir:f,opoulos:f}]},{}],135:[function(t,e,r){"use strict";e.exports=function(t){var e=Object.keys(t);e.forEach(function(r){t[r].downward=[];for(var n=0;n<e.length;n++)t[e[n]].isA&&t[e[n]].isA===r&&t[r].downward.push(e[n])})}},{}],136:[function(t,e,r){"use strict";e.exports=[["Noun","Verb","Adjective","Adverb","Determiner","Conjunction","Preposition","QuestionWord","Expression","Url","PhoneNumber","Email","Emoji"],["Person","Organization","Value","Place","Actor","Demonym","Pronoun"],["Acronym","Pronoun","Actor","Unit","Address"],["Acronym","Plural"],["Plural","Singular"],["MaleName","FemaleName"],["FirstName","LastName","Honorific"],["Comparative","Superlative"],["Value","Verb","Adjective"],["Ordinal","Cardinal"],["TextValue","NumericValue"],["NiceNumber","TextValue"],["Ordinal","Currency"],["PastTense","PresentTense","FutureTense"],["Pluperfect","Copula","Modal","Participle","Infinitive","Gerund","FuturePerfect","PerfectTense"],["Auxiliary","Noun","Value"],["Month","WeekDay","Year","Duration","Holiday"],["Particle","Conjunction","Adverb","Preposition"],["Date","Verb","Adjective","Person"],["Date","Money","RomanNumeral","Fraction"],["Value","Determiner"],["Url","Value","HashTag","PhoneNumber","Emoji"],["RomanNumeral","Fraction","NiceNumber"],["RomanNumeral","Money"],["UpperCase","TitleCase","CamelCase"],["VerbPhrase","Noun","Adjective","Value"],["QuestionWord","VerbPhrase"],["Acronym","VerbPhrase"]]},{}],137:[function(t,e,r){"use strict";var n,a,i,o=t("./conflicts"),s=t("./tags/nouns"),u=t("./tags/verbs"),l=t("./tags/values"),c=t("./tags/dates"),h=t("./tags/misc"),f=t("./addDownward"),m={Noun:"blue",Date:"red",Value:"red",Verb:"green",Auxiliary:"green",Negative:"green",VerbPhrase:"green",Preposition:"cyan",Condition:"cyan",Conjunction:"cyan",Determiner:"cyan",Adjective:"magenta",Adverb:"cyan"},d=function(t,e){Object.keys(t).forEach(function(r){e[r]=t[r]})};e.exports=(d(s,i={}),d(u,i),d(l,i),d(c,i),d(h,i),f(i),n=i,Object.keys(n).forEach(function(t){n[t].notA={};for(var e=0;e<o.length;e++){var r=o[e];-1!==r.indexOf(t)&&(r=r.filter(function(e){return e!==t})).forEach(function(e){n[t].notA[e]=!0})}n[t].notA=Object.keys(n[t].notA)}),a=i,Object.keys(a).forEach(function(t){m[t]?a[t].color=m[t]:a[t].isA&&m[a[t].isA]?a[t].color=m[a[t].isA]:a[t].isA&&a[a[t].isA].color&&(a[t].color=a[a[t].isA].color)}),i)},{"./addDownward":135,"./conflicts":136,"./tags/dates":138,"./tags/misc":139,"./tags/nouns":140,"./tags/values":141,"./tags/verbs":142}],138:[function(t,e,r){"use strict";e.exports={Date:{},Month:{isA:"Date",also:"Singular"},WeekDay:{isA:"Date",also:"Noun"},RelativeDay:{isA:"Date"},Year:{isA:"Date"},Duration:{isA:"Date",also:"Noun"},Time:{isA:"Date",also:"Noun"},Holiday:{isA:"Date",also:"Noun"}}},{}],139:[function(t,e,r){"use strict";e.exports={Adjective:{},Comparable:{isA:"Adjective"},Comparative:{isA:"Adjective"},Superlative:{isA:"Adjective"},NumberRange:{isA:"Contraction"},Adverb:{},Currency:{},Determiner:{},Conjunction:{},Preposition:{},QuestionWord:{},RelativeProunoun:{isA:"Pronoun"},Expression:{},Abbreviation:{},Url:{},PhoneNumber:{},HashTag:{},AtMention:{is:"Noun"},Emoji:{},Email:{},Condition:{},VerbPhrase:{},Auxiliary:{},Negative:{},Contraction:{},TitleCase:{},CamelCase:{},UpperCase:{},Hyphenated:{},Acronym:{},ClauseEnd:{},Quotation:{},StartQuotation:{isA:"Quotation"},EndQuotation:{isA:"Quotation"},Parentheses:{},EndBracket:{isA:"Parentheses"},StartBracket:{isA:"Parentheses"}}},{}],140:[function(t,e,r){"use strict";e.exports={Noun:{},Singular:{isA:"Noun"},ProperNoun:{isA:"Noun"},Person:{isA:"Singular"},FirstName:{isA:"Person"},MaleName:{isA:"FirstName"},FemaleName:{isA:"FirstName"},LastName:{isA:"Person"},Honorific:{isA:"Noun"},Place:{isA:"Singular"},Country:{isA:"Place"},City:{isA:"Place"},Region:{isA:"Place"},Address:{isA:"Place"},Organization:{isA:"Singular"},SportsTeam:{isA:"Organization"},Company:{isA:"Organization"},School:{isA:"Organization"},Plural:{isA:"Noun"},Uncountable:{isA:"Noun"},Pronoun:{isA:"Noun"},Actor:{isA:"Noun"},Activity:{isA:"Noun"},Unit:{isA:"Noun"},Demonym:{isA:"Noun"},Possessive:{isA:"Noun"}}},{}],141:[function(t,e,r){"use strict";e.exports={Value:{},Ordinal:{isA:"Value"},Cardinal:{isA:"Value"},Multiple:{isA:"Value"},RomanNumeral:{isA:"Cardinal"},Fraction:{isA:"Value"},TextValue:{isA:"Value"},NumericValue:{isA:"Value"},NiceNumber:{isA:"Value"},Money:{},Percent:{isA:"Value"}}},{}],142:[function(t,e,r){"use strict";e.exports={Verb:{isA:"VerbPhrase"},PresentTense:{isA:"Verb"},Infinitive:{isA:"PresentTense"},Gerund:{isA:"PresentTense"},PastTense:{isA:"Verb"},PerfectTense:{isA:"Verb"},FuturePerfect:{isA:"Verb"},Pluperfect:{isA:"Verb"},Copula:{isA:"Verb"},Modal:{isA:"Verb"},Participle:{isA:"Verb"},Particle:{isA:"Verb"},PhrasalVerb:{isA:"Verb"}}},{}],143:[function(t,e,r){"use strict";var n=t("./paths").fns,a=t("./whitespace"),i=t("./makeUID"),o=t("./methods/normalize/normalize").addNormal,s=t("./methods/normalize/root"),u=function(t,e){this.tags={},this._text=n.ensureString(t),Object.defineProperty(this,"world",{enumerable:!1,value:e});var r=a(this._text);this.whitespace=r.whitespace,this._text=r.text,this.parent=null,this.silent_term="",this.lumped=!1,o(this),s(this),this.dirty=!1,this.uid=i(this.normal),Object.defineProperty(this,"text",{get:function(){return this._text},set:function(t){t=t||"",this._text=t.trim(),this.dirty=!0,this.normalize()}}),Object.defineProperty(this,"isA",{get:function(){return"Term"}})};u.prototype.normalize=function(){return o(this),s(this),this},u.prototype.index=function(){var t=this.parentTerms;return t?t.terms.indexOf(this):null},u.prototype.clone=function(){var t=new u(this._text,this.world);return t.tags=n.copy(this.tags),t.whitespace=n.copy(this.whitespace),t.silent_term=this.silent_term,t},t("./methods/misc")(u),t("./methods/out")(u),t("./methods/tag")(u),t("./methods/case")(u),t("./methods/punctuation")(u),e.exports=u},{"./makeUID":144,"./methods/case":146,"./methods/misc":147,"./methods/normalize/normalize":149,"./methods/normalize/root":150,"./methods/out":153,"./methods/punctuation":156,"./methods/tag":158,"./paths":161,"./whitespace":162}],144:[function(t,e,r){"use strict";e.exports=function(t){for(var e="",r=0;r<5;r++)e+=parseInt(9*Math.random(),10);return t+"-"+e}},{}],145:[function(t,e,r){"use strict";var n={Auxiliary:1,Possessive:1,TitleCase:1,ClauseEnd:1,Comma:1,CamelCase:1,UpperCase:1,Hyphenated:1,VerbPhrase:1,EndBracket:1,StartBracket:1,Parentheses:1,Quotation:1};e.exports=function(t){var e=t.world.tags,r=Object.keys(t.tags);return(r=(r=r.sort()).sort(function(t,r){return e[t]?n[r]||!e[r]?-1:(e[t].downward.length,e[r].downward.length,1):1}))[0]}},{}],146:[function(t,e,r){"use strict";e.exports=function(t){var e={toUpperCase:function(){return this.text=this._text.toUpperCase(),this.tag("#UpperCase","toUpperCase"),this},toLowerCase:function(){return this.text=this._text.toLowerCase(),this.unTag("#TitleCase"),this.unTag("#UpperCase"),this},toTitleCase:function(){return this.text=this._text.replace(/^ *[a-z]/,function(t){return t.toUpperCase()}),this.tag("#TitleCase","toTitleCase"),this},needsTitleCase:function(){for(var t=["Person","Place","Organization","Acronym","UpperCase","Currency","RomanNumeral","Month","WeekDay","Holiday","Demonym"],e=0;e<t.length;e++)if(this.tags[t[e]])return!0;for(var r=["i","god","allah"],n=0;n<r.length;n++)if(this.normal===r[n])return!0;return!1}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{}],147:[function(t,e,r){"use strict";var n=t("./normalize/isAcronym"),a=t("./bestTag"),i=/[aeiouy]/i,o=/[a-z]/,s=/[0-9]/;e.exports=function(t){var e={bestTag:function(){return a(this)},isAcronym:function(){return n(this._text)},isWord:function(){var t=this;return!(!t.silent_term&&(!1===/[a-z|A-Z|0-9]/.test(t.text)||3<t.normal.length&&!0===o.test(t.normal)&&!1===i.test(t.normal)&&!1===t.isAcronym()||!0===s.test(t.normal)&&!1===t.tags.hasOwnProperty("Value")&&!0===/[a-z][0-9][a-z]/.test(t.normal)))}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{"./bestTag":145,"./normalize/isAcronym":148}],148:[function(t,e,r){"use strict";var n=/([A-Z]\.)+[A-Z]?,?$/,a=/^[A-Z]\.,?$/,i=/[A-Z]{2}('s|,)?$/;e.exports=function(t){return!0===n.test(t)||!0===a.test(t)||!0===i.test(t)}},{}],149:[function(t,e,r){"use strict";var n=t("./unicode"),a=t("./isAcronym");r.normalize=function(t){var e=t=(t=(t=t||"").toLowerCase()).trim();return t=(t=(t=(t=(t=(t=(t=n(t)).replace(/^[#@]/,"")).replace(/[,;.!?]+$/,"")).replace(/[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]+/g,"'")).replace(/[\u0022\u00AB\u00BB\u201C\u201D\u201E\u201F\u2033\u2034\u2036\u2037\u2E42\u301D\u301E\u301F\uFF02]+/g,'"')).replace(/\u2026/g,"...")).replace(/\u2013/g,"-"),!0===/[a-z][^aeiou]in[']$/.test(t)&&(t=t.replace(/in[']$/,"ing")),!0===/^(re|un)-?[^aeiou]./.test(t)&&(t=t.replace("-","")),!1===/^[:;]/.test(t)&&(t=(t=(t=t.replace(/\.{3,}$/g,"")).replace(/['",\.!:;\?\)]+$/g,"")).replace(/^['"\(]+/g,"")),""===(t=t.trim())&&(t=e),t},r.addNormal=function(t){var e=t._text||"";e=r.normalize(e),a(t._text)&&(e=e.replace(/\./g,"")),e=e.replace(/([0-9]),([0-9])/g,"$1$2"),t.normal=e}},{"./isAcronym":148,"./unicode":151}],150:[function(t,e,r){"use strict";e.exports=function(t){var e=t.normal||t.silent_term||"";e=(e=e.replace(/'s\b/,"")).replace(/'$/,""),t.root=e}},{}],151:[function(t,e,r){"use strict";var n={"!":"","?":"",'"':'"',"'":"","-":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",I:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:""},a={};Object.keys(n).forEach(function(t){n[t].split("").forEach(function(e){a[e]=t})}),e.exports=function(t){var e=t.split("");return e.forEach(function(t,r){a[t]&&(e[r]=a[t])}),e.join("")}},{}],152:[function(t,e,r){"use strict";var n=t("../../paths"),a=n.fns,i=n.tags;e.exports=function(t){for(var e="silver",r=Object.keys(t.tags),n=0;n<r.length;n++)if(i[r[n]]&&i[r[n]].color){e=i[r[n]].color;break}var o=a.leftPad(t.text,12);o+=" "+r,console.log("%c "+o,"color: "+e)}},{"../../paths":161}],153:[function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a=t("./renderHtml"),i=t("./client"),o=t("./server"),s={text:function(t){return(t.whitespace.before||"")+t._text+(t.whitespace.after||"")},normal:function(t){return t.normal},root:function(t){return t.root||t.normal},html:function(t){return a(t)},tags:function(t){return{text:t.text,normal:t.normal,tags:Object.keys(t.tags)}},debug:function(t){"object"===("undefined"==typeof window?"undefined":n(window))?i(t):o(t)}};e.exports=function(t){return t.prototype.out=function(t){return s[t]||(t="text"),s[t](this)},t}},{"./client":152,"./renderHtml":154,"./server":155}],154:[function(t,e,r){"use strict";var n=function(t){var e={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"," ":"&nbsp;"};return t.replace(/[<>&"' ]/g,function(t){return e[t]})};e.exports=function(t){var e=Object.keys(t.tags).filter(function(t){return"Term"!==t});e=(e=e.map(function(t){return"nl-"+t})).join(" ");var r=function(t){for(var e,r="(?:[^\"'>]|\"[^\"]*\"|'[^']*')*",n=new RegExp("<(?:!--(?:(?:-*[^->])*--+|-?)|script\\b"+r+">[\\s\\S]*?<\/script\\s*|style\\b"+r+">[\\s\\S]*?</style\\s*|/?[a-z]"+r+")>","gi");(t=(e=t).replace(n,""))!==e;);return t.replace(/</g,"&lt;")}(t.text),a='<span class="'+e+'">'+(r=n(r))+"</span>";return n(t.whitespace.before)+a+n(t.whitespace.after)}},{}],155:[function(t,e,r){"use strict";var n=t("../../paths").fns;e.exports=function(t){var e=Object.keys(t.tags).map(function(t){return n.printTag(t)}).join(", "),r=t.text;r="'"+n.yellow(r||"-")+"'";var a="";t.silent_term&&(a="["+t.silent_term+"]"),r=n.leftPad(r,20),r+=n.leftPad(a,8),console.log("   "+r+"        - "+e)}},{"../../paths":161}],156:[function(t,e,r){"use strict";var n=/([a-z0-9 ])([,:;.!?]+)$/i;e.exports=function(t){var e={getPunctuation:function(){var t=this.text.match(n);return t?t[2]:null},setPunctuation:function(t){return this.killPunctuation(),this.text+=t,","===t&&(this.tags.Comma=!0),this},hasComma:function(){return","===this.getPunctuation()},killPunctuation:function(){return this.text=this._text.replace(n,"$1"),delete this.tags.Comma,delete this.tags.ClauseEnd,this}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{}],157:[function(t,e,r){"use strict";e.exports=function t(e,r){var n=e.world.tags;if(void 0===n[r])return!0;for(var a=n[r].notA||[],i=0;i<a.length;i++)if(!0===e.tags[a[i]])return!1;return void 0===n[r].isA||t(e,n[r].isA)}},{}],158:[function(t,e,r){"use strict";var n=t("./setTag"),a=t("./unTag"),i=t("./canBe"),o={".":!0};e.exports=function(t){var e={tag:function(t,e){!0!==o[t]&&n(this,t,e)},unTag:function(t,e){!0!==o[t]&&a(this,t,e)},canBe:function(t){if("string"==typeof(t=t||"")){if(!0===o[t])return!0;t=t.replace(/^#/,"")}return i(this,t)}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{"./canBe":157,"./setTag":159,"./unTag":160}],159:[function(t,e,r){"use strict";var n=t("../../paths"),a=n.log,i=n.fns,o=t("./unTag"),s=function t(e,r,n){var i=e.world.tags;if(r=r.replace(/^#/,""),!0!==e.tags[r]&&(e.tags[r]=!0,a.tag(e,r,n),i[r])){for(var s=i[r].notA||[],u=0;u<s.length;u++)!0===e.tags[s[u]]&&o(e,s[u],n);if(i[r].isA){var l=i[r].isA;!0!==e.tags[l]&&t(e,l," --\x3e "+r)}}};e.exports=function(t,e,r){if(t&&e){var n=t.world.tags;i.isArray(e)?e.forEach(function(e){return s(t,e,r)}):(s(t,e,r),n[e]&&void 0!==n[e].also&&s(t,n[e].also,r))}}},{"../../paths":161,"./unTag":160}],160:[function(t,e,r){"use strict";var n=t("../../paths").log;e.exports=function(t,e,r){t&&e&&("*"!==e?function t(e,r,a){var i=e.world.tags;if(e.tags[r]&&(n.unTag(e,r,a),delete e.tags[r],i[r]))for(var o=i[r].downward,s=0;s<o.length;s++)t(e,o[s]," - -   - ")}(t,e,r):t.tags={})}},{"../../paths":161}],161:[function(t,e,r){"use strict";e.exports={fns:t("../fns"),log:t("../log")}},{"../fns":3,"../log":6}],162:[function(t,e,r){"use strict";var n=/^([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]|\x2D+|\.\.+|\/|"|"|\uFF02|'|\u201C|\u2018|\u201F|\u201B|\u201E|\u2E42|\u201A|\xAB|\u2039|\u2035|\u2036|\u2037|\u301D|`|\u301F)+/,a=/([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+|\x2D+|\.\.+|"|"|\uFF02|'|\u201D|\u2019|\xBB|\u203A|\u2032|\u2033|\u2034|\u301E|\xB4)+$/,i=/([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+|\x2D+|\.\.+|"|"|\uFF02|'|\u201D|\u2019|\xBB|\u203A|\u2032|\u2033|\u2034|\u301E|\xB4)+[ !,\.;\?]*$/,o=/^( *)-(\$|||)?([0-9])/;e.exports=function(t){var e={before:"",after:""},r=t.match(o);return null!==r?(e.before=r[1],t=t.replace(/^ */,"")):null!==(r=t.match(n))&&(e.before=t.match(n)[0],t=t.replace(n,"")),null!==(r=t.match(i))&&(t=t.replace(a,""),e.after=r[0]),{whitespace:e,text:t}}},{}],163:[function(t,e,r){"use strict";var n=t("../term"),a=/\S/,i=/^[!?.]+$/,o={".":!0,"-":!0,"":!0,"":!0,"--":!0,"...":!0};e.exports=function(t,e){var r,s=[],u=[];"number"==typeof(t=t||"")&&(t=String(t));for(var l,c=t.split(/(\S+)/),h=0;h<c.length;h++){var f=c[h];if(1==(!0!==/^(re|un)-?[^aeiou]./.test(r=f)&&(!0===/^([a-z`"'/]+)(-||)([a-z0-9].*)/i.test(r)||!!/^([0-9]+)(|)([0-9].*)/i.test(r))))for(var m=f.split(/[-]/),d=0;d<m.length;d++)d===m.length-1?u.push(m[d]):u.push(m[d]+"-");else if(1==!(!/[a-z]\/[a-z]/.test(l=f)||2!==l.split(/\//g).length)){var p=f.split(/\//);u.push(p[0]),u.push("/"+p[1])}else u.push(f)}for(var g="",v=0;v<u.length;v++)!0===a.test(u[v])&&!1===o.hasOwnProperty(u[v])&&!1===i.test(u[v])?(s.push(g+u[v]),g=""):g+=u[v];return g&&0<s.length&&(s[s.length-1]+=g),s.map(function(t){return new n(t,e)})}},{"../term":143}],164:[function(t,e,r){"use strict";e.exports={parent:{get:function(){return this.refText||this},set:function(t){return this.refText=t,this}},parentTerms:{get:function(){return this.refTerms||this},set:function(t){return this.refTerms=t,this}},dirty:{get:function(){for(var t=0;t<this.terms.length;t++)if(!0===this.terms[t].dirty)return!0;return!1},set:function(t){this.terms.forEach(function(e){e.dirty=t})}},refTerms:{get:function(){return this._refTerms||this},set:function(t){return this._refTerms=t,this}},found:{get:function(){return 0<this.terms.length}},length:{get:function(){return this.terms.length}},isA:{get:function(){return"Terms"}},whitespace:{get:function(){var t=this;return{before:function(e){return t.firstTerm().whitespace.before=e,t},after:function(e){return t.lastTerm().whitespace.after=e,t}}}}}},{}],165:[function(t,e,r){"use strict";var n=t("./build"),a=t("./getters"),i=t("../world"),o=function(t,e,r,n){var o=this;this.terms=t,this.world=e||i,this.refText=r,this._refTerms=n,this.get=function(t){return o.terms[t]};for(var s=Object.keys(a),u=0;u<s.length;u++)Object.defineProperty(this,s[u],a[s[u]])};o.fromString=function(t,e){var r=n(t,e),a=new o(r,e,null);return a.terms.forEach(function(t){t.parentTerms=a}),a},t("./match")(o),t("./methods/tag")(o),t("./methods/loops")(o),t("./match/not")(o),t("./methods/delete")(o),t("./methods/insert")(o),t("./methods/misc")(o),t("./methods/out")(o),t("./methods/replace")(o),t("./methods/split")(o),t("./methods/transform")(o),t("./methods/lump")(o),e.exports=o},{"../world":215,"./build":163,"./getters":164,"./match":166,"./match/not":176,"./methods/delete":177,"./methods/insert":178,"./methods/loops":179,"./methods/lump":181,"./methods/misc":182,"./methods/out":183,"./methods/replace":184,"./methods/split":185,"./methods/tag":186,"./methods/transform":187}],166:[function(t,e,r){"use strict";var n=t("./lib/syntax"),a=t("./lib/startHere"),i=t("../../text"),o=t("./lib");e.exports=function(t){var e={match:function(e,r){var n=this;if(0===this.terms.length)return new i([],this.world,this.parent);if(!e)return new i([],this.world,this.parent);var a=o(this,e,r);return a=a.map(function(e){return new t(e,n.world,n.refText,n.refTerms)}),new i(a,this.world,this.parent)},matchOne:function(t){if(0===this.terms.length)return null;for(var e=n(t),r=0;r<this.terms.length&&!(e[0]&&e[0].starting&&0<r);r++){var i=a(this,r,e);if(i)return i}return null},has:function(t){return null!==this.matchOne(t)}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{"../../text":192,"./lib":170,"./lib/startHere":174,"./lib/syntax":175}],167:[function(t,e,r){"use strict";e.exports=function(t,e){e.capture?t.captureGroup=!0:t.captureGroup=void 0}},{}],168:[function(t,e,r){"use strict";e.exports=function(t){var e=[];return t.forEach(function(t){if(0!==t.filter(function(t){return!0===t.captureGroup}).length){for(var r=[],n=0;n<t.length;n+=1)t[n].captureGroup?r.push(t[n]):0<r.length&&(e.push(r),r=[]);0<r.length&&e.push(r)}else e.push(t)}),e}},{}],169:[function(t,e,r){"use strict";e.exports=function(t,e){for(var r=0;r<e.length;r++){var n=e[r],a=!1;if(!0!==n.optional&&!0!==n.negative&&void 0===n.minMax){if(void 0!==n.normal){for(var i=0;i<t.terms.length;i++){if(t.terms[i].normal===n.normal||t.terms[i].silent_term===n.normal){a=!0;break}if(!0===t.terms[i].lumped)return!1}if(!1===a)return!0}if(void 0!==n.tag){for(var o=0;o<t.terms.length;o++)if(!0===t.terms[o].tags[n.tag]){a=!0;break}if(!1===a)return!0}}}return!1}},{}],170:[function(t,e,r){"use strict";var n=t("./syntax"),a=t("./startHere"),i=t("./fastPass"),o=t("./captureGroup"),s=function(t){return t?t.terms.map(function(t){return{id:t.uid}}):[]};e.exports=function(t,e,r){if("string"==typeof e?e=n(e):e&&"Text"===e.isA?e=s(e.list[0]):e&&"Terms"===e.isA&&(e=s(e)),!e||0===e.length)return[];if(!0===i(t,e,r))return[];for(var u=[],l=0;l<t.terms.length&&!(0<l&&e[0]&&e[0].starting);l+=1){var c=a(t,l,e,r);c&&0<c.length&&(u.push(c),l+=c.length-1)}return o(u)}},{"./captureGroup":168,"./fastPass":169,"./startHere":174,"./syntax":175}],171:[function(t,e,r){"use strict";var n=t("./applyCaptureGroup");e.exports=function(t,e,r){if(!t||!e)return!1;var a=function(t,e){if(!t||!e)return!1;if(!0===e.anyOne)return!0;if(void 0!==e.tag)return t.tags[e.tag];if(void 0!==e.id)return e.id===t.uid;if(void 0!==e.normal)return e.normal===t.normal||e.normal===t.silent_term;if(!0===e.suffix&&void 0!==e.partial){var r=t.normal.length;return t.normal.substr(r-e.partial.length,r)===e.partial}if(!0===e.prefix&&void 0!==e.partial)return t.normal.substr(0,e.partial.length)===e.partial;if(!0===e.infix&&e.partial)return-1!==t.normal.indexOf(e.partial);if(void 0!==e.regex)return e.regex.test(t.normal)||e.regex.test(t.text);if(void 0===e.oneOf)return!1;for(var n=0;n<e.oneOf.tagArr.length;n++)if(!0===t.tags.hasOwnProperty(e.oneOf.tagArr[n]))return!0;return e.oneOf.terms.hasOwnProperty(t.normal)||e.oneOf.terms.hasOwnProperty(t.silent_term)}(t,e);return e.negative&&(a=!Boolean(a)),a&&n(t,e),a}},{"./applyCaptureGroup":167}],172:[function(t,e,r){"use strict";var n=function(t,e){return e.normal.substr(0,t.length)===t};e.exports=function(t,e,r){var a=e[r].normal;if(void 0!==a&&n(a,t))for(r+=1;r<e.length;r++){if((a+=" "+e[r].normal)===t.normal)return r;if(!1===n(a,t))return null}return null}},{}],173:[function(t,e,r){arguments[4][73][0].apply(r,arguments)},{"../../paths":189,dup:73}],174:[function(t,e,r){"use strict";var n=t("./lumpMatch"),a=t("./isMatch"),i=t("./applyCaptureGroup"),o=function(t,e,r){for(;e<t.length;e++)if(a(t.terms[e],r))return e;return null},s=function(t,e,r,n){for(;e<t.length;e++){var i=t.terms[e];if(n&&a(i,n))return e;if(!a(i,r))return e}return e};e.exports=function(t,e,r,u){for(var l=e,c=0;c<r.length;c++){var h=t.terms[l],f=r[c],m=r[c+1];if(!h){if(!0===f.optional)continue;return null}if(!0===f.starting&&0<l)return null;if(!0===f.ending&&l!==t.length-1&&!f.minMax)return null;if(!0!==f.astrix)if(void 0===r[c].minMax)if(!0!==f.optional)if(a(h,f,u)){if(l+=1,!0===f.consecutive){var d=r[c+1];l=s(t,l,f,d)}}else if(!h.silent_term||h.normal){var p=n(h,r,c,u);if(null===p){if(!0!==f.optional)return null}else c=p,l+=1}else{if(0===c)return null;l+=1,c-=1}else{var g=r[c+1];l=s(t,l,f,g)}else for(var v=r[c].minMax.min||0,y=r[c].minMax.max,b=r[c+1],D=0;D<y;D++){var w=t.terms[l+D];if(!w)return null;if(!1===a(w,f))return null;if(!(D<v-1)){if(!b){l+=1;break}if(v<=D&&a(w,b))break;var x=t.terms[l+D+1];if(x&&a(x,b)){l+=D+2,c+=1;break}if(D===y-1)return null}}else{if(!m){for(var C=t.terms.slice(e,t.length),k=l-e;k<C.length;k++)i(C[k],f);return C}var E=o(t,l,r[c+1]);if(!E)return null;for(var A=l;A<E;A++)i(t.terms[A],f);l=E+1,c+=1}}return t.terms.slice(e,l)}},{"./applyCaptureGroup":167,"./isMatch":171,"./lumpMatch":172}],175:[function(t,e,r){"use strict";var n=t("./paths").fns,a=/\{[0-9,]+\}$/,i=function(t){return t.substr(1,t.length)},o=function(t){return t.substring(0,t.length-1)};e.exports=function(t){for(var e=(t=t||"").split(/ +/),r=0;r<e.length;r+=1)if(-1!==e[r].indexOf("(")&&-1===e[r].indexOf(")")){var s=e[r+1];s&&-1===s.indexOf("(")&&-1!==s.indexOf(")")&&(e[r+1]=e[r]+" "+e[r+1],e[r]="")}e=e.filter(function(t){return t});var u=!1;return e.map(function(t){var e=!1;return"["===t.charAt(0)&&(t=i(t),u=!0),"]"===t.charAt(t.length-1)&&(t=o(t),e=!(u=!1)),t=function(t){t=(t=t||"").trim();var e={};if(1===t.length&&"."!==t&&"*"!==t)return e.normal=t.toLowerCase(),e;if("!"===t.charAt(0)&&(t=i(t),e.negative=!0),"^"===t.charAt(0)&&(t=i(t),e.starting=!0),"$"===t.charAt(t.length-1)&&(t=o(t),e.ending=!0),"?"===t.charAt(t.length-1)&&(t=o(t),e.optional=!0),"+"===t.charAt(t.length-1)&&(t=o(t),e.consecutive=!0),"_"===t.charAt(t.length-1)?(t=o(t),e.prefix=!0,"_"===t.charAt(0)&&(t=i(t),e.prefix=void 0,e.infix=!0),e.partial=t,t=""):"_"===t.charAt(0)&&(t=i(t),e.suffix=!0,e.partial=t,t=""),"}"===t.charAt(t.length-1)&&!0===a.test(t)){var r=t.match(/\{([0-9])*,? ?([0-9]+)\}/);e.minMax={min:parseInt(r[1],10)||0,max:parseInt(r[2],10)},t=t.replace(a,"")}if("#"===t.charAt(0)&&(t=i(t),e.tag=n.titleCase(t),t=""),"/"===t.charAt(0)&&"/"===t.charAt(t.length-1)&&(t=o(t),t=i(t),e.regex=new RegExp(t,"i"),t=""),"("===t.charAt(0)&&")"===t.charAt(t.length-1)){t=o(t);var s=(t=i(t)).split(/\|/g);e.oneOf={terms:{},tagArr:[]},s.forEach(function(t){if("#"===t.charAt(0)){var r=t.substr(1,t.length)
;r=n.titleCase(r),e.oneOf.tagArr.push(r)}else e.oneOf.terms[t]=!0}),t=""}return"."===t&&(e.anyOne=!0,t=""),"*"===t&&(e.astrix=!0,t=""),""!==t&&(t=t.replace(/\\([\\#\*\.\[\]\(\)\+\?\^])/g,""),e.normal=t.toLowerCase()),e}(t),!0!==u&&!0!==e||(t.capture=!0),t})}},{"./paths":173}],176:[function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a=t("./lib/syntax"),i=t("./lib/startHere"),o=t("../../text");e.exports=function(t){var e={notObj:function(e,r){var n=[],a=[];return e.terms.forEach(function(t){r.hasOwnProperty(t.normal)?(a.length&&n.push(a),a=[]):a.push(t)}),a.length&&n.push(a),n=n.map(function(r){return new t(r,e.world,e.refText,e.refTerms)}),new o(n,e.world,e.parent)},notString:function(e,r,n){for(var s=[],u=a(r),l=[],c=0;c<e.terms.length;c++){var h=i(e,c,u,n);h&&0<h.length?(0<l.length&&(s.push(l),l=[]),c+=h.length-1):l.push(e.terms[c])}return 0<l.length&&s.push(l),s=s.map(function(r){return new t(r,e.world,e.refText,e.refTerms)}),new o(s,e.world,e.parent)},notArray:function(t,r){var n=r.reduce(function(t,e){return t[e]=!0,t},{});return e.notObj(t,n)},notText:function(t,r){var n=r.out("array");return e.notArray(t,n)}};return t.prototype.not=function(t,r){if("object"===n(t)){var a=Object.prototype.toString.call(t);if("[object Array]"===a)return e.notArray(this,t,r);if("[object Object]"===a)return"Text"===t.isA?e.notText(this,t,r):e.notObj(this,t,r)}return"string"==typeof t?e.notString(this,t,r):this},t}},{"../../text":192,"./lib/startHere":174,"./lib/syntax":175}],177:[function(t,e,r){"use strict";var n=t("../mutate");e.exports=function(t){return t.prototype.delete=function(t){if(!this.found)return this;if(!t)return this.parentTerms=n.deleteThese(this.parentTerms,this),this;var e=this.match(t);return e.found?n.deleteThese(this,e):this.parentTerms},t}},{"../mutate":188}],178:[function(t,e,r){"use strict";var n=t("../mutate"),a=function(t,e){return t.terms.length&&t.terms[e]&&(t.terms[e].whitespace.before=" "),t};e.exports=function(t){var e=function(e,r){if("Terms"===e.isA)return e;if("Term"===e.isA)return new t([e],r);var n=t.fromString(e,r);return n.tagger(),n},r={insertBefore:function(t,r){var i=this.terms.length,o=e(t,this.world);r&&o.tag(r);var s=this.index();return a(this.parentTerms,s),0<s&&a(o,0),this.parentTerms.terms=n.insertAt(this.parentTerms.terms,s,o),this.terms.length===i&&(this.terms=o.terms.concat(this.terms)),this},insertAfter:function(t,r){var i=this.terms.length,o=e(t,this.world);r&&o.tag(r);var s=this.terms[this.terms.length-1].index();return a(o,0),this.parentTerms.terms=n.insertAt(this.parentTerms.terms,s+1,o),this.terms.length===i&&(this.terms=this.terms.concat(o.terms)),this},insertAt:function(t,r,i){t<0&&(t=0);var o=this.terms.length,s=e(r,this.world);return i&&s.tag(i),0<t&&a(s,0),this.parentTerms.terms=n.insertAt(this.parentTerms.terms,t,s),this.terms.length===o&&Array.prototype.splice.apply(this.terms,[t,0].concat(s.terms)),0===t&&(this.terms[0].whitespace.before="",s.terms[s.terms.length-1].whitespace.after=" "),this}};return Object.keys(r).forEach(function(e){t.prototype[e]=r[e]}),t}},{"../mutate":188}],179:[function(t,e,r){"use strict";e.exports=function(t){return[["toUpperCase","UpperCase"],["toLowerCase"],["toTitleCase","TitleCase"]].forEach(function(e){var r=e[0],n=e[1];t.prototype[r]=function(){var t=arguments;return this.terms.forEach(function(e){e[r].apply(e,t)}),n&&this.tag(n,r),this}}),t}},{}],180:[function(t,e,r){"use strict";var n=t("../../../term");e.exports=function(t,e){var r=t.terms[e],a=t.terms[e+1];if(a){var i,o,s,u=(o=a,s=(i=r).whitespace.before+i.text+i.whitespace.after,s+=o.whitespace.before+o.text+o.whitespace.after);t.terms[e]=new n(u,r.context),t.terms[e].normal=r.normal+" "+a.normal,t.terms[e].lumped=!0,t.terms[e].parentTerms=t.terms[e+1].parentTerms,t.terms[e+1]=null,t.terms=t.terms.filter(function(t){return null!==t})}}},{"../../../term":143}],181:[function(t,e,r){"use strict";var n=t("./combine"),a=t("../../mutate"),i=function(t,e){for(var r=t.terms.length,a=0;a<r;a++)n(t,0);var i=t.terms[0];return i.tags=e,i};e.exports=function(t){return t.prototype.lump=function(){var t=this.index(),e={};if(this.terms.forEach(function(t){Object.keys(t.tags).forEach(function(t){return e[t]=!0})}),this.parentTerms===this){var r=i(this,e);return this.terms=[r],this}this.parentTerms=a.deleteThese(this.parentTerms,this);var n=i(this,e);return this.parentTerms.terms=a.insertAt(this.parentTerms.terms,t,n),this},t}},{"../../mutate":188,"./combine":180}],182:[function(t,e,r){"use strict";var n=t("../../tagger");e.exports=function(t){var e={tagger:function(){return n(this),this},firstTerm:function(){return this.terms[0]},lastTerm:function(){return this.terms[this.terms.length-1]},all:function(){return this.parent},data:function(){return{text:this.out("text"),normal:this.out("normal")}},term:function(t){return this.terms[t]},first:function(){var e=this.terms[0];return new t([e],this.world,this.refText,this.refTerms)},last:function(){var e=this.terms[this.terms.length-1];return new t([e],this.world,this.refText,this.refTerms)},slice:function(e,r){var n=this.terms.slice(e,r);return new t(n,this.world,this.refText,this.refTerms)},index:function(){var t=this.parentTerms,e=this.terms[0];if(!t||!e)return null;for(var r=0;r<t.terms.length;r++)if(e===t.terms[r])return r;return null},termIndex:function(){var t=this.terms[0],e=this.refText||this;if(!e||!t)return null;for(var r=0,n=0;n<e.list.length;n++)for(var a=e.list[n],i=0;i<a.terms.length;i++){if(a.terms[i]===t)return r;r+=1}return r},chars:function(){return this.terms.reduce(function(t,e){return t+=e.whitespace.before.length,(t+=e.text.length)+e.whitespace.after.length},0)},wordCount:function(){return this.terms.length},setPunctuation:function(t){this.terms[this.terms.length-1].setPunctuation(t)},getPunctuation:function(){var t=this.last().terms[0];return t&&t.getPunctuation()||""},toCamelCase:function(){return this.toTitleCase(),this.terms.forEach(function(t,e){0!==e&&(t.whitespace.before=""),t.whitespace.after=""}),this.tag("#CamelCase","toCamelCase"),this}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{"../../tagger":95}],183:[function(t,e,r){"use strict";var n=t("../paths").fns,a={text:function(t){return t.terms.reduce(function(t,e){return t+e.out("text")},"")},match:function(t){for(var e="",r=t.terms.length,n=0;n<r;n++)0<n&&(e+=t.terms[n].whitespace.before),e+=t.terms[n].text.replace(/[,.?!]$/,""),n<r-1&&(e+=t.terms[n].whitespace.after);return e},normal:function(t){var e=t.terms.filter(function(t){return t.text});return(e=e.map(function(t){return t.normal})).join(" ")},grid:function(t){var e="  ";return(e+=t.terms.reduce(function(t,e){return t+n.leftPad(e.text,11)},""))+"\n\n"},color:function(t){return t.terms.reduce(function(t,e){return t+n.printTerm(e)},"")},csv:function(t){return t.terms.map(function(t){return t.normal.replace(/,/g,"")}).join(",")},newlines:function(t){return t.terms.reduce(function(t,e){return t+e.out("text").replace(/\n/g," ")},"").replace(/^\s/,"")},root:function(t){return t.terms.map(function(t){return t.silent_term||t.root}).join(" ").toLowerCase()},html:function(t){return t.terms.map(function(t){return t.render.html()}).join(" ")},debug:function(t){t.terms.forEach(function(t){t.out("debug")})},custom:function(t,e){return t.terms.map(function(t){return Object.keys(e).reduce(function(r,n){return e[n]&&t[n]&&("function"==typeof t[n]?r[n]=t[n]():r[n]=t[n]),r},{})})}};a.plaintext=a.text,a.normalize=a.normal,a.normalized=a.normal,a.colors=a.color,a.tags=a.terms,e.exports=function(t){return t.prototype.out=function(t){if("string"==typeof t){if(a[t])return a[t](this)}else if(!0===n.isObject(t))return a.custom(this,t);return a.text(this)},t.prototype.debug=function(){return a.debug(this)},t}},{"../paths":189}],184:[function(t,e,r){"use strict";var n=t("../mutate");e.exports=function(t){var e={replace:function(t,e,r){return void 0===e?this.replaceWith(t,r):(this.match(t).replaceWith(e,r),this)},replaceWith:function(e,r){var a=t.fromString(e,this.world);a.tagger(),r&&this.terms.forEach(function(t,e){var r=Object.keys(t.tags);void 0!==a.terms[e]&&r.forEach(function(t){return a.terms[e].tag(t,"from-memory")})});var i=this.getPunctuation(),o=this.index();return this.parentTerms=n.deleteThese(this.parentTerms,this),this.parentTerms.terms=n.insertAt(this.parentTerms.terms,o,a),this.terms=a.terms,0<this.terms.length&&(this.terms[this.terms.length-1].whitespace.after+=i),this}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{"../mutate":188}],185:[function(t,e,r){"use strict";var n=function(t,e){for(var r=e.terms[0],n=e.terms.length,a=0;a<t.length;a++)if(t[a]===r)return{before:t.slice(0,a),match:t.slice(a,a+n),after:t.slice(a+n,t.length)};return{after:t}};e.exports=function(t){var e={splitAfter:function(e,r){var a=this,i=this.match(e,r),o=this.terms,s=[];return i.list.forEach(function(t){var e=n(o,t);e.before&&e.match&&s.push(e.before.concat(e.match)),o=e.after}),o.length&&s.push(o),s=s.map(function(e){var r=a.refText;return new t(e,a.world,r,a.refTerms)})},splitOn:function(e,r){var a=this,i=this.match(e,r),o=this.terms,s=[];return i.list.forEach(function(t){var e=n(o,t);e.before&&s.push(e.before),e.match&&s.push(e.match),o=e.after}),o.length&&s.push(o),s=(s=s.filter(function(t){return t&&t.length})).map(function(e){return new t(e,e.world,e.refText,a.refTerms)})},splitBefore:function(e,r){var a=this,i=this.match(e,r),o=this.terms,s=[];i.list.forEach(function(t){var e=n(o,t);e.before&&s.push(e.before),e.match&&s.push(e.match),o=e.after}),o.length&&s.push(o);for(var u=0;u<s.length;u++)for(var l=0;l<i.length;l++)i.list[l].terms[0]===s[u][0]&&s[u+1]&&(s[u]=s[u].concat(s[u+1]),s[u+1]=[]);return s=(s=s.filter(function(t){return t&&t.length})).map(function(e){return new t(e,e.world,e.refText,a.refTerms)})}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{}],186:[function(t,e,r){"use strict";e.exports=function(t){var e={tag:function(t,e){var r=[];return"string"==typeof t&&(r=t.split(" ")),1<r.length?this.terms.forEach(function(t,n){t.tag(r[n],e)}):this.terms.forEach(function(r){r.tag(t,e)}),this},unTag:function(t,e){var r=[];return"string"==typeof t&&(r=t.split(" ")),1<r.length?this.terms.forEach(function(t,n){t.unTag(r[n],e)}):this.terms.forEach(function(r){r.unTag(t,e)}),this},canBe:function(e){var r=this.terms.filter(function(t){return t.canBe(e)});return new t(r,this.world,this.refText,this.refTerms)}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{}],187:[function(t,e,r){"use strict";e.exports=function(t){var e={clone:function(){var e=this.terms.map(function(t){return t.clone()});return new t(e,this.world,this.refText,null)},hyphenate:function(){var t=this;return this.terms.forEach(function(e,r){r!==t.terms.length-1&&(e.whitespace.after="-"),0!==r&&(e.whitespace.before="")}),this},dehyphenate:function(){return this.terms.forEach(function(t){"-"===t.whitespace.after&&(t.whitespace.after=" ")}),this},trim:function(){return this.length<=0||(this.terms[0].whitespace.before="",this.terms[this.terms.length-1].whitespace.after=""),this}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{}],188:[function(t,e,r){"use strict";var n=function(t){var e=[];return"Terms"===t.isA?e=t.terms:"Text"===t.isA?e=t.flatten().list[0].terms:"Term"===t.isA&&(e=[t]),e};r.deleteThese=function(t,e){var r=n(e);return t.terms=t.terms.filter(function(t){for(var e=0;e<r.length;e++)if(t===r[e])return!1;return!0}),t},r.insertAt=function(t,e,r){r.dirty=!0;var a=n(r);return 0<e&&a[0]&&!a[0].whitespace.before&&(a[0].whitespace.before=" "),Array.prototype.splice.apply(t,[e,0].concat(a)),t}},{}],189:[function(t,e,r){"use strict";e.exports={fns:t("../fns"),Term:t("../term")}},{"../fns":3,"../term":143}],190:[function(t,e,r){"use strict";var n=t("./index"),a=t("./tokenize"),i=t("./paths"),o=i.Terms,s=i.fns;e.exports=function(t,e){var r=(s.isArray(t)?t:(t=s.ensureString(t),a(t))).map(function(t){return o.fromString(t,e)}),i=new n(r,e);return i.list.forEach(function(t){t.refText=i}),i}},{"./index":192,"./paths":205,"./tokenize":207}],191:[function(t,e,r){"use strict";e.exports={found:function(){return 0<this.list.length},parent:function(){return this.original||this},length:function(){return this.list.length},isA:function(){return"Text"},whitespace:function(){var t=this;return{before:function(e){return t.list.forEach(function(t){t.whitespace.before(e)}),t},after:function(e){return t.list.forEach(function(t){t.whitespace.after(e)}),t}}}}},{}],192:[function(t,e,r){"use strict";function n(t,e,r){this.list=t||[],"function"==typeof e&&(e=e()),this.world=function(){return e},this.original=r;for(var n=Object.keys(a),i=0;i<n.length;i++)Object.defineProperty(this,n[i],{get:a[n[i]]})}var a=t("./getters");(e.exports=n).addMethods=function(t,e){for(var r=Object.keys(e),n=0;n<r.length;n++)t.prototype[r[n]]=e[r[n]]},n.makeSubset=function(t,e){var r=function(t,e,r){n.call(this,t,e,r)};return r.prototype=Object.create(n.prototype),n.addMethods(r,t),r.find=e,r},t("./methods/misc")(n),t("./methods/loops")(n),t("./methods/match")(n),t("./methods/out")(n),t("./methods/sort")(n),t("./methods/split")(n),t("./methods/normalize")(n),t("./subsets")(n);var i={acronyms:t("../subset/acronyms"),adjectives:t("../subset/adjectives"),adverbs:t("../subset/adverbs"),contractions:t("../subset/contractions"),dates:t("../subset/dates"),nouns:t("../subset/nouns"),people:t("../subset/people"),sentences:t("../subset/sentences"),terms:t("../subset/terms"),possessives:t("../subset/possessives"),values:t("../subset/values"),verbs:t("../subset/verbs"),ngrams:t("../subset/ngrams"),startGrams:t("../subset/ngrams/startGrams"),endGrams:t("../subset/ngrams/endGrams")};Object.keys(i).forEach(function(t){n.prototype[t]=function(e,r){var n=i[t].find(this,e,r);return new i[t](n.list,this.world,this.parent)}}),n.prototype.words=n.prototype.terms},{"../subset/acronyms":9,"../subset/adjectives":10,"../subset/adverbs":17,"../subset/contractions":23,"../subset/dates":25,"../subset/ngrams":35,"../subset/ngrams/endGrams":32,"../subset/ngrams/startGrams":36,"../subset/nouns":38,"../subset/people":49,"../subset/possessives":51,"../subset/sentences":52,"../subset/terms":58,"../subset/values":65,"../subset/verbs":75,"./getters":191,"./methods/loops":193,"./methods/match":194,"./methods/misc":195,"./methods/normalize":196,"./methods/out":197,"./methods/sort":202,"./methods/split":204,"./subsets":206}],193:[function(t,e,r){"use strict";var n=["toTitleCase","toUpperCase","toLowerCase","toCamelCase","hyphenate","dehyphenate","trim","insertBefore","insertAfter","insertAt","replace","replaceWith","delete","lump","tagger","unTag"];e.exports=function(t){n.forEach(function(e){t.prototype[e]=function(){for(var t=0;t<this.list.length;t++)this.list[t][e].apply(this.list[t],arguments);return this}}),t.prototype.tag=function(){if(0===this.list.length)return this;for(var t=0;t<this.list.length;t++)this.list[t].tag.apply(this.list[t],arguments);return this}}},{}],194:[function(t,e,r){"use strict";var n=t("../../../terms/match/lib/syntax"),a=t("../../../terms");e.exports=function(t){var e=function(e,r){var n=[];return e.list.forEach(function(t){t.terms.forEach(function(t){!0===r.hasOwnProperty(t.normal)&&n.push(t)})}),n=n.map(function(t){return new a([t],e.world(),e,t.parentTerms)}),new t(n,e.world(),e.parent)},r=function(t,r){var n=r.reduce(function(t,e){return t[e]=!0,t},{});return e(t,n)},i={match:function(a,i){if(0===this.list.length||null==a){var o=this.parent||this;return new t([],this.world(),o)}if("string"==typeof a||"number"==typeof a)return function(e,r,a){var i=[];r=n(r),e.list.forEach(function(t){t.match(r,a).list.forEach(function(t){i.push(t)})});var o=e.parent||e;return new t(i,e.world(),o)}(this,a,i);var s,u=Object.prototype.toString.call(a);return"[object Array]"===u?r(this,a):"[object Object]"===u?"Text"===a.isA?(s=a.out("array"),r(this,s)):e(this,a):this},not:function(e,r){var n=[];this.list.forEach(function(t){var a=t.not(e,r);n=n.concat(a.list)});var a=this.parent||this;return new t(n,this.world(),a)},if:function(e){for(var r=[],n=0;n<this.list.length;n++)!0===this.list[n].has(e)&&r.push(this.list[n]);var a=this.parent||this;return new t(r,this.world(),a)},ifNo:function(e){for(var r=[],n=0;n<this.list.length;n++)!1===this.list[n].has(e)&&r.push(this.list[n]);var a=this.parent||this;return new t(r,this.world(),a)},has:function(t){for(var e=0;e<this.list.length;e++)if(!0===this.list[e].has(t))return!0;return!1},before:function(e){for(var r=[],n=0;n<this.list.length;n++){var a=this.list[n].matchOne(e);if(a){var i=a[0].index(),o=this.list[n].slice(0,i);0<o.length&&r.push(o)}}var s=this.parent||this;return new t(r,this.world(),s)},after:function(e){for(var r=[],n=0;n<this.list.length;n++){var a=this.list[n].matchOne(e);if(a){var i=a[a.length-1].index(),o=this.list[n].slice(i+1,this.list[n].length);0<o.length&&r.push(o)}}var s=this.parent||this;return new t(r,this.world(),s)}};return i.and=i.match,i.notIf=i.ifNo,i.only=i.if,i.onlyIf=i.if,t.addMethods(t,i),t}},{"../../../terms":165,"../../../terms/match/lib/syntax":175}],195:[function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a=t("../../terms");e.exports=function(t){var e={all:function(){return this.parent},index:function(){return this.list.map(function(t){return t.index()})},wordCount:function(){return this.terms().length},data:function(){return this.list.map(function(t){return t.data()})},map:function(e){var r=this;return this.list.map(function(n,a){var i=new t([n],r.world);return e(i,a)})},forEach:function(e){var r=this;return this.list.forEach(function(n,a){var i=new t([n],r.world);e(i,a)}),this},filter:function(e){var r=this,n=this.list.filter(function(n,a){var i=new t([n],r.world);return e(i,a)});return new t(n,this.world)},reduce:function(e,r){var n=this;return this.list.reduce(function(r,a){var i=new t([a],n.world);return e(r,i)},r)},find:function(e){for(var r=0;r<this.list.length;r++){var n=this.list[r],a=new t([n],this.world);if(e(a))return a}},clone:function(){var e=this.list.map(function(t){return t.clone()});return new t(e,this.world)},term:function(e){var r=this,n=this.list.map(function(t){var n=[],i=t.terms[e];return i&&(n=[i]),new a(n,r.world,r.refText,r.refTerms)});return new t(n,this.world,this.parent)},firstTerm:function(){return this.match("^.")},lastTerm:function(){return this.match(".$")},slice:function(t,e){return this.list=this.list.slice(t,e),this},get:function(e){if(!e&&0!==e||!this.list[e])return new t([],this.world,this.parent);var r=this.list[e];return new t([r],this.world,this.parent)},first:function(e){return e||0===e?new t(this.list.slice(0,e),this.world,this.parent):this.get(0)},last:function(e){if(!e&&0!==e)return this.get(this.list.length-1);var r=this.list.length,n=r-e;return new t(this.list.slice(n,r),this.world,this.parent)},concat:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];"object"===n(e)&&("Text"===e.isA&&e.list&&(this.list=this.list.concat(e.list)),"Terms"===e.isA&&this.list.push(e))}return this},flatten:function(){var e=[];if(this.list.forEach(function(t){e=e.concat(t.terms)}),!e.length)return new t(null,this.world,this.parent);var r=new a(e,this.world,this,null);return new t([r],this.world,this.parent)},canBe:function(t){return this.list.forEach(function(e){e.terms=e.terms.filter(function(e){return e.canBe(t)})}),this},random:function(e){e=e||1;var r=Math.floor(Math.random()*this.list.length),n=this.list.slice(r,r+e);if(n.length<e){var a=e-n.length;r<a&&(a=r),n=n.concat(this.list.slice(0,a))}return new t(n,this.world,this.parent)},setPunctuation:function(t){return this.list.forEach(function(e){return e.setPunctuation(t)}),this},getPunctuation:function(t){return t||0===t?this.list[t]?this.list[t].getPunctuation():"":this.list.map(function(t){return t.getPunctuation()})},offset:function(){return this.out("offset")},text:function(){return this.out("text")}};e.eq=e.get,e.join=e.flatten,t.addMethods(t,e)}},{"../../terms":165}],196:[function(t,e,r){"use strict";var n=t("../../term/methods/normalize/unicode"),a={whitespace:!0,case:!0,numbers:!0,punctuation:!0,unicode:!0,contractions:!0,acronyms:!0,parentheses:!1,possessives:!1,plurals:!1,verbs:!1,honorifics:!1},i={whitespace:function(t){return t.terms().list.forEach(function(t,e){var r=t.terms[0];0<e&&!r.silent_term?r.whitespace.before=" ":0===e&&(r.whitespace.before=""),!(r.whitespace.after="")===r.tags.StartQuotation&&(r.whitespace.before+='"'),!0===r.tags.EndQuotation&&(r.whitespace.after='"'+r.whitespace.after)}),t},case:function(t){return t.list.forEach(function(t){t.terms.forEach(function(e,r){0===r||e.tags.Person||e.tags.Place||e.tags.Organization||t.toLowerCase()})}),t},numbers:function(t){return t.values().toNumber(),t},punctuation:function(t){return t.list.forEach(function(t){if(t.terms.length){t.terms[0]._text=t.terms[0]._text.replace(/^/,"");for(var e=0;e<t.terms.length-1;e++){var r=t.terms[e];r._text=r._text.replace(/[:;,]$/,"")}var n=t.terms[t.terms.length-1];n._text=n._text.replace(/\.+$/,"."),n._text=n._text.replace(/!+$/,"!"),n._text=n._text.replace(/\?+!?$/,"?")}}),t},unicode:function(t){return t.list.forEach(function(t){t.terms.forEach(function(t){t.text=n(t.text)})}),t},contractions:function(t){return t.contractions().expand(),t},acronyms:function(t){return t.acronyms().stripPeriods(),t},possessives:function(t){return t.possessives().strip(),t},parentheses:function(t){return t.parentheses().delete(),t},plurals:function(t){return t.nouns().toSingular(),t},verbs:function(t){return t.verbs().toInfinitive(),t},honorifics:function(t){return t.delete("#Honorific")}};e.exports=function(t){t.prototype.normalize=function(t){var e=this;t=t||{};var r=Object.assign({},a);return Object.keys(t).forEach(function(e){r[e]=t[e]}),Object.keys(r).forEach(function(t){r[t]&&void 0!==i[t]&&(e=i[t](e))}),e}}},{"../../term/methods/normalize/unicode":151}],197:[function(t,e,r){"use strict";var n=t("./topk"),a=t("./offset"),i=t("./indexes"),o=t("../paths").fns,s={text:function(t){return t.list.reduce(function(t,e){return t+e.out("text")},"")},match:function(t){return t.list.reduce(function(t,e){return t+e.out("match")},"")},normal:function(t){return t.list.map(function(t){var e=t.out("normal");if(t.last()){var r=t.getPunctuation();"."!==r&&"!"!==r&&"?"!==r||(e+=r)}return e}).join(" ")},root:function(t){return t.list.map(function(t){return t.out("root")}).join(" ")},offsets:function(t){return a(t)},index:function(t){return i(t)},grid:function(t){return t.list.reduce(function(t,e){return t+e.out("grid")},"")},color:function(t){return t.list.reduce(function(t,e){return t+e.out("color")},"")},array:function(t){return t.list.map(function(t){return t.out("normal")})},csv:function(t){return t.list.map(function(t){return t.out("csv")}).join("\n")},newlines:function(t){return t.list.map(function(t){return t.out("newlines")}).join("\n")},json:function(t){return t.list.reduce(function(t,e){var r=e.terms.map(function(t){return{text:t.text,normal:t.normal,tags:t.tag}});return t.push(r),t},[])},html:function(t){return"<span> "+t.list.reduce(function(t,e){return t+"\n  <span>"+e.terms.reduce(function(t,e){return t+"\n    "+e.out("html")},"")+"\n  </span>"},"")+"\n</span>"},terms:function(t){var e=[];return t.list.forEach(function(t){t.terms.forEach(function(t){e.push({text:t.text,normal:t.normal,tags:Object.keys(t.tags)})})}),e},debug:function(t){return console.log("===="),t.list.forEach(function(t){console.log("   --"),t.debug()}),t},topk:function(t){return n(t)},custom:function(t,e){return t.list.map(function(t){return t.out(e)})}};s.plaintext=s.text,s.normalized=s.normal,s.colors=s.color,s.tags=s.terms,s.offset=s.offsets,s.idexes=s.index,s.frequency=s.topk,s.freq=s.topk,s.arr=s.array,e.exports=function(t){return t.prototype.out=function(t){if("string"==typeof t){if(s[t])return s[t](this)}else if(!0===o.isObject(t))return s.custom(this,t);return s.text(this)},t.prototype.debug=function(){return s.debug(this)},t}},{"../paths":201,"./indexes":198,"./offset":199,"./topk":200}],198:[function(t,e,r){"use strict";e.exports=function(t){var e=[],r={};t.terms().list.forEach(function(t){r[t.terms[0].uid]=!0});var n=0;return t.all().list.forEach(function(t,a){t.terms.forEach(function(t,i){void 0!==r[t.uid]&&e.push({text:t.text,normal:t.normal,term:n,sentence:a,sentenceTerm:i}),n+=1})}),e}},{}],199:[function(t,e,r){"use strict";e.exports=function(t){var e=t.all();return t.list.map(function(t){for(var r=[],n=0;n<t.terms.length;n++)r.push(t.terms[n].normal);var a=function(t){var e=t.terms;if(e.length<=2)return t.out("normal");for(var r=e[0].normal,n=1;n<e.length-1;n++){var a=e[n];r+=a.whitespace.before+a.text+a.whitespace.after}return r+" "+e[t.terms.length-1].normal}(t),i=t.out("text"),o=function(t,e){for(var r=0,n=0;n<t.list.length;n++)for(var a=0;a<t.list[n].terms.length;a++){var i=t.list[n].terms[a];if(i.uid===e.uid)return r;r+=i.whitespace.before.length+i._text.length+i.whitespace.after.length}return null}(e,t.terms[0]),s=o+t.terms[0].whitespace.before.length;return{text:i,normal:t.out("normal"),offset:o,length:i.length,wordStart:s,wordEnd:s+a.length}})}},{}],200:[function(t,e,r){"use strict";e.exports=function(t,e){var r={};t.list.forEach(function(t){var e=t.out("root");r[e]=r[e]||0,r[e]+=1});var n=[];return Object.keys(r).forEach(function(t){n.push({normal:t,count:r[t]})}),n.forEach(function(e){e.percent=parseFloat((e.count/t.list.length*100).toFixed(2))}),n=n.sort(function(t,e){return t.count>e.count?-1:1}),e&&(n=n.splice(0,e)),n}},{}],201:[function(t,e,r){"use strict";e.exports=t("../paths")},{"../paths":205}],202:[function(t,e,r){"use strict";var n=t("./methods");e.exports=function(t){var e={sort:function(e){return(e=(e=e||"alphabetical").toLowerCase())&&"alpha"!==e&&"alphabetical"!==e?"chron"===e||"chronological"===e?n.chron(this,t):"length"===e?n.lengthFn(this,t):"freq"===e||"frequency"===e?n.freq(this,t):"wordcount"===e?n.wordCount(this,t):this:n.alpha(this,t)},reverse:function(){return this.list=this.list.reverse(),this},unique:function(){var t={};return this.list=this.list.filter(function(e){var r=e.out("root");return!t.hasOwnProperty(r)&&(t[r]=!0)}),this}};return t.addMethods(t,e),t}},{"./methods":203}],203:[function(t,e,r){"use strict";var n=function(t){return(t=t.sort(function(t,e){return t.index>e.index?1:t.index===e.index?0:-1})).map(function(t){return t.ts})};r.alpha=function(t){return t.list.sort(function(t,e){if(t===e)return 0;if(t.terms[0]&&e.terms[0]){if(t.terms[0].root>e.terms[0].root)return 1;if(t.terms[0].root<e.terms[0].root)return-1}return t.out("root")>e.out("root")?1:-1}),t},r.chron=function(t){var e=t.list.map(function(t){return{ts:t,index:t.termIndex()}});return t.list=n(e),t},r.lengthFn=function(t){var e=t.list.map(function(t){return{ts:t,index:t.chars()}});return t.list=n(e).reverse(),t},r.wordCount=function(t){var e=t.list.map(function(t){return{ts:t,index:t.length}});return t.list=n(e),t},r.freq=function(t){var e={};t.list.forEach(function(t){var r=t.out("root");e[r]=e[r]||0,e[r]+=1});var r=t.list.map(function(t){return{ts:t,index:-1*(e[t.out("root")]||0)}});return t.list=n(r),t}},{}],204:[function(t,e,r){"use strict";e.exports=function(t){return t.addMethods(t,{splitAfter:function(t,e){var r=[];return this.list.forEach(function(n){n.splitAfter(t,e).forEach(function(t){r.push(t)})}),this.list=r,this},splitBefore:function(t,e){var r=[];return this.list.forEach(function(n){n.splitBefore(t,e).forEach(function(t){r.push(t)})}),this.list=r,this},splitOn:function(t,e){var r=[];return this.list.forEach(function(n){n.splitOn(t,e).forEach(function(t){r.push(t)})}),this.list=r,this}}),t}},{}],205:[function(t,e,r){arguments[4][201][0].apply(r,arguments)},{"../paths":8,dup:201}],206:[function(t,e,r){"use strict";var n=t("../subset/sentences/isQuestion");e.exports=function(t){var e={clauses:function(t){var e=this.splitAfter("#ClauseEnd");return"number"==typeof t&&(e=e.get(t)),e},hashTags:function(t){var e=this.match("#HashTag").terms();return"number"==typeof t&&(e=e.get(t)),e},organizations:function(t){var e=this.splitAfter("#Comma");return e=e.match("#Organization+"),"number"==typeof t&&(e=e.get(t)),e},phoneNumbers:function(t){var e=this.splitAfter("#Comma");return e=e.match("#PhoneNumber+"),"number"==typeof t&&(e=e.get(t)),e},places:function(t){var e=this.splitAfter("#Comma");return e=e.match("#Place+"),"number"==typeof t&&(e=e.get(t)),e},quotations:function(t){var e=this.match("#Quotation+"),r=[];return e.list.forEach(function(t){var e=0,n=null;t.terms.forEach(function(a,i){!0===a.tags.StartQuotation&&(0===e&&(n=i),e+=1),0<e&&!0===a.tags.EndQuotation&&(e-=1),0===e&&null!==n&&(r.push(t.slice(n,i+1)),n=null)}),null!==n&&r.push(t.slice(n,t.terms.length))}),e.list=r,"number"==typeof t&&(e=e.get(t)),e},topics:function(t){var e=this.clauses(),r=e.people();return r.concat(e.places()),r.concat(e.organizations()),(r=r.not(["someone","man","woman","mother","brother","sister","father"])).sort("chronological"),"number"==typeof t&&(r=r.get(t)),r},urls:function(t){var e=this.match("#Url");return"number"==typeof t&&(e=e.get(t)),e},questions:function(e){var r=this.all();"number"==typeof e&&(r=r.get(e));var a=r.list.filter(function(t){return n(t)});return new t(a,this.world,this.parent)},statements:function(e){var r=this.all();"number"==typeof e&&(r=r.get(e));var a=r.list.filter(function(t){return!1===n(t)});return new t(a,this.world,this.parent)},parentheses:function(t){var e=this.match("#Parentheses+");return e=e.splitAfter("#EndBracket"),"number"==typeof t&&(e=e.get(t)),e}};return Object.keys(e).forEach(function(r){t.prototype[r]=e[r]}),t}},{"../subset/sentences/isQuestion":53}],207:[function(t,e,r){"use strict";var n=Object.keys(t("../world/more-data/abbreviations")),a=new RegExp("\\b("+n.join("|")+")[.!?-] *$","i"),i=/[ .][A-Z]\.? *$/i,o=/(?:\u2026|\.{2,}) *$/,s=/((?:\r?\n|\r)+)/,u=/(\S.+?[.!?\u203D\u2E18\u203C\u2047-\u2049])(?=\s+|$)/g,l=/[a-z0-9\u0000-\u007F]/i,c=/\S/;e.exports=function(t){t=t||"";var e=[],r=[];if(!(t=String(t))||"string"!=typeof t||!1===c.test(t))return e;for(var n=function(e){for(var r=[],n=t.split(s),a=0;a<n.length;a++)for(var i=n[a].split(u),o=0;o<i.length;o++)r.push(i[o]);return r}(),h=0;h<n.length;h++){var f=n[h];if(void 0!==f&&""!==f){if(!1===c.test(f)){if(r[r.length-1]){r[r.length-1]+=f;continue}if(n[h+1]){n[h+1]=f+n[h+1];continue}}r.push(f)}}for(var m=0;m<r.length;m++){var d=r[m];r[m+1]&&l.test(d)&&(a.test(d)||i.test(d)||o.test(d))?r[m+1]=d+(r[m+1]||""):d&&0<d.length&&l.test(d)&&(e.push(d),r[m]="")}return 0===e.length?[t]:e}},{"../world/more-data/abbreviations":216}],208:[function(t,e,r){"use strict"
;e.exports='{"words":"Comparativebetter|Superlativeearlier|PresentTensesounds|Valuea few|Nounautumn,daylight9eom,here,no doubt,one d8s5t2w0yesterd8;eek0int5;d6end;mr1o0;d4morrow;!w;ome 1tandard3umm0;er;d0point;ay; time|Copulaa1is,w0;as,ere;m,re|Conditionif,unless|PastTensebe2came,d1had,mea0sa1taken,we0;nt;id;en,gan|Gerundaccord0be0develop0go0result0stain0;ing|Negativen0;ever,o0;!n,t|QuestionWordhow3wh0;at,e1ich,o0y;!m,se;n,re; come,\'s|Singulara05bYcTdPeNfKgJhFici09jel06kitty,lEmCnBoAp7question mark,r6s4t1us 0;dollUstV; rex,a1h0ic,ragedy,v show;ere,i06;l02x return;ky,tu0uper bowl,yst05;dIff;alZi02oom;a1robl02u0;dCrpo8;rt,tE;cean,thers;othiXumbG;ayfTeeNo0;del,nopoS;iRunch;ead start,o0;lPme1u0;se;! run;adfMirlIlaci8od,rand slam,ulM;amiLly,olLr1un0;diN;iGosD;conomy,gg,ner3v0xampG;ent;eath,inn2o0ragonfG;cument6g0iFlFor;gy;er;an3eiliFhocol2i0ottage,redit card;ty,vil w0;ar;ate;ary;ankiAel7les9o2reakfast,u0;n0tterf6;ti8;dy,tt2y0;fri0;end;le;d1l0noma0;ly; homin2verti0;si0;ng;em|Infinitive0:6Y;1:7C;2:7A;3:79;4:74;5:5F;6:6D;7:6L;8:78;9:6W;A:73;B:7D;C:76;D:6R;E:68;F:60;a6Qb69c5Bd4Je43f3Qg3Jh3Ci2Zj2Xk2Tl2Km2Bn28o24p1Pques3Rr0Xs05tWuRvOwHyG;awn,ield;aJe24hist7iIoGre6H;nd0rG;k,ry;n,pe,sh,th0;lk,nHrGsh,tDve;n,raB;d0t;aHiGo8;ew,sA;l6Rry;nHpGr3se;gra4Wli49;dGi8lo65;erGo;go,mi5H;aNeMhKie,oJrHuGwi4;ne,rn;aGe0Ui60u4y;de,in,nsf0p,v5O;r37uD;ank,rG;eat2Vi2;nd,st;ke,lk,rg5Os8;a06c03eZhWi4Jkip,lVmUneTo56pQtJuGwitD;bmAck,ff0gge4ppHrGspe6;ge,pri1rou53vi2;ly,o3D;aLeKoJrHuG;dy,mb7;aEeGi2;ngth2Lss,tD;p,re;m,p;in,ke,r0Yy;iHlaFoil,rinG;g,k7;n,t;ak,e3E;aFe22i7o5B;am,e1Qip;aHiv0oG;ck,ut;re,ve;arDeIle6nHr2tG;!t7;d,se;k,m;aHo5rG;atDew;le,re;il,ve;a05eIisk,oHuG;b,in,le,n,sh;am,ll;a01cZdu9fYgXje6lUmTnt,pQquPsKtJvGwa5V;eGiew,o4U;al,l,rG;se,t;aEi5u42;eJi4oItG;!o5rG;i6uc20;l2rt;mb7nt,r2;e4i5;air,eHlGo40reseB;a9y;at;aEemb0i3Wo2;aHeGi2y;a1nt;te,x;a5Dr4A;act1Yer,le6u1;a12ei2k5PoGyc7;gni2Cnci7rd;ch,li2Bs5N;i1nG;ge,k;aTerSiRlPoNrIuG;b21ll,mp,rGsh,t;cha1s4Q;ai1eJiBoG;cHdu9greChibAmi1te4vG;e,i2U;eClaim;di6pa5ss,veB;iBp,rtr43sGur;e,t;a3RuG;g,n3;ck,le;fo32mAsi4;ck,iBrt4Mss,u1y;bIccur,ff0pera8utweHverGwe;co47lap,ta3Qu1whelm;igh;ser2taE;eHotG;e,i9;ed,gle6;aLeKiIoHuG;ltip3Frd0;nit14ve;nGrr13;d,g7us;asu5lt,n0Qr3ssa3;intaEke d40na3rHtG;ch,t0;ch,k39ry;aMeLiIoGu1F;aGck,ok,ve;d,n;ft,ke,mAnHstGve;!en;e,k;a2Gc0Ht;b0Qck,uG;gh,nD;eIiHnoG;ck,w;ck,ll,ss;ep;am,oEuG;d3mp;gno5mQnGss3I;cOdica8flu0NhNsKtIvG;eGol2;nt,st;erGrodu9;a6fe5;i4tG;aGru6;ll;abAibA;lu1Fr1D;agi22pG;lemeBo20ro2;aKeIi5oHuG;nt,rry;ld fa4n03pe,st;aGlp;d,t;nd7ppGrm,te;en;aLet,loCoKrIuG;arGeCi14;ant39d;aGip,ow,umb7;b,sp;es,ve1I;in,th0ze;aQeaPiNlLoIracHuncG;ti3I;tu5;cus,lHrG;ce,eca4m,s30;d,l22;aFoG;at,od,w;gu5lGniFx;e,l;r,tu5;il,ll,vG;or;a13cho,dAle6mSnPstNvalua8xG;a0AcLerKi4pGte16;a15eHlaEoGreC;rt,se;ct,riG;en9;ci1t;el,han3;abGima8;liF;ab7couXdHfor9ga3han9j03riDsu5t0vG;isi2Vy;!u5;body,er3pG;hasiGow0;ze;a06eUiMoLrHuG;mp;aIeHiGop;ft;am,ss;g,in;!d3ubt;e,ff0p,re6sHvG;e,iXor9;aJcGli13miCpl18tinguiF;oGuC;uGv0;ra3;gr1YppG;ear,ro2;al,cNem,fLliv0ma0Cny,pKsHterG;mi0D;cribe,er2iHtrG;oy;gn,re;a08e07i6osA;eGi08y;at,ct;iIlHrG;ea1;a5i04;de;ma3n9re,te;a0Ae09h06i8l03oJrGut;aHeGoCuFy;a8dA;ck,ve;llYmSnHok,py,uGv0;gh,nt;cePdu6fMsKtIvG;eGin9;rt,y;aEin0XrG;a4ibu8ol;iGtitu8;d0st;iHoGroB;rm;gu5rm;rn;biKe,foJmaIpG;a5laE;re;nd;rt;ne;ap1e6;aHiGo1;ng,p;im,w;aHeG;at,ck,w;llen3n3r3se;a1nt0;ll,ncHrGt0u1;e,ry;el;aUeQloPoNrKuG;dgIlHrG;n,y;ly;et;aHuF;sh;ke;a4mb,o4rrGth0un9;ow;ck;ar,coSgElHnefAtrG;ay;ie2ong;in;nGse;!g;band0Jc0Bd06ffo05gr04id,l01mu1nYppTrQsKttGvoid,waA;acIeHra6;ct;m0Fnd;h,k;k,sG;eIiHocia8uG;me;gn,st;mb7rt;le;chHgGri2;ue;!i2;eaJlIroG;aDve;ch;aud,y;l,r;noun9sw0tG;icipa8;ce;lHt0;er;e3ow;ee;rd;aRdIju4mAoR;it;st;!reC;ss;cJhie2knowled3tiva8;te;ge;ve;eIouBu1;se;nt;pt;on|ActoraJbGcFdCengineIfAgardenIh9instructPjournalLlawyIm8nurse,opeOp5r3s1t0;echnCherapK;ailNcientJoldiGu0;pervKrgeon;e0oofE;ceptionGsearC;hotographClumbColi1r0sychologF;actitionBogrammB;cem6t5;echanic,inist9us4;airdress8ousekeep8;arm7ire0;fight6m2;eputy,iet0;ici0;an;arpent2lerk;ricklay1ut0;ch0;er;ccoun6d2ge7r0ssis6ttenda7;chitect,t0;ist;minist1v0;is1;rat0;or;ta0;nt|HonorificaObrigadiNcHdGexcellency,fiBking,liDmaAofficNp6queen,r3s0taoiseach,vice5;e0ultJ;c0rgeaC;ond liAretary;abbi,e0;ar0verend; adJ;astFr0;eside6i0ofessE;me ministEnce0;!ss;gistrate,r4yB;eld mar3rst l0;ady,i0;eutena0;nt;shA;oct5utchess;aptain,hance3o0;lonel,mmand4ngress0unci2;m0wom0;an;ll0;or;er;d0yatullah;mir0;al|SportsTeam0:1M;1:1T;2:1U;a1Rb1Dc0Zd0Qfc dallas,g0Nhouston 0Mindiana0Ljacksonville jagua0k0Il0Fm02newVoRpKqueens parkJrIsAt5utah jazz,vancouver whitecaps,w3yY;ashington 3est ham0Xh16;natio21redski1wizar12;ampa bay 6e5o3;ronto 3ttenham hotspur;blu1Hrapto0;nnessee tita1xasD;buccanee0ra1G;a7eattle 5heffield0Qporting kansas13t3;. louis 3oke12;c1Srams;mari02s3;eah1IounI;cramento Sn 3;antonio spu0diego 3francisco gi0Bjose earthquak2;char0EpaB;eal salt lake,o04; ran0C;a8h5ittsburgh 4ortland t3;imbe0rail blaze0;pirat2steele0;il3oenix su1;adelphia 3li2;eagl2philNunE;dr2;akland 4klahoma city thunder,r3;i10lando magic;athle0Trai3;de0; 3castle05;england 6orleans 5york 3;city fc,giUje0Lkn02me0Lred bul19y3;anke2;pelica1sain0J;patrio0Irevolut3;ion;aBe9i3ontreal impact;ami 7lwaukee b6nnesota 3;t4u0Rvi3;kings;imberwolv2wi1;re0Cuc0W;dolphi1heat,marli1;mphis grizz3ts;li2;nchester 5r3vN;i3li1;ne0;c00u0H;a4eicesterYos angeles 3;clippe0dodFlaA; galaxy,ke0;ansas city 3nH;chiefs,ro3;ya0M; pace0polis colX;astr0Edynamo,rockeWtexa1;i4olden state warrio0reen bay pac3;ke0;anT;.c.Aallas 7e3i0Cod5;nver 5troit 3;lio1pisto1ti3;ge0;bronc06nuggeO;cowboUmav3;er3;ic06; uX;arCelNh8incinnati 6leveland 5ol3;orado r3umbus crew sc;api5ocki2;brow1cavalie0india1;benga03re3;ds;arlotte horCicago 3;b4cubs,fire,wh3;iteE;ea0ulY;di3olina panthe0;ff3naW; c3;ity;altimore ElAoston 7r3uffalo bilT;av2e5ooklyn 3;ne3;ts;we0;cel4red3; sox;tics;ackburn rove0u3;e ja3;ys;rs;ori3rave1;ol2;rizona Ast8tlanta 3;brav2falco1h4u3;nited;aw9;ns;es;on villa,r3;os;c5di3;amondbac3;ks;ardi3;na3;ls|Uncountable0:1C;a1Hb1Bc12e0Wf0Qg0Mh0Gi0Dj0Cknowled1Gl07mYnXoWpRrOsCt8vi7w1;a5ea0Ai4o1;o2rld1;! seI;d,l;ldlife,ne;rmth,t0;neg0Xol08;e3hund0ime,oothpaste,r1una;affRou1;ble,sers,t;a,nnis;aAcene07e9h8il7now,o6p3te2u1;g0Rnshi0L;am,el;ace2e1;ciOed;!c12;ap,cc0ft0B;k,v0;eep,opp0O;riJ;d07fe0Wl1nd;m0Qt;ain,e1i0W;c1laxa0Csearch;ogni0Brea0B;a4e2hys0Elast9o1ress00;rk,w0;a1pp0trol;ce,nR;p0tiK;il,xygen;ews,oi0C;a7ea5i4o3u1;mps,s1;ic;nHo08;lk,st;sl1t;es;chine1il,themat00; learn02ry;aught0e3i2u1;ck,g07;ghtnZqu0CteratI;a1isH;th0;ewel7usti08;ce,mp1nformaOtself;ati1ortan06;en05;a4isto3o1;ck1mework,n1spitali01;ey;ry;ir,lib1ppi9;ut;o2r1um,ymnastJ;a7ound;l1ssip;d,f;i5lour,o2ruit,urnit1;ure;od,rgive1wl;ne1;ss;c6sh;conom9duca5lectriciMn3quip4th9very1;body,o1thB;ne;joy1tertain1;ment;tiC;a8elcius,h4iv3loth6o1urrency;al,ffee,ld w1nfusiAttA;ar;ics;aos,e1;e2w1;ing;se;ke,sh;a3eef,is2lood,read,utt0;er;on;g1ss;ga1;ge;c4dvi3irc2mnes1rt;ty;raft;ce;id|Unit0:17;a12b10c0Md0Le0Jf0Fg0Bh08in07joule0k01lZmOnNoMpIqHsqCt7volts,w6y4z321;g,s;c,f,n;b,e2;a0Lb,d0Rears old,o1;tt0F;att0b;able4b3e2on1sp;!ne0;a2r0B;!l,sp;spo03; ft,uare 1;c0Gd0Ff3i0Dkilo0Hm1ya0C;e0Kil1;e0li0F;eet0o0B;t,uart0;a3e2i1ou0Nt;c0Knt0;rcent,t00;!scals;hms,uVz;an0GewtR;/s,b,e7g,i3l,m2p1,;h,s;!;!/h,cro3l1;e1li05;! DsC;g05s0A;gPter1;! 2s1;! 1;per second;b,iZm,u1x;men0x0;b,elvin0g,ilo2m1nQ;!/h,ph,;byYgWmeter1;! 2s1;! 1;per hour;,;e1g,z;ct1rtz0;aWogP;al2b,ig9ra1;in0m0;!l1;on0;a3emtOl1tG; oz,uid ou1;nce0;hrenheit0rad0;b,x1;abyH;eciCg,l,mA;arat0eAg,l,m9oulomb0u1;bic 1p0;c5d4fo3i2meAya1;rd0;nch0;ot0;eci2;enti1;me4;!,;lsius0nti1;g2li1me1;ter0;ram0;bl,y1;te0;c4tt1;os1;eco1;nd0;re0;!s|Pronoun\'em,elle,h4i3me,ourselves,she5th1us,we,you0;!rself;e0ou;m,y;!l,t;e0im;!\'s|Organization0:44;a39b2Qc2Ad22e1Yf1Ug1Mh1Hi1Ej1Ak18l14m0Tn0Go0Dp07qu06rZsStFuBv8w3y1;amaha,m0You1w0Y;gov,tu2R;a3e1orld trade organizati3Z;lls fargo,st1;fie23inghou17;l1rner br3B;-m12gree30l street journ25m12;an halNeriz3Uisa,o1;dafo2Gl1;kswagLvo;bs,kip,n2ps,s1;a tod2Qps;es33i1;lev2Wted natio2T; mobi2Jaco bePd bMeAgi frida9h3im horto2Smz,o1witt2V;shiba,y1;ota,s r Y;e 1in lizzy;b3carpen31daily ma2Vguess w2holli0rolling st1Ns1w2;mashing pumpki2Nuprem0;ho;ea1lack eyed pe3Dyrds;ch bo1tl0;ys;l2s1;co,la m13;efoni08us;a6e4ieme2Fnp,o2pice gir5ta1ubaru;rbucks,to2L;ny,undgard1;en;a2Px pisto1;ls;few24insbu25msu1W;.e.m.,adiohead,b6e3oyal 1yan2V;b1dutch she4;ank;/max,aders dige1Ed 1vl30;bu1c1Thot chili peppe2Ilobst27;ll;c,s;ant2Tizno2D;an5bs,e3fiz23hilip morrBi2r1;emier25octer & gamb1Qudenti14;nk floyd,zza hut;psi26tro1uge09;br2Ochina,n2O; 2ason1Wda2E;ld navy,pec,range juli2xf1;am;us;aAb9e5fl,h4i3o1sa,wa;kia,tre dame,vart1;is;ke,ntendo,ss0L;l,s;c,stl3tflix,w1; 1sweek;kids on the block,york09;e,;a,c;nd1Rs2t1;ional aca2Co,we0P;a,cYd0N;aAcdonald9e5i3lb,o1tv,yspace;b1Knsanto,ody blu0t1;ley crue,or0N;crosoft,t1;as,subisO;dica3rcedes2talli1;ca;!-benz;id,re;\'s,s;c\'s milk,tt11z1V;\'ore08a3e1g,ittle caesa1H;novo,x1;is,mark; pres5-z-boy,bour party;atv,fc,kk,m1od1H;art;iffy lu0Jo3pmorgan1sa;! cha1;se;hnson & johns1Py d1O;bm,hop,n1tv;g,te1;l,rpol; & m,asbro,ewlett-packaSi3o1sbc,yundai;me dep1n1G;ot;tac1zbollah;hi;eneral 6hq,l5mb,o2reen d0Gu1;cci,ns n ros0;ldman sachs,o1;dye1g09;ar;axo smith kliYencore;electr0Gm1;oto0S;a3bi,da,edex,i1leetwood mac,oFrito-l08;at,nancial1restoU; tim0;cebook,nnie mae;b04sa,u3xxon1; m1m1;ob0E;!rosceptics;aiml08e5isney,o3u1;nkin donuts,po0Tran dur1;an;j,w j1;on0;a,f leppa2ll,peche mode,r spiegXstiny\'s chi1;ld;rd;aEbc,hBi9nn,o3r1;aigsli5eedence clearwater reviv1ossra03;al;ca c5l4m1o08st03;ca2p1;aq;st;dplLgate;ola;a,sco1tigroup;! systems;ev2i1;ck fil-a,na daily;r0Fy;dbury,pital o1rl\'s jr;ne;aFbc,eBf9l5mw,ni,o1p,rexiteeV;ei3mbardiJston 1;glo1pizza;be;ng;ack & deckFo2ue c1;roW;ckbuster video,omingda1;le; g1g1;oodriM;cht3e ge0n & jer2rkshire hathaw1;ay;ryG;el;nana republ3s1xt5y5;f,kin robbi1;ns;ic;bWcRdidQerosmith,ig,lKmEnheuser-busDol,pple9r6s3t&t,v2y1;er;is,on;hland1sociated F; o1;il;by4g2m1;co;os; compu2bee1;\'s;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 4catel2t1;air;!-luce1;nt;jazeera,qae1;da;as;/dc,a3er,t1;ivisi1;on;demy of scienc0;es;ba,c|Demonym0:16;1:13;a0Wb0Nc0Cd0Ae09f07g04h02iYjVkTlPmLnIomHpDqatari,rBs7t5u4v3wel0Rz2;am0Fimbabwe0;enezuel0ietnam0H;g9krai1;aiwThai,rinida0Iu2;ni0Qrkmen;a4cot0Ke3ingapoOlovak,oma0Tpa05udRw2y0X;edi0Kiss;negal0Br08;mo0uU;o6us0Lw2;and0;a3eru0Hhilipp0Po2;li0Ertugu06;kist3lesti1na2raguay0;ma1;ani;amiZi2orweP;caragu0geri2;an,en;a3ex0Mo2;ngo0Erocc0;cedo1la2;gasy,y08;a4eb9i2;b2thua1;e0Dy0;o,t02;azakh,eny0o2uwaiti;re0;a2orda1;ma0Bp2;anN;celandic,nd4r2sraeli,ta02vo06;a2iT;ni0qi;i0oneV;aiDin2ondur0unN;di;amDe2hanai0reek,uatemal0;or2rm0;gi0;i2ren7;lipino,n4;cuadoVgyp6ngliJsto1thiopi0urope0;a2ominXut4;niH;a9h6o4roa3ub0ze2;ch;ti0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el8o6r3ul2;gaG;aziBi2;ti2;sh;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;gent2me1;ine;ba1ge2;ri0;ni0;gh0r2;ic0;an|Regiona20b1Sc1Id1Des1Cf19g13h10i0Xj0Vk0Tl0Qm0FnZoXpSqPrMsDtAut9v5w2y0zacatec22;o05u0;cat18kZ;a0est vir4isconsin,yomi14;rwick1Qshington0;! dc;er2i0;cto1Ir0;gin1R;acruz,mont;ah,tar pradesh;a1e0laxca1Cusca9;nnessee,x1Q;bas0Jmaulip1PsmI;a5i3o1taf0Nu0ylh12;ffUrrZs0X;me0Zno19uth 0;cRdQ;ber1Hc0naloa;hu0Rily;n1skatchew0Qxo0;ny; luis potosi,ta catari1H;a0hode6;j0ngp01;asth0Lshahi;inghai,u0;e0intana roo;bec,ensVreta0D;ara3e1rince edward0; isT;i,nnsylv0rnambu01;an13;!na;axa0Mdisha,h0klaho1Antar0reg3x03;io;ayarit,eAo2u0;evo le0nav0K;on;r0tt0Qva scot0W;f5mandy,th0; 0ampton0P;c2d1yo0;rk0N;ako0X;aroli0U;olk;bras0Wva00w0; 1foundland0;! and labrador;brunswick,hamp0Gjers0mexiIyork state;ey;a5i1o0;nta0Mrelos;ch2dlanAn1ss0;issippi,ouri;as geraFneso0L;igPoacP;dhya,harasht03ine,ni2r0ssachusetts;anhao,y0;land;p0toba;ur;anca03e0incoln03ouis7;e0iG;ds;a0entucky,hul09;ns07rnata0Cshmir;alis0iangxi;co;daho,llino1nd0owa;ia04;is;a1ert0idalDun9;fordS;mpRwaii;ansu,eorgVlou4u0;an1erre0izhou,jarat;ro;ajuato,gdo0;ng;cesterL;lori1uji0;an;da;sex;e3o1uran0;go;rs0;et;lawaDrbyC;a7ea6hi5o0umbrG;ahui3l2nnectic1rsi0ventry;ca;ut;iLorado;la;apDhuahua;ra;l7m0;bridge2peche;a4r3uck0;ingham0;shi0;re;emen,itish columb2;h1ja cal0sque,var1;iforn0;ia;guascalientes,l3r0;izo1kans0;as;na;a1ber0;ta;ba1s0;ka;ma|PossessiveanyAh5its,m3noCo1sometBthe0yo1;ir1mselves;ur0;!s;i8y0;!se4;er1i0;mse2s;!s0;!e0;lf;o1t0;hing;ne|Currency$,aud,bRcPdKeurJfIgbp,hkd,inr,jpy,kGlEp8r7s3usd,x2y1z0,,,,,,,,,,,;lotyR;en,uanQ;af,of;h0t5;e0il5;k0q0;elL;iel,oubleKp,upeeK;e2ound st0;er0;lingH;n0soG;ceFn0;ies,y;e0i7;i,mpi6;n,r0wanzaByatB;!onaAw;ori7ranc9t;!o8;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;ad,e0ny;nt1;aht,itcoin0;!s|Country0:38;1:2L;a2Wb2Dc21d1Xe1Rf1Lg1Bh19i13j11k0Zl0Um0Gn05om3CpZqat1JrXsKtCu6v4wal3yemTz2;a24imbabwe;es,lis and futu2X;a2enezue31ietnam;nuatu,tican city;.5gTkraiZnited 3ruXs2zbeE;a,sr;arab emirat0Kkingdom,states2;! of am2X;k.,s.2; 27a.;a7haBimor-les0Bo6rinidad4u2;nis0rk2valu;ey,me2Xs and caic1T; and 2-2;toba1J;go,kel0Ynga;iw2Vji2nz2R;ki2T;aCcotl1eBi8lov7o5pa2Bri lanka,u4w2yr0;az2ed9itzerl1;il1;d2Qriname;lomon1Vmal0uth 2;afr2IkLsud2O;ak0en0;erra leoEn2;gapo1Wt maart2;en;negKrb0ychellY;int 2moa,n marino,udi arab0;hele24luc0mart1Z;epublic of ir0Com2Cuss0w2;an25;a3eHhilippinTitcairn1Ko2uerto riM;l1rtugE;ki2Bl3nama,pua new0Tra2;gu6;au,esti2;ne;aAe8i6or2;folk1Gth3w2;ay; k2ern mariana1B;or0M;caragua,ger2ue;!ia;p2ther18w zeal1;al;mib0u2;ru;a6exi5icro09o2yanm04;ldova,n2roc4zamb9;a3gol0t2;enegro,serrat;co;c9dagascZl6r4urit3yot2;te;an0i14;shall0Vtin2;ique;a3div2i,ta;es;wi,ys0;ao,ed00;a5e4i2uxembourg;b2echtenste10thu1E;er0ya;ban0Gsotho;os,tv0;azakh1De2iriba02osovo,uwait,yrgyz1D;eling0Jnya;a2erF;ma15p1B;c6nd5r3s2taly,vory coast;le of m19rael;a2el1;n,q;ia,oI;el1;aiSon2ungary;dur0Mg kong;aAermany,ha0Pibralt9re7u2;a5ern4inea2ya0O;!-biss2;au;sey;deloupe,m,tema0P;e2na0M;ce,nl1;ar;bTmb0;a6i5r2;ance,ench 2;guia0Dpoly2;nes0;ji,nl1;lklandTroeT;ast tim6cu5gypt,l salv5ngl1quatorial3ritr4st2thiop0;on0; guin2;ea;ad2;or;enmark,jibou4ominica3r con2;go;!n B;ti;aAentral african 9h7o4roat0u3yprQzech2; 8ia;ba,racao;c3lo2morPngo-brazzaville,okFsta r03te d\'ivoiK;mb0;osD;i2ristmasF;le,na;republic;m2naTpe verde,yman9;bod0ero2;on;aFeChut00o8r4u2;lgar0r2;kina faso,ma,undi;azil,itish 2unei;virgin2; is2;lands;liv0nai4snia and herzegoviGtswaGuvet2; isl1;and;re;l2n7rmuF;ar2gium,ize;us;h3ngladesh,rbad2;os;am3ra2;in;as;fghaFlCmAn5r3ustr2zerbaijH;al0ia;genti2men0uba;na;dorra,g4t2;arct6igua and barbu2;da;o2uil2;la;er2;ica;b2ger0;an0;ia;ni2;st2;an|Citya2Wb26c1Wd1Re1Qf1Og1Ih1Ai18jakar2Hk0Zl0Tm0Gn0Co0ApZquiYrVsLtCuBv8w3y1z0;agreb,uri1Z;ang1Te0okohama;katerin1Hrev34;ars3e2i0rocl3;ckl0Vn0;nipeg,terth0W;llingt1Oxford;aw;a1i0;en2Hlni2Z;lenc2Uncouv0Gr2G;lan bat0Dtrecht;a6bilisi,e5he4i3o2rondheim,u0;nVr0;in,ku;kyo,ronIulouC;anj23l13miso2Jra2A; haJssaloni0X;gucigalpa,hr2Ol av0L;i0llinn,mpe2Bngi07rtu;chu22n2MpT;a3e2h1kopje,t0ydney;ockholm,uttga12;angh1Fenzh1X;o0KvZ;int peters0Ul3n0ppo1F; 0ti1B;jo0salv2;se;v0z0Q;adU;eykjavik,i1o0;me,t25;ga,o de janei17;to;a8e6h5i4o2r0ueb1Qyongya1N;a0etor24;gue;rt0zn24; elizabe3o;ls1Grae24;iladelph1Znom pe07oenix;r0tah tik19;th;lerJr0tr10;is;dessa,s0ttawa;a1Hlo;a2ew 0is;delTtaip0york;ei;goya,nt0Upl0Uv1R;a5e4i3o1u0;mb0Lni0I;nt0scH;evideo,real;l1Mn01skolc;delln,lbour0S;drid,l5n3r0;ib1se0;ille;or;chest0dalWi0Z;er;mo;a4i1o0vAy01;nd00s angel0F;ege,ma0nz,sbZverpo1;!ss0;ol; pla0Iusan0F;a5hark4i3laipeda,o1rak0uala lump2;ow;be,pavog0sice;ur;ev,ng8;iv;b3mpa0Kndy,ohsiu0Hra0un03;c0j;hi;ncheMstanb0zmir;ul;a5e3o0; chi mi1ms,u0;stI;nh;lsin0rakliG;ki;ifa,m0noi,va0A;bu0SiltD;alw4dan3en2hent,iza,othen1raz,ua0;dalaj0Gngzhou;bu0P;eUoa;sk;ay;es,rankfu0;rt;dmont4indhovU;a1ha01oha,u0;blRrb0Eshanbe;e0kar,masc0FugavpiJ;gu,je0;on;a7ebu,h2o0raioJuriti01;lo0nstanJpenhagNrk;gFmbo;enn3i1ristchur0;ch;ang m1c0ttagoL;ago;ai;i0lgary,pe town,rac4;ro;aHeBirminghWogoAr5u0;char3dap3enos air2r0sZ;g0sa;as;es;est;a2isba1usse0;ls;ne;silPtisla0;va;ta;i3lgrade,r0;g1l0n;in;en;ji0rut;ng;ku,n3r0sel;celo1ranquil0;la;na;g1ja lu0;ka;alo0kok;re;aBb9hmedabad,l7m4n2qa1sh0thens,uckland;dod,gabat;ba;k0twerp;ara;m5s0;terd0;am;exandr0maty;ia;idj0u dhabi;an;lbo1rh0;us;rg|PlaceaMbKcIdHeFfEgBhAi9jfk,kul,l7m5new eng4ord,p2s1the 0upJyyz;bronx,hamptons;fo,oho,under2yd;acifMek,h0;l,x;land;a0co,idDuc;libu,nhattK;a0gw,hr;s,x;ax,cn,ndianGst;arlem,kg,nd;ay village,re0;at 0enwich;britain,lak2;co,ra;urope,verglad0;es;en,fw,own1xb;dg,gk,hina0lt;town;cn,e0kk,rooklyn;l air,verly hills;frica,m5ntar1r1sia,tl0;!ant1;ct0;ic0; oce0;an;ericas,s|FemaleName0:G0;1:G4;2:FT;3:FF;4:FE;5:FU;6:ER;7:GH;8:F1;9:ET;A:GD;B:E7;C:GA;D:FQ;E:FN;F:EI;G:C8;aE4bD6cB9dAJe9Hf92g8Ih85i7Uj6Wk61l4Pm3An2Vo2Sp2Hqu2Fr1Ps0Rt05ursu9vVwPyMzH;aKeIoH;e,la,ra;lHna;da,ma;da,ra;as7GeIol1UvH;et6onBA;le0sen3;an8endBPhiB5iH;lJnH;if3BniHo0;e,f3A;a,helmi0lHma;a,ow;aNeKiH;cIviH;an9YenG4;kD1tor3;da,l8Wnus,rH;a,nHoniD4;a,iDE;leHnesEF;nDOrH;i1y;aTeQhOiNoKrHu9y4;acG6iHu0F;c3na,sH;h9Nta;nIrH;a,i;i9Kya;a5KffaCIna,s5;al3eHomasi0;a,l8Ho6Zres1;g7Vo6YrIssH;!a,ie;eFi,ri7;bOliNmLnJrIs5tHwa0;ia0um;a,yn;iHya;a,ka,s5;a4e4iHmCCra;!ka;a,t5;at5it5;a06carlet2Ze05hViTkye,oRtNuIyH;bFMlvi1;e,sIzH;an2Uet6ie,y;anHi7;!a,e,nH;aEe;aJeH;fHl3EphH;an2;cFBr73;f3nHphi1;d4ia,ja,ya;er4lv3mon1nHobh76;dy;aLeHirlBNo0y9;ba,e0i9lJrH;iHrBRyl;!d71;ia,lBX;ki4nJrIu0w0yH;la,na;i,leAon,ron;a,da,ia,nHon;a,on;l60re0;bNdMi8lLmJndIrHs5vannaE;aEi0;ra,y;aHi4;nt5ra;lBPome;e,ie;in1ri0;a03eYhWiUoIuH;by,thBM;bRcQlPnOsIwe0xH;an95ie,y;aIeHie,lC;ann7ll1marBHtB;!lHnn1;iHyn;e,nH;a,d7X;da,i,na;an8;hel55io;bin,erByn;a,cHkki,na,ta;helC2ki;ea,iannE0oH;da,n13;an0bJgi0i0nHta,y0;aHee;!e,ta;a,eH;cATkaE;chHe,i0mo0n5FquCGvDy0;aCFelHi8;!e,le;een2iH;a0nn;aNeMhKoJrH;iHudenAX;scil1Uyamva8;lly,rt3;ilome0oebe,ylH;is,lis;arl,ggy,nelope,r9t4;ige,m0Fn4Po9rvaBDtIulH;a,et6in1;ricHsy,tA9;a,e,ia;ctav3deIf86lHph86;a,ga,iv3;l3t6;aReQiKoHy9;eIrH;aEeDma;ll1mi;aLcJkHla,na,s5ta;iHki;!ta;hoB4k8ColH;a,eBJ;!mh;l7Una,risF;dJi5PnIo23taH;li1s5;cy,et6;eAiCQ;a01ckenz2eViLoIrignayani,uriBIyrH;a,na,tAV;i4ll9ZnH;a,iH;ca,ka,qB7;a,chPkaOlKmi,nJrHtzi;aHiam;!n8;a,dy,erva,h,n2;a,dJi9LlH;iHy;cent,e;red;!e9;ae9el3I;ag4LgLi,lIrH;edi62isFyl;an2iHliF;nHsAP;a,da;!an,han;b09c9Gd07e,g05i04l02n00rLtKuIv6TxGyHz2;a,bell,ra;de,rH;a,eD;h77il8t2;a,cTgPiKjor2l6Jn2s5tJyH;!aHbe5RjaAlou;m,n9V;a,ha,i0;!aJbAOeIja,lCna,sHt54;!a,ol,sa;!l07;!h,m,nH;!a,e,n1;arJeIie,oHr3Lueri6;!t;!ry;et3JiB;elHi62y;a,l1;dHon,ue9;akranBy;iHlo97;a,ka,n8;a,re,s2;daHg2;!l2Y;alCd2elHge,isBJon0;eiAin1yn;el,le;a0Je09iXoRuLyH;d3la,nH;!a,dIe9VnHsAT;!a,e9U;a,sAR;aB4cKelJiFlIna,pHz;e,iB;a,u;a,la;iHy;a2Ce,l27n8;is,l1IrItt2uH;el9is1;aJeIi7na,rH;aGi7;lei,n1tB;!in1;aRbQd3lMnJsIv3zH;!a,be4Let6z2;a,et6;a,dH;a,sHy;ay,ey,i,y;a,iaJlH;iHy;a8Je;!n4G;b7Verty;!n5T;aOda,e0iMla,nLoJslAUtHx2;iHt2;c3t3;la,nHra;a,ie,o4;a,or1;a,gh,laH;!ni;!h,nH;a,d4e,n4O;cOdon7Ui9kes5na,rNtLurJvIxHy9;mi;ern1in3;a,eHie,yn;l,n;as5is5oH;nya,ya;a,isF;ey,ie,y;a01eWhadija,iOoNrJyH;lHra;a,ee,ie;isHy5D;!tH;a,en,iHy;!e,n48;ri,urtn9C;aNerMl9BmJrHzzy;a,stH;en,in;!berlH;eHi,y;e,y;a,stD;!na,ra;el6QiKlJnIrH;a,i,ri;d4na;ey,i,l9Ss2y;ra,s5;c8Yi5YlPma9nyakumari,rNss5MtKviByH;!e,lH;a,eH;e,i7A;a5FeIhHi3PlCri0y;arGerGie,leDr9Hy;!lyn75;a,en,iHl4Vyn;!ma,n31sF;ei74i,l2;a05eWilUoNuH;anLdKliHstG;aIeHsF;!nAt0W;!n8Z;e,i2Ry;a,iB;!anMcelCd5Wel73han6JlKni,sIva0yH;a,ce;eHie;fi0lCphG;eHie;en,n1;!a,e,n36;!i10lH;!i0Z;anMle0nJrIsH;i5Rsi5R;i,ri;!a,el6Rif1RnH;a,et6iHy;!e,f1P;a,e74iInH;a,e73iH;e,n1;cMd1mi,nIqueliAsmin2Uvie4yAzH;min7;a7eIiH;ce,e,n1s;!lHsFt06;e,le;inIk2lCquelH;in1yn;da,ta;da,lQmOnNo0rMsIvaH;!na;aIiHob6W;do4;!belHdo4;!a,e,l2G;en1i0ma;a,di4es,gr5T;el8ogH;en1;a,eAia0o0se;aNeKilIoHyacin1N;ll2rten1H;a5HdHla5H;a,egard;ath0XiIlHnrietBrmiAst0X;en25ga;di;il78lLnKrHtt2yl78z6G;iHmo4Hri4I;etH;!te;aEnaE;ey,l2;aZeUiPlNold13rJwH;enHyne19;!dolC;acIetHisel8;a,chD;e,ieH;!la;adys,enHor3yn1Z;a,da,na;aKgi,lIna,ov74selH;a,e,le;da,liH;an;!n0;mZnJorgIrH;aldGi,m2Utru76;et6i5W;a,eHna;s1Ovieve;briel3Hil,le,rnet,yle;aSePio0loNrH;anIe8iH;da,e8;!cH;esIiHoi0H;n1s3X;!ca;!rH;a,en45;lIrnH;!an8;ec3ic3;rItiHy7;ma;ah,rah;d0GileDkBl01mVn4DrSsNtMuLvH;aJelIiH;e,ta;in0Byn;!ngelG;geni1la,ni3T;h55ta;meral8peranKtH;eIhHrel9;er;l2Rr;za;iHma,nestGyn;cHka,n;a,ka;eKilJmH;aHie,y;!liA;ee,i1y;lHrald;da,y;aUeSiNlMma,no4oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c3da,nKsHzaI;aHe;!beH;th;!a,or;anor,nH;!a;in1na;en,iHna,wi0;e,th;aXeLiKoHul2W;lor54miniq41n32rHtt2;a,eDis,la,othHthy;ea,y;an0AnaEonAx2;anQbPde,eOiMja,lJmetr3nHsir4X;a,iH;ce,se;a,iIla,orHphiA;es,is;a,l5M;dHrdH;re;!d4Pna;!b2EoraEra;a,d4nH;!a,e;hl3i0mNnLphn1rIvi1YyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,et6iH;!ca,el1Cka;arHia;is;a0Se0Oh06i04lWoKrIynH;di,th3;istHy06;al,i0;lQnNrIurH;tn1F;aKdJiHnJriA;!nH;a,e,n1;el3;!l1T;n2sH;tanHuelo;ce,za;eHleD;en,t6;aJeoIotH;il4D;!pat4;ir7rJudH;et6iH;a,ne;a,e,iH;ce,sY;a4er4ndH;i,y;aQeNloe,rH;isIyH;stal;sy,tH;aIen,iHy;!an1e,n1;!l;lseIrH;!i7yl;a,y;nMrH;isKlImH;aiA;a,eHot6;n1t6;!sa;d4el1RtH;al,el1Q;cIlH;es6i3H;el3ilH;e,ia,y;iZlYmilXndWrOsMtHy9;aKeJhHri0;erGleDrCy;in1;ri0;li0ri0;a2IsH;a2Hie;a,iNlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eHie,y;ne,y;na,sF;a0Ei0E;a,e,l1;isBl2;tlH;in,yn;arb0DeZianYlWoUrH;andSeQiJoIyH;an0nn;nwCok7;an2PdgLg0KtH;n29tH;!aInH;ey,i,y;ny;etH;!t7;an0e,nH;da,na;i7y;bbi7nH;iBn2;ancHossom,ythe;a,he;ca;aScky,lin8niBrOssNtJulaEvH;!erlH;ey,y;hIsy,tH;e,i11y7;!anH;ie,y;!ie;nHt5yl;adIiH;ce;et6iA;!triH;ce,z;a4ie,ra;aliy2Bb26d1Ng1Ji1Bl0Um0Pn03rYsPthe0uLvJyH;anHes5;a,na;a,eHr27;ry;drJgusIrH;el3o4;ti0;a,ey,i,y;hItrH;id;aLlHt1Q;eIi7yH;!n;e,iHy;gh;!nH;ti;iJleIpiB;ta;en,n1t6;an1AelH;le;aZdXeVgRiPja,nItoHya;inet6n3;!aKeIiHmJ;e,ka;!mHt6;ar2;!belIliFmU;sa;!le;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!t6;te;je9rea;la;!bImHstas3;ar3;el;aJberIel3iHy;e,na;!ly;l3n8;da;aUba,eOiLlJma,ta,yH;a,c3sH;a,on,sa;iHys0K;e,s0J;a,cIna,sHza;a,ha,on,sa;e,ia;c3is5jaJna,ssaJxH;aHia;!nd4;nd4;ra;ia;i0nIyH;ah,na;a,is,naE;c5da,leDmMnslLsH;haElH;inHyX;g,n;!h;ey;ee;en;at5g2nH;es;ie;ha;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lCsH;on;yn;!lH;iAyn;ne;agaKbIiH;!gaJ;ey,i7y;!e;il;ah|Persona01bZcTdQeOfMgJhHinez,jFkEleDmAnettPo9p7r4s3t2uncle,v0womL;a0irgin maH;lentino rossi,n go3;heresa may,iger woods,yra banks;addam hussaQcarlett johanssRistZlobodan milosevic,omeone,tepGuC;ay romano,eese witherspoQo1ush limbau0;gh;d stewart,naldinho,sario;a0ipV;lmUris hiltM;prah winfrOra;an,essiaen,itt romnNo0ubarek;m0thR;!my;bron james,e;anye west,iefer sutherland,obe bryaN;aime,effersFk rowli0;ng;alle ber0ulk hog3;ry;astBentlem1irl,rand0uy;fa2mo2;an;a0ella;thF;ff0meril lagasse,zekiel;ie;a0enzel washingt4ick wolf,ude;d0lt3nte;!dy;ar2lint1ous0ruz;in;on;dinal wols1son0;! palm5;ey;arack obama,oy,ro0;!ck,th2;dolf hitl1shton kutch1u0;nt;er|WeekDayfri4mon4s2t1wed0;!nesd4;hurs2ues2;at0un1;!urd1;!d0;ay0;!s|Dateautumn,daylight9eom,one d8s5t2w0yesterd8;eek0int5;d6end;mr1o0;d4morrow;!w;ome 1tandard3umm0;er;d0point;ay; time|Timea6breakfast 5dinner5e3lunch5m2n0oclock,some5to7;i7o0;on,w;id4or1;od,ve0;ning;time;fternoon,go,ll day,t 0;ni0;ght|Holiday0:1Q;1:1P;a1Fb1Bc12d0Ye0Of0Kg0Hh0Di09june07kwanzaa,l04m00nYoVpRrPsFt9v6w4xm03y2;om 2ule;hasho16kippur;hit2int0Xomens equalit8; 0Ss0T;alentines3e2ictor1E;r1Bteran1;! 0;-0ax 0h6isha bav,rinityMu2; b3rke2;y 0;ish2she2;vat;a0Xe prophets birth0;a6eptember14h4imchat tor0Ut 3u2;kk4mmer T;a8p7s6valentines day ;avu2mini atzeret;ot;int 2mhain;a4p3s2valentine1;tephen1;atrick1;ndrew1;amadan,ememberanc0Yos2;a park1h hashana;a3entecost,reside0Zur2;im,ple heart 0;lm2ssovE; s04;rthodox 2stara;christma1easter2goOhoJn0C;! m07;ational 2ew years09;freedom 0nurse1;a2emorial 0lHoOuharram;bMr2undy thurs0;ch0Hdi gr2tin luther k0B;as;a2itRughnassadh;bour 0g baom2ilat al-qadr;er; 2teenth;soliU;d aJmbolc,n2sra and miraj;augurGd2;ependen2igenous people1;c0Bt1;a3o2;ly satur0;lloween,nukkUrvey mil2;k 0;o3r2;ito de dolores,oundhoW;odW;a4east of 2;our lady of guadalupe,the immaculate concepti2;on;ther1;aster8id 3lectYmancip2piphany;atX;al-3u2;l-f3;ad3f2;itr;ha;! 2;m8s2;un0;ay of the dead,ecemb3i2;a de muertos,eciseis de septiembre,wali;er sol2;stice;anad8h4inco de mayo,o3yber m2;on0;lumbu1mmonwealth 0rpus christi;anuk4inese n3ristmas2;! N;ew year;ah;a 0ian tha2;nksgiving;astillCeltaine,lack4ox2;in2;g 0; fri0;dvent,ll 9pril fools,rmistic8s6u2;stral4tum2;nal2; equinox;ia 0;cens2h wednes0sumption of mary;ion 0;e 0;hallows 6s2;ai2oul1t1;nt1;s 0;day;eve|MonthaBdec9feb7j2mar,nov9oct1sep0;!t8;!o8;an3u0;l1n0;!e;!y;!u1;!ru0;ary;!em0;ber;pr1ug0;!ust;!il|Durationcentur4d2hour3m0seconds,week3year3;i0onth2;llisecond1nute1;ay0ecade0;!s;ies,y|FirstNameaEblair,cCdevBj8k6lashawn,m3nelly,re2sh0;ay,e0iloh;a,lby;g1ne;ar1el,org0;an;ion,lo;as8e0;ls7nyatta,rry;am0ess1;ie,m0;ie;an,on;as0heyenne;ey,sidy;lexis,ndra,ubr0;ey|LastName0:35;1:3C;2:3A;3:2Z;4:2F;a3Bb31c2Od2Ee2Bf25g1Zh1Oi1Jj1Dk16l0Ym0Mn0Io0Fp04rXsLtGvEwBxAy7zh5;a5ou,u;ng,o;a5eun2Uoshi1Jun;ma5ng;da,guc1Zmo27sh21zaQ;iao,u;a6eb0il5o3right,u;li3Bs2;gn0lk0ng,tanabe;a5ivaldi;ssilj37zqu1;a8h7i2Go6r5sui,urn0;an,ynisI;lst0Orr1Uth;at1Uomps2;kah0Unaka,ylor;aDchCeBhimizu,iAmi9o8t6u5zabo;ar1lliv2AzuD;a5ein0;l23rm0;sa,u3;rn4th;lva,mmo24ngh;mjon4rrano;midt,neid0ulz;ito,n6sa5to;ki;ch1dKtos,z;amAeag1Zi8o6u5;bio,iz,sC;b5dri1MgHj0Sme24osevelt,sZux;erts,ins2;c5ve0E;ci,hards2;ir1os;aDe9h7ic5ow20;as5hl0;so;a5illips;m,n1T;ders20et7r6t5;e0Nr4;ez,ry;ers;h21rk0t5vl4;el,te0J;baAg0Alivei00r5;t5w1O;ega,iz;a5eils2guy1Rix2owak,ym1E;gy,ka5var1K;ji5muV;ma;aDeBiAo7u5;ll0n5rr0Bssolini,5;oz;lina,oJr5zart;al0Me5r0U;au,no;hhail4ll0;rci0s5y0;si;eVmmad4r5tsu07;in5tin1;!o;aBe7i5op1uo;!n5u;coln,dholm;fe6n0Qr5w0J;oy;bv5v5;re;mmy,rs14u;aAennedy,imu9le0Lo7u6wo5;k,n;mar,znets4;bay5vacs;asY;ra;hn,rl8to,ur,zl4;a9en8ha3imen1o5u3;h5nYu3;an5ns2;ss2;ki0Es0S;cks2nsse0D;glesi8ke7noue,shik6to,vano5;u,v;awa;da;as;aBe8it7o6u5;!a3b0ghNynh;a3ffmann,rvat;chcock,l0;mingw6nde5rM;rs2;ay;ns0ErrPs6y5;asCes;an4hi5;moI;a8il,o7r6u5;o,tierr1;ayli3ub0;m1nzal1;nd5o,rcia;hi;er9is8lor7o6uj5;ita;st0urni0;es;ch0;nand1;d6insteGsposi5vaK;to;is2wards;aBeAi8omin7u5;bo5rand;is;gu1;az,mitr4;ov;lgado,vi;nkula,rw6vi5;es,s;in;aEhAlark9o5;hKl5op0rbyn,x;em6li5;ns;an;!e;an7e6iu,o5ristensFu3we;i,ng,u3w,y;!n,on5u3;!g;mpb6rt0st5;ro;ell;aAe7ha3lanco,oyko,r5yrne;ooks,yant;ng;ck6ethov5nnett;en;er,ham;ch,h7iley,rn5;es,i0;er;k,ng;dCl8nd5;ers5r9;en,on,s2;on;eks6iy7var1;ez;ej5;ev;ams|MaleName0:CE;1:BK;2:C2;3:BS;4:B4;5:BZ;6:AT;7:9V;8:BC;9:AW;A:AO;B:8W;aB5bA9c98d88e7Hf6Zg6Hh5Wi5Ij4Lk4Bl3Rm2Pn2Eo28p22qu20r1As0Qt07u06v01wOxavi3yHzC;aCor0;cCh8Jne;hDkC;!a5Z;ar51e5Y;ass2i,oDuC;sEu25;nFsEusC;oCsD;uf;ef;at0g;aKeIiDoCyaAQ;lfgang,odrow;lCn1O;bEey,frBJlC;aA6iC;am,e,s;e8Aur;i,nde7sC;!l6t1;de,lDrr5yC;l1ne;lCt3;a94y;aFern1iC;cDha0nceCrg9Cva0;!nt;ente,t5B;lentin49n8Zughn;lyss4Msm0;aTeOhLiJoFrDyC;!l3ro8s1;av9ReCist0oy,um0;nt9Jv55y;bEd7YmCny;!as,mCoharu;aAYie,y;iBy;mCt9;!my,othy;adDeoCia7EomB;!do7O;!de9;dFrC;en8JrC;an8IeCy;ll,n8H;!dy;dgh,ic9Unn3req,ts46;aScotQeOhKiIoGpenc3tCur1Pylve8Jzym1;anEeCua7D;f0phAGvCwa7C;e59ie;!islaw,l6;lom1nA4uC;leyma8ta;dClBm1;!n6;aEeC;lCrm0;d1t1;h6Une,qu0Vun,wn,y8;aCbasti0k1Yl42rg41th,ymo9J;m9n;!tC;!ie,y;lDmCnti22q4Kul;!mAu4;ik,vato6X;aXeThe94iPoGuDyC;an,ou;b6NdDf9pe6SssC;!elAK;ol2Vy;an,bJcIdHel,geGh0landA4mFnEry,sDyC;!ce;coe,s;!a96nA;an,eo;l3Kr;e4Sg3n6oA5ri6A;co,ky;bAe9V;cCl6;ar5Qc5PhDkCo;!ey,ie,y;a87ie;gDid,ub5x,yCza;ansh,nT;g8XiC;na8Ts;ch60fa4lEmDndCpha4sh6Wul,ymo72;alA0ol2Cy;i9Jon;f,ph;ent2inC;cy,t1;aGeEhilDier64ol,reC;st1;!ip,lip;d9Crcy,tC;ar,e2W;b3Udra6Ht46ul;ctav2Wliv3m97rGsDtCum8Vw5;is,to;aDc8TvC;al54;ma;i,l4BvK;athKeIiEoC;aCel,l0ma0r2Y;h,m;cDg4i3KkC;h6Wola;holBkColB;!olB;al,d,il,ls1vC;il52;anCy;!a4i4;aXeUiLoGuDyC;l22r1;hamDr61staC;fa,p4I;ed,mG;dibo,e,hamEis1YntDsCussa;es,he;e,y;ad,ed,mC;ad,ed;cHgu4kFlEnDtchC;!e7;a7Aik;o04t1;e,olC;aj;ah,hCk6;a4eC;al,l;hDlv2rC;le,ri7v2;di,met;ck,hOlMmPnu4rIs1tEuricDxC;!imilian87we7;e,io;eo,hDiBtC;!eo,hew,ia;eCis;us,w;cEio,k81lDqu6Isha7tCv2;i2Jy;in,on;!el,oLus;achCcolm,ik;ai,y;amCdi,moud;adC;ou;aSeOiNlo2ToJuDyC;le,nd1;cFiEkCth3;aCe;!s;gi,s;as,iaC;no;g0nn6SrenEuCwe7;!iC;e,s;!zo;am,on4;a7Cevi,la4UnEoCst3vi;!nC;!a62el;!ny;mDnCr16ur4Vwr4V;ce,d1;ar,o4P;aJeEhaled,iCrist4Xu4Ay3D;er0p,rC;by,k,ollos;en0iFnCrmit,v2;!dDnCt5E;e10y;a7ri4P;r,th;na69rCthem;im,l;aZeRiPoEuC;an,liCst2;an,o,us;aqu2eKhnJnHrFsC;eDhCi7Due;!ua;!ph;dCge;an,i,on;!aCny;h,s,th4Z;!ath4Yie,nA;!l,sCy;ph;an,e,mC;!mA;d,ffHrEsC;sCus;!e;a5KemDmai8oCry;me,ni0Q;i6Wy;!e07rC;ey,y;cId5kHmGrEsDvi3yC;!d5s1;on,p3;ed,od,rCv4O;e51od;al,es,is1;e,ob,ub;k,ob,quC;es;aObrahNchika,gLkeKlija,nuJrHsEtCv0;ai,sC;uki;aCha0i6Hma4sac;ac,iaC;h,s;a,vinCw2;!g;k,nngu53;!r;nacCor;io;im;in,n;aLeGina4WoEuCyd57;be27gCmber4EsE;h,o;m3ra35sCwa3Z;se2;aFctEitEnDrC;be22m0;ry;or;th;bLlKmza,nJo,rEsDyC;a44d5;an,s0;lFo4FrEuCv6;hi41ki,tC;a,o;is1y;an,ey;k,s;!im;ib;aReNiMlenLoJrFuC;illerDsC;!tavo;mo;aEegCov3;!g,orC;io,y;dy,h58nt;nzaCrd1;lo;!n;lbe4Qno,ovan4S;ne,oErC;aCry;ld,rd4O;ffr6rge;bri4l5rCv2;la20r3Fth,y;aSeOiMlKorr0JrC;anEedCitz;!dAeCri25;ri24;cEkC;!ie,lC;in,yn;esKisC;!co,zek;etch3oC;yd;d4lConn;ip;deriEliDng,rnC;an02;pe,x;co;bi0di;ar00dVfrUit0lOmHnGo2rDsteb0th0uge8vCym5zra;an,ere2W;gi,iDnCrol,v2w2;est3Zie;c08k;och,rique,zo;aHerGiDmC;aGe2Q;lDrC;!h0;!io;s1y;nu4;be0Ad1iFliEmDt1viCwood;n,s;er,o;ot1Us;!as,j44sC;ha;a2en;!dAg32mFuDwC;a26in;arC;do;o0Tu0T;l,nC;est;aZePiMoFrEuDwCyl0;ay8ight;a8dl6nc0st2;ag0ew;minGnEri0ugDyC;le;!lB;!a29nCov0;e7ie,y;go,icC;!k;armuDeCll1on,rk;go;id;anJj0lbeImetri9nGon,rFsEvDwCxt3;ay8ey;en,in;hawn,mo09;ek,ri0G;is,nCv3;is,y;rt;!dC;re;lLmJnIrEvC;e,iC;!d;en,iEne7rCyl;eCin,yl;l2Wn;n,o,us;!e,i4ny;iCon;an,en,on;e,lB;as;a07e05hXiar0lMoHrFuDyrC;il,us;rtC;!is;aCistobal;ig;dy,lFnDrC;ey,neli9y;or,rC;ad;by,e,in,l2t1;aHeEiCyJ;fCnt;fo0Dt1;meDt9velaC;nd;nt;rEuDyC;!t1;de;enC;ce;aGeFrisDuC;ck;!tC;i0oph3;st3;d,rlCs;eCie;s,y;cCdric,s11;il;lFmer1rC;ey,lDro7y;ll;!os,t1;eb,v2;ar03eVilUlaToQrDuCyr1;ddy,rtJ;aKeFiEuDyC;an,ce,on;ce,no;an,ce;nDtC;!t;dDtC;!on;an,on;dDndC;en,on;!foCl6y;rd;bDrCyd;is;!by;i8ke;al,lA;nGrCshoi;at,nDtC;!r11;aCie;rd0M;!edict,iDjam2nA;ie,y;to;n6rCt;eCy;tt;ey;ar0Yb0Od0Kgust2hm0Hid5ja0FlZmXnPputsiOrFsaEuCya0ziz;gust9st2;us;hi;aJchIi4jun,maGnEon,tCy0;hCu07;ur;av,oC;ld;an,nd05;el;ie;ta;aq;dHgel00tC;hoFoC;i8nC;!iXy;ne;ny;reCy;!as,s,w;ir,mCos;ar;an,bePd5eJfGi,lFonEphonIt1vC;aNin;on;so,zo;an,en;onDrC;edK;so;c,jaFksandEssaFxC;!and3;er;ar,er;ndC;ro;rtC;!o;ni;en;ad,eC;d,t;in;aDoCri0vik;lfo;mCn;!a;dGeFraDuC;!bakr,lfazl;hCm;am;!l;allFel,oulaye,ulC;!lDrahm0;an;ah,o;ah;av,on|Verbawak9born,cannot,fr8g7h5k3le2m1s0wors9;e8h3;ake sure,sg;ngth6ss6;eep tabs,n0;own;as0e2;!t2;iv1onna;ight0;en|PhrasalVerb0:71;1:6P;2:7D;3:73;4:6I;5:7G;6:75;7:6O;8:6B;9:6C;A:5H;B:70;C:6Z;a7Gb62c5Cd59e57f45g3Nh37iron0j33k2Yl2Km2Bn29o27p1Pr1Es09tQuOvacuum 1wGyammerCzD;eroAip EonD;e0k0;by,up;aJeGhFiEorDrit52;d 1k2Q;mp0n49pe0r8s8;eel Bip 7K;aEiD;gh 06rd0;n Br 3C;it 5Jk8lk6rm 0Qsh 73t66v4O;rgeCsD;e 9herA;aRePhNiJoHrFuDype 0N;ckArn D;d2in,o3Fup;ade YiDot0y 32;ckle67p 79;ne66p Ds4C;d2o6Kup;ck FdEe Dgh5Sme0p o0Dre0;aw3ba4d2in,up;e5Jy 1;by,o6U;ink Drow 5U;ba4ov7up;aDe 4Hll4N;m 1r W;ckCke Elk D;ov7u4N;aDba4d2in,o30up;ba4ft7p4Sw3;a0Gc0Fe09h05i02lYmXnWoVpSquare RtJuHwD;earFiD;ngEtch D;aw3ba4o6O; by;ck Dit 1m 1ss0;in,up;aIe0RiHoFrD;aigh1LiD;ke 5Xn2X;p Drm1O;by,in,o6A;n2Yr 1tc3H;c2Xmp0nd Dr6Gve6y 1;ba4d2up;d2o66up;ar2Uell0ill4TlErDurC;ingCuc8;a32it 3T;be4Brt0;ap 4Dow B;ash 4Yoke0;eep EiDow 9;c3Mp 1;in,oD;ff,v7;gn Eng2Yt Dz8;d2o5up;in,o5up;aFoDu4E;ot Dut0w 5W;aw3ba4f36o5Q;c2EdeAk4Rve6;e Hll0nd GtD; Dtl42;d2in,o5upD;!on;aw3ba4d2in,o1Xup;o5to;al4Kout0rap4K;il6v8;at0eKiJoGuD;b 4Dle0n Dstl8;aDba4d2in52o3Ft2Zu3D;c1Ww3;ot EuD;g2Jnd6;a1Wf2Qo5;ng 4Np6;aDel6inAnt0;c4Xd D;o2Su0C;aQePiOlMoKrHsyc29uD;ll Ft D;aDba4d2in,o1Gt33up;p38w3;ap37d2in,o5t31up;attleCess EiGoD;p 1;ah1Gon;iDp 52re3Lur44wer 52;nt0;ay3YuD;gAmp 9;ck 52g0leCn 9p3V;el 46ncilA;c3Oir 2Hn0ss FtEy D;ba4o4Q; d2c1X;aw3ba4o11;pDw3J;e3It B;arrow3Serd0oD;d6te3R;aJeHiGoEuD;ddl8ll36;c16p 1uth6ve D;al3Ad2in,o5up;ss0x 1;asur8lt 9ss D;a19up;ke Dn 9r2Zs1Kx0;do,o3Xup;aOeMiHoDuck0;a16c36g 0AoDse0;k Dse34;aft7ba4d2forw2Ain3Vov7uD;nd7p;e GghtFnEsDv1T;ten 4D;e 1k 1; 1e2Y;ar43d2;av1Ht 2YvelD; o3L;p 1sh DtchCugh6y1U;in3Lo5;eEick6nock D;d2o3H;eDyA;l2Hp D;aw3ba4d2fSin,o05to,up;aFoEuD;ic8mpA;ke2St2W;c31zz 1;aPeKiHoEuD;nker2Ts0U;lDneArse2O;d De 1;ba4d2oZup;de Et D;ba4on,up;aw3o5;aDlp0;d Fr Dt 1;fDof;rom;in,oO;cZm 1nDve it;d Dg 27kerF;d2in,o5;aReLive Jloss1VoFrEunD; f0M;in39ow 23; Dof 0U;aEb17it,oDr35t0Ou12;ff,n,v7;bo5ft7hJw3;aw3ba4d2in,oDup,w3;ff,n,ut;a17ek0t D;aEb11d2oDr2Zup;ff,n,ut,v7;cEhDl1Pr2Xt,w3;ead;ross;d aEnD;g 1;bo5;a08e01iRlNoJrFuD;cDel 1;k 1;eEighten DownCy 1;aw3o2L;eDshe1G; 1z8;lFol D;aDwi19;bo5r2I;d 9;aEeDip0;sh0;g 9ke0mDrD;e 2K;gLlJnHrFsEzzD;le0;h 2H;e Dm 1;aw3ba4up;d0isD;h 1;e Dl 11;aw3fI;ht ba4ure0;eInEsD;s 1;cFd D;fDo1X;or;e B;dQl 1;cHll Drm0t0O;apYbFd2in,oEtD;hrough;ff,ut,v7;a4ehi1S;e E;at0dge0nd Dy8;o1Mup;o09rD;ess 9op D;aw3bNin,o15;aShPlean 9oDross But 0T;me FoEuntD; o1M;k 1l6;aJbIforGin,oFtEuD;nd7;ogeth7;ut,v7;th,wD;ard;a4y;pDr19w3;art;eDipA;ck BeD;r 1;lJncel0rGsFtch EveA; in;o16up;h Bt6;ry EvD;e V;aw3o12;l Dm02;aDba4d2o10up;r0Vw3;a0He08l01oSrHuD;bbleFcklTilZlEndlTrn 05tDy 10zz6;t B;k 9; ov7;anMeaKiDush6;ghHng D;aEba4d2forDin,o5up;th;bo5lDr0Lw3;ong;teD;n 1;k D;d2in,o5up;ch0;arKgJil 9n8oGssFttlEunce Dx B;aw3ba4;e 9; ar0B;k Bt 1;e 1;d2up; d2;d 1;aIeed0oDurt0;cFw D;aw3ba4d2o5up;ck;k D;in,oK;ck0nk0st6; oJaGef 1nd D;d2ov7up;er;up;r0t D;d2in,oDup;ff,ut;ff,nD;to;ck Jil0nFrgEsD;h B;ainCe B;g BkC; on;in,o5; o5;aw3d2o5up;ay;cMdIsk Fuction6; oD;ff;arDo5;ouD;nd;d D;d2oDup;ff,n;own;t D;o5up;ut|Modalc5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to;ay,ight,ust;an,o0;uld|Adjective0:74;1:7J;2:7P;3:7I;4:7B;5:5B;6:4R;7:49;8:48;9:7G;A:60;B:72;C:6Z;D:6Y;a6Hb63c5Pd55e4Rf48g3Zh3Oi33j31k30l2Pm2En25o1Pp19quack,r0Zs0Ft08uPvMwEyear5;arp0eIholeHiGoE;man5oEu6A;d6Czy;despr73s5E;!sa7;eFlEste24;co1Gl o4J;!k5;aFiEola4A;b7Rce versa,ol53;ca2gabo61nilla;ltVnIpFrb58su4tterE;!moD; f32b1MpFsEti1F;ca7et,ide dLtairs;er,i3L;aObeco6Pconvin25deLeKfair,ivers4knJprecedXrHsFwE;iel1Yritt5X;i1TuE;pervis0specti3;eEu5;cognKgul6Fl6F;own;ndi3v5Rxpect0;cid0rE;!grou5MsE;iz0tood;b7ppeaKssu6EuthorE;iz0;i22ra;aIeGhough4NoFrE;i1oubl0;geth6p,rpC;en5OlEm4Yrr2Sst0;li3;boo,lEn;ent0;aWcVeThSiQmug,nobbi3DoOpNqueami3DtIuEymb62;bGi gener53pErprisi3;erEre0J;! dup6b,i27;du0seq4S;anda6SeHi0NrEy37;aightEip0; fEfE;or59;adfaDreotyp0;a4Xec2Eir1HlendCot on; call0le,mb6phist1VrEu0Vvi40;dCry;gnifica2nE;ce4Tg7;am2Oe6ocki3ut;cEda1em5lfi2Xni1Upa67re8;o1Er3U;at56ient26reec56;cr0me,ns serif;aLeHiFoE;buDtt4SuRy4;ghtEv4;!-27fA;ar,bel,condi1du61fres50lGpublic3UsEta2C;is46oE;lu1na2;e1Cuc44;bCciE;al,st;aOeMicayu8lacCopuliDrFuE;bl58mp0;eIiFoE;!b08fuBmi30p6;mFor,sEva1;ti8;a4Ue;ciBmE;a0Gi5I;ac20rEti1;fe9ma2Tplexi3v33;rEst;allelGtE;-tiEi4;me;!ed;bPffNkMld fashion0nLpKrg1Gth6utJvE;al,erE;!aGniFt,wE;eiErouE;ght;ll;do0Uer,g2Lsi45;en,posi1; boa5Fg2Jli8;!ay; gua5DbEli8;eat;eGsE;cEer0Gole1;e8u3J;d2Sse;ak0eLiKoEua4O;nIrFtE;ab7;thE;!eE;rn;chala2descri4Zstop;ght5;arby,cessa3Wighbor5xt;aMeKiHoEultip7;bi7derFlEnth5ot,st;dy;a1n;nEx0;iaEor;tu32;di4EnaEre;ci3;cEgenta,in,j02keshift,le,mmoth,ny,sculi8;ab2Yho;aNeIiFoEu13;uti12vi3;mFteraE;l,te;it0;ftHgEth4;al,eFitiE;ma1;nda3C;!-0B;nguCst,tt6;ap1Sind5no09;agg0uE;niNstifi0veni7;de4gno4Blleg4mRnGpso 1VrE;a1releE;va2; MaLbr0corKdIfluenSiSnHsGtE;a9enBoxE;ic36;a8i2R;a1er,oce2;iFoE;or;re9;deq3Jppr2Y;fEsitu,vitro;ro2;mIpE;arGerfe9oErop6;li1rtE;a2ed;ti4;eEi0Q;d2QnB;aJelIiGoEumdr3B;neDok0rrEs07ur5;if2S;ghfalut1OspE;an2Q;liZpfA;lHnGrE;d05roE;wi3;dy,gi3;f,low0;ainfAener2Jiga22lLoKraHuE;aFilEng ho;ty;rd0;cFtE;efAis;efA;ne,od;ea2Cob4;aTeNinMlLoGrE;a1SeEoz1J;e2Cq11tfA;oGrE; keeps,eEm6tuna1;g03ign;liE;sh;ag2Yue2;al,i1;dImFrE;ti7;a7ini8;ne;le; up;bl0i2lBr Eux,vori1;oEreac1E;ff;aNfficie2lMmiLnJre9there4veIxE;a9cess,peGtraFuE;be2Ll0H;!va1D;ct0rt;n,ryday; Ecouragi3ti0P;rou1sui1;ne2;abo22dPe17i1;g6sE;t,ygE;oi3;er;aUeMiGoErea14ue;mina2ne,ubE;le,tfA;dact1Afficu1NsFvE;erB;creGeas0gruntl0honeDordFtE;a2ress0;er5;et; KadpJfIgene1OliGrang0spe1OtFvoE;ut;ail0ermin0;be1Lca1ghE;tfA;ia2;an;facto;i5magEngeroYs0H;ed,i3;ly;ertaQhief,ivil,oGrE;aEowd0u0G;mp0v01z0;loMmKnFoi3rrEve0O;e9u1H;cre1grHsGtE;emEra0E;po0C;ta2;ue2;mer07pleE;te,x;ni4ss4;in;aOeKizarJlIoFrE;and new,isk,okO;gFna fiVttom,urgeoE;is;us;ank,iH;re;autifAhiFlov0nEst,yoF;eUt;nd;ul;ckFnkru0WrrE;en;!wards; priori,b0Mc0Jd09fraCg04h03lYma05ntiquXpTrNsLttracti06utheKvHwE;aFkE;wa0T;ke,re;ant garFerE;age;de;ntU;leep,tonisE;hi3;ab,bitHroGtiE;fiE;ci4;ga2;raE;ry;pEt;are2etiOrE;oprE;ia1;at0;arHcohFeEiLl,oof;rt;olE;ic;mi3;ead;ainDgressiFoniE;zi3;ve;st;id; LeJuIvE;aFerB;se;nc0;ed;lt;pt,qE;ua1;hoc,infinitE;um;cuFtu4u1;al;ra1;erOlNoLruKsFuE;nda2;e2oFtra9;ct;lu1rbi3;ng;te;pt;aEve;rd;aze,e;ra2;nt|Comparable0:41;1:4I;2:45;3:4B;4:3X;5:2Y;a4Ob44c3Od3De35f2Rg2Fh24i1Vj1Uk1Rl1Im1Cn16o14p0Tqu0Rr0IsRtKuIvFw7y6za12;ell27ou3;aBe9hi1Yi7r6;o3y;ck0Mde,l6n1ry,se;d,y;a6i4Mt;k,ry;n1Tr6sI;m,y;a7e6ulgar;nge4rda2xi3;gue,in,st;g0n6pco3Mse4;like0ti1;aAen9hi8i7ough,r6;anqu2Qen1ue;dy,g3Ume0ny,r09;ck,n,rs2R;d42se;ll,me,rt,s6wd47;te4;aVcarUeThRiQkin0GlMmKoHpGqua1HtAu7w6;eet,ift;b7dd15per0Hr6;e,re2J;sta2Ht5;aAe9iff,r7u6;pXr1;a6ict,o3;ig3Hn0W;a1ep,rn;le,rk;e24i3Hright0;ci2Aft,l7o6re,ur;n,thi3;emn,id;a6el0ooth;ll,rt;e8i6ow,y;ck,g37m6;!y;ek,nd3F;ck,l0mp5;a6iUort,rill,y;dy,ll0Zrp;cu0Tve0Txy;ce,ed,y;d,fe,int0l1Xv16;aBe9i8o6ude;mantic,o1Ksy,u6;gh,nd;ch,pe,tzy;a6d,mo0J;dy,l;gg7ndom,p6re,w;id;ed;ai2i6;ck,et;aFhoEi1SlCoBr8u6;ny,r6;e,p5;egna2ic7o6;fou00ud;ey,k0;li06or,te1D;a6easa2;in,nt;ny;in4le;dd,f6i0ld,ranR;fi11;aAe8i7o6;b5isy,rm16sy;ce,mb5;a6w;r,t;ive,rr02;aAe8ild,o7u6;nda1Ate;ist,o1;a6ek,llY;n,s0ty;d,tuR;aCeBi9o6ucky;f0Vn7o1Eu6ve0w18y0U;d,sy;e0g;g1Uke0tt5v6;e0i3;an,wd;me,r6te;ge;e7i6;nd;en;ol0ui1P;cy,ll,n6;sBt6;e6ima8;llege2r6;es7media6;te;ti3;ecu6ta2;re;aEeBiAo8u6;ge,m6ng1R;b5id;ll6me0t;ow;gh,l0;a6f04sita2;dy,v6;en0y;nd1Hppy,r6te4;d,sh;aGenFhDiClBoofy,r6;a9e8is0o6ue1E;o6ss;vy;at,en,y;nd,y;ad,ib,ooI;a2d1;a6o6;st0;t5uiY;u1y;aIeeb5iDlat,oAr8u6;ll,n6r14;!ny;aHe6iend0;e,sh;a7r6ul;get4mG;my;erce8n6rm,t;an6e;ciC;! ;le;ir,ke,n0Fr,st,t,ulA;aAerie,mp9sse7v6xtre0Q;il;nti6;al;ty;r7s6;tern,y;ly,th0;aFeCi9r7u6;ll,mb;u6y;nk;r7vi6;ne;e,ty;a6ep,nD;d6f,r;!ly;mp,pp03rk;aHhDlAo8r7u6;dd0r0te;isp,uel;ar6ld,mmon,ol,st0ward0zy;se;e6ou1;a6vW;n,r;ar8e6il0;ap,e6;sy;mi3;gey,lm8r6;e4i3;ful;!i3;aNiLlIoEr8u6;r0sy;ly;aAi7o6;ad,wn;ef,g7llia2;nt;ht;sh,ve;ld,r7un6;cy;ed,i3;ng;a7o6ue;nd,o1;ck,nd;g,tt6;er;d,ld,w1;dy;bsu9ng8we6;so6;me;ry;rd|Adverba07by 05d01eYfShQinPjustOkinda,mMnJoEpCquite,r9s5t2up1very,w0Bye0;p,s; to,wards5;h1o0wiO;o,t6ward;en,us;everal,o0uch;!me1rt0; of;hXtimes,w07;a1e0;alS;ndomRthN;ar excellDer0oint blank; Mhaps;f3n0;ce0ly;! 0;ag00moU; courHten;ewJo0; longEt 0;onHwithstanding;aybe,eanwhiAore0;!ovB;! aboS;deed,steT;en0;ce;or2u0;l9rther0;!moH; 0ev3;examp0good,suF;le;n mas1v0;er;se;e0irect1; 1finite0;ly;ju7trop;far,n0;ow; CbroBd nauseam,gAl5ny2part,side,t 0w3;be5l0mo5wor5;arge,ea4;mo1w0;ay;re;l 1mo0one,ready,so,ways;st;b1t0;hat;ut;ain;ad;lot,posteriori|Expressiona02b01dXeVfuck,gShLlImHnGoDpBshAu7voi04w3y0;a1eLu0;ck,p;!a,hoo,y;h1ow,t0;af,f;e0oa;e,w;gh,h0;! 0h,m;huh,oh;eesh,hh,it;ff,hew,l0sst;ease,z;h1o0w,y;h,o,ps;!h;ah,ope;eh,mm;m1ol0;!s;ao,fao;a4e2i,mm,oly1urr0;ah;! mo6;e,ll0y;!o;ha0i;!ha;ah,ee,o0rr;l0odbye;ly;e0h,t cetera,ww;k,p;\'oh,a0uh;m0ng;mit,n0;!it;ah,oo,ye; 1h0rgh;!em;la|Preposition\'o,-,aKbHcGdFexcept,fEinDmidPnotwithstandiQoBpRqua,sAt6u3vi2w0;/o,hereMith0;!in,oQ;a,s-a-vis;n1p0;!on;like,til;h0ill,owards;an,r0;ough0u;!oI;ans,ince,o that;\',f0n1ut;!f;!to;or,rom;espite,own,u3;hez,irca;ar1e0oAy;low,sides,tween;ri6;\',bo7cross,ft6lo5m3propos,round,s1t0;!op;! long 0;as;id0ong0;!st;ng;er;ut|ConjunctionaEbAcuz,how8in caDno7o6p4supposing,t1vers5wh0yet;eth8ile;h0o;eref9o0;!uC;l0rovided that;us;r,therwi6; matt1r;!ev0;er;e0ut;cau1f0;ore;se;lthou1nd,s 0;far as,if;gh|DetermineraAboth,d8e5few,l3mu7neiCown,plenty,some,th2various,wh0;at0ich0;evB;at,e3is,ose;a,e0;!ast,s;a1i6l0nough,very;!se;ch;e0u;!s;!n0;!o0y;th0;er","conjugations":"t:ake,ook|:can,could,can,_|free:_,,,ing|puk:e,,,ing|ar:ise,ose,,,isen|babys:it,at|:be,was,is,am,been|:is,was,is,being|beat:_,,,ing,en|beg:in,an,,inning,un|ban:_,ned,,ning|bet:_,,,,_|bit:e,_,,ing,ten|ble:ed,d,,,d|bre:ed,d|br:ing,ought,,,ought|broadcast:_,_|buil:d,t,,,t|b:uy,ought,,,ought|cho:ose,se,,osing,sen|cost:_,_|deal:_,t,,,t|d:ie,ied,,ying|d:ig,ug,,igging,ug|dr:aw,ew,,,awn|dr:ink,ank,,,unk|dr:ive,ove,,iving,iven|:eat,ate,,eating,eaten|f:all,ell,,,allen|fe:ed,d,,,d|fe:el,lt|f:ight,ought,,,ought|f:ind,ound|fl:y,ew,,,own|bl:ow,ew,,,own|forb:id,ade|edit:_,,,ing|forg:et,ot,,eting,otten|forg:ive,ave,,iving,iven|fr:eeze,oze,,eezing,ozen|g:et,ot|g:ive,ave,,iving,iven|:go,went,goes,,gone|h:ang,ung,,,ung|ha:ve,d,s,ving,d|hear:_,d,,,d|hid:e,_,,,den|h:old,eld,,,eld|hurt:_,_,,,_|la:y,id,,,id|le:ad,d,,,d|le:ave,ft,,,ft|l:ie,ay,,ying|li:ght,t,,,t|los:e,t,,ing|ma:ke,de,,,de|mean:_,t,,,t|me:et,t,,eting,t|pa:y,id,,,id|read:_,_,,,_|r:ing,ang,,,ung|r:ise,ose,,ising,isen|r:un,an,,unning,un|sa:y,id,ys,,id|s:ee,aw,,eeing,een|s:ell,old,,,old|sh:ine,one,,,one|sho:ot,t,,,t|show:_,ed|s:ing,ang,,,ung|s:ink,ank|s:it,at|slid:e,_,,,_|sp:eak,oke,,,oken|sp:in,un,,inning,un|st:and,ood|st:eal,ole|st:ick,uck|st:ing,ung|:stream,,,,|str:ike,uck,,iking|sw:ear,ore|sw:im,am,,imming|sw:ing,ung|t:each,aught,eaches|t:ear,ore|t:ell,old|th:ink,ought|underst:and,ood|w:ake,oke|w:ear,ore|w:in,on,,inning|withdr:aw,ew|wr:ite,ote,,iting,itten|t:ie,ied,,ying|ski:_,ied|:boil,,,,|miss:_,,_|:act,,,,|compet:e,ed,,ing|:being,were,are,are|impl:y,ied,ies|ic:e,ed,,ing|develop:_,ed,,ing|wait:_,ed,,ing|aim:_,ed,,ing|spil:l,t,,,led|drop:_,ped,,ping|log:_,ged,,ging|rub:_,bed,,bing|smash:_,,es|egg:_,ed|suit:_,ed,,ing|age:_,d,s,ing|shed:_,_,s,ding|br:eak,oke|ca:tch,ught|d:o,id,oes|b:ind,ound|spread:_,_|become:_,,,,_|ben:d,,,,t|br:ake,,,,oken|burn:_,,,,ed|burst:_,,,,_|cl:ing,,,,ung|c:ome,ame,,,ome|cre:ep,,,,pt|cut:_,,,,_|dive:_,,,,d|dream:_,,,,t|fle:e,,,eing,d|fl:ing,,,,ung|got:_,,,,ten|grow:_,,,,n|hit:_,,,,_|ke:ep,,,,pt|kne:el,,,,lt|know:_,,,,n|leap:_,,,,t|len:d,,,,t|lo:ose,,,,st|prove:_,,,,n|put:_,,,,_|quit:_,,,,_|rid:e,,,,den|s:eek,,,,ought|sen:d,,,,t|set:_,,,,_|sew:_,,,,n|shake:_,,,,n|shave:_,,,,d|shut:_,,,,_|s:eat,,,,at|sla:y,,,,in|sle:ep,,,,pt|sn:eak,,,,uck|spe:ed,,,,d|spen:d,,,,t|sp:it,,,,at|split:_,,,,_|spr:ing,,,,ung|st:ink,unk,,,unk|strew:_,,,,n|sw:are,,,,orn|swe:ep,,,,pt|thrive:_,,,,d|undergo:_,,,,ne|upset:_,,,,_|w:eave,,,,oven|we:ep,,,,pt|w:ind,,,,ound|wr:ing,,,,ung","plurals":"addend|um|a,alga|e,alumna|e,alumn|us|i,appendi|x|ces,avocado|s,bacill|us|i,barracks|,beau|x,bus|es,cact|us|i,chateau|x,analys|is|es,diagnos|is|es,parenthes|is|es,prognos|is|es,synops|is|es,thes|is|es,child|ren,circus|es,clothes|,corp|us|ora,criteri|on|a,curricul|um|a,database|s,deer|,echo|es,embargo|es,epoch|s,f|oot|eet,gen|us|era,g|oose|eese,halo|s,hippopotam|us|i,ind|ex|ices,larva|e,lea|f|ves,librett|o|i,loa|f|ves,m|an|en,matri|x|ces,memorand|um|a,modul|us|i,mosquito|es,move|s,op|us|era,ov|um|a,ox|en,pe|rson|ople,phenomen|on|a,quiz|zes,radi|us|i,referend|um|a,rodeo|s,sex|es,shoe|s,sombrero|s,stomach|s,syllab|us|i,tableau|x,thie|f|ves,t|ooth|eeth,tornado|s,tuxedo|s,zero|s","patterns":{"Person":["master of #Noun","captain of the #Noun"]},"regex":{"HashTag":["^#[a-z]+"],"Gerund":["^[a-z]+n[\']$"],"PhoneNumber":["^[0-9]{3}-[0-9]{4}$","^[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$"],"Time":["^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$","^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$","^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$","^[PMCE]ST$","^utc ?[+-]?[0-9]+?$","^[a-z0-9]*? o\'?clock$"],"Date":["^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$","^[0-9]{1,4}/[0-9]{1,2}/[0-9]{1,4}$"],"Money":["^[-+]?[$][0-9]+(.[0-9]{1,2})?$","^[-+]?[$][0-9]{1,3}(,[0-9]{3})+(.[0-9]{1,2})?$"],"Value":["^[-+]?[$][0-9]+(.[0-9]{1,2})?$","^[-+]?[$][0-9]{1,3}(,[0-9]{3})+(.[0-9]{1,2})?$","^[0-9.]{1,2}[-][0-9]{1,2}$"],"NumberRange":["^[0-9.]{1,4}(st|nd|rd|th)?[-][0-9.]{1,4}(st|nd|rd|th)?$","^[0-9.]{1,2}[-][0-9]{1,2}$"],"NiceNumber":["^[-+]?[0-9.,]{1,3}(,[0-9.,]{3})+(.[0-9]+)?$"],"NumericValue":["^[-+]?[0-9]+(.[0-9]+)?$","^.?[0-9]+([0-9,.]+)?%$"],"Percent":["^.?[0-9]+([0-9,.]+)?%$"],"Cardinal":["^.?[0-9]+([0-9,.]+)?%$"],"Fraction":["^[0-9]{1,4}/[0-9]{1,4}$"],"LastName":["^ma?c\'.*","^o\'[drlkn].*"]}}'
},{}],209:[function(t,e,r){"use strict";var n=t("../subset/verbs/methods/conjugate/faster.js");e.exports=function(t){var e=this;return Object.keys(t).forEach(function(r){e.conjugations[r]=e.conjugations[r]||{},e.words[r]=e.words[r]||"Infinitive",Object.keys(t[r]).forEach(function(n){var a=t[r][n];e.conjugations[r][n]=a,e.words[a]=e.words[a]||n,e.cache.toInfinitive[t[r][n]]=r});var a=n(r,e);Object.keys(a).forEach(function(t){var r=a[t];!1===e.words.hasOwnProperty(r)&&(e.words[r]=t)})}),t}},{"../subset/verbs/methods/conjugate/faster.js":79}],210:[function(t,e,r){"use strict";e.exports=function(t){var e=this;return Object.keys(t).forEach(function(r){e.patterns[r]=t[r]}),t}},{}],211:[function(t,e,r){"use strict";e.exports=function(t){var e=this;return Object.keys(t).forEach(function(r){var n=t[r];e.plurals[r]=n,e.words[n]=e.words[n]||"Plural",e.words[r]=e.words[r]||"Singular",e.cache.toSingular[n]=r}),t}},{}],212:[function(t,e,r){"use strict";e.exports=function(t){var e=this;Object.keys(t).forEach(function(r){e.regex.push({reg:new RegExp(r,"i"),tag:t[r]})})}},{}],213:[function(t,e,r){"use strict";var n=t("../tags/addDownward");e.exports=function(t){var e=this;return Object.keys(t).forEach(function(r){var n=t[r];n.notA=n.notA||[],n.downward=n.downward||[],e.tags[r]=n}),n(this.tags),t}},{"../tags/addDownward":135}],214:[function(t,e,r){"use strict";var n=t("../term/methods/normalize/normalize").normalize,a=t("../subset/nouns/methods/pluralize"),i=t("../subset/verbs/methods/conjugate/faster.js"),o=t("../subset/adjectives/methods"),s=/ /;e.exports=function(t){var e=this;return Object.keys(t).forEach(function(r){var u=t[r];if(r=n(r).replace(/\s+/," ").replace(/[.\?,;\!]/g,""),e.words[r]=u,!0===s.test(r)){var l=r.split(s);e.cache.firstWords[l[0]]=!0}if("Singular"!==u)if("Infinitive"!==u)if("PhrasalVerb"!==u){if("Comparable"===u){var c=o.toComparative(r);c&&r!==c&&(e.words[c]="Comparative");var h=o.toSuperlative(r);h&&r!==h&&(e.words[h]="Superlative")}}else{var f=r.split(/ /),m=i(f[0],e);Object.keys(m).forEach(function(t){var r=m[t]+" "+f[1];e.words[r]="PhrasalVerb",e.cache.firstWords[m[t]]=!0})}else{var d=i(r,e);Object.keys(d).forEach(function(t){e.words[d[t]]=t})}else{var p=a(r,{});p&&p!==r&&(e.words[p]="Plural")}}),t}},{"../subset/adjectives/methods":11,"../subset/nouns/methods/pluralize":44,"../subset/verbs/methods/conjugate/faster.js":79,"../term/methods/normalize/normalize":149}],215:[function(t,e,r){"use strict";var n=t("../fns"),a=t("./_data"),i=t("./more-data"),o=t("../tags"),s=t("./unpack"),u=t("./addTags"),l=t("./addWords"),c=t("./addRegex"),h=t("./addConjugations"),f=t("./addPatterns"),m=t("./addPlurals"),d=t("./more-data/misc"),p=function(t,e){for(var r=Object.keys(e),n=0;n<r.length;n++)t[r[n]]=e[r[n]];return t},g=function(){this.words={},this.tags=o,this.regex=[],this.patterns={},this.conjugations={},this.plurals={},this.cache={firstWords:{},toInfinitive:{},toSingular:{}}};g.prototype.addTags=u,g.prototype.addWords=l,g.prototype.addRegex=c,g.prototype.addConjugations=h,g.prototype.addPlurals=m,g.prototype.addPatterns=f,g.prototype.clone=function(){var t=this,e=new g;return["words","firstWords","tagset","regex","patterns","conjugations","plurals"].forEach(function(r){t[r]&&(e[r]=n.copy(t[r]))}),e},g.prototype.plugin=function(t){(t=s(t)).tags&&this.addTags(t.tags),t.regex&&this.addRegex(t.regex),t.patterns&&this.addPatterns(t.patterns),t.conjugations&&this.addConjugations(t.conjugations),t.plurals&&this.addPlurals(t.plurals),t.words&&this.addWords(t.words)};var v=new g;v.plugin(a),v.addWords(d),i.forEach(function(t){p(v.words,t)}),e.exports={w:v,reBuild:function(){var t=new g;return t.plugin(a),t.addWords(d),i.forEach(function(e){p(t.words,e)}),t}}},{"../fns":3,"../tags":137,"./_data":208,"./addConjugations":209,"./addPatterns":210,"./addPlurals":211,"./addRegex":212,"./addTags":213,"./addWords":214,"./more-data":217,"./more-data/misc":219,"./unpack":223}],216:[function(t,e,r){"use strict";for(var n={Noun:["arc","al","exp","fy","pd","pl","plz","tce","bl","ma","ba","lit","ex","eg","ie","ca","cca","vs","etc","esp","ft","bc","ad","md","corp","col"],Organization:["dept","univ","assn","bros","inc","ltd","co","yahoo","joomla","jeopardy"],Place:["rd","st","dist","mt","ave","blvd","cl","ct","cres","hwy","ariz","cal","calif","colo","conn","fla","fl","ga","ida","ia","kan","kans","minn","neb","nebr","okla","penna","penn","pa","dak","tenn","tex","ut","vt","va","wis","wisc","wy","wyo","usafa","alta","ont","que","sask"],Month:["jan","feb","mar","apr","jun","jul","aug","sep","sept","oct","nov","dec"],Date:["circa"],Honorific:["adj","adm","adv","asst","atty","bldg","brig","capt","cmdr","comdr","cpl","det","dr","esq","gen","gov","hon","jr","llb","lt","maj","messrs","mister","mlle","mme","mr","mrs","ms","mstr","op","ord","phd","prof","pvt","rep","reps","res","rev","sen","sens","sfc","sgt","sir","sr","supt","surg"],Value:["no"]},a={},i=Object.keys(n),o=0;o<i.length;o++)for(var s=n[i[o]],u=0;u<s.length;u++)a[s[u]]=[i[o],"Abbreviation"];e.exports=a},{}],217:[function(t,e,r){"use strict";e.exports=[t("./abbreviations"),t("./irregularAdjectives").lexicon,t("./numbers").lexicon,t("./orgWords")]},{"./abbreviations":216,"./irregularAdjectives":218,"./numbers":220,"./orgWords":221}],218:[function(t,e,r){"use strict";var n={bad:"badly",best:"best",early:"early",fast:"fast",good:"well",hard:"hard",icy:"icily",idle:"idly",late:"late",latter:"latter",little:"little",long:"long",low:"low",male:"manly",public:"publicly",simple:"simply",single:"singly",special:"especially",straight:"straight",vague:"vaguely",well:"well",whole:"wholly",wrong:"wrong"},a={grey:"greyer",gray:"grayer",green:"greener",yellow:"yellower",red:"redder",good:"better",well:"better",bad:"worse",sad:"sadder",big:"bigger"},i={nice:"nicest",late:"latest",hard:"hardest",inner:"innermost",outer:"outermost",far:"furthest",worse:"worst",bad:"worst",good:"best",big:"biggest",large:"largest"},o=function(t,e,r){for(var n=Object.keys(e),a=0;a<n.length;a++)t[n[a]]="Comparable",void 0===t[e[n[a]]]&&(t[e[n[a]]]=r);return t},s=o({},i,"Superlative");s=o(s=o(s,a,"Comparative"),n,"Adverb"),e.exports={lexicon:s,toAdverb:n,toComparative:a,toSuperlative:i}},{}],219:[function(t,e,r){"use strict";e.exports={"20th century fox":"Organization","3m":"Organization","7 eleven":"Organization","7-eleven":"Organization",g8:"Organization","motel 6":"Organization",vh1:"Organization",q1:"Date",q2:"Date",q3:"Date",q4:"Date",records:"Plural","&":"Conjunction"}},{}],220:[function(t,e,r){"use strict";var n={ones:{zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24}},a={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24}},i={},o={},s={};Object.keys(a).forEach(function(t){for(var e=Object.keys(a[t]),r=Object.keys(n[t]),u=0;u<r.length;u++)i[r[u]]=e[u],o[e[u]]=r[u],s[e[u]]=["Ordinal","TextValue"],s[r[u]]=["Cardinal","TextValue"],"multiples"===t&&(s[e[u]].push("Multiple"),s[r[u]].push("Multiple"))}),e.exports={toOrdinal:i,toCardinal:o,cardinal:n,ordinal:a,prefixes:{yotta:1,zetta:1,exa:1,peta:1,tera:1,giga:1,mega:1,kilo:1,hecto:1,deka:1,deci:1,centi:1,milli:1,micro:1,nano:1,pico:1,femto:1,atto:1,zepto:1,yocto:1,square:1,cubic:1,quartic:1},lexicon:s}},{}],221:[function(t,e,r){"use strict";e.exports=["administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","building society","bureau","cafe","caisse","capital","care","cathedral","center","central bank","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","daily news","data","departement","department","department store","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","evening news","faculty","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","health authority","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institute of technology","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","liberation army","limited","local authority","local health authority","machines","magazine","management","marine","marketing","markets","media","memorial","mercantile exchange","ministere","ministry","military","mobile","motor","motors","musee","museum","news","news service","observatory","office","oil","optical","orchestra","organization","partners","partnership","people's party","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","polytechnic","post","power","press","productions","quartet","radio","regional authority","regional health authority","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","social club","societe","society","sons","standard","state police","state university","stock exchange","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"].reduce(function(t,e){return t[e]="Noun",t},{})},{}],222:[function(t,e,r){"use strict";var n=[null,"PastTense","PresentTense","Gerund","Participle"];e.exports=function(t){return t.split("|").reduce(function(t,e){var r=e.split(":"),a=r[0],i=r[1].split(","),o=a+i[0];"_"===i[0]&&(o=a),t[o]={};for(var s=1;s<n.length;s++){var u=r[0]+i[s];"_"===i[s]&&(u=r[0]),i[s]&&(t[o][n[s]]=u)}return t},{})}},{}],223:[function(t,e,r){"use strict";var n={words:t("efrt-unpack"),plurals:t("./plurals"),conjugations:t("./conjugations"),keyValue:t("./key-value")};e.exports=function(t){var e=t;return"string"==typeof t&&(e=JSON.parse(t)),e.words&&"string"==typeof e.words&&(e.words=n.words(e.words)),e.patterns&&(e.patterns=n.keyValue(e.patterns)),e.regex&&(e.regex=n.keyValue(e.regex)),e.plurals&&"string"==typeof e.plurals&&(e.plurals=n.plurals(e.plurals)),e.conjugations&&"string"==typeof e.conjugations&&(e.conjugations=n.conjugations(e.conjugations)),e}},{"./conjugations":222,"./key-value":224,"./plurals":225,"efrt-unpack":1}],224:[function(t,e,r){"use strict";e.exports=function(t){var e=Object.keys(t),r=!0;return e[0]&&"string"==typeof t[e[0]]&&(r=!1),e.reduce(function(e,n){return!0===r?t[n].forEach(function(t){e[t]?("string"==typeof e[t]&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n}):e[n]=t[n],e},{})}},{}],225:[function(t,e,r){"use strict";e.exports=function(t){return t.split(/,/g).reduce(function(t,e){var r=e.split(/\|/g);return 3===r.length?t[r[0]+r[1]]=r[0]+r[2]:2===r.length?t[r[0]]=r[0]+r[1]:t[r[0]]=r[0],t},{})}},{}]},{},[4])(4)});</script> <script>PERCH.nlpCompromise=window.nlp,delete window.nlp;</script> <script>PERCH.AvsAnSimple=function(a){function i(a){var e=parseInt(r,36)||0,o=e&&e.toString(36).length;a.article="."==r[o]?"a":"an",r=r.substr(1+o);for(var n=0;n<e;n++){var t=a[r[0]]={};r=r.substr(1),i(t)}}var r="2h.#2.a;i;&1.N;*4.a;e;i;o;/9.a;e;h1.o.i;l1./;n1.o.o;r1.e.s1./;01.8;12.1a;01.0;12.8;9;2.31.7;4.5.6.7.8.9.8a;0a.0;1;2;3;4;5;6;7;8;9;11; .22; ..31; .42; ..55; .,.h.k.m.62; .k.72; ..82; .,.92; ..8;<2.m1.d;o;=1.=1.E;@;A6;A1;A1.S;i1;r1;o.m1;a1;r1; .n1;d1;a1;l1;u1;c1.i1.a1.n;s1;t1;u1;r1;i1;a1;s.t1;h1;l1;e1;t1;e1.s;B2.h2.a1.i1;r1;a.;o1.r1.d1. ;C3.a1.i1.s1.s.h4.a2.i1.s1;e.o1.i;l1.;r1.o1.;u2.i;r1.r1.a;o1.n1.g1.j;D7.a1.o1.q;i2.n1.a1.s;o1.t;u1.a1.l1.c;1. ;;;;E7;U1;R.b1;o1;l1;i.m1;p1;e1;z.n1;a1;m.s1;p5.a1.c;e;h;o;r;u1.l1;o.w1;i.F11. ;,;.;/;0;1;2;3;4;5;6;71.0.8;9;Ae;B.C.D.F.I2.L.R.K.L.M.N.P.Q.R.S.T.B;C1;M.D;E2.C;I;F1;r.H;I3.A1;T.R1. ;U;J;L3.C;N;P;M;O1. ;P1;..R2.A1. ;S;S;T1;S.U2.,;.;X;Y1;V.c;f1.o.h;;G7.e1.r1.n1.e;h1.a3.e;i;o;i1.a1.n1.g;o2.f1. ;t1.t1. ;r1.i1.a;w1.a1.r1.r;;Hs. ;&;,;.2;A.I.1;2;3;5;7;B1;P.C;D;F;G;H1;I.I6;C.G.N.P.S1.D;T.K1.9;L;M1;..N;O2. ;V;P;R1;T.S1.F.T;V;e2.i1.r;r1.r1.n;o2.n6;d.e1.s;g.k.o2;l.r1;i1.f;v.u1.r;I3;I2;*.I.n1;d1;e1;p1;e1;n1;d2;e1;n1;c1;i..s1;l1;a1;n1;d1;s.J1.i1.a1.o;Ly. ;,;.;1;2;3;4;8;A3. ;P;X;B;C;D;E2. ;D;F1;T.G;H1.D.I1.R;L;M;N;P;R;S1;m.T;U1. ;V1;C.W1.T;Z;^;a1.o1.i1.g;o1.c1.h1.a1;b.p;u1.s1.h1;o.;M15. ;&;,;.1;A1;.1;S./;1;2;3;4;5;6;7;8;Ai;B.C.D.F.G.J.L.M.N.P.R.S.T.V.W.X.Y.Z.B1;S1;T.C;D;E3.P1;S.W;n;F;G;H;I4. ;5;6;T1;M.K;L;M;N;O1.U;P;Q;R;S;T1;R.U2. ;V;V;X;b1.u1.m;f;h;o2.D1.e.U1;..p1.3;s1.c;Ny. ;+;.1.E.4;7;8;:;A3.A1;F.I;S1.L;B;C;D;E3.A;H;S1. ;F1;U.G;H;I7.C.D1. ;K.L.N.O.S.K;L;M1;M.N2.R;T;P1.O1.V1./1.B;R2;J.T.S1;W.T1;L1.D.U1.S;V;W2.A;O1.H;X;Y3.C1.L;P;U;a1.s1.a1.n;t1.h;v;;;O5;N1;E.l1;v.n2;c1.e.e1.i;o1;p.u1;i.P1.h2.i1.a;o2.b2;i.o.i;Q1.i1.n1.g1.x;Rz. ;&;,;.1;J./;1;4;6;A3. ;.;F1;T.B1;R.C;D;E3. ;S1.P;U;F;G;H1.S;I2.A;C1. ;J;K;L1;P.M5;1.2.3.5.6.N;O2.H;T2;A.O.P;Q;R1;F.S4;,...?.T.T;U4;B.M.N.S.V;X;c;f1;M1...h2.A;B;;S11. ;&;,;.4.E;M;O;T1..3.B;D;M;1;3;4;5;6;8;9;A3. ;8;S2;E.I.B;C3.A1. ;R2.A.U.T;D;E6. ;5;C3;A.O.R.I1.F.O;U;F3;&.H.O1.S.G1;D.H3.2;3;L;I2. ;S1.O.K2.I.Y.L3;A2. ;.;I1. ;O.M3;A1. ;I.U1.R.N5.A.C3.A.B.C.E.F.O.O5. ;A1.I;E;S1;U.V;P7;A7;A.C.D.M.N.R.S.E1. ;I4;C.D.N.R.L1;O.O.U.Y.Q1. ;R;S1;W.T9.A1. ;C;D;F;I;L;M;S;V;U7.B.L.M.N.P.R.S.V;W1.R;X1.M;h1.i1.g1.a1.o;p1.i1.o1;n.t2.B;i1.c1.i;T4.a2.i2.g1.a.s1.c;v1.e1.s;e1.a1.m1.p;u1.i2.l;r;;Um..1.N1..1.C;/1.1;11. .21.1;L1.T;M1.N;N4.C1.L;D2. .P.K;R1. .a;b2;a.i.d;g1.l;i1.g.l2;i.y.m;no. ;a1.n.b;c;d;e1;s.f;g;h;i2.d;n;j;k;l;m;n;o;p;q;r;s;t;u;v;w;p;r3;a.e.u1.k;s3. ;h;t1;r.t4.h;n;r;t;x;z;;W2.P1.:4.A1.F;I2.B;N1.H.O1.V;R1.F1.C2.N.U.i1.k1.i1.E1.l1.i;X7;a.e.h.i.o.u.y.Y3.e1.t1.h;p;s;[5.A;E;I;a;e;_2._1.i;e;`3.a;e;i;a7; .m1;a1;r1. .n1;d2; ..p1;r1;t.r1;t1;.u1;s1;s1;i1. .v1;u1;t.d3.a1.s1. ;e2.m1. ;r1. ;i2.c1.h1. ;e1.s1.e2.m;r;e8;c1;o1;n1;o1;m1;i1;a.e1;w.l1;i1;t1;e1;i.m1;p1;e1;z.n1;t1;e1;n1;d.s2;a1. .t4;a1; .e1; .i1;m1;a1;r.r1;u1.t.u1.p1. ;w.f3. ;M;y1.i;h9. ;,;.;C;a1.u1.t1;b.e2.i1.r1;a.r1.m1.a1.n;o4.m2.a1; .m;n8; .b.d.e3; .d.y.g.i.k.v.r1.s1. ;u1.r;r1. ;t1;t1;p1;:.i6;b1;n.e1;r.n2;f2;l1;u1;.o1;a.s1;t1;a1;l1;a.r1; .s1; .u.k1.u1. ;l3.c1.d;s1. ;v1.a;ma. ;,;R;b1.a.e1.i1.n;f;p;t1.a.u1.l1.t1.i1.c1.a1.m1.p1.i;;n6. ;V;W;d1; .t;;o8;c2;h1;o.u1;p.d1;d1;y.f1; .g1;g1;i.no. ;';,;/;a;b;c1.o;d;e2.i;r;f;g;i;l;m;n;o;r;s;t;u;w;y;z;;r1;i1;g1;e.t1;r1.s;u1;i.r3. ;&;f;s9.,;?;R;f2.e.o.i1.c1.h;l1. ;p2.3;i1. ;r1.g;v3.a.e.i.t2.A;S;uc; ...b2.e;l;f.k2.a;i;m1;a1. .n3;a3; .n5.a;c;n;s;t;r1;y.e2; .i.i8.c2.o1.r1.p;u1.m;d1;i1.o;g1.n;l1.l;m1;o.n;s1.s;v1.o1;c.r5;a.e.i.l.o.s3. ;h;u1.r2;e.p3;a.e.i.t2.m;t;v.w1.a;xb. ;';,;.;8;b;k;l;m1;a.t;y1. ;y1.l;{1.a;|1.a;1.8;;;;;;;;;;;;;;;1;t3.a;o;u;;;1; .;;;;;;;;;;;;;2.e;i;;";return i(a),{raw:a,query:function(i){var r,e,o=a,n=0;do{e=i[n++]}while("\"$'".indexOf(e)>=0);for(;;){if(r=o.article||r,!(o=o[e]))return r;e=i[n++]||" "}}}}({});</script> <script>{
  const PERCH = window.PERCH;

  let textTransformNames = [];

  PERCH.addNodeMethods = function(node) {
    // NOTE: Object.defineProperty is used so that these properties aren't enumerable, since only child items should be enumerable.
    
    // REMEMBER TO UPDATE stringAndNumberModifications and arrayModifications if you add more methods

    Object.defineProperty(node, "$odds", {get:PERCH.$oddsMethod, configurable:true});
    Object.defineProperty(node, "getOdds", {get:PERCH.$oddsMethod, configurable:true});

    Object.defineProperty(node, "getName", {get:function() { return this.$text; }, configurable:true});
    Object.defineProperty(node, "getParent", {get:function() { return this.$parent; }, configurable:true});

    // This is incorrect because it counts properties that have been added by the user at runtime with code like `list.foo = 10`
    // Object.defineProperty(node, "getLength", {get:function() { return Object.keys(this).length; }, configurable:true});
    
    Object.defineProperty(node, "getLength", {get:function() { return this.$children.length; }, configurable:true});
    Object.defineProperty(node, "getRawListText", {get:function() { return this.$perchanceCode; }, configurable:true});

    // Workaround for the problem of a node not being resolved (mainly for use in functions) (I put this in the execution properties of the proxy)
    Object.defineProperty(node, "getSelf", {get:function() { return this; }, configurable:true});
    Object.defineProperty(node, "getPropertyKeys", {get:function() { return this.$valueChildren.slice(0); }, configurable:true}); // deprecated, but staying for backwards-compat. use getPropertyNames instead
    Object.defineProperty(node, "getPropertyNames", {get:function() { return this.$valueChildren.slice(0); }, configurable:true});
    Object.defineProperty(node, "getChildNames", {get:function() { return this.$children.slice(0); }, configurable:true});
    Object.defineProperty(node, "getFunctionNames", {get:function() { return this.$functionChildren.slice(0); }, configurable:true});
    Object.defineProperty(node, "getAllKeys", {get:function() { return this.$allKeys.slice(0); }, configurable:true});

    // Object.defineProperty(node, "isConsumable", {value:false, writable:true, configurable:true})

    Object.defineProperty(node, "toString", {value:PERCH.toStringMethod, configurable:true});
    
    // we need this otherwise if they have:
    //   num = {1-1000}
    // and they type [num.toLocaleString()], the JS engine calls toString on the object (since that's the default thing to do with objects, I guess), which results in a string.
    Object.defineProperty(node, "toLocaleString", {value:function(...args) {
      let result = String(this.toString()); // String()-ing because apparently toString can return a number?? no time to look into it right now
      if(String(Number(result)) === result) { 
        result = Number(result);
      }
      return result.toLocaleString(...args);
    }, writable:true, configurable:true});

    Object.defineProperty(node, "evaluateItem", {get:function() {
      return this.valueOf();
    }, configurable:true});


    // TODO: add a setter method for $odds which changes the node data? wait, shouldn't $odds just return the string? or not?

    // TODO: these need fixing (see funciton declaration for notes)
    // Object.defineProperty(node, "$addChild", {get:$addChildMethod});
    // Object.defineProperty(node, "$removeChild", {get:$removeChildMethod});

    Object.defineProperty(node, "selectOne", {get:PERCH.selectOneMethod, configurable:true});
    Object.defineProperty(node, "selectAll", {get:PERCH.selectAllMethod, configurable:true});
    Object.defineProperty(node, "selectMany", {value:PERCH.selectManyMethod, writable:true, configurable:true});
    Object.defineProperty(node, "selectUnique", {value:PERCH.selectUniqueMethod, writable:true, configurable:true});

    Object.defineProperty(node, "joinItems", {value:PERCH.joinItemsMethod, writable:true, configurable:true});
    
    Object.defineProperty(node, "sumItems", {get:function() {
      return this.selectAll.reduce((a, v) => a+v.evaluateItem, 0);
    }, configurable:true});

    Object.defineProperty(node, "valueOf", {value:PERCH.valueOfMethod, writable:true, configurable:true});

    //Object.defineProperty(node, "shuffleItems", {value:shuffleMethod, configurable:true});

    // TEXT TRANSFORMS:
    Object.defineProperty(node, "pluralForm", {get:PERCH.pluralFormMethod, configurable:true});
    Object.defineProperty(node, "singularForm", {get:PERCH.singularFormMethod, configurable:true});
    Object.defineProperty(node, "pastTense", {get:PERCH.pastTenseMethod, configurable:true});
    Object.defineProperty(node, "presentTense", {get:PERCH.presentTenseMethod, configurable:true});
    Object.defineProperty(node, "futureTense", {get:PERCH.futureTenseMethod, configurable:true});
    Object.defineProperty(node, "negativeForm", {get:PERCH.negativeFormMethod, configurable:true});
    // TODO**: should have seperate "soft" versions of sentence and title case which DON'T call toLowerCase on the whole string first? (i.e. to leave current capitalisations there)
    Object.defineProperty(node, "sentenceCase", {get:PERCH.sentenceCaseMethod, configurable:true});
    Object.defineProperty(node, "titleCase", {get:PERCH.titleCaseMethod, configurable:true});
    Object.defineProperty(node, "lowerCase", {get:PERCH.lowerCaseMethod, configurable:true});
    Object.defineProperty(node, "upperCase", {get:PERCH.upperCaseMethod, configurable:true});
    Object.defineProperty(node, "replaceText", {value:PERCH.replaceTextMethod, configurable:true});
    // REMEMBER: add text transform names here if you add new ones:
    if(textTransformNames.length === 0) {
      textTransformNames.push("pluralForm");
      textTransformNames.push("singularForm");
      textTransformNames.push("pastTense");
      textTransformNames.push("presentTense");
      textTransformNames.push("futureTense");
      textTransformNames.push("negativeForm");
      textTransformNames.push("sentenceCase");
      textTransformNames.push("titleCase");
      textTransformNames.push("lowerCase");
      textTransformNames.push("upperCase");
      textTransformNames.push("replaceText");
    }


    //Object.defineProperty(node, "createClone", {get:createCloneMethod, configurable:true});
    Object.defineProperty(node, "consumableList", {get:PERCH.consumableListMethod, configurable:true});

    Object.defineProperty(node, "createClone", {get:function() { return PERCH.duplicatePerchanceNode(this); }, configurable:true});

    // Object.defineProperty(node, "ordinal", {get:ordinalMethod});

    // Object.defineProperty(node, "$withArticle", {get:withArticleMethod});

    // TODO: add the rest of the default methods for version 1 (including getters like ".itemCount" (which gets the length of the $children array))
    // TODO: .hideOutput transform?
    // TODO: .replaceText("blah","na") transform (alias for .replace() except it always replaces ALL occurances unless you use regex and not the global flag)
    // TODO: add any newly added execution properties to the proxy executionProperties array (e.g. replaceText)
    // TODO***: remember that you'll need to move the `apply`s along with the text transforms that have an `apply` (e.g. replaceText)
  }

  PERCH.replaceTextMethod = function(needle, replacement) {
    if(needle instanceof RegExp) {
      return this.toString().replace(needle, replacement.toString());
    } else {
      //needle = new RegExp(needle.toString(), "g");
      //return this.toString().replace(needle, replacement.toString());
      return this.toString().split(needle.toString()).join(replacement.toString());
    }
  }

  // let createCloneMethod = function() {
  //   // TODO*****: This would try to clone $moduleSpace, $parent, $root, etc.???????????????????!!!!!!!!!!!!!!!!
  //   //              --> test by putting in debugger and testing `this.$parent === clone.parent`
  //   //              --> need to temporarily remove properties which reference other node objects directly? then add them back after
  //   //            At least it DOESN'T make copies of functions
  //   //            I think I need to make my own cloner... either that or really make sure this is working like I expect
  //   let clone = cloner.deep.copy(this);
  //   if(!this.___isLocalCall) {
  //     return clone;
  //   } else {
  //
  //     let proxiedThisRef;
  //     proxiedThisRef = new Proxy(clone, {
  //       // NOTE: if you edit this, edit the same one in evaluateSquareBlock
  //       get: function(target, property, receiver) {
  //         if(property === "$output") {
  //           return undefined;
  //         } else if(property === "___isLocalCall") {
  //           return true;
  //         } else {
  //
  //           let desc = Object.getOwnPropertyDescriptor(target, property);
  //           if(!desc) {
  //             perchanceError(`The '${property}' property doesn't exist within '${target.getName}'.`, ctxInfo.declarationLineNumber);
  //             return;
  //           }
  //           if(desc.get) {
  //             return desc.get.bind(proxiedThisRef)();
  //           } else if(desc.value && typeof desc.value === 'function') {
  //             return desc.value.bind(proxiedThisRef);
  //           } else {
  //             return target[property];
  //           }
  //
  //         }
  //       }
  //     });
  //
  //     return proxiedThisRef;
  //
  //   }
  // };

  PERCH.consumableListMethod = function() {


    // it's called consumable*List* because it only makes sense to call it on a list-oriented node

    // let list = this.createClone;
    // Object.defineProperty(list, "isConsumable", {value:true, configurable:true, writable:true}); // not $-prefixed because it should be publicly changable
    // return list;

    // If this node is wrapped in the $output-hider (See REF:kjhfw927f63ohwkgw82g in evaluateSquareBlock.js), then we unwrap it and do the unhiding ourself in the proxy we create below.
    // This is needed due to this problem: https://www.reddit.com/r/perchance/comments/fx7exs/how_to_have_multiple_lists_point_to_the_same/fmxzccb/ Basically, if we have something like `$output = [this.consumableList.selectMany(3)]`, then, target[property] will be returned (in the below proxy's getter) *bound to the $output-hider proxy* rather than this one, and so there is no consumableList from the perspective of selectMany. So we make this proxy handle the $output hiding stuff. Remember than binding is different to proxying! This is some chef's kiss spaghetti 
    let thisRef = this;
    let $outputShouldBeHidden = false;
    if(thisRef.___$outputShouldBeHidden) {
      thisRef = thisRef.___proxyTarget;
      $outputShouldBeHidden = true;
    }

    let proxy = new Proxy(thisRef, {
      alreadyConsumedItems:new Set(),
      get: function(target, property) {
        if(property === "selectOne") {
          // NOTE: inline consumable lists are handled in the toStringMethod
          let selectedNode = PERCH.selectOneMethod.bind(proxy)();
          if(selectedNode && selectedNode.$nodeType) { // make sure it's a node (could be an error string)
            this.alreadyConsumedItems.add(selectedNode);
          }
          return selectedNode;
        } else if(property === "evaluateItem") {
          return PERCH.valueOfMethod.bind(proxy)();
        } else if(property === "getLength") {
          if(Object.keys(target).includes("getLength")) return target["getLength"];
          else return target.$children.length - this.alreadyConsumedItems.size;
          // else return Object.keys(target).length - this.alreadyConsumedItems.size;
        } else if(property === "$alreadyConsumedItems") {
          return this.alreadyConsumedItems;
        } else if(textTransformNames.includes(property)) {
          return proxy.selectOne[property]; // added due to this problem: https://www.reddit.com/r/perchance/comments/7uw0sp/errors_with_consumablelist_and_uppercase_together/
        } else if(property === "getSelf") {
          return proxy;
        } else if($outputShouldBeHidden && property === "$output") {
          return undefined;
        } else {
          // TODO: strangely, the return value here seems to be automatically bound to this proxy.
          // so it also handles toString and valueOf methods like we want it to.
          // I think it's because in `foo().bar()`, bar is by default bound to the thing returned by foo?
          return target[property];
        }
      },
    });

    return proxy;

  };


  PERCH.valueOfMethod = function(key) {
    let str = this.toString();
    if(String(Number(str)) === str) {
      return Number(str);
    } else {
      return str;
    }
  };


  // let idMethod = function(key) {
  //
  //   if(typeof key !== 'string') {
  //     key = key.toString();
  //   }
  //
  //   // TODO***: (BIG ONE): clone `this` and set its toString method so it
  //   // always returns the $child string that was selected below BUT ALSO can
  //   // still have its sub-properties accessed. (i.e. the only difference between
  //   // the clone and the original is that the clone always returns a static string
  //   // when toString is called (instead of selecting a random child - or returning the
  //   // evaluated $value text in the case of a $value node))
  //   // BUT HERE'S THING THING: if a child node is selected and it's "the {cat|dog}", do
  //   // future requests to that id return "the {cat|dog}" or the EVALUATED version of
  //   // that text? So we can store either:
  //   //  - the node itself
  //   //  - the text of the node
  //   //  - the *evaluated* text of the node
  //   // and return it next time that id is called again. Which one? The ideal one seems
  //   // to depend on the context:
  //   /*
  //
  //   // here, the node one doesn't make sense, but the other two work fine
  //   animal
  //     dog
  //     cat
  //     pig
  //
  //   // here, the node one doesn't make sense, and the other two behave differently.
  //   // it seems like storing the *evaluated* text would make the most sense in this case.
  //   sentence
  //     I'm {going|running} to the {shops|hotel}.
  //     That's a {great|silly|quaint} handbag you've got there.
  //   // and actually, I can't think of an example where storing the un-evaluated text would
  //   // make sense.
  //
  //   NEW TACK: curly notation for the id thing because it will be so common:
  //   {animal#1} -> [animal.$id(1)]
  //   but wait - I still need to decide on id behavior...
  //   -----
  //   The cloning behaviour makes the most sense? Need to bite the bullet and spend a day perfecting this.
  //   It's an integral part of the last big trio (id/unique/remember)
  //
  //
  //   */
  //
  //   if(this.$idStore[key]) {
  //     return this.$idStore[key];
  //   } else {
  //     let child = this.$child;
  //
  //     // if its text is dynamic, we need to evaluate it (they expect the same text each time!).
  //     // if it's not, there's no need to evaluate it.
  //     // note that if it IS dynamic, then there won't be any child properties, so we can just store
  //     // and return a plain old string!
  //     let blocks = splitTextAtAllBlocks(child.$text);
  //     if(blocks.length > 1 || blocks[0][0] === "[" || blocks[0][0] === "{") {
  //       child = child.toString();
  //     }
  //
  //     this.$idStore[key] = child;
  //     return this.$idStore[key];
  //   }
  //
  // };
  // let setIdMethod = function(key) {
  //   if(this.$idStore[key]) {
  //     delete this.$idStore[key];
  //   }
  //   return this.$id(key);
  // };


  PERCH.selectAllMethod = function() {

    // This methos gets ALL items, regarless of whether they have odds == 0
    // If one wants to exlude `odds==0` items: list.selectAll.filter(item => item.getOdds > 0)
    
    let $output = this.$output;
    if($output !== undefined) {
      return [$output]; // make it an array because why not. (consistency is nice)
    }

    if(this.$nodeType === "value") {
      let text = this.$value;
      if(text[0] === "{" && text[text.length-1] === "}") {
        let items = PERCH.splitUpCurlyOrBlock(text.substr(1, text.length-2));
        if(items) { // i.e. if it's a valid curly OR block
          return items;
        } else {
          PERCH.perchanceError(`You've called 'selectAll' on something that doesn't appear to be a list?`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
          return;
        }
      } else {
        PERCH.perchanceError(`You've called 'selectAll' on something that doesn't appear to be a list?`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
        return;
      }
    }

    let arr = [];
    for(let key of this.$children) {
      arr.push(this[key]);
    }
    arr.toString = function() { return this.join(""); }; // This makes sense, right? Who would selectAll, but then expect a single random item? That would be silly.
    return arr;
  };




  PERCH.selectOneMethod = function() {

    const isConsumableList = !!this.$alreadyConsumedItems;

    let consumedNodes = new Set();
    if(isConsumableList) {
      consumedNodes = this.$alreadyConsumedItems; // this is a property of the consumableList proxy handler that we expose
    }

    let $output = this.$output; // cache it so we don't "execute" it twice if it's something like `$output = [this.age++]`
    if($output !== undefined) {
      return $output;
    }

    if(this.$nodeType === "value") {
      // I'm pretty sure we want to `toString` (evaulate) it because why would you call selectOne on a value node otherwise?
      // Consider these two examples:
      // height = {1-10}
      // height
      //   {1-10}
      // You might think we should treat the former the same way as the latter (i.e. NOT evaluate it), but that doesn't make sense in terms of the user's intention.
      // I'm pretty sure I've made the right decision here but hopefully the beta testers will surface any mistakes in my reasoning.
      let result = this.toString();
      if(String(Number(result)) === result) return Number(result);
      else return result;
    }

    let textNodes = [];
    let oddsSum = 0;
    let oddsArray = [];

    for(let key of this.$children) {
      let node = this[key];
      if(!consumedNodes.has(node)) {
        let odds = node.$odds; // remember, $odds is a getter and could be dynamic, so we musn't call it multiple times and expect the same result

        // if it has odds of zero, leave it out - but don't consume it, because it hasn't been consumed (zero odds could be temporary, for example)
        // EDIT: turns this doesn't really make sense for non-consumable lists (because you end up with problems like this: https://www.reddit.com/r/perchance/comments/co6msx/bug_list_name_being_included_in_output_of_list/)
        //       and it's not really that useful for cosumableLists either except to help people find bugs where their list ran out of non-zero-odds items. So I think
        //       due to the problems it causes with peoples' code it's not worth the trouble. So I'm commenting it out for now.
        //if(odds === 0 && isConsumableList) continue;

        if(odds < 0 || isNaN(odds)) {
          PERCH.perchanceError(`The item on this line has the following odds: <code>${node.$oddsText}</code>. This has resulted in an odds value of <code>${odds}</code>, which is not valid. It should be a positive number.`, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node});
        }

        textNodes.push(node);
        oddsSum += odds;
        oddsArray.push(odds);
      }
    }

    if(textNodes.length === 0) {
      if(consumedNodes.size > 0) return `(no more items in the consumable '${this.$text}' list)`;
      else {
        let out = PERCH.evaluateText(this.$root, this.$parent, this.$text, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this}); // we need to return the text if no children, otherwise we can't do nice stuff like this: https://www.reddit.com/r/perchance/comments/6g1uqk/fixed_variables/dio2da4/
        if(window.generatorLastEditTime > 1716337636385) { // May 22nd 2024 bugfix, ensures only generators edited after this time get it, to prevent breaking old generators that rely on the bug
          out = PERCH.processEscapedCharacters(out);
        }
        return out;
      }
      // and we need to *evaluate* the text because otherwise we couldn't do `c = b.selectOne.selectOne` in this example: https://www.reddit.com/r/perchance/comments/6qqc4d/items_in_shorthand_lists_arent_always_stored/dl01lkv/

      //else return `('${this.$text}' is not a list)`;
      // don't throw error because it's okay for a node not to have children
      //console.error(`Error trying to get child nodes of '${this.$text}' which was declared on line number ${this.$declarationLineNumber}.`);
      // if(this.isConsumable) return `(no more items in the consumable '${this.$text}' list)`;
      // else return `('${this.$text}' is not a list)`; // TODO***: return `this.$text` here since it's not consumable and has no children?
    }

    // choose random position in oddsSum range
    let oddsSumStopPoint = oddsSum*Math.random();
    let selectedTextNode = null;
    let oddsSumForChoice = 0;

    for(let i = 0; i < textNodes.length; i++) {
      oddsSumForChoice += oddsArray[i];
      if(oddsSumForChoice >= oddsSumStopPoint) {
        selectedTextNode = textNodes[i];
        break;
      }
    }

    if(selectedTextNode === null) {
      PERCH.perchanceError(`This shouldn't happen! This may be a problem with the Perchance engine. Please report this bug to <a href='https://lemmy.world/c/perchance'>lemmy.world/c/perchance</a>. A text node couldn't be picked during a random selection in a node's .toString() function. Here's some extra details for the bug report: this.$text=${this.$text}; this.$children=${this.$children.join(",")}; this.$declarationLineNumber=${this.$declarationLineNumber}`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
      console.log(this, textNodes);
      console.error("Returning first text node rather than random one to prevent crashing while debugging.");
      return textNodes[0];
    }

    // if(this.isConsumable) {
    //   let text = selectedTextNode.$text;
    //   this.$children = this.$children.filter(c => c !== text);
    //   delete this[text];
    // }

    return selectedTextNode;

  }


  PERCH.toStringMethod = function(opts={}) {

    // NOTE: We can't call processEscapedCharacters on the text before returning it because this method gets called
    //       DURING the evaluateSquareBlock calls that are inside evaluateText, and so processEscapedCharacters would get
    //       called multiple times on the same text. We actually (sort of counterintuitively) want to keep all the backslashes
    //       in the input until just before the whole string is returned.
    //       I was previously doing this by calling processEscapedCharacters in the updateTemplatedNodes function, but the
    //       problem with that is that if you have something like onclick="outputEl.innerHTML = animal.description" it won't
    //       remove the backslashes from the animal.description text. I was previously solving that by using the MutationObserver
    //       stuff, but that still doesn't cut it, because when you grab the text from a Perchance node and manipulate it with JS,
    //       you obviously don't expect it to have the escape characters in it.
    //   --> WAIT. I haven't slept in way too long, but I have a crazy theory that we actually don't want to strip the backslashes
    //       when the text is "viewed" from JavaScript. JavaScript is the "engine" so it makes sense that we'd see the text in its
    //       most "raw" state - no processing at all. Oh, so I just need to make evaluateItem strip the backslashes??
    //   --> WAIT AGAIN: I don't think that makes sense. When we convert a node/item to a string, we expect it to just be a plain
    //       string. It's "out of perchance" at that point. It's just meant to be a plain old string. So I think the obvious thing
    //       to do here (regarding the above note about this being used in the evaluateText function - and wanting to preserve
    //       backslashes until right before the final string is returned from this function) is just to use a version of this method
    //       which specifically doesn't remove backslashes, right? Should this function just take an options object? Yep, I'm going
    //       with that.

    // TODO***: use getOwnPropertyDescriptor to detect $output? since it could be defined and yet return undefined
    //          make sure you update other methods too
    let $output = this.$output;
    if($output !== undefined) {
      $output = typeof $output === "number" ? $output.toString() : $output.toString({keepEscapes:opts.keepEscapes}); // only pass the keepEscapes object if it's not a number (because numbers expect a radix as the param of toString)
      let result = PERCH.evaluateText(this.$root, this.$parent, $output, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
      if(opts.keepEscapes) return result;
      else return PERCH.processEscapedCharacters(result);
    }

    if(this.$nodeType === "value") {
      if(typeof this.$value === "number")  { return this.$value; }
      else {
        // if it's a consumableList and is plain inline notation like {1|2|3|4|...} with nothing before or after, then let's consume it
        let text = this.$value;
        if(this.$alreadyConsumedItems && text[0] === "{" && text[text.length-1] === "}") {
          let items = PERCH.splitUpCurlyOrBlock(text.substr(1, text.length-2));
          if(items) { // i.e. if it's a valid curly OR block
            // remove already consumed items
            items = items.filter(i => !this.$alreadyConsumedItems.has( PERCH.getTextOddsDetails(i).textWithoutOdds || i )); // "|| i" needed because getTextOddsDetails returns false if no odds details
            if(items.length === 0) return `(inline consumable list '${this.$key}' has no more items)`;
            // choose an item
            let chosenItem = PERCH.chooseRandomTextByOdds(this.$root, this.$parent, items, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
            // add the chosen item to $alreadyConsumedItems
            this.$alreadyConsumedItems.add(chosenItem);
            // return the chosen item
            if(opts.keepEscapes) return chosenItem;
            else return PERCH.processEscapedCharacters(chosenItem);
          }
        }
        if(this.$alreadyConsumedItems) PERCH.perchanceError(`You tried to make this into a consumable list: <code>${PERCH.escapeHTMLSpecialChars(this.$key)} = ${PERCH.escapeHTMLSpecialChars(this.$value)}</code>, but for an inline item to be consumable, it must be of the format <code>a = {b|c|d}</code> and cannot have anything outside of the curly brackets (e.g. you could not make <code>a = {b|c|d}efg</code> consumable).`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
        let result = PERCH.evaluateText(this.$root, this.$parent, this.$value, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
        if(opts.keepEscapes) return result;
        else return PERCH.processEscapedCharacters(result);
      }
    }

    // toString treats childless nodes differently to ones that have children (i.e. items that are themselves lists)
    // this sounds like a terrible idea at first, but I've put a bit of thought into it and it seems like the best option
    // so that newbies don't have to understand how the engine works just to simply do: [f = flower.selectOne]. The
    // alternative would be to make them do [f = flower.selectOne.itemName] which is ridiculous.
    // If you think about it, this approach actually makes a bit of sense. If `this` node is itself a list, then that's
    // an important fundamental difference, and so a difference in behaviour isn't really too unexpected.
    // What we're basically saying is that leaves are treated differently to branches. The awesome part about this
    // approach is that it alls us to do `[a = animal.selectOne] ... [a.genus]` - i.e. we can access the *properties*
    // of the selected animal. [a=animal.outputText] doesn't allow us to do this.
    if(this.$children.length === 0) {
      let result = PERCH.evaluateText(this.$root, this.$parent, this.$text, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
      if(opts.keepEscapes) return result;
      else return PERCH.processEscapedCharacters(result);
    }

    if(this.$children.length > 0) {

      let child = this.selectOne;
      if(typeof child === 'string') { // e.g., if it is an error message
        return child;
      }
      let text = child.$text;

      let result = PERCH.evaluateText(this.$root, child.$parent, text, {declarationLineNumber:child.$declarationLineNumber, moduleName:child.$moduleName, node:child});
      if(opts.keepEscapes) return result;
      else return PERCH.processEscapedCharacters(result);

    }

  };


  // let addItemMethod = function(key) {
  //   this.$children.push(key);
  //   this[key] = undefined;
  //   console.log("THIS NEEDS FIXING! (see TODO, below this line)")
  //   // TODO: fix this? what if they want to add a child of the added child? needs to be a *proper* node?
  //   // TODO: implement $addChildren and $removeChildren methods ($addChild and $removeChild should really just be aliases of these)
  // };
  // let removeItemMethod = function(key) {
  //   this.$children.filter(k => k !== key);
  //   delete this[key];
  //   // TODO: verify that this works and makes sense
  // };

  PERCH.$oddsMethod = function() {

    if(this.$oddsText == '1') return 1;
    if( String(Number(this.$oddsText)) === this.$oddsText ) return Number(this.$oddsText);

    // NOTE: must use $oddsText odds rather than this.$odds, because this is the definition of $odds! (it'd be recursive)
    if(typeof this.$oddsText !== 'string') {
      PERCH.perchanceError(`This shouldn't happen. This may be a problem with the Perchance engine. Please report this bug to <a href='https://lemmy.world/c/perchance'>lemmy.world/c/perchance</a>. The odds property of this node isn't a string. Here's some extra details for the bug report: this.$text=${PERCH.escapeHTMLSpecialChars(this.$text)}; this.$children=${PERCH.escapeHTMLSpecialChars(this.$children.join(","))}; this.$declarationLineNumber=${PERCH.escapeHTMLSpecialChars(this.$declarationLineNumber)}; this.$oddsText=${PERCH.escapeHTMLSpecialChars(this.$oddsText)}`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
      return 1;
    }

    let evaluatedOdds = PERCH.oddsTextToNumber(this.$root, this.$parent, this.$oddsText, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});
    if(typeof evaluatedOdds === 'number') {
      return evaluatedOdds;
    } else {
      // TODO: potentially convert strings to numbers using eval (if it is a number, obviously). The reason
      // I'm not doing it yet is because I may do string->number conversions automatically across the whole system.
      // i.e. in the evaluateSquareBlock function itself.
      PERCH.perchanceError(`The '^' character is used to specify how likely an item is of being chosen during a random selection. This line appears to have a '^' character, but the text after that character (<b>${PERCH.escapeHTMLSpecialChars(this.$oddsText)}</b>) isn't a number, or didn't evaluate to a number. You're allowed to use square and curly bracket expressions to randomly/dynamically determine the odds, but these expressions must evaluate to a number. In this case your odds expression didn't result in a number.`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});

      return 1;
    }

  };

  // let shuffleMethod = function(numShuffles) {
  //
  //   // TODO***: can't order object keys, so this method is useless on nodes (but useful for arrays and strings)
  //
  //   if(numShuffles === undefined) {
  //
  //     var array = this.$children;
  //     var currentIndex = array.length, temporaryValue, randomIndex;
  //     // While there remain elements to shuffle...
  //     while (0 !== currentIndex) {
  //       // Pick a remaining element...
  //       randomIndex = Math.floor(Math.random() * currentIndex);
  //       currentIndex -= 1;
  //       // And swap it with the current element.
  //       temporaryValue = array[currentIndex];
  //       array[currentIndex] = array[randomIndex];
  //       array[randomIndex] = temporaryValue;
  //     }
  //     array = array.map(c => this[c]); // map to actual node objects
  //     array.toString = function() { this.join(""); }
  //     return array;
  //
  //   } else {
  //
  //     let text = this.toString().split("");
  //     for(let i = 0; i < numShuffles; i++) {
  //       let i1 = Math.floor(text.length*Math.random());
  //       let i2 = Math.floor(text.length*Math.random());
  //       let c1 = text[i1];
  //       let c2 = text[i2];
  //       text[i1] = c2;
  //       text[i2] = c1;
  //     }
  //     return text.join("");
  //
  //   }
  //
  // }


  PERCH.joinItemsMethod = function(str) {

    let $output = this.$output;
    if($output !== undefined) {
      return $output.toString();
    }

    let arr = [];
    for(let c of this.$children) {
      arr.push(this[c].getName);
    }
    return arr.joinItems(str+"");
  };


  PERCH.selectUniqueMethod = function(...a) {
    return this.consumableList.selectMany(...a);
  };

  PERCH.selectManyMethod = function(...a) {

    let num;
    if(a.length === 1) {
      if(Array.isArray(a[0])) {
        num = Number(a[0][Math.floor(Math.random()*a[0].length)]);
      } else {
        num = Number(a[0]);
      }
    } else if(a.length === 2) {
      num = Number(a[0]) + Math.round(Math.random()*(a[1]-a[0]));
    } else if(a.length > 2) {
      num = Number(a[Math.floor(Math.random()*a.length)]);
    }
    if(isNaN(num) || typeof num !== 'number') {
      if(a.length === 0) {
        PERCH.perchanceError(`You didn't give the selectMany() function any inputs when you used it on the node with the text "${PERCH.escapeHTMLSpecialChars(this.$text || this)}". You need to give it at least one input so it knows how long the list/array should be.`, {moduleName:this.$moduleName});
      } else {
        PERCH.perchanceError(`There's a problem with the inputs that you provided to the "selectMany" function when you used it on the node with the text "${PERCH.escapeHTMLSpecialChars(this.$text || this)}". You have given it the following input${a.length == 1 ? "" : "s"}: <b>${PERCH.escapeHTMLSpecialChars(a.join("</b>, <b>"))}</b>. ${a.length == 1 ? "This" : "These"} input${a.length == 1 ? "" : "s"} should be numeric (i.e. ${a.length == 1 ? "it" : "they"} should be${a.length == 1 ? " a " : " "} number${a.length == 1 ? "" : "s"}).`, {moduleName:this.$moduleName});
      }
      return ["(syntax error)"];
    }
    let arr = [];
    for(let i = 0; i < num; i++) {
      arr.push(this.selectOne);
    }
    // overwrite default array behaviour (selects a random one)
    // in the case where they don't specify a join() after the repeat:
    arr.toString = function() { return this.join(""); };
    return arr;
  };



  PERCH.titleCaseMethod = function() {
    return this.toString().split(' ').map((s) => (s.slice(0, 1).toUpperCase() + s.slice(1).toLowerCase())).join(' ');
  };
  PERCH.sentenceCaseMethod = function() {
    return this.toString().split(/([!?.]+)/g).map((s) => {
      let i = s.search(/[a-zA-Z]/);
      let a = s.slice(0, i);
      let b = s.slice(i, i+1).toUpperCase();
      let c = s.slice(i+1);
      return a + b + c;
    }).join("");
  };
  PERCH.upperCaseMethod = function() {
    //debugger;
    return this.toString().toUpperCase();
  };
  PERCH.lowerCaseMethod = function() {
    return this.toString().toLowerCase();
  };

  !function(e,a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define(function(){return a()}):e.pluralize=a()}(this,function(){var e=[],a=[],i={},r={},s={};function o(e){return"string"==typeof e?new RegExp("^"+e+"$","i"):e}function t(e,a){return e===a?a:e===e.toLowerCase()?a.toLowerCase():e===e.toUpperCase()?a.toUpperCase():e[0]===e[0].toUpperCase()?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():a.toLowerCase()}function n(e,a){return e.replace(a[0],function(i,r){var s,o,n=(s=a[1],o=arguments,s.replace(/\$(\d{1,2})/g,function(e,a){return o[a]||""}));return t(""===i?e[r-1]:i,n)})}function u(e,a,r){if(!e.length||i.hasOwnProperty(e))return a;for(var s=r.length;s--;){var o=r[s];if(o[0].test(a))return n(a,o)}return a}function l(e,a,i){return function(r){var s=r.toLowerCase();return a.hasOwnProperty(s)?t(r,s):e.hasOwnProperty(s)?t(r,e[s]):u(s,r,i)}}function c(e,a,i,r){return function(r){var s=r.toLowerCase();return!!a.hasOwnProperty(s)||!e.hasOwnProperty(s)&&u(s,s,i)===s}}function h(e,a,i){return(i?a+" ":"")+(1===a?h.singular(e):h.plural(e))}return h.plural=l(s,r,e),h.isPlural=c(s,r,e),h.singular=l(r,s,a),h.isSingular=c(r,s,a),h.addPluralRule=function(a,i){e.push([o(a),i])},h.addSingularRule=function(e,i){a.push([o(e),i])},h.addUncountableRule=function(e){"string"!=typeof e?(h.addPluralRule(e,"$0"),h.addSingularRule(e,"$0")):i[e.toLowerCase()]=!0},h.addIrregularRule=function(e,a){a=a.toLowerCase(),e=e.toLowerCase(),s[e]=a,r[a]=e},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach(function(e){return h.addIrregularRule(e[0],e[1])}),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach(function(e){return h.addPluralRule(e[0],e[1])}),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/(dg|ss|ois|lk|ok|wn|mb|th|ch|ec|oal|is|ck|ix|sser|ts|wb)ies$/i,"$1ie"],[/\b(l|(?:neck|cross|hog|aun)?t|coll|faer|food|gen|goon|group|hipp|junk|vegg|(?:pork)?p|charl|calor|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach(function(e){return h.addSingularRule(e[0],e[1])}),["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","furniture","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[e]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(h.addUncountableRule),h});
  PERCH.pluralize396795627295786 = window.pluralize;
  delete window.pluralize;

  PERCH.pluralFormMethod = function() {
    let input = this.toString();
    return PERCH.pluralize396795627295786(input);
    
    //let output = nlp(input).nouns().toPlural().out("text");
    //return output === "" ? input : output; // don't add "s" by default because the lib should already do it, and sometimes plural is same as singular (e.g. furniture)
  };
  PERCH.singularFormMethod = function() {
    let input = this.toString();
    return PERCH.pluralize396795627295786(input, 1);
    
    // let output = nlp(input).nouns().toSingular().out("text");
    // return output === "" ? input : output;
  };


  let nlpCompromiseAddedWords = {abolish:"Verb",abound:"Verb",abstract:"Verb",accent:"Verb",accomplish:"Verb",admonish:"Verb",alert:"Verb",ally:"Verb",appropriate:"Verb",astonish:"Verb",auction:"Verb",audition:"Verb",average:"Verb",awake:"Verb",award:"Verb",back:"Verb",backpedal:"Verb",banish:"Verb",bank:"Verb",bankrupt:"Verb",better:"Verb",bill:"Verb",blacklist:"Verb",bless:"Verb",blind:"Verb",bloody:"Verb",blossom:"Verb",board:"Verb",bob:"Verb",bombard:"Verb",bottle:"Verb",brave:"Verb",breakfast:"Verb",brief:"Verb",bus:"Verb",busy:"Verb",butcher:"Verb",butter:"Verb",cake:"Verb",calm:"Verb",captain:"Verb",care:"Verb",cash:"Verb",caution:"Verb",center:"Verb",cherish:"Verb",christen:"Verb",chronicle:"Verb",chuck:"Verb",circumvent:"Verb",clean:"Verb",clear:"Verb",club:"Verb",commission:"Verb",complete:"Verb",comply:"Verb",conceal:"Verb",condition:"Verb",content:"Verb",contrive:"Verb",cool:"Verb",correct:"Verb",corrupt:"Verb",critique:"Verb",cup:"Verb",dawn:"Verb",degenerate:"Verb",demolish:"Verb",deprive:"Verb",derive:"Verb",design:"Verb",diminish:"Verb",disable:"Verb",discard:"Verb",disregard:"Verb",don:"Verb",double:"Verb",down:"Verb",dry:"Verb",dull:"Verb",elaborate:"Verb",embellish:"Verb",empty:"Verb",engineer:"Verb",enlist:"Verb",equal:"Verb",erect:"Verb",exact:"Verb",faint:"Verb",fake:"Verb",fancy:"Verb",fine:"Verb",firm:"Verb",fish:"Verb",fit:"Verb",flatter:"Verb",flicker:"Verb",flourish:"Verb",fly:"Verb",ford:"Verb",forward:"Verb",foster:"Verb",foul:"Verb",free:"Verb",frequent:"Verb",fund:"Verb",furnish:"Verb",further:"Verb",garnish:"Verb",gossip:"Verb",grace:"Verb",grant:"Verb",ground:"Verb",group:"Verb",herald:"Verb",hoist:"Verb",hollow:"Verb",hope:"Verb",house:"Verb",hum:"Verb",humble:"Verb",ice:"Verb",impoverish:"Verb",indent:"Verb",index:"Verb",initial:"Verb",institute:"Verb",inventory:"Verb",knot:"Verb",last:"Verb",lavish:"Verb",lean:"Verb",light:"Verb",lobby:"Verb",long:"Verb",lower:"Verb",lunch:"Verb",mail:"Verb",man:"Verb",mark:"Verb",marshal:"Verb",mature:"Verb",mean:"Verb",mellow:"Verb",milk:"Verb",mimic:"Verb",mine:"Verb",model:"Verb",moderate:"Verb",motion:"Verb",mute:"Verb",narrow:"Verb",near:"Verb",nestle:"Verb",nick:"Verb",number:"Verb",nurse:"Verb",obscure:"Verb",oil:"Verb",open:"Verb",outlive:"Verb",overcrowd:"Verb",overdo:"Verb",overeat:"Verb",overflow:"Verb",overhaul:"Verb",overhear:"Verb",overheat:"Verb",overload:"Verb",overlook:"Verb",overpower:"Verb",overrule:"Verb",oversee:"Verb",overshadow:"Verb",oversleep:"Verb",overthrow:"Verb",overturn:"Verb",own:"Verb",panic:"Verb",part:"Verb",partition:"Verb",patent:"Verb",patrol:"Verb",pedal:"Verb",pepper:"Verb",perfect:"Verb",perish:"Verb",petition:"Verb",plant:"Verb",please:"Verb",ply:"Verb",police:"Verb",polish:"Verb",position:"Verb",post:"Verb",pound:"Verb",power:"Verb",press:"Verb",pressure:"Verb",prime:"Verb",pucker:"Verb",punish:"Verb",query:"Verb",quiz:"Verb",rain:"Verb",rally:"Verb",ration:"Verb",rear:"Verb",rebel:"Verb",rebound:"Verb",refurbish:"Verb",relish:"Verb",repeal:"Verb",replenish:"Verb",requisition:"Verb",research:"Verb",reserve:"Verb",rev:"Verb",revive:"Verb",right:"Verb",ring:"Verb",rival:"Verb",round:"Verb",salt:"Verb",sanction:"Verb",scent:"Verb",school:"Verb",secure:"Verb",separate:"Verb",service:"Verb",shut:"Verb",signal:"Verb",silhouette:"Verb",single:"Verb",slow:"Verb",smooth:"Verb",snicker:"Verb",snow:"Verb",sour:"Verb",space:"Verb",spare:"Verb",speed:"Verb",spike:"Verb",spiral:"Verb",spy:"Verb",square:"Verb",stable:"Verb",station:"Verb",steady:"Verb",steam:"Verb",stuff:"Verb",sue:"Verb",tame:"Verb",tan:"Verb",taper:"Verb",tarnish:"Verb",tender:"Verb",tense:"Verb",thin:"Verb",thunder:"Verb",till:"Verb",time:"Verb",top:"Verb",total:"Verb",trouble:"Verb",undercut:"Verb",underline:"Verb",undertake:"Verb",undervalue:"Verb",up:"Verb",upset:"Verb",utter:"Verb",vanish:"Verb",varnish:"Verb",void:"Verb",wade:"Verb",warm:"Verb",water:"Verb",weather:"Verb",wed:"Verb",welcome:"Verb",woo:"Verb",wound:"Verb"};
  PERCH.pastTenseMethod = function() {
    let word = this.toString();
    if(word === "hope" || word === "hopes" || word === "hoped" || word === "hoping") return "hoped";
    if(word === "bill" || word === "bills" || word === "billed" || word === "billing") return "billed";
    if(word === "dawn" || word === "dawns" || word === "dawned" || word === "dawning") return "dawned";
    //return nlp(this.toString(), nlpCompromiseAddedWords).sentences().toPastTense().out("text")
    let out = PERCH.nlpCompromise("They "+this.toString(), nlpCompromiseAddedWords).verbs().conjugate()[0];
    return out ? out.PastTense : this.toString()+"ed";
  };
  PERCH.futureTenseMethod = function() {
    let word = this.toString();
    if(word === "hope" || word === "hopes" || word === "hoped" || word === "hoping") return "will hope";
    if(word === "bill" || word === "bills" || word === "billed" || word === "billing") return "will bill";
    if(word === "dawn" || word === "dawns" || word === "dawned" || word === "dawning") return "will dawn";
    //return nlp(this.toString(), nlpCompromiseAddedWords).sentences().toFutureTense().out("text")
    let out = PERCH.nlpCompromise("They "+this.toString(), nlpCompromiseAddedWords).verbs().conjugate()[0];
    return out ? out.FutureTense : this.toString()+"ed";
  };
  PERCH.presentTenseMethod = function() {
    let word = this.toString();
    if(word === "hope" || word === "hopes" || word === "hoped" || word === "hoping") return "hopes";
    if(word === "bill" || word === "bills" || word === "billed" || word === "billing") return "bills";
    if(word === "dawn" || word === "dawns" || word === "dawned" || word === "dawning") return "dawns";
    //return nlp(this.toString(), nlpCompromiseAddedWords).sentences().toPresentTense().out("text")
    let out = PERCH.nlpCompromise("They "+this.toString(), nlpCompromiseAddedWords).verbs().conjugate()[0];
    return out ? out.PresentTense : this.toString()+"ed";
  };

  PERCH.negativeFormMethod = function() {
    return PERCH.nlpCompromise(this.toString()).sentences().toNegative().out("text");
  };

  // let ordinalMethod = function() {
  //   return nlp.getOrdinal(this.toString());
  // };
  // let withArticleMethod = function() {
  //   return nlp.getWithArticle(this.toString());
  // };

}</script> <script>{
  const PERCH = window.PERCH;

  PERCH.evaluateSquareBlock = function(root, thisRef, expression, ctxInfo={}) {

    let originalExpression = expression;
    expression = expression.trim();

    if(PERCH.throwErrorIfNonDirectListReferenceIsFoundDuringEvaluateSquareBlock) {
      if(!PERCH.isValidJavaScriptIdentifier(expression)) {
        throw new Error("this is a harmless error - it's just used to break out of the direct-node-linking process createPerchanceTree");
      }
    }

    // **WITHIN a node**, we don't want references to `this` to result in "$output"
    // Otherwise we're very limited in terms of how we can interact with "local" items (can't use selectOne, etc. EVEN IN `$output` (since it would reference itself no matter what))
    // Note that we can't just temporarily set $output to undefined, because the square block that we're evaluating could reference another list which references THIS list and expects $output to work. We only want uses of `this` in this square block (and uses of `this` within chained methods like selectOne in this example: `[this.selectOne]` - hence the need to bind functions to this proxy)
    // REF:kjhfw927f63ohwkgw82g
    let proxiedThisRef = undefined;
    if(Object.getOwnPropertyDescriptor(thisRef, "$output")) {

      proxiedThisRef = new Proxy(thisRef, {
        get: function(target, property) {
          if(property === "$output") {
            return undefined; // <-- we pretend that this list doesn't have an $output property so that node methods like toString don't use it.
          } else if(property === "___$outputShouldBeHidden") {
            return true; // this is a hack to tell the consumableList proxy to hide the $output property (since we can only bind a function to one of the proxies)
          } else if(property === "___proxyTarget") {
            return thisRef;
          } else {

            let desc = Object.getOwnPropertyDescriptor(target, property);
            if(!desc) {
              //perchanceError(`The '${property}' property doesn't exist within '${target.$text}'.`, ctxInfo.declarationLineNumber);
              return undefined;
            }
            
            if(desc.get) {
              return desc.get.bind(proxiedThisRef)(); // <-- need to bind to this proxy so that the $output property is hidden from all successively chained functions - e.g. this.consumableList.selectOne.toString()
            } else if(desc.value && typeof desc.value === 'function') {
              return desc.value.bind(proxiedThisRef);
            } else {
              return target[property];
            }

          }
        }
      });

    }

    try {

      let tempHasHandlerHolder;
      if(root.___isProxy) {
        tempHasHandlerHolder = root.___proxyHandler.has;
        root.___proxyHandler.has = document.__perchanceInternal.rootProxyHasHandler_Greedy.bind(root.___proxyHandler);
      }
      PERCH.currentEvaluateSquareBlockRoot = root; // this is for String.prototype.evaluateItem, etc. handlers because otherwise they have no way of accessing their root if they are from an *imported* generator.
      let result = (function(){ return eval(`with(root){${expression}}`); }).apply(proxiedThisRef || thisRef); // NOTE: we can't change this to `with(root.getSelf)` because we're using the proxy to make it so [thingThatDoesntExist] returns undefined rather than throwing a syntax error.
      if(root.___isProxy) root.___proxyHandler.has = tempHasHandlerHolder; //.bind(root.___proxyHandler);
      PERCH.currentEvaluateSquareBlockRoot = null;

      if(result === undefined) {
        PERCH.perchanceError(`The expression '[${PERCH.escapeHTMLSpecialChars(originalExpression)}]' returned nothing (<code>undefined</code>). You may be trying to reference a list, variable, or function that doesn't exist. Here are some common causes of this error: <ul><li>You tried to reference a list/variable that you haven't created. For example, if you wrote [animal], but there was no top-level list called "animal", then you would get this error. Note that names are <b>case-sensitive</b> - check your capitalization.</li><li>If you misspell a property/function name, then you'll get this error. For example "[noun.pluralFormm]" would produce this error because "pluralForm" has been misspelled.</li><li>If you try to access a property of an object that doesn't exist, or that evaluates to something which doesn't exist, then you'll get this error.</li></ul> These errors can sometimes be hard to debug, so after you've given it your best shot, please post a question over on the <a href="https://lemmy.world/c/perchance">perchance community</a> and a friendly community member will help you out :)`, ctxInfo);
        return undefined;
      } else {
        if(typeof result === 'string' && String(Number(result)) === result) {
          return Number(result);
        } else {
          return result;
        }
      }
    } catch(e) {
      if(PERCH.throwErrorIfNonDirectListReferenceIsFoundDuringEvaluateSquareBlock) {
        throw new Error("ignore this");
      }
      if(e.message.toLowerCase().includes("call stack size")) {
        PERCH.perchanceError(`There's a problem with the syntax of this expression: '[${PERCH.escapeHTMLSpecialChars(originalExpression)}]'. Here's the message that was returned when execution failed: <b>${PERCH.escapeHTMLSpecialChars(e.message.slice(0, 5000))}</b>. It may be that you've accidentally created an "infinite loop" by making a list reference itself, or something like that.`, ctxInfo);
      } else if(e.message.toLowerCase().includes("token") && (originalExpression.includes("") || originalExpression.includes(""))) {
        PERCH.perchanceError(`There's a problem with the syntax of this expression: '[${PERCH.escapeHTMLSpecialChars(originalExpression)}]'. Here's the message that was returned when execution failed: <b>${PERCH.escapeHTMLSpecialChars(e.message.slice(0, 5000))}</b>. It looks like you might be using "curly quotes" (like this: <code>blah</code>) instead of normal quotes (like this: <code>"blah"</code>)? Perchance requires that you use normal quotes for text inside square brackets (e.g. <code>[a = animal.selectOne,""]</code>).`, ctxInfo);
      } else {
        PERCH.perchanceError(`There's a problem with the syntax of this expression: '[${PERCH.escapeHTMLSpecialChars(originalExpression)}]'. Here's the message that was returned when execution failed: <b>${PERCH.escapeHTMLSpecialChars(e.message)}</b>. Here are some common mistakes: <ul><li>you tried to reference a variable/list that you haven't created</li><li>list names are case-sensitive: "[animal]" is different to [Animal], and you should use underscores in list names instead of spaces</li></ul>`, ctxInfo);
      }
      return "(syntax error)";
    }
  }

}</script> <script>{
  const PERCH = window.PERCH;

  // Heads up: This code is extremely messy and hacked together. Many comments are outdated.

  let NODE_ODDS_INDICATOR_CHARACTER = "^";

  // adding to document as an alternative to 'polluting' window. We can't add to PERCH since it needs to be accessible in eval/`new Function()` code
  document.__perchanceInternal.rootProxyHasHandler = undefined; // <-- gets set after rootProxy creation
  document.__perchanceInternal.rootProxyHasHandler_Greedy = function(target, prop) {

    let isInGlobalScope;
    if(PERCH.withExportDebug83748) {
      isInGlobalScope = prop in window;
      if(!isInGlobalScope) {
        // for e.g. `let` declarations that are in the global scope but not in the window object:
        try { eval(prop); isInGlobalScope = true; } catch(e) {}
      }
    } else {
      isInGlobalScope = prop in window;
    }

    if(isInGlobalScope) {
      if(prop in this.executeChain(target, this.capturedCalls)) {
        return true;
      } else {
        return false; // don't be so greedy that we steal window's props even when `window` has it and `root` doesn't.
      }
    } else {
      return true;
    }
  }

  // window.globalProxyLoopCount = 0;
  // function proxyLoopCountResetLoop() {
  //   window.globalProxyLoopCount = 0;
  //   setTimeout(proxyLoopCountResetLoop, 1000);
  // }
  // proxyLoopCountResetLoop();

  PERCH.createPerchanceTree = function(text, moduleName, backupModuleName /*<-- this is for the hacky node creation function*/, doNotPreprocess) {

    const functionStartTime = Date.now();

    /*
      There are two main steps in creating the tree:
      1. We split up the text into lines and collect all the data we need about each line (e.g. odds, line number, etc.) and tidy it up as necessary (e.g. .trim() it, or remove it completely if it's a comment). Then we group sets of lines that are below a function header into said function header. We create all the parent/child hierarchy links along the way.
      2. We turn all that node data into a neat "perchance tree" which has the properties required to make the DSL work nicely, and we attach all the perchance methods to each node. Then we return the root node in this tree.
    */

    // remove inline comments
    let lines = text.replace(/\r/g,"").split("\n");
    const commentRegex = /\/\//;
    for(let i = 0; i < lines.length; i++) {
      if(!commentRegex.test(lines[i])) continue; // <-- just an optimisation
      lines[i] = PERCH.stripCommentFromLine(lines[i]);
    }

    // *trim* EMPTY lines (otherwise whitespace can throw indentation error in next step)
    // we need to keep blank lines so line numbers are preserved. they're removed in a bit
    lines = lines.map(text => /[^\s]/.test(text) ? text : text.trim());

    // mixed spaces and tabs -> only tabs
    for(let i = 0; i < lines.length; i++) {
      let normed = PERCH.normaliseLineIndentsToTabs(lines[i]);
      if(normed === false) {
        PERCH.perchanceError(`There appears to be an indenting error on this line near this text: "${PERCH.escapeHTMLSpecialChars(lines[i].substr(0,30))}". Perchance lists should be indented with either one tab or two spaces (per nesting level). If you want to have a space before a list item, then you should start the item with "\\s" (backslash + "s") which will be converted into a space (you can read more about this in the <a href="/tutorial">tutorial</a>).`, {declarationLineNumber:i+1, moduleName});
        return;
      } else {
        lines[i] = normed;
      }
    }

    // make lines objects
    for(let i = 0; i < lines.length; i++) {
      lines[i] = {
        text: lines[i],
        indents: lines[i].search(/[^\t]/), //index of first non-tab
        lineNumber:i+1, // plus one because line num start at 1 by convention
        children:[],
        parent: null,
        // REMEMBER: if you add anything here you need to add it to root line bject and line objects created in inline declarations
      }
      lines[i].text = lines[i].text.trim(); //trim away indents and end whitespace
    }

    // remove blank lines, but keep track of them via a reference from the line above (which works fine for successive blank lines), so we can add them back for function bodies (since e.g. in multi-line string the blank lines matter)
    lines = lines.filter((l, i) => {
      if(l.text === "") {
        if(lines[i-1]) lines[i-1].blankLineBelow = l;
        return false;
      } else {
        return true;
      }
    });

    // create parent-child hierarchy
    let root = {
      text:"<root>",
      indents:-1,
      lineNumber:-1,
      children:[],
      parent: null,
      nodeType: "text",
      odds: "1",
      perchanceCode:"",
      //expressionArray: ["<root>"],
    };
    let indentOwners = {0:root}; // maps # indents of current line to correct parent
    for(let i = 0; i < lines.length; i++) {
      let line = lines[i];
      let indents = line.indents;
      if(indentOwners[indents]) {
        // this is child of indentOwners[indents]:
        indentOwners[indents].children.push(line);
        line.parent = indentOwners[indents];
        // this becomes owner of next indent level:
        indentOwners[indents+1] = line;
        // and *no one* owns the indent level after that:
        indentOwners[indents+2] = undefined;
      } else {
        PERCH.perchanceError(`There appears to be an indenting error on this line near this text: "${PERCH.escapeHTMLSpecialChars(line.text.substr(0,30))}". Perchance lists should be indented with either one tab or two spaces. If you want to have a space before a list item, then you should start the item with "\\s" (backslash + "s") which will be converted into a space (you can read more about this in the <a href="/tutorial">tutorial</a>).`, {declarationLineNumber:line.lineNumber, moduleName});
        return;
      }
    }

    // for each node, get the perchance text required to create it.
    for(let i = 0; i < lines.length; i++) {
      // for each line (ordered top to bottom)...
      lines[i].perchanceCode = lines[i].text;
      let j = 0;
      let parent = lines[i].parent;
      let ancestor = parent;
      // append this line's text to *all* ancestors of this line (with appropriate indentation):
      while(1) {

        if(ancestor.parent === null) ancestor.perchanceCode += `${ancestor.perchanceCode ? "\n" : ""}` + lines[i].text; // handle case where ancestor === root node
        else ancestor.perchanceCode += "\n" + "  ".repeat(lines[i].indents - ancestor.indents) + lines[i].text;

        // EDIT: we also need to add blank lines back in because they matter e.g. for multi-line strings in function bodies:
        let blankLine = lines[i].blankLineBelow;
        while(blankLine) {
          ancestor.perchanceCode += "\n";
          blankLine = blankLine.blankLineBelow;
        }

        ancestor = ancestor.parent;
        if(!ancestor) break;

        if(j++ > 100000) {
          PERCH.perchanceError(`Some sort of looping/recursion error has occurred. Please make a post on the forum (lemmy.world/c/perchance) so I can take a look at this. Thanks!`, {moduleName});
          return;
        }

      }
    }
    root.perchanceCode = text;

    // check for variable names wrapped in square brackets when they're already within a square block:
    const unnecessarySquareBracketsRegex = /([^\\]|^)\[([^\]]*?[^a-zA-Z0-9_$\]]|)\[[a-zA-Z][a-zA-Z0-9_$.]*?\][^\]]*?\]/;
    // above regex explained:
    //  - we need the [^a-zA-Z_$\]] part (character right before inner square brackets must not be a variable-name character) because we don't want to show a warning for `[myList[key]]`, for example.
    //  - we need the dot in [a-zA-Z_$.]+ because we of course want to be able to detect and warn about something like `[a > 7 ? [list.subProp] : "blah"]`
    //  - this doesn't handle escaping properly (because the preceding backslash could itself be escaped), and doesn't properly handle the fact that square brackets could occur within strings/regex/etc. that are within the outer square block
    const singleEqualsInDynamicOddsRegex = /\^\[[^\]]*[^=!<>]=[^=>][^\]]*\]\s*$/;
    const singleEqualsInIfElseConditionRegex = /\[if\s*\([^\)]*[^=><!]=[^=>][^\)]*\)\s*\{/;
    for(let i = 0; i < lines.length; i++) {
      if(lines[i].text.length > 5000) continue;
      if(lines[i].text.indexOf("[") === -1) continue; // <-- just an optimisation

      // unnecessary square brackets:
      if(lines[i].text.indexOf("\"") !== -1 || lines[i].text.indexOf("'") !== -1 || lines[i].text.indexOf("'") !== -1) {
        if(lines[i].text.match(unnecessarySquareBracketsRegex)) { // don't use .test() --> https://stackoverflow.com/a/21373261/11950764
          // try removing quoted parts to see if it's still a match (very hacky, but it's not a huuge deal if it causes us to miss some - it's better than false positives):
          let newText = lines[i].text;
          newText = newText.replace(/".*[^\\]?"/g, `""`);
          newText = newText.replace(/`.*[^\\]?`/g, "``");
          newText = newText.replace(/'.*[^\\]?'/g, `''`);
          if(newText.match(unnecessarySquareBracketsRegex)) { // if it still matches, then it's ~likely a true positive.
            if(!/\[ *\.\.\./.test(newText)) { // avoid triggering for e.g. [[...array].map(n => n+1)]
              window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"square-brackets-wrapping-variable-name-within-square-block"});
            }
          }
        }
      } else {
        if(lines[i].text.match(unnecessarySquareBracketsRegex)) {
          window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"square-brackets-wrapping-variable-name-within-square-block"});
        }
      }
      
      if(lines[i].text.match(singleEqualsInIfElseConditionRegex)) {
        window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"single-equals-in-if-else-condition"});
      }

      // single equals in dynamic odds
      if(lines[i].text.indexOf("^[") === -1) continue; // <-- just an optimisation
      if(lines[i].text.match(singleEqualsInDynamicOddsRegex)) {
        window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"single-equals-in-dynamic-odds"});
      }
    }

    // get node data for functions (pack all details into header node and remove children)
    // note that we need to handle functions first because otherwise lines of js will be
    // classed as other node types
    for(let i = 0; i < lines.length; i++) {
      let funcHeaderDetails = PERCH.getFunctionHeaderDetails(lines[i].text);
      if(funcHeaderDetails) {
        lines[i].nodeType = "function";

        lines[i].functionName = funcHeaderDetails.name;
        lines[i].functionArgs = funcHeaderDetails.args; // <-- array of arg names
        lines[i].functionIsAsync = funcHeaderDetails.isAsync;
        // recursively collect all children, grandchildren, etc into one flat array:
        let children = lines[i].children;
        let j = 0;
        while(1) {
          if(j >= children.length) { break; }
          let c = children[j];
          children.splice(j+1, 0, ...c.children); // must put them in correct pos
          j++;
        }
        // remove children/grandchildren/... from lines array:
        for(let c of children) {
          lines = lines.filter(l => l !== c);
        }

        // concat children/grandchildren/... with newlines and add to functionBody property
        lines[i].functionBody = children.map(l => {
          let text = l.text;

          // add black lines back in since they matter for e.g. multi-line strings:
          let blankLine = l.blankLineBelow;
          while(blankLine) {
            text += "\n";
            blankLine = blankLine.blankLineBelow;
          }

          return text;
        }).join("\n");

        // remove children
        lines[i].children = [];
      }
    }

    // get node data for inline functions
    const functionNodeRegex = /=>/;
    for(let i = 0; i < lines.length; i++) {
      if(lines[i].nodeType) continue;
      if(!functionNodeRegex.test(lines[i].text)) continue; // <-- just an optimisation
      let inlineFuncDetails = PERCH.getInlineFunctionDetails(lines[i].text);
      if(inlineFuncDetails) {
        lines[i].nodeType = "function";

        // inline functions shouldn't have children
        if(lines[i].children.length > 0) {
          PERCH.perchanceError(`It appears that you've tried to give an inline function children (child items). At this point, inline functions are not allowed to have children (though I could change this in the future if people need this feature). There's also the possibility that you accidentally created an inline function. Inline functions have the form: <b>functionName(input1, input2, ...) =&gt; functionBody</b>. If you'd like to use "=" in a literal sense, put a backslash character right before it like this: "\\=".`, {declarationLineNumber:lines[i].lineNumber, moduleName});
          return;
        }

        lines[i].functionName = inlineFuncDetails.name;
        lines[i].functionArgs = inlineFuncDetails.args; // <-- array of arg names
        lines[i].functionBody = inlineFuncDetails.body;
        lines[i].functionIsAsync = inlineFuncDetails.isAsync;
      }
    }


    // TODO: process other node-types (list with args) here


    const unescapedEqualsSignSpecialCharsRegex = /[!"\#%&'()*+,.\/:;<>?@\[\\\]^{|}~]/;
    const unescapedEqualsSignHtmlElement = /<[a-zA-Z]+ /;
    const unescapedEqualsSignUrl = /https?:\/\/[^ ]+\?/;
    
    const primitiveNodeRegex = /=/;
    let ignoreEqualsSignWarnings = false;
    let reenableEqualsSignWarningsAtIndentLevel = null;
    for(let i = 0; i < lines.length; i++) {
      if(reenableEqualsSignWarningsAtIndentLevel !== null && lines[i].indents <= reenableEqualsSignWarningsAtIndentLevel) {
        ignoreEqualsSignWarnings = false;
        reenableEqualsSignWarningsAtIndentLevel = null;
      }

      if(lines[i].nodeType) continue;
      if(!primitiveNodeRegex.test(lines[i].text)) continue; // <-- just an optimisation

      let details = PERCH.getPrimitiveNodeDetails(lines[i].text);
      if(details) {
        // NOTE: We've discovered an inline/"primitive" thing, but here's the thing:
        //       If it's not a direct reference (i.e. value !== "[...]" or "{...}")
        //       but it DOES contain square/curly block(s), then we need to make it
        //       into a normal node with details.value as a child.
        //       See marker odj29hfi3j0d2kj0hx24f for the handling of $value nodes.
        //       The reason we need to do this is because if we had ``output = [prefix]-blah` (for example)
        //       then we couldn't call `output.selectMany(3)` on it if it was a $value node.
        //       Basically, the fact that I want to be able to create "direct references" with
        //       value nodes means a bunch of mucking around trying to make everything else work
        //       as expected.
        // let blocks = splitTextAtAllBlocks(details.value);
        // if(blocks.length > 1) {
        //   lines[i].nodeType = "text";
        //   lines[i].text = details.key;
        //   //lines[i].expressionArray = [details.key];
        //   let child = {
        //     text: details.value,
        //     indents: lines[i].indents+1,
        //     lineNumber:lines[i].lineNumber,
        //     children:[],
        //     parent: lines[i],
        //     nodeType:"text",
        //     odds:"1",
        //     //expressionArray: splitTextAtSquareBlocks(details.value),
        //   }
        //   lines[i].children.push(child);
        //   lines.splice(i+1, 0, child);
        // } else {
          lines[i].nodeType = "primitiveKeyValue";
          lines[i].primitiveKey = details.key;
          lines[i].primitiveValue = details.value;

          if(!ignoreEqualsSignWarnings && typeof details.value === "string" && details.value.startsWith("[this.getRawListText")) {
            ignoreEqualsSignWarnings = true;
            reenableEqualsSignWarningsAtIndentLevel = lines[i].indents-1;
          }
          
          if(!ignoreEqualsSignWarnings) {
            // NOTE: these if conditions have seemingly-redundant .includes(...) at the start as an optimization - may actually slow things down though, haven't tested
            // warn if key contains space AND previous line was a normal item in the same list. So users can avoid this warning by putting all their properties (that have spaces in their key) at the top of the list.
            if(details.key.trim().includes(" ") && lines[i-1] && lines[i-1].primitiveKey === undefined && lines[i-1].indents === lines[i].indents) {
              window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"unescaped-equals-sign"});
            } else if(details.key.includes("<") && unescapedEqualsSignHtmlElement.test(details.key) && (details.value.trim().startsWith(`"`) || details.value.trim().startsWith(`'`))) { // also warn if it looks like e.g. <img src="..."
              window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"unescaped-equals-sign"});
            } else if(details.key.includes("?") && unescapedEqualsSignUrl.test(details.key)) { // also warn if it looks like e.g. https://example.com?foo=bar
              window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"unescaped-equals-sign"});
            }
          }
          /* else if(unescapedEqualsSignSpecialCharsRegex.test(details.key)) { // also warn if key has weird/special characters. This catches e.g. <img src="..." even if it's the first item in the list (which would prevent above case from catching it)
            window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"unescaped-equals-sign"});
          }*/
        //}
      }

    }

    // extract all the node data (odds, expression array) for plain old text nodes
    const oddsDetailsRegex = /\^/;
    for(let i = 0; i < lines.length; i++) {
      if(lines[i].nodeType) continue;
      if(!oddsDetailsRegex.test(lines[i].text)) { // <-- just an optimisation
        lines[i].odds = "1";  // as string because all the others are strings - system is built to take strings and interpret them as expresions/numbers
      } else {
        // extract and remove odds stuff first:
        let oddsDetails = PERCH.getTextOddsDetails(lines[i].text);
        let odds, textWithoutOdds;
        if(oddsDetails) {
          lines[i].nodeType = "text";
          lines[i].odds = oddsDetails.odds;
          lines[i].text = oddsDetails.textWithoutOdds.trim(); // <-- NOTE: spaces between end of text and odds notation are ignored in lists! thus we trim. (not in curly "or" blocks though)
        } else {
          lines[i].odds = "1"; // as string because all the others are strings - system is built to take strings and interpret them as expresions/numbers
        }
      }

      lines[i].nodeType = "text";
      // let arr = splitTextAtSquareBlocks(lines[i].text);
      // if(arr) {
      //   lines[i].nodeType = "text";
      //   lines[i].expressionArray = arr;
      //   // if((lines[i].expressionArray.length > 1 || (lines[i].expressionArray.length === 1 && lines[i].expressionArray[0][0] === "[")) && lines[i].children.length > 0) {
      //   //   console.error(`Error on line number ${lines[i].lineNumber}. Lines with random variables shouldn't have children.`);
      //   //   return;
      //   // }
      // }

      // if(oddsDetails && !arr) {
      //   perchanceError(`It seems that you've got a '^' character where it shouldn't be. The '^' character is a special one that allows you to specify how likely a node is of being selected. This "odds notation" should not be present on functions or other non-text nodes because they aren't a part of the group which is randomly selected from (they are special children). If you want to use the odds character ("^") literally (i.e. not to declare likelihood), then you can put a backslash character before it like so: \\^`, lines[i].lineNumber);
      //   return;
      // }

    }

    // // warn for unclassified lines and then set nodeType as "text"
    // for(let i = 0; i < lines.length; i++) {
    //   if(!lines[i].nodeType) {
    //     perchanceError(`For some reason this line could not be classified properly. There may be something wrong with your syntax of this line, or it may be a bug with the Perchance engine. If you think that there's a bug, please report it here: <a href="http://reddit.com/r/perchance">reddit.com/r/perchance</a>. That would be very much appreciated! :)`, lines[i].lineNumber);
    //     lines[i].nodeType = "text";
    //     lines[i].expressionArray = [lines[i].text];
    //   }
    // }


    // next up, construct the actual perchance node tree.
    // first create a node for each line
    // then connect up parent/children
    //
    // we also the perchance methods including the .toString() function to each node.
    // the toString function is where the magic happens. calling
    // [myrootvar] will just return the myrootvar variable. when this
    // gets joined to a string, `myrootvar.toString()` is called which
    // recursively resolves it into an actual string value, taking into
    // account odds and other expressions (in expressionArrays) that it
    // finds along the way


    // 1. convert lines to perchance nodes
    let allNodes = [];
    lines.unshift(root);
    for(let i = 0; i < lines.length; i++) {

      lines[i].node = {};

      lines[i].node[Symbol.for("node data")] = { // TODO: why use symbol? just put it in a non-enumerable $data property? then fix up all references to it? TODO: can this be deleted after we're done creating tree?
        parentNode:null,
        childNodes:[],
        root:root,
        declarationLineNumber: lines[i].lineNumber,
        odds: null,
      };

      // make default function properties writable (not needed because we use simple objects now)
      // Object.defineProperty(lines[i].node, "name", {writable:true});
      // Object.defineProperty(lines[i].node, "length", {writable:true});

      // NOTE TO SELF: Object.defineProperty seems to cause some bad performance slow-downs, but I'm pretty sure
      // we need to make these properties non-enumerable - at least, I think that was the original idea. Might be worth
      // thinking about this at some point because the perf gains are definitely significant if you can somehow avoid defineProperty.

      Object.defineProperty(lines[i].node, "$root", {value:root.node, writable:true, configurable:true});
      Object.defineProperty(lines[i].node, "$declarationLineNumber", {value:lines[i].lineNumber, writable:true, configurable:true});
      Object.defineProperty(lines[i].node, "$moduleName", {value:moduleName, writable:true, configurable:true});
      Object.defineProperty(lines[i].node, Symbol.toPrimitive, {value:function(hint) {
        return this.valueOf();
        // if(hint === "default" || hint === "string") {
        //   return this.toString();
        // } else {
        //   return this.valueOf();
        // }
      }, writable:true, configurable:true});

      // add $valueChildren array which contains all children of type 'value' so we can get the "properties" of a node (for stuff like 'generateInstance' plugin or build-in feature)
      Object.defineProperty(lines[i].node, "$valueChildren", {value:[], writable:true, configurable:true});

      // this is used in isFunctionNode in the proxy stuff:
      Object.defineProperty(lines[i].node, "$functionChildren", {value:[], writable:true, configurable:true});
      
      Object.defineProperty(lines[i].node, "$allKeys", {value:[], writable:true, configurable:true});
      Object.defineProperty(lines[i].node, "$allKeysSet", {value:new Set(), writable:true, configurable:true});

      Object.defineProperty(lines[i].node, "$perchanceCode", {value:lines[i].perchanceCode, writable:true, configurable:true});

      PERCH.addNodeMethods(lines[i].node);

      allNodes.push(lines[i].node);

    }

    // 2. fill in parent/child references:
    for(let i = 0; i < lines.length; i++) {
      let node = lines[i].node;
      let nodeData = node[Symbol.for("node data")];
      if(i === 0) { // i.e. if root - (since root has no parent)
        nodeData.parentNode = null;
        Object.defineProperty(node, "$parent", {value:null, writable:true, configurable:true});
      } else {
        nodeData.parentNode = lines[i].parent.node;
        Object.defineProperty(node, "$parent", {value:lines[i].parent.node, writable:true, configurable:true}); // <-- give it a public reference to its parent that *isn't* enumerable
      }
      nodeData.childNodes = lines[i].children.map(line => line.node);
    }

    let topLevelValidJsIdentifiers = new Set();
    for(let i = 0; i < lines.length; i++) {
      if(lines[i].parent === root) {
        let key = lines[i].primitiveKey || lines[i].functionName || lines[i].text;
        if(PERCH.isValidJavaScriptIdentifier(key)) {
          topLevelValidJsIdentifiers.add(key);
        }
      }
    }

    // 3. fill in the rest of the node details depending on the node type
    let alreadyWarnedAboutDuplicateTopLevelListNameCount = 0;
    for(let i = 0; i < lines.length; i++) {
      let node = lines[i].node;
      let nodeData = lines[i].node[Symbol.for("node data")];

      // add normal text nodes
      if(lines[i].nodeType === "text") {
        nodeData.type = "text";
        nodeData.odds = lines[i].odds;
        //nodeData.expressionArray = lines[i].expressionArray;

        Object.defineProperty(lines[i].node, "$nodeType", {value:"normal", writable:true, configurable:true});
        Object.defineProperty(lines[i].node, "$oddsText", {value:lines[i].odds, writable:true, configurable:true});

        Object.defineProperty(lines[i].node, "$text", {value:lines[i].text, writable:true, configurable:true}); // <-- give it a public reference to its text that *isn't* enumerable
        if(node.$parent) { // i.e. if not root
          let key = node.$text;
          // while(node.$parent[key] !== undefined) {// if there's already one called this, add {|} (hacky, but I think it's fine since they're just text nodes?)
          while(node.$parent.$allKeysSet.has(key)) { // if there's already one called this, add {|} (hacky, but I think it's fine since they're just text nodes?)
            key += "{|}";

            if(alreadyWarnedAboutDuplicateTopLevelListNameCount < 3 && node.$parent.$parent === null) {
              window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"duplicate-top-level-list-name"});
              alreadyWarnedAboutDuplicateTopLevelListNameCount++;
            }
          }
          node.$parent[key] = node; // not via defineProperty, therefore it's enumerable
          nodeData.parentNode.$allKeys.push(key);
          nodeData.parentNode.$allKeysSet.add(key);
        }

      }

      // add user-defined functions
      if(lines[i].nodeType === "function") {

        if(PERCH.globalPerchanceFunctionIndex === undefined) PERCH.globalPerchanceFunctionIndex = -1;
        PERCH.globalPerchanceFunctionIndex++;

        nodeData.type = "function";
        nodeData.functionName = lines[i].functionName;
        nodeData.functionArgs = lines[i].functionArgs;
        nodeData.functionBody = lines[i].functionBody;
        nodeData.functionIsAsync = lines[i].functionIsAsync;
        //let withStr = `window.root.$imports.includes("${moduleName}") ? window.root.$imports[window.root.$imports.indexOf("${moduleName}")] : window.root`;
        let moduleToUse = moduleName || backupModuleName;
        let moduleRefStr = `window.moduleSpace["${moduleToUse}"]`;
        if(moduleToUse === "<null>") moduleRefStr = `this.$root`; // this might actually be a better way to handle it for *all* modules, not just null, but haven't tested.
        let finalFunctionBody;
        if(false) { // NOTE: this has the problem that getters are triggered by the topLevelValidJsIdentifiers deconstruction stuff. I'm also not sure if I should be exposing stuff that was added to the root during runtime (i.e. after initial compilation)
          let rootVarsStr = topLevelValidJsIdentifiers.size > 0 ? `let { ${[...topLevelValidJsIdentifiers].filter(n => n !== "root").join(", ")} } = root` : ``;
          finalFunctionBody = `${"\n".repeat(Math.max(0, lines[i].lineNumber-1))}let root = ${moduleRefStr}.___proxyTarget.withObjProxy; debugger; ${rootVarsStr}; document.__perchanceInternal.lastPerchanceFnExecutionDetails = {async:${nodeData.functionIsAsync ? "true" : "false"}, time:Date.now(), declarationLineNumber:${lines[i].lineNumber}, moduleName:"${moduleName}"};
  return (${nodeData.functionIsAsync ? "async " : ""}function(${nodeData.functionArgs.join(",")}) {
  ${nodeData.functionBody}
  }).apply(this, [${nodeData.functionArgs.join(",")}])`;
        } else {
          finalFunctionBody = `
            let tempHasHandlerRememberer927394 = ${moduleRefStr}.___proxyHandler.has;
            ${moduleRefStr}.___proxyHandler.has = document.__perchanceInternal.rootProxyHasHandler; /* .bind(${moduleRefStr}.___proxyHandler); */


            ${nodeData.functionArgs.map(a => PERCH.isValidJavaScriptIdentifier(a) ? `if(${a} && ${a}.getSelf && !(${a} instanceof String)) ${a} = ${a}.getSelf;` : '').join("")}

            // make a proxy for the module so we can "exclude" this function's inputs from the "with" statement.
            // this allows us to have inputs that are the same name as module globals and they won't be "overwritten" by those globals.
            // I had to add the Number stuff because my numbers were acting funny after messing with their prototype: https://stackoverflow.com/questions/52580398/why-doesnt-new-arraynew-number3-produce-an-array-of-length-3  (edit: originally had just !isNaN(a), but I had to add the toPrecision and $nodeType type stuff because isNaN was executing valueOf on list objects/nodes, which obviously causes trouble)
            let moduleRefProxy = new Proxy(${moduleRefStr}.___proxyTarget.obj, {
              get: function(target, name) {
                if(false) {} // <-- just to make the next line easier to write
                ${nodeData.functionArgs.map(a => { a = a.split("=")[0]; if(a.startsWith("...")) { a = a.slice(3); } return `else if (name === "${a}") { return typeof ${a} !== "undefined" && typeof ${a} !== "object" && !${a}.$nodeType && ${a}.toPrecision && ${a}.toExponential && !isNaN(${a}) ? Number(${a}) : ${a}; }` }).join("\n")}
                else { return target[name]; }
              }
            });

            let returnValue;
            with(moduleRefProxy) {
              let root = ${moduleRefStr}.___proxyTarget.obj; // <-- because for some reason 'root' was referencing window.root (which is different to this module's root if this is an imported module) 
              document.__perchanceInternal.lastPerchanceFnExecutionDetails = {async:${nodeData.functionIsAsync ? "true" : "false"}, time:Date.now(), functionName:"${nodeData.functionName.replace(/"/g, "")}", declarationLineNumber:${lines[i].lineNumber}, moduleName:"${moduleName}", globalFunctionIndex:${PERCH.globalPerchanceFunctionIndex}, functionStartLineWithinWrappedFunction:REPLACED_WITH_LINE_NUM_857947593};
              try {
                returnValue = (${nodeData.functionIsAsync ? "async " : ""}function(${nodeData.functionArgs.join(",")}) { /* FN_START_LINE_DEBUG */
                  ${nodeData.functionBody}
                }).apply(this, [${nodeData.functionArgs.join(",")}]);
                document.__perchanceInternal.lastPerchanceFnExecutionDetails.didThrow = false;
              } catch(e) {
                document.__perchanceInternal.lastPerchanceFnExecutionDetails.didThrow = true;
                document.__perchanceInternal.lastPerchanceFnExecutionDetails.error = e;
                try {
                  let lineNumber = e.stack.toString().match(/<anonymous>:([0-9]+):[0-9]/)?.[1];
                  if(!lineNumber) lineNumber = e.stack.toString().match(/> Function:([0-9]+):[0-9]/)?.[1];
                  if(lineNumber) {
                    lineNumber = Number(lineNumber) - document.__perchanceInternal.lastPerchanceFnExecutionDetails.functionStartLineWithinWrappedFunction;
                    document.__perchanceInternal.logPerchanceListsFunctionError(document.__perchanceInternal.lastPerchanceFnExecutionDetails, {lineNumber});
                  }
                } catch(e2) { console.error(e2); }
                throw e;
              }
            }

            ${moduleRefStr}.___proxyHandler.has = tempHasHandlerRememberer927394;
            return returnValue;
          `;
          try {
            let actualLineNumStart = finalFunctionBody.split("\n").findIndex(l => l.includes("/* FN_START_LINE_DEBUG */")) + 3;
            finalFunctionBody = finalFunctionBody.replace("REPLACED_WITH_LINE_NUM_857947593", actualLineNumStart);
            if(!PERCH.globalPerchanceFunctionIndexToFunctionText) PERCH.globalPerchanceFunctionIndexToFunctionText = {};
            PERCH.globalPerchanceFunctionIndexToFunctionText[PERCH.globalPerchanceFunctionIndex] = `${nodeData.functionIsAsync ? "async" : ""} function ${nodeData.functionName}(${nodeData.functionArgs.join(",")}) {\n${nodeData.functionBody}\n}`.trim();
          } catch(e) { console.error(e); }
        }
        // ${nodeData.functionIsAsync ? `.catch(e => { console.error(e); PERCH.perchanceError("An error occurred somewhere within the function defined at line ${lines[i].lineNumber}. Here is the error message: <b>"+e.message+"</b>", {declarationLineNumber:${lines[i].lineNumber}, moduleName:"${moduleName}"}); throw e; })` : ""};
        try {
          if(nodeData.functionIsAsync) {
            // Note: I don't think we actually need to make the "outer" function async, since it will always return a promise (made by the inner async function). But doing it anyway in case people try to write code like `myCoolFunction.constructor.name === "AsyncFunction"` or something.
            let AsyncFunction = (async function () {}).constructor;
            nodeData.functionRef = new AsyncFunction(nodeData.functionArgs.join(","), finalFunctionBody).bind(nodeData.parentNode);
          } else {
            nodeData.functionRef = new Function(nodeData.functionArgs.join(","), finalFunctionBody).bind(nodeData.parentNode);
          }
        } catch(e) {
          // try to create a more helpful error message by detecting line number of error if possible:
          if(e instanceof SyntaxError) {
            try {
              let scriptEl = document.createElement("script");
              let newScriptTextContent = [
                `{ let foo = ${nodeData.functionIsAsync ? "async" : ""} function() {`,
                nodeData.functionBody,
                `} }`,
              ].join("\n").trim();
              scriptEl.textContent = newScriptTextContent;
              PERCH.scriptTagInsertDebug84du84ksfhk = {numDebugLinesAtStartOfScript:1, scriptTextContent:`${nodeData.functionIsAsync ? "async" : ""} function ${nodeData.functionName}(${nodeData.functionArgs.join(",")}) {\n${nodeData.functionBody}\n}`.trim(), type:"function", functionName:nodeData.functionName, functionHeaderLineNumber:lines[i].lineNumber, moduleName};
              document.head.append(scriptEl);
              delete PERCH.scriptTagInsertDebug84du84ksfhk;
              scriptEl.remove();
            } catch(e) { console.error(e); }
          }
          console.error(e);
          PERCH.perchanceError(`Seem like there's a syntax error in the function called '${nodeData.functionName}'. Here's the error message: "${e.message}".`, {declarationLineNumber:lines[i].lineNumber, moduleName});
          throw new Error(e);
        }
        //nodeData.parentNode[nodeData.functionName] = new Function(nodeData.functionArgs.join(","), nodeData.functionBody).bind(nodeData.parentNode);
        Object.defineProperty(lines[i].node, "$nodeType", {value:"function", writable:true, configurable:true});
        Object.defineProperty(nodeData.parentNode, nodeData.functionName, {value:nodeData.functionRef, writable:true, configurable:true});
        Object.defineProperty(lines[i].node, "$text", {value:nodeData.functionName, writable:true, configurable:true});
        Object.defineProperty(lines[i].node, "$function", {value:nodeData.functionRef, writable:true, configurable:true});

        nodeData.parentNode.$functionChildren.push(lines[i].functionName);
        nodeData.parentNode.$allKeys.push(lines[i].functionName);
        nodeData.parentNode.$allKeysSet.add(lines[i].functionName);

      }

      if(lines[i].nodeType === "primitiveKeyValue") {
        nodeData.type = "primitiveKeyValue";
        nodeData.primitiveKey = lines[i].primitiveKey;
        nodeData.primitiveValue = lines[i].primitiveValue;
        // NOTE: it appears that then we write "[apple*10]" where apple={1|2|3}, JS implicitely calls toString on apple (even though it's a multiplication operation). so we don't need to worry about implementing valueOf
        //node.$value = lines[i].primitiveValue;
        //node.$key = lines[i].primitiveKey;
        let value = lines[i].primitiveValue;

        // if it's just plain text, process escaped characters (remove backslashes)
        // EDIT: NO! That's a terrible idea. Why remove escaped characters?! If you do, `output = \[wassup\]` throws an error (obviously). Was there a reason I previously thought this was a good idea?
        if(typeof value === 'string') {
          let split = PERCH.splitTextAtAllBlocks(value, {declarationLineNumber:lines[i].lineNumber, moduleName});
          if(typeof value === 'string' && split.length === 1 && split[0][0] !== "[" && split[0][0] !== "{") { // only need to check start bracket because it it exists, then it is unescaped, then the last character *must* be a closing bracket (since splitted text array has length of 1) else the first bracket would be unclosed
            //value = processEscapedCharacters(value);
            Object.defineProperty(lines[i].node, "$isPlainPrimitive", {value:true, writable:true, configurable:true});
          }
        } else if(typeof value === "number" || typeof value === "boolean") {
          Object.defineProperty(lines[i].node, "$isPlainPrimitive", {value:true, writable:true, configurable:true});
        } else {
          throw new Error("unknown primitive type??");
        }

        Object.defineProperty(lines[i].node, "$value", {value:value, writable:true, configurable:true});
        Object.defineProperty(lines[i].node, "$key", {value:lines[i].primitiveKey, writable:true, configurable:true});
        //Object.defineProperty(nodeData.parentNode, lines[i].primitiveKey, {value:node, writable:true, configurable:true});

        // Just to be helpful:
        if(typeof nodeData.primitiveValue === "string" && nodeData.parentNode === nodeData.root.node && nodeData.primitiveKey === "$output" && nodeData.primitiveValue.substr(1, nodeData.primitiveValue.length-2).trim() === "this") {
          PERCH.perchanceError("The generator called <code><a href='/"+moduleName+"#edit'>"+moduleName+"</a></code> has <code>$output</code> set to <code>[this]</code>. Perchance does this by default, so this line should be removed. That is, if you don't specify a top-level <code>$output</code> (the list you want to export) for your generator, then Perchance will export your <i>whole hierarchy</i>.", {declarationLineNumber:nodeData.declarationLineNumber, moduleName});
          return;
        }

        Object.defineProperty(nodeData.parentNode, lines[i].primitiveKey, {
          get:function() {
            // MARKER:odj29hfi3j0d2kj0hx24f
            if(node.$isPlainPrimitive) {
              // When a user writes `thing.prop` we want them to be able to access the proper string (with escape chars removed), but the problem
              // is that we use this same getter in the evaluateText process, and we definitely don't want to remove escapes during that process
              // because it gets recursively evaluated so we'd be removing backslashes and evaluating blocks that shouldn't be evaluated. The toString
              // method also had this problem, but I solved it by passing in a {keepEscapes:true} object when it is used in the evaluateText process,
              // but since this is a getter, we can't pass in arguments, so I've used a global var hack. See the evaluateText function
              // file for the actual location where this var is altered. It should always be false except for when it is used during the evaluateText process.
              //  EDIT: (TODO) This has caused issues because *during* the evaluateText process, external functions and stuff can obviously be called, and so
              //    within those functions the escapes are being incorectly kept. BE CAREFUL when trying to fix this, since I think it could break *a lot* of stuff.
              if(typeof node.$value === "string" && !PERCH.primitiveValueGetterKeepEscapesYolo) return PERCH.processEscapedCharacters(node.$value);
              else return node.$value;
            }
            if(typeof node.$value === 'number') {
              return node.$value;
            } else if(typeof node.$value === 'string') {

              // EDIT: (7th Aug 2019), realised due to [this post](https://www.reddit.com/r/perchance/comments/cmlfqh/imported_expression_returns_undefined/)
              // that they can have something like:
              //   name = BATMAN
              //   $output
              //     n = ["[name]"]
              // and the IMPORTING generator's `name` variable will be used instead, since we're only resolving the first "layer" of square brackets. If the
              // getter returns a string, I'm pretty sure it should be a FULLY RESOLVED string (otherwise why resolve the first layer at all?). If you really do
              // want to pass around unresolved strings, then you're probably a pro and you know how to use functions and stuff.
              // example:
              //  imported: https://perchance.org/imported-2324234#edit
              //  importer: https://perchance.org/importing-93845793#edit
              let ctxInfo = {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node};
              let splitted = PERCH.splitTextAtAllBlocks(node.$value, ctxInfo);
              if(splitted.length === 1) {
                if(splitted[0][0] === "[" /*&& splitted[0][splitted[0].length-1] === "]"*/) {
                  // we don't want to evaluateText on this because it'll be coerced into a string (we want to preserve "direct" references)
                  let expression = node.$value.substr(1,node.$value.length-2);
                  let result = PERCH.evaluateSquareBlock(node.$root, node.$parent, expression, ctxInfo);
                  while(1) {
                    if(typeof result === "string") {
                      // if it is a single square block, we need to preserve direct references to other nodes - if not we can just evaluateText
                      let newSplitted = PERCH.splitTextAtAllBlocks(result, ctxInfo);
                      if(newSplitted.length === 1 && newSplitted[0][0] === "[") {
                        let expression = result.substr(1,result.length-2);
                        result = PERCH.evaluateSquareBlock(node.$root, node.$parent, expression, ctxInfo);
                      } else if(newSplitted.length === 1 && /^\{import:[a-z0-9\-]+\}$/.test(newSplitted[0])) {
                        let moduleName = result.slice(8, -1);
                        if(!window.moduleSpace[moduleName]) PERCH.perchanceError(`Tried to (dynamically?) load the module "${moduleName}" but it doesn't exist. Try adding <b>{import:${moduleName}}</b> anywhere in your generator's code to preload the data. If you're already importing it, but still getting this error, this could be a bug in the Perchance engine. Potentially useful: <a href="https://perchance.org/dynamic-import-plugin" target="_blank" style="color:blue;">perchance.org/dynamic-import-plugin</a>`, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node});
                        let moduleRoot = window.moduleSpace[moduleName].getSelf;
                        return moduleRoot.hasOwnProperty("$output") ? moduleRoot.$output : moduleRoot;
                      } else {
                        // it's definitely not one lone square block, so it's definitely not a direct reference and thus we can just resolve it to plain text:
                        result = PERCH.evaluateText(node.$root, node.$parent, result, ctxInfo);
                        // if(window.generatorLastEditTime > 1716337636385) { // May 22nd 2024 bugfix, ensures only generators edited after this time get it, to prevent breaking old generators that rely on the bug
                        //   out = PERCH.processEscapedCharacters(out);
                        // }
                        // if(localStorage.test2974296 === "sfsdfdsdfss4") { // above bugfix causes issues with many generators, so this is for testing
                        //   result = PERCH.processEscapedCharacters(result);
                        // }
                        break;
                      }
                    } else {
                      break;
                    }
                  }
                  return result;
                } else if(splitted[0][0] === "{" /*&& splitted[0][splitted[0].length-1] === "}"*/) {
                  //let expression = node.$value.substr(1,node.$value.length-2);
                  //return PERCH.evaluateCurlyBlock(node.$root, node.$parent, expression, {declarationLineNumber:node.$declarationLineNumber});
                  //return "{"+expression+"}";
                  // ---
                  // return node; // for square blocks we evaluate it to get a direct reference, but there's no need for this with curly blocks (we let toString do the evalation)
                  // EDIT: (read above 7th Aug 2019 realisation - we need to do the evaluation ourselves so that it's evaluated within THIS generator's scope (in terms of `this` and global variables)):
                  // return evaluateText(node.$root, node.$parent, node.$value, {declarationLineNumber:node.$declarationLineNumber});
                  // EDIT AGAIN: NOPE! Luckily, this is a *node*, not a string, so the future toString will keep the correct context. If we evaluateText here, then you end up not being able to make
                  //             a consumableList from an "inline" list like `icecreamflavor = {chocolate|vanilla|pistachio}` because `icecreamflavor` immediately resolves to one of the flavours as reported here: https://www.reddit.com/r/perchance/comments/co6msx/bug_list_name_being_included_in_output_of_list/ewgjzmm/
                  if(/^\{import:[a-z0-9\-]+\}$/.test(splitted[0])) {
                    let moduleName = splitted[0].slice(8, -1);
                    // return window.moduleSpace[moduleName].getSelf.$output;
                    if(!window.moduleSpace[moduleName]) PERCH.perchanceError(`Tried to (dynamically?) load the module "${moduleName}" but it doesn't exist. Try adding <b>{import:${moduleName}}</b> anywhere in your generator's code to preload the data. If you're already importing it, but still getting this error, this could be a bug/problem in the Perchance engine. Potentially useful: <a href="https://perchance.org/dynamic-import-plugin" target="_blank">perchance.org/dynamic-import-plugin</a>`, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node});
                    let moduleRoot = window.moduleSpace[moduleName].getSelf;
                    return moduleRoot.hasOwnProperty("$output") ? moduleRoot.$output : moduleRoot;
                  } else {
                    return node;
                  }
                } else {
                  // // plain text (no curly or square blocks) - LATER: why do we need to evaluate it then? not necessary?
                  //return evaluateText(node.$root, node.$parent, node.$value, {declarationLineNumber:node.$declarationLineNumber});
                  return PERCH.processEscapedCharacters(node.$value); // <-- WAIT - this will never occur?? The if(node.$isPlainPrimitive) above will catch all plain text nodes.
                }
              } else {
                // we've found a non-direct reference that's not plain text.
                // we need to return the *actual node* because otherwise if we have `output = [prefix]-blah` (for example)
                // then we couldn't call `output.selectMany(3)` on it because `output` would be a plain string (like "pseudo-blah", for example).
                // note that when used on $value nodes, selectOne will just return the node itself
                return node;
                // var n = node.createClone;
                // n.$nodeType = "text";
                // Object.defineProperty(lines[i].node, "$text", {value:n.$value, writable:true, configurable:true});
                // Object.defineProperty(lines[i].node, "$oddsText", {value:"1", writable:true, configurable:true});
                // delete n.$key;
                // delete n.$value;
                // return n;
              }

            } else if(typeof node.$value === 'boolean') {
              return node.$value;
            } else {
              //console.error("Something went wrong? $value should be either a number, string, or boolean, right?");
              return node.$value; // June 11th 2019: It's a direct reference to another node, or a reference to an objext or something. (I thought I was tyding direct references up somewhere else, but that wouldn't cut it anyway because they can change the value now that there's a setter (e.g. to a POJO or whatever))
            }
          },
          set:function(v) { // June 11th 2019: Added this setter - why wasn't it set already? If it's not set then we can't change it and we get problems like this: https://www.reddit.com/r/perchance/comments/bz2smn/one_of_the_example_generator_is_broken_i_think_i/
            node.$value = v;
            return v;
          },
          configurable:true,
        });

        Object.defineProperty(lines[i].node, "$nodeType", {value:"value", writable:true, configurable:true});
        Object.defineProperty(lines[i].node, "$text", {value:lines[i].primitiveKey, writable:true, configurable:true});

        nodeData.parentNode.$valueChildren.push(lines[i].primitiveKey);
        nodeData.parentNode.$allKeys.push(lines[i].primitiveKey);
        nodeData.parentNode.$allKeysSet.add(lines[i].primitiveKey);
      }

    }

    // add $children property to each node (an array of all of the keys of the node's non-primitive, non-function children that are leaf nodes (i.e. that are themselves childless))
    // TODO: final confirmation: this should be just the keys, right? or would it be more useful to people as nodes? what are use cases of this property? [animal.$children] - actually yeah, it makes sense that it returns a key - if it returned an object then a random child of THAT object would be chosen!
    for(let node of allNodes) {
      let keys = Object.keys(node).filter(k => node[k].$nodeType === 'normal').sort((k1,k2) => node[k1].$declarationLineNumber-node[k2].$declarationLineNumber); // filter out primitives and sort by the actual order of the list
      Object.defineProperty(node, "$children", {value:keys, writable:true, configurable:true});
    }

    // // error if any of the **direct children of root** aren't valid javascript identifiers.
    // // this is necessary for two reasons:
    // // 1. calling [else] will throw an error - but [thing.else] will not
    // // 2. calling [my list] will throw an error - but [thing["my list"]] will not
    // let warnLineNumbers = [];
    // for(let key of root.node.$children) {
    //   if(!isValidJavaScriptIdentifier(key)) {
    //     warnLineNumbers.push( root.node[key].$declarationLineNumber );
    //   }
    // }
    // if(warnLineNumbers.length > 0) {
    //   if(warnLineNumbers.length > 10) {
    //     warnLineNumbers = warnLineNumbers.slice(1,9);
    //     warnLineNumbers.push("...");
    //   }
    //   console.warn(`Warning at line number${(warnLineNumbers.length > 1 ? "s" : "")+" "+warnLineNumbers.join(", ")}. All *top-level* items must only include letters, numbers and underscore characters (no spaces or special characters). They also must not start with a number. They also must not be any of these "reserved" names: break, do, instanceof, typeof, case, else, new, var, catch, finally, return, void, continue, for, switch, while, debugger, function, this, with, default, if, throw, delete, in, try class, enum, extends, super, const, export, import, implements, interface, let, package, private, protected, public, static, yield`);
    // }

    // TODO: add module name to all errors, or print module name when you catch errors
    // TODO: add "need help?" link to all errors that links to community (reddit, probably)

    // extract import statements:
    let importedModuleNamesArray = [];
    PERCH.ignorePerchanceErrors = true;
    for(let line of lines) {
      if(line.nodeType === 'function' || line.node.$isPlainPrimitive) continue;
      let names = PERCH.collectImportedModuleNamesFromText(line.text);
      importedModuleNamesArray.push(...names);
    }
    PERCH.ignorePerchanceErrors = false;
    Object.defineProperty(root.node, "$imports", {value:[...new Set(importedModuleNamesArray)], writable:true, configurable:true});


    Object.defineProperty(root.node, "$allNodes", {value:allNodes, writable:true, configurable:true});



    // for(let node of allNodes) {
    //   if(node.$constructorFunction.prototype !== undefined) {debugger;}
    //   Object.defineProperties(node.$constructorFunction.prototype, Object.getOwnPropertyDescriptors(node));
    // }

    let alreadySeenTopLevelKeysToLineNum = new Map();
    const allowedDollarVariables = ["$output", "$preprocess"];
    for(let node of root.node.$allNodes) {
      if(node.$nodeType === "value" && node.$text[0] === "$" && !allowedDollarVariables.includes(node.$text)) {
        PERCH.perchanceError(`There's a problem with the '${moduleName}' generator. You've created a property with a name that starts with "$". This is highly discouraged because dollar-sign variables are reserved for special features such as $output and $preprocess. New features that are added to Perchance in the future may use other dollar-sign variable names and these may conflict with your variable-name choice and thus cause errors.`, {declarationLineNumber:node.$declarationLineNumber, moduleName, node});
        continue;
      }
      let nodeName = node.$text;
      // I use `moduleName !== null` here to hackily exclude the name check if this run of createPerchanceTree is due to a call of the createClone function (the only case where no module name is allowed). In this case it's fine for top-level nodes to have names to be invalid JS identifiers, because they aren't referencable as if they were global variables.
      // Note that if this is a call to createClone, then `root` isn't the "real" root and is discarded once we've created the clone.
      if(moduleName !== null && node.$parent === root.node && (!PERCH.isValidJavaScriptIdentifier(nodeName) || node.$text === "update")) {
        PERCH.perchanceError(`There's a problem with the '${moduleName}' generator. You've created a top-level list called "<b>${PERCH.escapeHTMLSpecialChars(node.$text)}</b>", which is not allowed. Unfortunately top-level list names are subject to some strict rules:<ul><li>They must not contain any spaces</li><li>They must only contain letters (lower or upper case), numbers and underscores ("_")</li><li>They must not begin with a number</li><li>They must not be any of the following special "reserved" names: update, do, if, in, for, let, new, try, var, case, else, enum, eval, null, this, true, void, with, await, break, catch, class, const, false, super, throw, while, yield, delete, export, import, public, return, static, switch, typeof, default, extends, finally, package, private, continue, debugger, function, arguments, interface, protected, implements, instanceof</li></ul> Sorry for the inconvenience! These rules may seem strange, but they're needed to make the more advanced features of the perchance engine work.`, {declarationLineNumber:node.$declarationLineNumber, moduleName, node});
      }
      
      try { // new code, so try/catch
        if(node.$parent === node.$root) {
          if(alreadySeenTopLevelKeysToLineNum.has(node.$text)) {
            PERCH.perchanceError(`The list name '<code>${node.$text}</code>' was used on line number <b>${alreadySeenTopLevelKeysToLineNum.get(node.$text)}</b>, and again on line <b>${node.$declarationLineNumber}</b>. Top-level list names should be unique.`, {declarationLineNumber:node.$declarationLineNumber, node, moduleName});
          } else {
            alreadySeenTopLevelKeysToLineNum.set(node.$text, node.$declarationLineNumber);
          }
        }
      } catch(e) { console.error(e); }
    }



    let fn = function(){};
    fn.obj = root.node;
    
    // for use in `with` statement, so it only exposes direct child names and not e.g. lowerCase, $imports, etc.
    fn.visiblePropertiesForWith = root.node.getAllKeys;
    fn.visiblePropertiesForWith.push("$root", "$moduleName"); // since people are using these as if they're globals
    fn.withObjProxy = new Proxy(root.node, {
      get(target, prop, receiver) {
        if(fn.visiblePropertiesForWith.includes(prop)) {
          return Reflect.get(target, prop, receiver);
        }
        return undefined;
      },
      set(target, prop, value, receiver) {
        if(fn.visiblePropertiesForWith.includes(prop)) {
          return Reflect.set(target, prop, value, receiver);
        }
        return true; // ignore non-visible properties - seems like it's not really necessary though since `with` won't try setting non-visible properties due to `has` handler check. So it'll pass throught to `window`.
      },
      has(target, prop) {
        return fn.visiblePropertiesForWith.includes(prop);
      },
      ownKeys(target) {
        return fn.visiblePropertiesForWith;
      },
      getOwnPropertyDescriptor(target, prop) {
        if (fn.visiblePropertiesForWith.includes(prop)) {
          return Reflect.getOwnPropertyDescriptor(target, prop);
        }
        return undefined;
      }
    });

    let rootProxy = new Proxy(fn, {
        capturedCalls: [],
        executionProperties: [
          "toString",
          "valueOf",
          Symbol.hasInstance,
          Symbol.isConcatSpreadable,
          Symbol.iterator,
          Symbol.match,
          Symbol.prototype,
          Symbol.replace,
          Symbol.search,
          Symbol.species,
          Symbol.split,
          Symbol.toPrimitive,
          Symbol.toStringTag,
          Symbol.unscopables,
          Symbol.for,
          Symbol.keyFor,
          "selectMany",
          "selectOne",
          "selectAll",
          "getSelf",
          "getName",
          "$imports",
          "$allNodes",
          "$odds",
          "$text",
          "$value",
          "$key",
          "$nodeType",
          "$oddsText",
          "$declarationLineNumber",
          "$moduleName",
          "$root",
          "$parent",
          "$children",
          "isConsumable",
          "consumableList",
          "createClone",
          "evaluateItem",
          "joinItems",
          //"listName",
          // TODO: add new items here whenever you add any new special properties
        ],
        organiseCalls: function(capturedCalls) {
          // CAREFUL: do not move `apply`s away from their correct `get`
          let textTransforms = [];
          let nonTextTransforms = [];
          let inApplyChain = false;
          for(let i = 0; i < capturedCalls.length; i++) {
            let call = capturedCalls[i];
            if(call.type === "get" && textTransformNames.includes(call.name)) {
              // if(i+1 < capturedCalls.length && capturedCalls[i+1].type === "apply") {
              //   perchanceError(`Tried to call a text transform '${call.name}' as a function/method. Text transforms like ${call.name}, pluralForm and titleCase are not functions. They shouldn't be followed by a pair brackets.`);
              // }
              textTransforms.push(call);
              inApplyChain = true; // any `apply`s after this text transform must be moved with it

            } else if(call.type === "apply" && inApplyChain) {
              textTransforms.push(call);
            } else {
              nonTextTransforms.push(call);
              inApplyChain = false;
            }
          }
          let organisedCalls = [];
          organisedCalls.push(...nonTextTransforms);
          organisedCalls.push(...textTransforms);
          // TODO***: should text transforms be applied before joinItems?
          return organisedCalls;
        },
        executeChain: function(target, calls) {
          let result = target.obj;

          // let disable$output = false;
          // if(calls.map(c=>c.name).includes("disable$output")) {
          //   debugger;
          //   disable$output = true;
          // }

          if(calls.length === 0) {
            return target.obj;
          }

          // move text transforms to end (importantly, this method doesn't change the this.capturedCalls array - it returns a new one)
          let capturedCalls = this.organiseCalls(calls);

          let lastResult, secondLastResult;
          for(let i = 0; i < capturedCalls.length; i++) {
            let call = capturedCalls[i];

            secondLastResult = lastResult; // needed for `apply` (since LAST result is the actual function, and not the object/thing that it's being being called from)
            lastResult = result;

            if(call.type === "get") {
              result = result[call.name];
              if(result === undefined && i === 0) {
                result = window[call.name]; // try to fallback to global `window` if there's no list/function/property found - e.g. if they did [Math.min(hp, 100)] - "Math" is not a list
              }
            } else if(call.type === "apply") {
              // in my case the `this` variable should be the thing that the method is being called from
              // (this is done by default with getters)
              result = result.apply(secondLastResult, call.args);
            } else {
              console.error("How could this be?");
            }

            if(result === undefined) {
              // we DON'T return an error message because they may just want to check if the property exists.
              return undefined;
            }

            // Remember that `result` could be a Proxy (imagine `$output = [noun.pluralForm]` - root.$output is a proxy with `noun` and `pluralForm` in the capturedCalls array (because $value nodes are evaluated when called (using a `get` handler))).
            // If it IS a proxy, we want to append this proxy's capturedCalls array to the new one and execute it:
            if(result.___isProxy) {
              let leftOverCalls = capturedCalls.slice(i+1);
              let allCalls = [...result.___proxyHandler.capturedCalls, ...leftOverCalls];
              // TODO: just to confirm, we don't need to pass along secondLastResult do we? What if they called `apply` twice in a row? It's an edge case that might be annoying to debug later on
              return this.executeChain(result.___proxyTarget, allCalls);
            }

          }
          return result;
        },
        userDefinedNonNodePropertyIds: {},
        getUserDefinedNonNodePropertyId: function(property, calls) {

          // In case you're wondering what on earth is going on here:
          // We need to get the proxy to return properies that the USER has set with scripts (in square blocks, functions, etc.).
          // So we need to keep track of when they add their own properties to `root`.
          // That way, when the proxy gets a `get` request for one of these "non-node" properties, it can return it straight up.
          // Basically, any properties added to root AFTER compilation will always be returned in get requests (rather than returning a proxy).

          // This will probably cause memory leaks if they're setting properties on root with dynamically generated names?

          let seperator = "_{9287234632<<prop-id-call-seperator>>4632877592}_";
          let id = "root";
          for(let call of calls) {
            if(call.type === "apply") {
              return false;
            }
            id += seperator + call.name;
          }
          id += seperator + property;
          return id;
        },
        isUserDefinedNonNodeProperty: function(property, calls) {
          return this.userDefinedNonNodePropertyIds[ this.getUserDefinedNonNodePropertyId(property, calls) ] === true;
        },
        isFunctionNode: function(target, capturedCalls, property) {

          // If `property` is referencing a function node of target.obj, then we want to
          // return that function (not a proxy). That's why we need this function (we use it in the `get` handler)

          // if there are `apply`s in the capturedCalls, return false, since a function node can only be a
          // direct `get` chain from the root node (this is just an optimisation)
          for(let c of capturedCalls) {
            if(c.type === 'apply') return false;
          }

          let root = target.obj;

          // NOTE: we don't need to worry about user-defined non-node properties, because we detect them in the `get` trap
          // NOTE: remember, all nodes are functions, so be careful with your typeof logic (not used here anyway)
          let ref = root;
          for(let c of capturedCalls) {
            if(ref.$children.includes(c.name)) ref = ref[c.name];
            else return false;
          }
          if(ref.$functionChildren.includes(property)) return true; // the call path DOES reference a function node
          else return false;

          // OLD APPROACH: I have no idea why I was doing the reverse-lookup thing in this old approach. To get around proxy "looping" stuff???
          // // Here's what we do:
          // // 1. if there are `apply`s in the capturedCalls, return false, since a function node can only be a
          // //    direct `get` chain from the root node (this is just an optimisation)
          // // 2. For each occurrance of `property` in root.$allNodes that is a `value` or `function` node, trace
          // //    back up the $parent chain, checking at each stage that it matches the capturedCalls `get` names
          // //    in reverse order. If you get back to root, run the capturedCalls on root and see if it's a function.
          // //    If it is, return true. Otherwise continue.
          // // 3. If no matches, return false.
          //
          //
          // for(let c of capturedCalls) {
          //   if(c.type === 'apply') return false;
          // }
          //
          // let root = target.obj;
          //
          // for(let node of root.$allNodes) {
          //   if(node.$text !== property) continue;
          //   if(node.$nodeType !== 'value' && node.$nodeType !== 'function') continue;
          //
          //   // so we know it's a value or function node, and we know the `property` matches its name.
          //   // now we need to check if the node's ancestry chain back to root matches the capturedCalls array
          //
          //   let traceNode = node.$parent;
          //   for(let i = capturedCalls.length-1; i >= 0; i--) {
          //     if(capturedCalls[i].name !== traceNode.$text) break;
          //     traceNode = traceNode.$parent;
          //   }
          //
          //   if(traceNode === root) { // found a full path/ancestry match
          //     // now we just need to check if it's a function:
          //     let ref = root;
          //     for(let c of capturedCalls) { ref = ref[c.name]; }
          //     // i replaced the below two commented out lines with the third to help solve some `get` loops happening in the proxy with this.isFunctionNode
          //       // ref = ref[property]; // the final `get`
          //       // if(typeof ref === 'function') return true; // found a function node!!!
          //     if(ref.$functionChildren.includes(property)) return true; // found a function node!!!
          //   }
          //
          // }
          //
          // return false;

        },
        isGetterProperty: function(target, property) {
          let desc = Object.getOwnPropertyDescriptor(target.obj, property);
          return desc && desc.get;
        },
        get: function(target, property, receiver) {

          // commenting this out for now in favor of the perchance.org/my-generator#debugFreeze approach
          // if(window.globalProxyLoopCount > 10000000) {
          //   throw new Error("It seems like you've got an infinite loop somewhere in your code. Are you referencing a list name within a child of that list, such that it creates an infinite loop?");
          // }
          // window.globalProxyLoopCount++;


          if(property === "___isProxy") { return true; }
          if(property === "___proxyTarget") { return target; }
          if(property === "___proxyHandler") { return this; }
          // if(property === "___addExecutionPath") {
          //   let last = this.capturedCalls[this.capturedCalls.length-1];
          //   this.capturedCalls.pop();
          //   this.userDefinedNonNodePropertyIds[ this.getUserDefinedNonNodePropertyId(last, this.capturedCalls) ] = true;
          // }

          //if(this.isGetterProperty(target, property) || this.executionProperties.includes(property) || this.isUserDefinedNonNodeProperty(property, this.capturedCalls) || this.isFunctionNode(target, this.capturedCalls, property)) {
          if(true) { // testing out resolving all `get`s (QUESTION: was the only reason why we needed proxies for stuff like `pluralAnimalList = [animal.pluralForm]`? because that's really not needed anyway, and I don't think it's even possible in perchance's current state)

            let result = this.executeChain(target, this.capturedCalls);

            // if(typeof result === 'string' || typeof result === 'number')
            //   return result;

            if(result === undefined) {
              if(property === Symbol.toPrimitive) {
                return function() { return undefined; }
              } else {
                PERCH.perchanceError(`the list/variable <code>${this.capturedCalls.map(c=>c.name).join("")}</code> doesn't seem to exist in the <code>${target.obj.$moduleName}</code> generator.`, {moduleName:target.obj.$moduleName});
                // if(property === Symbol.toPrimitive) return function() { return "(error)"; }
                return "(error)";
              }
            }

            let finalResult = result[property];
            if(typeof finalResult === 'function' && !finalResult.___isProxy) {
              finalResult = finalResult.bind(result);
            }
            return finalResult;

          } else {
              // need to return new proxy
              let newHandler = {};
              Object.assign(newHandler, this);
              newHandler.capturedCalls = this.capturedCalls.slice(0);

              newHandler.capturedCalls.push({type:"get", name:property});
              let np = new Proxy(target, newHandler)
              return np;
          }
        },
        apply: function(target, thisArg, args) {
            // // return a new proxy:
            // let newHandler = {};
            // Object.assign(newHandler, this);
            // newHandler.capturedCalls = this.capturedCalls.slice(0);
            // // add arguments to last call that was captured
            // newHandler.capturedCalls.push({type:"apply", args});
            // let np = new Proxy(target, newHandler);
            // return np;

            // i commented out the above code and added this because we always want functions to resolve immediately. otherwise we get this problem (see comment in bottom left): https://i.imgur.com/SY9MOt8.png -- as another example, people needed to write [a = dice("1d6").selectOne] instead of just [a = dice("1d6")]
            // maybe I should make exceptions for joinItems and those other inbuilt functions?
            this.capturedCalls.push({type:"apply", args});
            return this.executeChain(target, this.capturedCalls);
        },
        set: function(target, property, value, receiver) {
          // resolve it if it's a proxy (to prevent infinite loops when you do something like [abc=abc] (where abc is an already-defined top-level node), since that would set abc to its own proxy, so when you resolve it, it would resolve to the proxy, and the loop continues)
          if(value && value.___isProxy) {
            value = value.___proxyHandler.executeChain(value.___proxyTarget, value.___proxyHandler.capturedCalls);
          }

          let obj = this.executeChain(target, this.capturedCalls);
          if(typeof obj !== 'object') {
            PERCH.perchanceError(`You tried to set <code>${PERCH.escapeHTMLSpecialChars(this.capturedCalls.map(c=>c.name).join("."))}</code> to <code>${PERCH.escapeHTMLSpecialChars(value)}</code>, but it appears that <code>${PERCH.escapeHTMLSpecialChars(this.capturedCalls.map(c=>c.name).join("."))}</code> does not exist, or some other strange error has occurred.`);
            return;
          }
          Object.defineProperty(obj, property, {value, writable:true, configurable:true}); // importantly we're executing defineProperty on an actual object, NOT a proxy
          this.userDefinedNonNodePropertyIds[ this.getUserDefinedNonNodePropertyId(property, this.capturedCalls) ] = true;
          return value;
        },
        isExtensible: function(target) { return Object.isExtensible(this.executeChain(target, this.capturedCalls)); },
        preventExtensions: function(target) { return Object.preventExtensions(this.executeChain(target, this.capturedCalls)); },
        getOwnPropertyDescriptor: function(target, prop) { return Object.getOwnPropertyDescriptor(this.executeChain(target, this.capturedCalls), prop); },
        defineProperty: function(target, property, descriptor) { return Object.defineProperty(this.executeChain(target, this.capturedCalls), property, descriptor); },
        has: function(target, prop) { return (prop in this.executeChain(target, this.capturedCalls)); },
        deleteProperty: function(target, property) { return delete this.executeChain(target, this.capturedCalls)[property]; },
        ownKeys: function(target) { return Reflect.ownKeys(this.executeChain(target, this.capturedCalls)); }
    });
    document.__perchanceInternal.rootProxyHasHandler = rootProxy.___proxyHandler.has;

    // add this module to modulespace now otherwise our functions won't work for the direct-reference checks
    // yolo
    window.moduleSpace[moduleName] = rootProxy;

    // EDIT: don't need this any more now that we've got isFunctionNode?
    // make user-defined functions execute immediately upon being called (i.e. don't return a proxy)
    // for(let i = 0; i < allNodes.length; i++) {
    //   if(allNodes[i].$nodeType === "function") {
    //     let node = allNodes[i];
    //     // we found a function, now lets build a call chain to it
    //     let calls = [];
    //     while(node.$parent) {
    //       calls.unshift(node.$parent.$text);
    //       node = node.$parent;
    //     }
    //     calls.shift(); // remove "<root>"
    //     let chain = [rootProxy];
    //     for(let c of calls) {
    //       chain.push(chain[chain.length-1][c]); // did it weirdly like this to prevent proxy setter being called
    //     }
    //     chain = chain[chain.length-1]; // the last element is the completed chain
    //     chain[allNodes[i].$text] = allNodes[i].$function; // EDIT: this calls the proxy setter and adds a "userDefinedNonNodeProperty" - was that the prupose?
    //   }
    // }


    // tie direct references to the actual nodes. e.g.:
    // animal = [african_animal]
    // $output = [person]
    // so rather than [animal] and [$output] being $value nodes, they'll directly reference [aftican_animal] and [person].
    // this is mainly needed to make $output behaviour sane.
    for(let node of allNodes) {
      if(node.$nodeType === "value" && !node.$isPlainPrimitive) {
        let blocks = PERCH.splitTextAtAllBlocks(node.$value, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node});
        if(blocks.length === 1 && blocks[0][0] === "[" && blocks[0][blocks[0].length-1] === "]") {
          let expression = node.$value.substr(1,node.$value.length-2);

          // only create link if they're DIRECTLY referencing another list:
          if(PERCH.isValidJavaScriptIdentifier(expression)) {
            // intermediate values can be non-direct references, and we don't want to e.g. execute `[a++]`, so we make sure that if PERCH.evaluateSquareBlock comes across something like that in a multi-step "indirection chain", it aborts
            PERCH.throwErrorIfNonDirectListReferenceIsFoundDuringEvaluateSquareBlock = true; // epic
            try {
              PERCH.ignorePerchanceErrors = true; // it may fail because it could reference a function that hasn't been linked yet (i have no idea what's going on)
              let refNode; 
              try { refNode = PERCH.evaluateSquareBlock(root.node, node.$parent, expression, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node}); } catch(e) {}
              PERCH.ignorePerchanceErrors = false;

              if(refNode && refNode.$nodeType /*|| Array.isArray(refNode)*/) { // did it not abort, and did it resolve to a node?
                node.$parent[node.$text] = refNode;
              }
            } catch(e) {}
            delete PERCH.throwErrorIfNonDirectListReferenceIsFoundDuringEvaluateSquareBlock;
          }

          // NOTE: curly IMPORT blocks get tied to their actual module after all imports are compiled (in iframe html)

          // TODO**: does all this work by default now because of the new proxy approach? can I remove this part all together?

          // TODO***: we need to pre-evaluate $output so it's a *direct* reference to the thing it references,
          //          but if we do that with other $value nodes, things can get messy:
          //
          // person
          //   name = [name.selectOne]
          //
          // `person.name` will always be same node!!
          // if we call update it stays the same
          // if we do [a = new person], the selection remains the same
          // etc. - tonnes of problems
          // here's why we WANT to be able to do this in the first place:
          // person
          //   name = [name.selectOne]
          //   gender = [this.name.gender]
          //
          // note that we can already do this sort of thing:
          //
          // person
          //   age = {1-100}
          //   isAdult = [this.age > 18]
          //
          // potential solution: only pre-evaluate it if it's a direct reference to another node
          // (just like $output always is).

        }
      }
    }

    // give each node an id:
    for(let i = 0; i < allNodes.length; i++) {
      Object.defineProperty(allNodes[i], "$id", {value:i, writable:true, configurable:true});
    }



    // fix up $root references so they point to proxy instead of actual node
    // also remove node data symbol stuff
    // TODO***: what about $parent references - should they be proxied too?
    for(let i = 0; i < allNodes.length; i++) {
      Object.defineProperty(allNodes[i], "$root", {value:rootProxy, writable:true, configurable:true});
      delete allNodes[i][Symbol.for("node data")];
    }

    // at the moment, this is mainly so that other users don't get confused about strange syntax - they can easily see there's a preprocessor,
    // but in the future I may speed up preprocessing by just grabbing the function from the top, compiling that, and then running the code through it.
    // (instead of compiling the whole thing just to get the $preprocess function, as is happening now.) EDIT: oh, don't forget they can *import* preprocessor too!
    if(root.node.$preprocess && root.node.$allNodes[1].$text !== "$preprocess") {
      PERCH.perchanceError(`The special <code>$preprocess</code> function must be placed above all your other lists - at the very top of the Perchance code editor.`, {moduleName});
      return;
    }

    if(root.node.$preprocess && !doNotPreprocess) {
      let preprocess;
      if(typeof root.node.$preprocess === 'function') {
        preprocess = root.node.$preprocess;
      } else {
        if(!root.node.$preprocess.$value && root.node.$preprocess.$allKeys.includes("$preprocess")) return PERCH.perchanceError(`Looks like you've imported the '${root.node.$preprocess.$moduleName}' generator for use as a preprocessor, but the preprocessor should be defined as the <code>$output</code> in '${root.node.$preprocess.$moduleName}', rather than as <code>$preprocess</code>.`, {moduleName});
        if(!root.node.$preprocess.$value.startsWith("{import:")) return PERCH.perchanceError(`The special <code>$preprocess</code> property must be defined as a function, or an imported function.`, {moduleName});
        let preprocessorName = root.node.$preprocess.$value.slice(8, -1);
        let module = window.moduleSpace[preprocessorName];
        if(!module) {
          PERCH.perchanceError(`The preprocessor '${preprocessorName}' could not be found?`, {moduleName});
          return;
        }
        if(!module.$output || !module.$output.$nodeType === "function") return PERCH.perchanceError(`The '${preprocessorName}' was imported into '${moduleName}' as a preprocessor function, but the <code>$output</code> of '${preprocessorName}' doesn't exist or is not a function?`, {moduleName});
        preprocess = module.$output;
      }
      let newInputText = preprocess(root.perchanceCode);
      return PERCH.createPerchanceTree(newInputText, moduleName, backupModuleName, true);
    }

    console.debug(`${moduleName} init: ${Date.now()-functionStartTime}ms`);

    return rootProxy;
    //return root.node;


    // notes:
    // TODO: remove todos that are already done...
    // TODO: primitive declarations using "=" and update toString so it ignores primitive-valued properties
    // TODO: in toString: add {a|b|c} notation handling (recusive)
    // TODO: add array handling: we just treat ["a", "b^2", "c"] like {a|b^2|c} when Array.toString() is called (use the same back-end function)

    // TODO: if we across duplicate sibling nodes, what do we do? just make the latter overwrite the prior? add the odds together?

  }


  PERCH.clonedNodeToOriginalNodeWeakMap = new WeakMap();
  PERCH.duplicatePerchanceNode = function(originalNode) { // this is very hacky...
    originalNode = originalNode.getSelf;

    // NOTE: node will be unreferencable from parent (since the node to be duplicated already holds that key).
    //       I think this is fine? They can always add it to the parent if some weird situation required that.

    let root = PERCH.createPerchanceTree(originalNode.$perchanceCode, null, originalNode.$moduleName);
    root = root.getSelf; // get target object, not proxy

    for(let node of root.$allNodes) {
      if(node === root) continue;
      node.$id = originalNode.$root.getSelf.$allNodes.length;
      originalNode.$root.getSelf.$allNodes.push(node);

      node.$root = originalNode.$root.getSelf;
      node.$moduleName = originalNode.$moduleName;
      // I think this is causing some problems when it tries to get a node of a "directly linked" property:
      //node.$declarationLineNumber = getCorrespondingOriginalNode(node).$declarationLineNumber;
    }

    // function getCorrespondingOriginalNode(clonedNode) {
    //   let propertyChain = [];
    //   let n = clonedNode;
    //   while(n.$parent) { // get chain up to cloned root
    //     propertyChain.unshift(n.$text);
    //     n = n.$parent;
    //   }
    //   n = originalNode.$parent.getSelf
    //   while(propertyChain.length) { // evaluate chain from original node's parent
    //     n = n[propertyChain[0]];
    //     propertyChain.shift();
    //   }
    //   return n;
    // }

    let node = root[originalNode.$text];
    node.$parent = originalNode.$parent.getSelf;

    PERCH.clonedNodeToOriginalNodeWeakMap.set(node, originalNode);
    return node;

  }


  // This function is PUBLIC - i.e. available for people to use in their generators
  window.createPerchanceTree = function(text, opts={}) {

    let root = PERCH.createPerchanceTree(text, opts.name ?? null, "<null>"); // <null> is a special value for nodes that technically don't belong to any module
    root = root.getSelf; // get target object, not proxy
    root.$moduleSpace = window.moduleSpace;

    return root;
  }


  PERCH.escapeHTMLSpecialChars = function(unsafe) {
      return unsafe.toString()
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
  }

  PERCH.collectImportedModuleNamesFromText = function(text) {
    let blocks = PERCH.splitTextAtAllBlocks(text);
    let moduleNames = [];
    for(let b of blocks) {
      if(b[0] === "{") {
        let match = /^\{import:([a-z0-9\-]+)\}$/.exec(b);
        if(match && match.length > 1) {
          moduleNames.push( /^\{import:([a-z0-9\-]+)\}$/.exec(b)[1] );
        } else {
          moduleNames.push( ...PERCH.collectImportedModuleNamesFromText( b.substr(1, b.length-2) ) );
        }
      }
    }
    return [...new Set(moduleNames)];
  }

  // function evaluateTextAsNumber(rootNode, thisRef, text, ctxInfo) {
  //   // NOTE: This function is NOT for evaluating odds expressions!
  //   // NOTE: this only returns the number if it can be "exactly" converted
  //   // into a number - it doesn't evaluate the string's mathematical operators
  //   // or anything like that. It only returns if text === String(Number(text))
  //   // because that mean indicates that the deliberately typed a number, and even if
  //   // they didn't, the toString conversion that occurs when this number is output
  //   // will give **exacttly the same result anyway**.
  //   let value = PERCH.evaluateText(rootNode, thisRef, text, ctxInfo);
  //   if(value === String(Number(value))) {
  //     return Number(value);
  //   } else {
  //     return false;
  //   }
  // }

  // WARNING: I'm exposing this as the old __evaluateText global below becuase people are relying on this in their generators, so if you want to make back-incompat changes, you need to duplicate it!!
  PERCH.evaluateText = function(rootNode, thisRef, text, ctxInfo, previousEvaluationText) {

    // IMPORTANT: Some curly functions may "return themselves" i.e. {a} may return "{a}" rather than "a" or "an" - this
    //            behaviour is allowable because evaluateText is called recursively until no unescaped curly/square blocks
    //            exist. The reason curly functions may do this is because parts of their arguments (the two strings either side of
    //            "{a}" in the case of the "{a}" function) may not have been evaluated yet, and it may rely on those parts having
    //            been evaluated. e.g. in the text "{a} [animal] is over there", {a} must wait until [animal] has been evaluated.
    // ALSO NOTE: previousEvaluationText is needed because (for example) if we evaluate "created {a}", there's nothing after {a} for
    //            us to detemrine whether we should use "a" or "an". But "created {a}" is still valid because they could be using it
    //            as part of a larger sentence. If `text` evaluates to `previousEvaluationText`, then we just return it rather than
    //            recursing infinitely.
    // ALSO NOTE: I had to change this so that instead of [passing through once and then checking if there are any unevaluated blocks that would
    //            require another pass-over], it does the recursion *within* the loop - otherwise things get executed out of order (e.g. assignment of
    //            variables and stuff). The user expects their variable assignments to happen in the order that the final output text is printed in.
    //            Edit: Oh, but I still need to recurse at the end, because some curly blocks like {a} may only be executable once all the blocks are
    //            joined together into one string.
    // ALSO NOTE: This function DOESN'T call processEscapedCharacters on the output. That must be called on the result.

    var bracketRegex = /[\[\]{}]/; // note: this is used further down too

    if(!bracketRegex.test(text)) return text; // if it has no brackets, nothing needs evaluating

    var blocks = PERCH.splitTextAtAllBlocks(text, ctxInfo);
    // iterate through and evaluate each block
    var evaluatedBlocks = [];
    var block, leftBlocks, rightBlocks;
    for(let i = 0; i < blocks.length; i++) {
      block = blocks[i];
      leftBlocks = blocks.slice(0,i);
      rightBlocks = blocks.slice(i+1);

      if(block[0] === "{") {

        let input = block.substr(1,block.length-2);
        let result = PERCH.evaluateCurlyBlock(rootNode, thisRef, input, leftBlocks, rightBlocks, ctxInfo);

        if(result && (typeof result === "object" || typeof result === "function") && result.$nodeType) {
          // This could be a Perchance node due to import blocks. See note below the `PERCH.evaluateSquareBlock` call below for explanation.
          result = result.toString({keepEscapes:true});
        } else {
          result = result + "";
        }

        // the first few conditions here are just performance optimisations:
        if(result !== block && bracketRegex.test(result) && (result[0] === "[" || result[0] === "{" || PERCH.splitTextAtAllBlocks(result).length > 1)) {
          result = PERCH.evaluateText(rootNode, thisRef, result, ctxInfo, result);
        }
        evaluatedBlocks.push(result);

      } else if(block[0] === "[") {

        let input = block.substr(1,block.length-2);
        PERCH.primitiveValueGetterKeepEscapesYolo = true; // see MARKER:odj29hfi3j0d2kj0hx24f for explanation
        let result = PERCH.evaluateSquareBlock(rootNode, thisRef, input, ctxInfo);
        PERCH.primitiveValueGetterKeepEscapesYolo = false;

        if(result && (typeof result === "object" || typeof result === "function") && result.$nodeType) {
          // If it's a Perchance node, we keep the escape characters, since if we remove them here, then we would unescape square/curly character (for example) and
          // then they'd get executed (in the code that follows this block) even though that's obviously not what the user wants. See the comments at the top of the toString
          // function for more context.
          result = result.toString({keepEscapes:true});
        } else {
          result = result + "";
        }

        // the first few conditions here are just performance optimisations:
        if(result !== block && bracketRegex.test(result) && (result[0] === "[" || result[0] === "{" || PERCH.splitTextAtAllBlocks(result).length > 1)) {
          result = PERCH.evaluateText(rootNode, thisRef, result, ctxInfo, result);
        }
        evaluatedBlocks.push(result);

      } else {
        evaluatedBlocks.push(block);
      }
    }

    if(previousEvaluationText === evaluatedBlocks.join("")) return previousEvaluationText; // see note at top of this function for explanation

    // if there's anything but plain text (i.e. if there's any curly/square blocks), recurse
    var b, completelyEvaluated = true;
    for(let i = 0; i < evaluatedBlocks.length; i++) {
      b = evaluatedBlocks[i];
      if(!bracketRegex.test(b)) continue;
      //if(b === undefined) { b = evaluatedBlocks[i] = "(not found)"; }
      if(b[0] === "[" || b[0] === "{" || PERCH.splitTextAtAllBlocks(b).length > 1) {
        completelyEvaluated = false;
        break;
      }
    }

    if(!completelyEvaluated) {
      return PERCH.evaluateText(rootNode, thisRef, evaluatedBlocks.join(""), ctxInfo, evaluatedBlocks.join(""));
    } else {
      return evaluatedBlocks.join("");
    }

  }
  window.__evaluateText = PERCH.evaluateText; // see note at top of this function for explanation

  PERCH.processEscapedCharacters = function(text) {

    //TODO***: when they have an item like `\ hello \` and they repeat it like [item][item][item]... you end up with `hello \ hello \ hello \ ...` because the two backslashes join up.
    //         I think this is pretty easy: if there's an unescaped backslash on the end, remove it when you create the node.
    //         If there's one at the start and it's just escaping a space, then remove that backslash too.

    // TODO***: allow them to escape forward slashes?
    // TODO***: empty character "\e"?

    // look for input characters that follow an unescaped backslash
    // and replace them with the output character and remove the backslash

    let escapableCharacters = [
      {input:"=", output:"="},
      {input:"{", output:"{"},
      {input:"}", output:"}"},
      {input:"[", output:"["},
      {input:"]", output:"]"},
      {input:"^", output:"^"},
      {input:"|", output:"|"},
      {input:"n", output:"\n"},
      {input:"t", output:"\t"},
      {input:"s", output:" "},
    ];

    let escaped = false;
    for(let i = 0; i < text.length; i++) {
      if(i !== 0) {
        if(text[i-1] !== "\\") {
          escaped = false;
        }
      }

      if(text[i] === "\\") {
        if(escaped) { // handle the special case of the backslash character:
          escaped = false;
          text = text.substr(0, i-1) + "\\" + text.substr(i+1);
          i--;
        } else {

          if(i === text.length-1) {
            return text.substr(0, text.length-1); // if last character is an unescaped backslash, return text without it
          } else {
            escaped = true;
          }

        }
        continue;
      }

      if(escaped) {
        for(let e of escapableCharacters) {
          if(text[i] === e.input) {
            text = text.substr(0, i-1) + e.output + text.substr(i+1);
            i--;
            break;
          }
        }
      }

    }

    return text;

  }

  PERCH.processEscapedBrackets = function(text) {

    let escapableCharacters = [
      {input:"{", output:"{"},
      {input:"}", output:"}"},
      {input:"[", output:"["},
      {input:"]", output:"]"},
    ];

    let escaped = false;
    for(let i = 0; i < text.length; i++) {
      if(i !== 0) {
        if(text[i-1] !== "\\") {
          escaped = false;
        }
      }

      if(text[i] === "\\") {
        if(escaped) { // handle the special case of the backslash character:
          escaped = false;
          text = text.substr(0, i-1) + "\\" + text.substr(i+1);
          i--;
        } else {

          if(i === text.length-1) {
            return text.substr(0, text.length-1); // if last character is an unescaped backslash, return text without it
          } else {
            escaped = true;
          }

        }
        continue;
      }

      if(escaped) {
        for(let e of escapableCharacters) {
          if(text[i] === e.input) {
            text = text.substr(0, i-1) + e.output + text.substr(i+1);
            i--;
            break;
          }
        }
      }

    }

    return text;

  }

  PERCH.evaluateCurlyBlock = function(rootNode, thisRef, block, leftBlocks, rightBlocks, ctxInfo) {

    // `block` is a string of the *contents* of the curly block
    for(let fn of PERCH.curlyFunctions) {
      // note that recursion can occur here since some curly functions may neet to
      // resolve their arguments to plain text. So they'll call evaluatedText, which
      // will call this function (if curly brackets are found), and so the loop loops.
      let evaluatedBlock = fn(rootNode, thisRef, block, leftBlocks, rightBlocks, ctxInfo);
      if(evaluatedBlock !== false) {
        if(typeof evaluatedBlock === 'string' && String(Number(evaluatedBlock)) === evaluatedBlock) {
          return Number(evaluatedBlock);
        } else {
          return evaluatedBlock;
        }
      }
    }

    if(block === "s") {
      PERCH.perchanceError(`Your curly block "<code>{${PERCH.escapeHTMLSpecialChars(block)}}</code>" doesn't appear to have the correct syntax. It is meant to be used for something like <code>I have {1-3} [fruit]{s}</code>. Notice that there needs to be a number preceding the <code>[fruit]</code> block. If you just want the plural of <code>[fruit]</code> then you can use <code>[fruit.pluralForm]</code>.`, {declarationLineNumber:ctxInfo.declarationLineNumber, moduleName:ctxInfo.moduleName, node:ctxInfo.node});
    } else {
      PERCH.perchanceError(`Your curly block "<code>{${PERCH.escapeHTMLSpecialChars(block)}}</code>" doesn't appear to have the correct syntax. Curly brackets (these ones: {}) are special characters in Perchance. They're used to do all sorts of fancy stuff which you can learn about in the <a href="/tutorial">tutorial</a>. If you didn't intend to use a special function, and instead just wanted to actually use curly brackets as literal characters, then you can put a backslash character before them like so: \\{...\\}`, {declarationLineNumber:ctxInfo.declarationLineNumber, moduleName:ctxInfo.moduleName, node:ctxInfo.node});
    }
    return "(invalid curly block)";

  }

  // function evaluateCurlylessBlock(rootNode, text) {
  //   // TODO: allow passing in the declarationLineNumber and other details to this function?
  //   let arr = splitTextAtSquareBlocks(text);
  //   let resultText = "";
  //   for(let e of arr) {
  //     if(e[0] === "[") {
  //       let jsExpr = e.substr(1, e.length-2);
  //       resultText += evaluateSquareBlock(rootNode, rootNode, jsExpr, {declarationLineNumber:null});
  //     } else {
  //       resultText += e;
  //     }
  //   }
  //   return resultText;
  // }

  PERCH.getTextOddsDetails = function(text, ctxInfo={}) {
    // JUST returns text on either side of unescaped "^" that is in a TEXT block, with some minor validation (just to help users debug)

    let blocks = PERCH.splitTextAtAllBlocks(text, ctxInfo);
    let blockI = 0;
    let charI = 0;
    let overallI = 0;
    let currentBlock = blocks[0];
    let inText = null;
    function inTextBlock(checkI) {
      // NOTE: we hold the state outside of the function so that we can start from where we left off
      if(overallI > checkI) {
        // start again if previous check state is past the current one
        blockI = 0;
        charI = 0;
        overallI = 0;
        currentBlock = blocks[0];
        inText = null;
      }

      while(true) {

        if(blockI > blocks.length-1) {
          console.error("The checkI value (index to be checked to see if it's within a TEXT block) seems to be greater than the length of the whole text.");
          return false;
        }

        // skip block if checkI doesn't occur within it
        if(charI === 0) {
          if(overallI + blocks[blockI].length-1 < checkI) {
            overallI += blocks[blockI].length; //don't subtract 1 because that would put overallI at last character of current block - we want it to be at the first character of nect block
            charI = 0; // not necessary since it already is zero, but just for expliciteness
            blockI++; // only increase block index after adding block size to overallI
            continue;
          }
        }

        if(charI === 0) {
          if(blocks[blockI][0] === "[" || blocks[blockI][0] === "{") {
            inText = false;
          } else {
            inText = true;
          }
        }

        if(overallI === checkI) {
          return inText;
        }

        if(charI === blocks[blockI].length-1) { // if we've reached the end of a block
          overallI++;
          blockI++;
          charI = 0;
        } else {
          charI++;
          overallI++;
        }

      }
    }

    //text = text.trim(); // <-- I commented this out because inline OR notation like { a ^1| b ^2} would return "a " or "b " instead or " a " or " b "
    let escaped = false;
    for(let i = 0; i < text.length; i++) {
      if(i !== 0) {
        if(text[i-1] !== "\\") { escaped = false; }
      }
      if(text[i] === "\\") { escaped = !escaped; }

      if(!escaped && text[i] === NODE_ODDS_INDICATOR_CHARACTER && inTextBlock(i)) {
        let odds = text.substr(i+1).trim();

        // tiny bit of validation, just to help out users, but definitely not an full validation (which would be basically impossible to do, since we'd need to simulate every possible combination of potentially huge programs)
        if(!/[!0-9\[\{]/.test(odds[0])) {
          PERCH.perchanceError(`There is a problem with this odds declaration: "<b>${PERCH.escapeHTMLSpecialChars(odds)}</b>" (the full text of the line with the error is "${PERCH.escapeHTMLSpecialChars(text)}"). The text after the "^" character defines the chance that that item will be selected (the higher the number the greater the chance). Odds declarations should only contain numbers, mathematical/logical operators, and are also allowed to have curly and square bracket blocks which will evaluate to number characters (these will be computed on-the-fly). If you'd like to use the "^" character literally (i.e. not to declare odds), you need to put a backslash character before it like so: "\\^"`, ctxInfo);
          return false;
        }

        return {
          odds,
          textWithoutOdds: text.substr(0,i), // don't trim() - allow caller to decide, since different notations have difference whitespace preferences
        };
      }
    }

    return false;

  }

  PERCH.oddsTextToNumber = function(rootNode, thisRef, text, ctxInfo={}) {

    // optimisations:
    if(text === "1") { // default value:
      return 1;
    } else if(!/[^0-9]/.test(text)) { // all digits:
      return Number(text);
    } else if(String(Number(text)) === text) {
      return Number(text);
    } else {

      // complex expressions:

      // NOTE: there's an important distinction between converting primitive declarations to numbers,
      // and converting odds declarations to numbers. We only convert primitive declarations to
      // numbers if Number.toString() would return the same string anyway. On the other hand, odds
      // declarations can contain strings with math symbols
      let evaluatedText = PERCH.evaluateText(rootNode, thisRef, text, ctxInfo);

      if(evaluatedText === "false") evaluatedText = "0";
      else if(evaluatedText === "true") evaluatedText = "1";

      // TODO: check that this works
      if(/[^0-9\/*&|%!.\(\)e\-]/.test(evaluatedText)) {
        PERCH.perchanceError(`Your odds declaration: "<b>${PERCH.escapeHTMLSpecialChars(text)}</b>", evaluated to: "<b>${PERCH.escapeHTMLSpecialChars(evaluatedText)}</b>" which contains characters that aren't allowed in odds declarations. The text after the "^" character defines the chance that that item will be selected (the higher the number the greater the chance). Odds declarations should only contain numbers, mathematical/logical operators, and are also allowed to have curly and square bracket blocks which will evaluate to number characters (these will be computed on-the-fly). If you'd like to use the "^" character literally (i.e. not to declare odds), you need to put a backslash character before it like so: "\\^"`, ctxInfo);
        return false;
      }
      let num = false;
      try { num = eval(evaluatedText); } catch(e) {/* no need to catch */}
      return num;

    }

  }

  PERCH.splitTextAtSquareBlocks = function(text, ctxInfo={}) {

    if(!text.includes("[") && !text.includes("]")) return [text];

    let escaped = false;
    let unclosedBracketCount = 0;
    let inJSExpr = false;
    let inJSExprString1 = false, inJSExprString2 = false, inJSExprString3 = false;
    let expressionArray = [];
    for(let i = 0; i < text.length; i++) {
      if(i !== 0) {
        if(text[i-1] !== "\\") { escaped = false; }
      }
      if(text[i] === "\\") { escaped = !escaped; }

      // skip strings in js expressions (square brackets in strings would mess
      // with our unclosedBracketCount):
      if(inJSExpr && !inJSExprString1 && !inJSExprString2 && !inJSExprString3 && !escaped && text[i] === "\"") { inJSExprString1 = true; continue; }
      if(inJSExprString1 && !escaped && text[i] !== "\"") { continue; }
      if(inJSExprString1 && !escaped && text[i] === "\"") { inJSExprString1 = false; continue; }

      if(inJSExpr && !inJSExprString1 && !inJSExprString2 && !inJSExprString3 && !escaped && text[i] === "'") { inJSExprString2 = true; continue; }
      if(inJSExprString2 && !escaped && text[i] !== "'") { continue; }
      if(inJSExprString2 && !escaped && text[i] === "'") { inJSExprString2 = false; continue; }

      if(inJSExpr && !inJSExprString1 && !inJSExprString2 && !inJSExprString3 && !escaped && text[i] === "`") { inJSExprString3 = true; continue; }
      if(inJSExprString3 && !escaped && text[i] !== "`") { continue; }
      if(inJSExprString3 && !escaped && text[i] === "`") { inJSExprString3 = false; continue; }

      // skip escaped brackets within js expressions (i.e. within regex declarations):
      if(inJSExpr && escaped && (text[i] === "[" || text[i] === "]")) { continue; }

      if(!escaped && text[i] === "[") {
        unclosedBracketCount++;
        // if we weren't already inJSExpr, then this is the start of the a JSExpr:
        if(!inJSExpr && i !== 0) {
          expressionArray.push(text.substr(0, i));
          text = text.substr(i);
          i = 0; // will be incremented to 0 on next loop, as required (we've already processed the first char, "[")
        }
        inJSExpr = true;
        continue;
      }

      if(!escaped && text[i] === "]") {
        unclosedBracketCount--;
        // we're only out of the js expression when we've closed all brackets
        if(inJSExpr && unclosedBracketCount === 0) {
          inJSExpr = false;
          expressionArray.push(text.substr(0, i+1));
          text = text.substr(i+1);
          i = -1; // will be incremented to 0 on next loop as required (we haven't yet processed the first character of the new string (the character after "]"))
        }
      }

      // last expression:
      if(i === text.length-1 && text.length !== 0) {
        expressionArray.push(text);
      }
    }

    if(unclosedBracketCount !== 0) {
      PERCH.perchanceError(`It appears that you've got a <b>mismatch in your opening and closing square brackets</b>. For each opening square bracket, there should be a closing one. If you'd like to use a <i>literal</i> square bracket (i.e. you want to actually display one, rather than using them to output a random list item, then you need to put a "backslash" before it like "\\[ ... \\]". Here's the text that seems to be causing the error: <blockquote>${PERCH.escapeHTMLSpecialChars(text)}</blockquote>`, ctxInfo);
      return false;
    }

    return expressionArray;

  }


  PERCH.getInlineFunctionDetails = function(lineText) {
    let isAsync = false;
    if(lineText.startsWith("async ")) {
      isAsync = true;
      lineText = lineText.substr(6);
    }
    let escaped = false;
    let openIndex, opened = false;
    let closeIndex, closed = false;
    for(let i = 0; i < lineText.length; i++) {
      if(i !== 0) {
        if(lineText[i-1] !== "\\") { escaped = false; }
      }
      if(lineText[i] === "\\") { escaped = !escaped; }
      if(lineText[i] === "(" && !escaped) { opened = true; openIndex = i; }
      if(lineText[i] === ")" && !escaped && opened) { closed = true; closeIndex = i; }
      if(lineText[i] === "=" && !escaped && opened && closed && lineText[i+1] === ">") {
        let argString = lineText.substr(openIndex+1, closeIndex-openIndex-1);
        let args = argString.split(",").map(a => a.trim());
        let name = lineText.substr(0, openIndex).trim();
        let body = lineText.substr(i+2).trim();
        if(name.trim() === "") { return false; }
        if(body.trim() === "") { return false; }
        if(PERCH.areValidFunctionArguments(args) || argString === "") {
          if(!PERCH.isValidJavaScriptIdentifier(name)) return false;
          args = args.filter(a => a !== ""); // for zero arg case
          return { args, name, body, isAsync };
        }
      }
    }
    return false;
  }


  PERCH.getFunctionHeaderDetails = function(lineText) {
    let isAsync = false;
    if(lineText.startsWith("async ")) {
      isAsync = true;
      lineText = lineText.substr(6);
    }
    lineText = lineText.trim();
    let l = lineText.length;
    if(lineText[l-2] === "=" && lineText[l-1] === ">") {
      lineText = lineText.substr(0, l-2).trim();
      l = lineText.length;
    } else {
      return false;
    }

    let escaped = false;
    let opened = false;
    let openIndex;
    for(let i = 0; i < lineText.length; i++) {
      if(i !== 0) {
        if(lineText[i-1] !== "\\") { escaped = false; }
      }
      if(lineText[i] === "\\") { escaped = !escaped; }
      if(lineText[i] === "(" && !escaped) { opened = true; openIndex = i; }
      if(lineText[i] === ")" && !escaped && opened) {
        let argString = lineText.substr(openIndex+1, i-openIndex-1);
        let args = argString.split(",").map(a => a.trim());
        let name = lineText.substr(0, openIndex).trim();
        if(name.trim() === "") { return false; }
        if(PERCH.areValidFunctionArguments(args) || argString === "") {
          if(!PERCH.isValidJavaScriptIdentifier(name)) return false;
          args = args.filter(a => a !== ""); // for zero arg case
          return { args, name, isAsync };
        }
      }
    }
    return false;
  }

  PERCH.areValidFunctionArguments = function(args) {
    for(let a of args) {
      if(!PERCH.isValidJavaScriptIdentifier(a.replace("...","").replace("=",""))) {
        return false;
      }
    }
    return true;
  }

  PERCH.isValidJavaScriptIdentifier = function(str) {
    return /^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|null|this|true|void|with|await|break|catch|class|const|false|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D])(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF])*$/.test(str);
  }

  PERCH.getPrimitiveNodeDetails = function(lineText) {
    // NOTE: this function interprets some strings as numbers and casts them using Number()
    //       note that this is *just a shorthand*. The reason it's okay to do is because it
    //       only interprets strings as numbers if Number(that_number).toString() would return
    //       the same string anyway. If the user wants to do something like:
    //            prop = [this.age]/[this.height]
    //       then they should do this instead:
    //            prop = [this.age/this.height]
    //       because the prior will return something like "10/140" (i.e. a string, rather than a number)

    // remember: the lineText could have square blocks which can of course have equals signs in them.
    // But since primitive node keys can't be dynamic we can just return false if we see an unescaped square
    // or curly bracket before we find an unescaped equals sign

    let escaped = false;
    for(let i = 0; i < lineText.length; i++) {
      if(i !== 0) {
        if(lineText[i-1] !== "\\") { escaped = false; }
      }
      if(lineText[i] === "\\") { escaped = !escaped; }

      if((lineText[i] === "[" || lineText[i] === "{") && !escaped) {
        // found square or curly block before unescaped equals sign, so it's not a primitive node
        return false;
      }

      if(lineText[i] === "=" && !escaped) {
        let key = lineText.substr(0, i).trim();
        let valueText = lineText.substr(i+1).trim();
        if(key === "" || valueText === "") {
          return false;
        }

        let value;
        if(valueText === String(Number(valueText))) {
          value = Number(valueText);
        } else if(valueText === "true") { // TODO: test that this works (with filter/where, etc.)
          value = true;
        } else if(valueText === "false") {
          value = false;
        } else {
          value = valueText;
        }

        return {key, value};

      }
    }
    return false;
  }

  // function isMostLikelyAnIntentionalNumericString(valueText) {
  //   if(isNaN(valueText)) { return false; }
  //   if(/[^0-9.\-]+/.test(valueText)) { return false; }
  //   if(valueText.split("-").length > 2) { return false; }
  //   if(valueText.split(".").length > 2) { return false; }
  //
  //   if(valueText.split("-").length === 2) {
  //     if(valueText[0] !== "-") { return false; }
  //     if(valueText[0] === "-" && valueText[1] === ".") { return false; }
  //   }
  //
  //   if(valueText.split(".").length === 2) {
  //     if(valueText[0] === ".") { return false; }
  //     if(valueText[valueText.length-1] === ".") { return false; }
  //
  //     let beforeDecimal = valueText.split(".")[0];
  //     let afterDecimal = valueText.split(".")[1];
  //     if(afterDecimal[afterDecimal.length-1] === "0") { return false; } // e.g. 20.0 shouldn't be treated as a number (they'd have just put in "20")
  //     if(beforeDecimal[0] === "0" && beforeDecimal.length > 1) { return false; } // e.g. 020 shouldn't be treated as a number
  //   }
  //
  //   return true;
  //
  // }


  PERCH.splitTextAtCurlyBlocks = function(text, ctxInfo={}) {
    // remember: we must ignore curly brackets if we're inside a js expression

    if(!text.includes("{") && !text.includes("}")) return [text];

    let escaped = false;
    let lastCurlyOpenIndex = null;

    let inJSExpr = false;
    let unclosedSquareBracketCount = 0;
    let inJSExprString1 = false;
    let inJSExprString2 = false;
    let inJSExprString3 = false;

    let inCurlyExpr = false;
    let unclosedCurlyBracketCount = 0;

    let blocks = [];

    for(let i = 0; i < text.length; i++) {
      if(i !== 0) {
        if(text[i-1] !== "\\") { escaped = false; }
      }
      if(text[i] === "\\") { escaped = !escaped; }

      ////////////////////////////////////
      // skip strings in js expressions //
      ////////////////////////////////////
      //(square brackets in strings would mess with our unclosedSquareBracketCount which we use to skip js expressions):
      if(inJSExpr && !inJSExprString1 && !inJSExprString2 && !inJSExprString3 && !escaped && text[i] === "\"") { inJSExprString1 = true; continue; }
      if(inJSExprString1 && !escaped && text[i] !== "\"") { continue; }
      if(inJSExprString1 && !escaped && text[i] === "\"") { inJSExprString1 = false; continue; }

      if(inJSExpr && !inJSExprString1 && !inJSExprString2 && !inJSExprString3 && !escaped && text[i] === "'") { inJSExprString2 = true; continue; }
      if(inJSExprString2 && !escaped && text[i] !== "'") { continue; }
      if(inJSExprString2 && !escaped && text[i] === "'") { inJSExprString2 = false; continue; }

      if(inJSExpr && !inJSExprString1 && !inJSExprString2 && !inJSExprString3 && !escaped && text[i] === "`") { inJSExprString3 = true; continue; }
      if(inJSExprString3 && !escaped && text[i] !== "`") { continue; }
      if(inJSExprString3 && !escaped && text[i] === "`") { inJSExprString3 = false; continue; }

      // skip escaped brackets within js expressions (i.e. escaped brackets within regex declarations):
      if(inJSExpr && /*--->*/escaped/*<---*/ && (text[i] === "[" || text[i] === "]")) { continue; }

      /////////////////////////////////////
      //      skip JS expressions        //
      /////////////////////////////////////
      // note that we're guarunteed to NOT be in a string for this block (since the
      // above block skips strings while we're in js expressions)
      if(!inJSExpr && text[i] === "[" && !escaped) {
        inJSExpr = true;
        unclosedSquareBracketCount++;
        continue;
      }
      if(inJSExpr && text[i] === "[") { // `escaped` is irrelevant, we're inJSExpr and not in string
        unclosedSquareBracketCount++;
        continue;
      }
      if(inJSExpr && text[i] === "]") { // `escaped` is irrelevant, we're inJSExpr and not in string
        unclosedSquareBracketCount--;
        if(unclosedSquareBracketCount === 0) { inJSExpr = false; }
      }


      //////////////////////////////////////
      //      extract curly blocks        //
      //////////////////////////////////////
      if(text[i] === "{" && !escaped && !inJSExpr) {
        unclosedCurlyBracketCount++;
        // if we're not yet in a curly expression, then this is the start of one:
        if(!inCurlyExpr && i !== 0) {
          blocks.push(text.substr(0, i));
          text = text.substr(i);
          i = 0;
        }
        inCurlyExpr = true;
        continue;
      }
      if(text[i] === "}" && !escaped && !inJSExpr) {
        unclosedCurlyBracketCount--;
        // we're only out of the curly expression when we've closed all curly brackets that were opened
        if(inCurlyExpr && unclosedCurlyBracketCount === 0) {
          blocks.push(text.substr(0, i+1));
          text = text.substr(i+1);
          i = -1;
          inCurlyExpr = false;
        }
      }

      // add last expression (if it didn't end in a curly block - in that case text.length === 0)
      if(i === text.length-1 && text.length !== 0) {
        blocks.push(text);
      }

    }

    if(unclosedSquareBracketCount !== 0) {
      PERCH.perchanceError(`It appears that you've got <b>a mismatch in your opening and closing square brackets</b>. For each opening square bracket, there should be a closing one. If you'd like to use a <i>literal</i> square bracket (i.e. you want to actually display one, rather than using them to output a random list item, then you need to put a "backslash" before it like "\\[ ... \\]". Here's the text that seems to be causing the error: <blockquote>${PERCH.escapeHTMLSpecialChars(text)}</blockquote>`, ctxInfo);
      return ["(syntax error)"];
    }

    if(unclosedCurlyBracketCount !== 0) {
      PERCH.perchanceError(`It appears that you've got <b>a mismatch in your opening and closing curly brackets</b>. For each opening curly bracket, there should be a closing one. If you'd like to use a <i>literal</i> curly bracket (i.e. you want to actually display one, rather than using them to do {import:noun} and stuff like that, then you need to put a "backslash" before it like "\\{ ... \\}". Here's the text that seems to be causing the error: <blockquote>${PERCH.escapeHTMLSpecialChars(text)}</blockquote>`, ctxInfo);
      return ["(syntax error)"];
    }


    return blocks;

  }

  PERCH.splitTextAtAllBlocks = function(text, ctxInfo={}) {
    let curlySplitParts = PERCH.splitTextAtCurlyBlocks(text, ctxInfo);
    let blocks = []; // this array will contain curly blocks, text blocks, and square blocks
    for(let part of curlySplitParts) {
      if(part[0] !== "{") {
        let squareSplitParts = PERCH.splitTextAtSquareBlocks(part, ctxInfo);
        if(squareSplitParts) {
          blocks.push(...squareSplitParts);
        } else {
          console.error("Something is wrong?");
        }
      } else {
        blocks.push(part);
      }
    }
    return blocks;
  }


  PERCH.stripCommentFromLine = function(line) {
    // NOTE: comment must either start at start of line, or have a space before it.
    // e.g. in http://example.com , "//example.com" isn't considered a comment because
    // it doesn't have a preceding space
    let i, escaped = false;
    for(i = 0; i < line.length; i++) {
      if(i !== 0) {
        if(line[i-1] !== "\\") { escaped = false; }
      }
      if(line[i] === "\\") { escaped = !escaped; }
      if(line[i] === "/" && !escaped && line[i+1] === "/") {
        if(i === 0) {
          break;
        } else {
          if(line[i-1] === " " || line[i-1] === "\t") {
            break;
          }
        }
      }
    }
    return line.substr(0,i);
  }



  PERCH.normaliseLineIndentsToTabs = function(line) {
    let i, eqSpaceCount = 0; //equivalent spaces (1 tab = 2 spaces)
    for(i = 0; i < line.length; i++) {
      if(line[i] === " ") { eqSpaceCount++; }
      else if(line[i] === "\t") { eqSpaceCount += 2; }
      else { break; }
    }
    if(eqSpaceCount%2 !== 0) {
      return false; //odd number of spaces
    } else {
      return "\t".repeat(parseInt(eqSpaceCount/2)) + line.substr(i);
    }
  }

}</script> <script>{
  const PERCH = window.PERCH;

  PERCH.selectManyMethodStringNum = function(num) {
    let arr = [];
    for(let i = 0; i < num; i++) {
      arr.push(this.selectOne);
    }
    // overwrite default array behaviour (selects a random one)
    // in the case where they don't specify a join() after the repeat:
    arr.toString = function() { return this.join(""); };
    return arr;
  }
  

  Object.defineProperty(String.prototype, "titleCase", {get:PERCH.titleCaseMethod});
  Object.defineProperty(Number.prototype, "titleCase", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "titleCase", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "sentenceCase", {get:PERCH.sentenceCaseMethod});
  Object.defineProperty(Number.prototype, "sentenceCase", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "sentenceCase", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "upperCase", {get:PERCH.upperCaseMethod});
  Object.defineProperty(Number.prototype, "upperCase", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "upperCase", {get:function(){return this.valueOf();}})

  Object.defineProperty(String.prototype, "lowerCase", {get:PERCH.lowerCaseMethod});
  Object.defineProperty(Number.prototype, "lowerCase", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "lowerCase", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "replaceText", {value:PERCH.replaceTextMethod});
  Object.defineProperty(Number.prototype, "replaceText", {value:PERCH.replaceTextMethod});
  Object.defineProperty(Boolean.prototype, "replaceText", {value:PERCH.replaceTextMethod});

  Object.defineProperty(String.prototype, "pastTense", {get:PERCH.pastTenseMethod});
  Object.defineProperty(Number.prototype, "pastTense", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "pastTense", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "presentTense", {get:PERCH.presentTenseMethod});
  Object.defineProperty(Number.prototype, "presentTense", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "presentTense", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "futureTense", {get:PERCH.futureTenseMethod});
  Object.defineProperty(Number.prototype, "futureTense", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "futureTense", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "getSelf", {get:function() { return this+""; }});
  Object.defineProperty(Number.prototype, "getSelf", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "getSelf", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "getOdds", {get:function() { return 1; }});
  Object.defineProperty(Number.prototype, "getOdds", {get:function(){ return 1; }});
  Object.defineProperty(Boolean.prototype, "getOdds", {get:function(){ return 1; }});

  // WHAT IS THIS?
  Object.defineProperty(String.prototype, "getName", {get:function() {
    return this+"";
  }});
  Object.defineProperty(Number.prototype, "getName", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "getName", {get:function(){return this.valueOf();}})


  Object.defineProperty(String.prototype, "evaluateItem", {get:function() {
    let r = PERCH.currentEvaluateSquareBlockRoot ? PERCH.currentEvaluateSquareBlockRoot : root; // so imported generators use their own root
    let out = PERCH.evaluateText(r, r, this.valueOf(), {declarationLineNumber:null});
    if(window.generatorLastEditTime > 1716337636385) { // May 22nd 2024 bugfix, ensures only generators edited after this time get it, to prevent breaking old generators that rely on the bug
      out = PERCH.processEscapedCharacters(out);
    }
    if(String(Number(out)) === out) {
      out = Number(out);
    }
    return out;
  }});
  Object.defineProperty(Number.prototype, "evaluateItem", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "evaluateItem", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, Symbol.toPrimitive, {value:function(hint) {
    return this.valueOf();
  }});
  // i don't think these two are necessary?
  Object.defineProperty(Number.prototype, Symbol.toPrimitive, {value:function(hint) {
    return this.valueOf();
  }});
  Object.defineProperty(Boolean.prototype, Symbol.toPrimitive, {value:function(hint) {
    return this.valueOf();
  }});


  Object.defineProperty(String.prototype, "selectMany", {value:PERCH.selectManyMethodStringNum});
  Object.defineProperty(Number.prototype, "selectMany", {value:PERCH.selectManyMethodStringNum});
  Object.defineProperty(Boolean.prototype, "selectMany", {value:PERCH.selectManyMethodStringNum});
  

  Object.defineProperty(String.prototype, "selectOne", {get:function() {
    let r = PERCH.currentEvaluateSquareBlockRoot ? PERCH.currentEvaluateSquareBlockRoot : root; // so imported generators use their own root
    let out = PERCH.evaluateText(r, r, this.valueOf(), {declarationLineNumber:null}); // so you can write e.g. [n = "{1-20}".selectOne]
    if(window.generatorLastEditTime > 1716337636385) { // May 22nd 2024 bugfix, ensures only generators edited after this time get it, to prevent breaking old generators that rely on the bug
      out = PERCH.processEscapedCharacters(out);
    }
    if(String(Number(out)) === out) {
      out = Number(out);
    }
    return out;
  }});
  Object.defineProperty(Number.prototype, "selectOne", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "selectOne", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "singularForm", {get:function(n) {
    let input = this+""; // need +"" because compromise wants primitive, not String() obj
    let output = PERCH.nlpCompromise(input).nouns().toSingular().out("text");
    return output === "" ? input : output;
  }});
  Object.defineProperty(Number.prototype, "singularForm", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "singularForm", {get:function(){return this.valueOf();}});

  Object.defineProperty(String.prototype, "pluralForm", {get:function(n) {
    let input = this+""; // need +"" because compromise wants primitive, not String() obj
    let output = PERCH.nlpCompromise(input).nouns().toPlural().out("text");
    return output === "" ? input : output;
  }});
  Object.defineProperty(Number.prototype, "pluralForm", {get:function(){return this.valueOf();}});
  Object.defineProperty(Boolean.prototype, "pluralForm", {get:function(){return this.valueOf();}});


}</script> <script>{

  const PERCH = window.PERCH;

  // NOTE (Feb 25th 2025): This was messing with minifiers (including for three.js), which change ${arr.join(",")} to ${arr}, since joining with commas is default behavior, and so this toString method was breaking external libraries.
  // This is a breaking change, but it's worth it considering it's breaking far more code by *not* reverting it.
  if(window.generatorLastEditTime < 1740480702863 && !["minimal", "blank"].includes(window.generatorName)) {
    Array.prototype.toString = function() {
      if(this.length === 0) return "";
      return this.selectOne+""; // should this be `this.selectOne.toString({keepEscapes:true})` ?
    };
  }

  Object.defineProperty(Array.prototype, "getOdds", {get:function() { return 1; }});
  Object.defineProperty(Array.prototype, "getSelf", {get:function() { return this; }});
  Object.defineProperty(Array.prototype, "getLength", {get:function() { return this.length; }});

  Object.defineProperty(Array.prototype, "consumableList", {get:function() {

    let proxy = new Proxy(this, {
      // alreadyConsumedItems: new Set(),
      alreadyConsumedIndices: new Set(), // NOTE: we need this (unlike in the addNodeMethods.js case where we use alreadyConsumedItems) because an array can contain duplicates of the same item: lemmy.world/post/6207000 but we should treat them as separate items.
      get: function(target, property) {
        if(property === "selectOne") {
          let selectedNode = PERCH.arraySelectOneMethod.bind(proxy)();
          // if(selectedNode) { // consumption is done in PERCH.arraySelectOneMethod now
          //   this.alreadyConsumedItems.add(selectedNode);
          // }
          return selectedNode;
        }/* else if(property === "$alreadyConsumedItems") {
          return this.alreadyConsumedItems;
        }*/ else if(property === "$alreadyConsumedIndices") {
          return this.alreadyConsumedIndices;
        } else if(property === "getLength") {
          // return target.length - this.alreadyConsumedItems.size;
          return target.length - this.alreadyConsumedIndices.size;
        } else {
          // TODO: strangely, the return value here seems to be automatically bound to this proxy.
          // so it also handles toString and valueOf methods like we want it to
          return target[property];
        }
      },
    });

    proxy.toString = function() {
      let selectedNode = PERCH.arraySelectOneMethod.bind(proxy)();
      return selectedNode;
    };
    return proxy;

  }});

  Object.defineProperty(Array.prototype, "selectAll", {get: function() {
    return this;
  }});

  Object.defineProperty(Array.prototype, "selectMany", {value:PERCH.selectManyMethod});

  Object.defineProperty(Array.prototype, "selectUnique", {value: function(...args) {
    return this.consumableList.selectMany(...args);
  }});

  PERCH.arraySelectOneMethod = function() {
    //return this[Math.floor(Math.random()*this.length)];
    let candidates = []; /*{item, odds}*/
    for(let i = 0; i < this.length; i++) {
      if(this.$alreadyConsumedIndices && this.$alreadyConsumedIndices.has(i)) continue;
      let a = this[i];
      if(a.$nodeType) { // if it's a node
        candidates.push({item:a, odds:a.$odds, index:i});
      } else if(typeof a === 'string') {
        let details = PERCH.getTextOddsDetails(a);
        if(details && (details.odds.includes("[") || details.odds.includes("{"))) details.odds = details.odds.evaluateItem; // don't need the if statement, but it's better for performance
        let odds = details ? Number(details.odds) : 1; // <-- this doesn't allow dynamic odds notation in arrays. Can always add it later if it turns out that it would be useful.
        
        if(odds < 0 || isNaN(odds)) {
          PERCH.perchanceError(`The odds of ${a} has evaluated to ${odds < 0 ? "a negative number" : "a non-number"}. It's item number ${i} in the list (the list that starts with ${this[0]}). You may have created this list with selectAll or selectUnique.`);
        }
        
        let item = details ? details.textWithoutOdds : a;
        candidates.push({item, odds, index:i});
      } else {
        candidates.push({item:a, odds:1, index:i});
      }
    }

    // if(this.$alreadyConsumedItems) { // this doesn't make sense because an array can contain duplicates of the same node: lemmy.world/post/6207000
    //   candidates = candidates.filter(c => !this.$alreadyConsumedItems.has(c.item));
    // }

    let oddsTotal = candidates.reduce((a,v) => { return a+v.odds; }, 0);
    let stopOddsSum = oddsTotal*Math.random();

    let oddsRunningSum = 0;
    for(let c of candidates) {
      oddsRunningSum += c.odds;
      if(oddsRunningSum >= stopOddsSum) {
        if(this.$alreadyConsumedIndices) this.$alreadyConsumedIndices.add(c.index);
        return c.item;
      }
    }

    if(this.$alreadyConsumedIndices) {
      PERCH.perchanceError("It looks like your <code>consumableList</code> ran out of items. This is the list in question: "+this.slice(0, 100).join(", "));
    } else {
      PERCH.perchanceError("Something went wrong! <code>Error: selectOne from array returned nothing.</code> Please report this on <a href='https://lemmy.world/c/perchance'>lemmy.world/c/perchance</a> since it's likely a bug with the engine.");
    }

  };
  Object.defineProperty(Array.prototype, "selectOne", {get:PERCH.arraySelectOneMethod});


  Object.defineProperty(Array.prototype, Symbol.toPrimitive, {value:function(hint) {
    return this.toString();
  }});

  // don't need this because we've got joinItems, right?
  // Object.defineProperty(Array.prototype, "evaluateItem", {get:function() {
  //   return this.toString();
  // }});

  Object.defineProperty(Array.prototype, "joinItems", {value:function(str="") {
    return this.join(str);
  }});

  Object.defineProperty(Array.prototype, "sumItems", {get:function() {
    return this.reduce((a, v) => a+v.evaluateItem, 0);
  }});


  // TODO***: make all methods configurable like in nodeMethods?

  Object.defineProperty(Array.prototype, "pluralForm", {get:function() {
    return this.map(a => a.pluralForm);
  }});
  Object.defineProperty(Array.prototype, "singularForm", {get:function() {
    return this.map(a => a.singularForm);
  }});

  Object.defineProperty(Array.prototype, "pastTense", {get:function() {
    return this.map(a => a.pastTense);
  }});
  Object.defineProperty(Array.prototype, "presentTense", {get:function() {
    return this.map(a => a.presentTense);
  }});
  Object.defineProperty(Array.prototype, "futureTense", {get:function() {
    return this.map(a => a.futureTense);
  }});

  Object.defineProperty(Array.prototype, "titleCase", {get:function() {
    return this.map(a => a.titleCase);
  }});
  Object.defineProperty(Array.prototype, "upperCase", {get:function() {
    return this.map(a => a.upperCase);
  }});
  Object.defineProperty(Array.prototype, "lowerCase", {get:function() {
    return this.map(a => a.lowerCase);
  }});
  Object.defineProperty(Array.prototype, "sentenceCase", {get:function() {
    return this.map(a => a.sentenceCase);
  }});

  Object.defineProperty(Array.prototype, "replaceText", {value:function(p1, p2, p3) {
    return this.map(a => a.replaceText(p1, p2, p3));
  }});


}</script> <script>{
  const PERCH = window.PERCH;

  PERCH.curlyFunction_Import = function(rootNode, thisRef, text, leftBlocks, rightBlocks, ctxInfo) {
    if(!text.includes(":")) return false;
    let match = /^import:([a-z0-9\-]+)$/.exec(text);
    if(!match) {
      return false;
    } else {
      let moduleName = match[1];
      let moduleRef = rootNode.$moduleSpace[moduleName];
      if( moduleRef ) {
        return moduleRef;
      } else {
        PERCH.perchanceError(`You've tried to import a generator that doesn't exist. The generator named '${PERCH.escapeHTMLSpecialChars(moduleName)}' was not found. You can see for yourself by visiting that generator: <a href="/${moduleName}">${moduleName}</a>. There's a <a href="/useful-generators">list of useful generators</a> that may help you find what you're looking for.`, ctxInfo);
        return `(cannot find generator '${moduleName}')`;
      }
    }
  }

  PERCH.curlyFunction_A = function(rootNode, thisRef, text, leftBlocks, rightBlocks) {
    if(text === "a" || text === "A") {
      let right = PERCH.removeHtmlTagsFromBlocksArray(rightBlocks); //rightBlocks.filter(b => b.replace(/<[^>]+?>/g, '').trim() !== "");
      if(right[0] === undefined || (right[0] && (right[0].trim()[0] === "{"|| right[0].trim()[0] === "["))) {
        return text === "a" ? "{a}" : "{A}";
      } else {
        let aOrAn = PERCH.AvsAnSimple.query(right[0].trim().replace(/<[^>]+?>/g, '').split(/[\s$%&*@#,!=+\-.?:;'"(){}\[\]\/<>`~_|]/g)[0].trim());
        if(text === "A") {
          if(aOrAn === "a") aOrAn = "A";
          else aOrAn = "An";
        }
        return aOrAn;
      }
    } else {
      return false;
    }
  }

  PERCH.curlyFunction_Range = function(rootNode, thisRef, text, leftBlocks, rightBlocks) {
    if(!text.includes("-")) return false;

    let match;

    // TODO: written numbers: {twenty-fifty five} ?
    // TODO: custom increments: {0-100:0.5} ? not sure about notation yet

    // {1-10}
    match = /^([0-9]+)-([0-9]+)$/.exec(text);
    if(match) {
      let min = Number(match[1]);
      let max = Number(match[2]);
      if(min > max) { [min, max] = [max, min]; }
      return Math.floor(Math.random() * (max - min + 1) + min); // we do not talk about what was here before
    }

    // {a-z}
    match = /^([a-z])-([a-z])$/.exec(text);
    if(match) {
      let min = Number(match[1].charCodeAt(0));
      let max = Number(match[2].charCodeAt(0));
      if(min > max) { [min, max] = [max, min]; }
      return String.fromCharCode( min+Math.round(Math.random()*(max-min)) );
    }

    // {A-Z}
    match = /^([A-Z])-([A-Z])$/.exec(text);
    if(match) {
      let min = Number(match[1].charCodeAt(0));
      let max = Number(match[2].charCodeAt(0));
      if(min > max) { [min, max] = [max, min]; }
      return String.fromCharCode( min+Math.round(Math.random()*(max-min)) );
    }

    return false;

  }

  PERCH.curlyFunction_S = function(rootNode, thisRef, text, leftBlocks, rightBlocks) {
    // there are {1..10} person{s} <-- can't do this, must manually handle the 2 cases
    // I have {1..10} coin{s} <-- can do this :)
    if(text === "s") {

      // TODO: fix this with some proper NLP to handle written numbers: "twenty five"

      // search through leftBlocks backwards for the first number.
      // if a non-text block is found before a number is, return "{s}"
      for(let i = leftBlocks.length-1; i >= 0; i--) {
        let block = leftBlocks[i];
        if(block[0] === "{" || block[0] === "[") {
          return "{s}";
        }
        let numbers = block.split(/[\s,!?\-()/.]+/).filter(a => /[0-9]+/.test(a));
        if(numbers.length > 0) {
          let num = Number(numbers[numbers.length-1]);
          return num === 1 ? "" : "s";
        }
      }

    }
    return false;

  }

  PERCH.curlyFunction_Or = function(rootNode, thisRef, text, leftBlocks, rightBlocks, ctxInfo={}) {
    if(!text.includes("|")) return false;

    // no need to evaluate the arguments. we can just extract them (with their odds)
    // and select a random one. We could evaluate the args but in that case it would be
    // important that we extract all the *arguments* first (and their odds), then
    // choose a random one (otherwise NEW "|" and "^" characters could end up in the evaluated text)
    // and mess up our interpretation of the arguments.

    // pulled the bulk of this curlyFunction_Or function out into its own function for use elsewhere:
    let args = PERCH.splitUpCurlyOrBlock(text, ctxInfo);
    if(args === false) return false;

    // now we need to extract odds and choose a random one
    // note that in curly "or" notation, *spaces matter* before and after the text.
    // thus we don't trim the string after extracting the odds.

    return PERCH.chooseRandomTextByOdds(rootNode, thisRef, args);

    // TODO: sort out Array.toString
    // LOOK AT Array.toString definition - try to extract out a common function
    // (or you could just call) .toString on `parts` lol
    // hmm. Array.toString relies on window.root being available which isn't great.
    // I think first step is to test whether it works, then extract out as much as I
    // can into functions. Array.toString is more of a handy hack - I don't want to rely
    // on it if I can help it.


  }

  PERCH.splitUpCurlyOrBlock = function(text, ctxInfo={}) {
    // note this returns false if it's not a valid curly OR block.
    // also, it expects that the outer curly brackets have already been removed

    // the easiest way to be find all the unescaped "|" characters is to split it
    // up and then search through *only text blocks*:
    let blocks = PERCH.splitTextAtAllBlocks(text, ctxInfo);
    let args = [];
    let currentArg = "";
    for(let j = 0; j < blocks.length; j++) {
      let block = blocks[j];
      if(block[0] !== "{" && block[0] !== "[") {

        let escaped = false;
        for(let i = 0; i < block.length; i++) {
          if(i === 0) {
            // if we're at the start of the block, it's not escaped:
            escaped = false;
          } else {
            // if we're not at start, it's not escaped if the last char wasn't a backslash:
            if(block[i-1] !== "\\") { escaped = false; }
          }
          // toggle escapedness at each consecutive backslash:
          if(block[i] === "\\") { escaped = !escaped; }

          if(block[i] === "|" && !escaped) {

            currentArg += block.substr(0,i);
            args.push(currentArg);
            currentArg = "";
            block = block.substr(i+1);
            i = -1; // will get incremented to zero on loop

          } else if(i === block.length-1) {

            currentArg += block;

          }

        }
        if(j === blocks.length-1) {
          args.push(currentArg);
        }

      } else {
        currentArg += block;
        if(j === blocks.length-1) {
          args.push(currentArg);
        }
      }
    }

    if(args.length === 0 || args.length === 1) {
      // this is not the correct curly function to interpret this curly block
      return false;
    }

    return args;

  }

  PERCH.chooseRandomTextByOdds = function(rootNode, thisRef, textArray, ctxInfo={}) {

    // extract odds
    let items = [];
    for(let text of textArray) {
      text = text+""; // cast to string (needed for Array.toString);
      let odds, textWithoutOdds;
      let details = PERCH.getTextOddsDetails(text);

      // TODO: fix this up to suit the new way of doign things

      if(!details) {
        textWithoutOdds = text;
        odds = 1;
        items.push({text:textWithoutOdds, odds});
        continue;
      }

      textWithoutOdds = details.textWithoutOdds;
      odds = details.odds;

      if(typeof odds === 'string' && (odds[0] === "[" || /[0-9]/.test(odds[0]) )) { // if it's a dynamic odds expression:

        let evaluatedOdds = PERCH.oddsTextToNumber(rootNode, thisRef, odds);

        if(evaluatedOdds < 0) {
          PERCH.perchanceError(`The dynamic odds expression "${PERCH.escapeHTMLSpecialChars(odds)}" in ${PERCH.escapeHTMLSpecialChars("{"+textArray.join("|")+"}")} resolved to a *negative* number. Odds must be positive numbers, since it doesn't make sense for something to have a negative chance of being selected. Remember that you can try executing this odds expression in the console (bottom-left panel in the editor interface) and see what it yeilds. Also remember that "^" is a special character that is used to declare the probability that the item will be selected, and if you want to use it as a literal character (i.e. not to declare odds), then you need to put a "backslash" before it like so: "\\^"`, ctxInfo);
          return false;
        }
        if(evaluatedOdds === false) {
          PERCH.perchanceError(`The dynamic odds expression "${PERCH.escapeHTMLSpecialChars(odds)}" in ${PERCH.escapeHTMLSpecialChars("{"+textArray.join("|")+"}")} didn't resolve to a number. Remember that you can try executing this odds expression in the console (bottom-left panel in the editor interface) and see what it yeilds. Also remember that "^" is a special character that is used to declare the probability that the item will be selected, and if you want to use it as a literal character (i.e. not to declare odds), then you need to put a "backslash" before it like so: "\\^"`, ctxInfo);
          return false;
        }
        odds = evaluatedOdds;

      }

      items.push({text:textWithoutOdds, odds});

    }


    // select one based on odds
    let oddsSum = 0;
    let oddsArray = [];
    for(let item of items) {
      oddsSum += item.odds;
      oddsArray.push(item.odds);
    }

    if(items.length === 0) {
      console.warn(`Warning: Tried to get random selection from an empty array?`);
      return "";
    }

    // choose random position in oddsSum range
    let oddsSumStopPoint = oddsSum*Math.random();
    let selectedItem;
    let oddsSumForChoice = 0;

    for(let i = 0; i < items.length; i++) {
      oddsSumForChoice += oddsArray[i];
      if(oddsSumForChoice >= oddsSumStopPoint) {
        selectedItem = items[i];
        break;
      }
    }

    return selectedItem.text;

  }

  // doesn't need to be perfect! just a rough clean to help the {a/A} blocks
  PERCH.removeHtmlTagsFromBlocksArray = function(blocks) {
    const joinTag = "sdoxci892387uoooJOINoooTAGooohkdsiyygjd970sjgs";
    let str = blocks.join(joinTag);
    let charArr = str.split("");
    let inTag = false;
    for(let i = 0; i < charArr.length; i++) {
      if(charArr[i] === "<" && !inTag) {
        inTag = true;
        charArr[i] = "";
      } else if(charArr[i] === ">" && inTag) {
        inTag = false;
        charArr[i] = "";
      } else if(inTag) {
        charArr[i] = "";
      }
    }
    return charArr.join("").split(joinTag).filter(c => c.trim() !== "");
  }

  PERCH.curlyFunctions = [PERCH.curlyFunction_Or, PERCH.curlyFunction_Import, PERCH.curlyFunction_Range, PERCH.curlyFunction_S, PERCH.curlyFunction_A];

}</script> <script>{
      const PERCH = window.PERCH;
      PERCH.alreadyAttachedSaveHandler = false;
      PERCH.postMessagesRecieved = 0;
      PERCH.isFirstUpdate = true; // NOTE: this is for `PERCH.updateOutput` calls, not `update` calls
      window.moduleSpace = {}; // NOTE: people are using this in their generators, so you can't change/remove it.

      {
        const navigator = window.navigator;
        let originalConfirm = window.confirm.bind(window);
        let lastWarnEl;
        window.confirm = function(...args) {
          let startTime = Date.now();
          let result = originalConfirm(...args);
          let timeTaken = Date.now()-startTime;
          if(timeTaken < 10 && !navigator.webdriver) {
            let className = "a"+Math.random().toString(36).substr(2, 9);
            let div = document.createElement("div");
            div.innerHTML = `<div style="text-align:left; padding:0.5rem; background:#530020; width:600px; max-width:95vw; display:inline-block; border-radius:3px; box-shadow:0px 0px 6px 0px #000000;"><span style="color:white;"><b>Heads up</b>: Your browser seems to be blocking dialog popups, which may be breaking functionality of this generator. You can try closing all perchance.org tabs and then re-opening this page, or restarting your browser, or looking in your browser settings for a way to unblock dialog popups. Otherwise, try using the 'Chrome' web browser instead.</span> <button onclick="this.closest('.${className}').remove()">dismiss</button></div>`;
            div.style.cssText = `z-index:100000000; position:fixed; top:1rem; left:0; right:0; width:100%; text-align:center;`;
            div.classList.add(className);
            if(lastWarnEl) lastWarnEl.remove();
            lastWarnEl = div;
            document.body.appendChild(div);
          }
          return result;
        }
      }

      {
        // Make href="#foo" links have .href prop that behaves like "/foo" ones (RE weird/inconsistent behavior of <base target="_parent"> for #foo links):
        const originalHrefGetter = Object.getOwnPropertyDescriptor(HTMLAnchorElement.prototype, 'href').get;
        Object.defineProperty(HTMLAnchorElement.prototype, 'href', {
          get: function() {
            const originalHref = originalHrefGetter.call(this);
            if(this.getAttribute("href").startsWith("#")) {
              let url = new URL(window.location.href);
              url.hostname = "perchance.org";
              url.search = "";
              url.hash = this.getAttribute("href");
              return url.href;
            } else {
              return originalHref;
            }
          },
          configurable: true,
          enumerable: true
        });

        // listen to parent telling us to change hash, reload page, etc.:
        window.addEventListener('message', async function(e) {
          if(e.source !== PERCH.parentWindow) return;
          if(e.origin !== "https://perchance.org") return;
          if(e.data.type === "changeHash") {
            if(window.location.hash !== e.data.hash) {
              window.location.hash = e.data.hash;
            }
          }
          if(e.data.type === "__triggerPageReload857392947") {
            PERCH.parentWindow.postMessage({type:"__triggerPageReloadResponse5792947", requestId:e.data.requestId}, "https://perchance.org");
            await new Promise(r => setTimeout(r, 50)); // wait for response to be sent
            window.location.reload();
          }
          if(e.data.type === "__triggerPageFocus8573946292") {
            window.focus();
          }
        });
        // tell parent our hash when it changes:
        window.addEventListener('hashchange', function() {
          PERCH.parentWindow.postMessage({type:"changeHash", hash:window.location.hash}, "https://perchance.org");
        });

        window.addEventListener('pointerdown', function() {
          PERCH.parentWindow.postMessage({type:"firstPageInteraction"}, "https://perchance.org");
        }, {once:true});

        // tell parent when query string changes:
        PERCH.originalHistoryReplaceState = history.replaceState.bind(history);
        history.replaceState = function(...args) {
          if(typeof args[2] === "string") {
            // fix relative URLs since they will use <base> which is incorrect:
            let url = new URL(args[2], window.location.href);
            if(url.pathname !== window.location.pathname) {
              throw new Error(`You tried to change the pathname to '${url.pathname}' with history.replaceState, but Perchance doesn't support changing the pathname with \`history.replaceState\`. The pathname must be '${window.location.pathname}'. You can only change the search/query string, and the hash. If you want to change the pathname (i.e. to navigate to a different generator), you can create a link with an href attribute, and call \`.click()\` on that link.`);
            }
            args[2] = url.href;
          }
          PERCH.originalHistoryReplaceState(...args);
          PERCH.parentWindow.postMessage({type:"changeUrl", search:window.location.search, hash:window.location.hash}, "https://perchance.org");
        };
        
        // tell parent when page title or favicon changes:
        function getFaviconHref() {
          const favicon = document.querySelector('link[rel="icon"], link[rel="shortcut icon"]');
          return favicon ? favicon.href : null;
        }
        let currentFaviconHref = getFaviconHref();
        let currentTitle = document.title;
        const observer = new MutationObserver((mutations) => {
          if(document.title !== currentTitle) {
            PERCH.parentWindow.postMessage({type:"changePageTitle", pageTitle:document.title}, "https://perchance.org");
            currentTitle = document.title;
          }
          const newFaviconHref = getFaviconHref();
          if(newFaviconHref !== currentFaviconHref) {
            PERCH.parentWindow.postMessage({type:"changeFavicon", href:newFaviconHref}, "https://perchance.org");
            currentFaviconHref = newFaviconHref;
          }
        });
        const config = { childList: true, subtree: true, attributes:true, attributeFilter:["href"] };
        observer.observe(document.head, config);
      }

      PERCH.updateOutput = async function(outputTemplate) {

        if(false) {
          // // NOTE: this was intended to replace all the original 'with' craziness, but the problem is that:
          // //   1. it triggers getters on root
          // //   2. even if we prevent that (e.g. just skip getters), there's no way to 'expose' those getters to the script tags without using `with`.
          // if(document.getElementById("__rootVarsScript9035397593sdfkjhi4")) document.getElementById("__rootVarsScript9035397593sdfkjhi4").remove();
          // let rootVarsScript = document.createElement('script');
          // rootVarsScript.id = "__rootVarsScript9035397593sdfkjhi4"
          // rootVarsScript.textContent = `
          //   try {
          //     for(let key of window.root.___proxyTarget.visiblePropertiesForWith) {
          //       eval(\`var \${key} = root['\${key}'];\`);
          //     }
          //   } catch(e) {
          //     console.error(e);
          //   }
          // `;
          // document.head.appendChild(rootVarsScript);
        }

        document.querySelector("#output-container").innerHTML = outputTemplate;

        // We need to get the MutationObserver to ignore all of the nodes we just added because
        // the MutationObserver is just for "dynamically added" nodes (i.e. added with custom javascript),
        // and the nodes that we just added will be rendered by the `update()` function, of course.
        // (we wouldn't actually need to do this if this function weren't async)
        let allNewTextNodes = PERCH.getAllTextNodeDescendents(document.querySelector("#output-container")); // this function adds the text nodes to the `allTextNodes` array
        for(let textNode of allNewTextNodes) {
          textNode.___alreadyRenderedPerchanceCode = true; // note that we haven't actually rendered it yet, but we're just about to (need to get in before MutationObserver, since this function is async)
        }
        // Need to do the same for attributes:
        for(let el of Array.from(document.querySelectorAll("#output-container *"))) {
          for(let attr of Array.from(el.attributes)) {
            attr.___alreadyRenderedPerchanceCode = true;
          }
        }

        PERCH.templatedNodes = [];
        PERCH.addNodeTemplates(document.querySelector("#output-container"));

        
        for(let element of Array.from(document.querySelectorAll("#output-container *"))) {
          PERCH.reAttachAllDomElementEventsWithRoot(element);
        }

        let capturedDomContentLoadedHandlers = [];
        const originalDocumentAddEventListener = document.addEventListener.bind(document);
        document.addEventListener = function(name, ...args) {
          if(typeof name === "string" && name.toLowerCase() === "domcontentloaded") {
            capturedDomContentLoadedHandlers.push(args[0]);
          } else {
            originalDocumentAddEventListener(name, ...args);
          }
        };

        let capturedWindowLoadHandlers = [];
        const originalWindowAddEventListener = window.addEventListener.bind(window);
        window.addEventListener = function(name, ...args) {
          if(typeof name === "string" && name.toLowerCase() === "load") {
            capturedWindowLoadHandlers.push(args[0]);
          } else {
            originalWindowAddEventListener(name, ...args);
          }
        };

        // needed to robustly detect if user's onload has ran (see below)
        let windowOnLoadAlreadyFiredBeforeUserCode = !!PERCH.windowOnLoadAlreadyFired;
        delete PERCH.windowOnLoadAlreadyFired;
        let dummyOnloadRan = false;
        let dummyOnload = function() { console.debug("dummyOnloadRan"); dummyOnloadRan = true; };
        window.onload = dummyOnload;

        let { scriptTextContentsArray } = await PERCH.executeScriptTags();
        update();

        // TODO: make fake event objects for all the calls below?
        
        await new Promise(r => setTimeout(r, 1)); // seems to be required to wait for inline module scripts to start executing (not necessarily finish, since they can have top-level await)

        for(let fn of capturedDomContentLoadedHandlers) {
          try { fn.bind(document)(); } catch(e) { console.error("An error occurred in a DOMContentLoaded handler:", e); }
        }
        document.addEventListener = originalDocumentAddEventListener;

        function runCapturedWindowLoadHandlers() {
          for(let fn of capturedWindowLoadHandlers) {
            try { fn.bind(window)(); } catch(e) { console.error("An error occurred in a window 'load' event handler:", e); }
          }
        }
        function runWindowOnLoad() {
          try {
            if(typeof window.onload == "function" && window.onload === document.body.onload) {
              // hacky heuristic, since outer block scope of script tags (due to perchance's `with` stuff) causes `function onload(){}` to "hoist into" being effectively a `var` declaration which is equivalent to `window.onload = function(){}`, which means it'd get incorrectly executed during page load.
              // i should really check dependencies too, but they shouldn't really be using this anyway (should use addEventListener) so false positive 'blocks' of this function are better than false negatives.
              if(scriptTextContentsArray.some(s => /window.onload\s*=\s*/s.test(s))) { // note: i originally had `/window.onload\s*=\s*(function\s*\(|\(.+?\)\s*=>\s*)/s.test(s)` but this prevents e.g. `window.onload = init;` from being matched.
                window.onload();
              }
            }
          } catch(e) { console.error(e); }
        }
        if(document.readyState == 'complete') {
          (async function() {
            
            // The 'load' event waits for static imports to complete, so we need to do that here:
            await Promise.all(Object.values(window.moduleScriptInsertDetails987934 || {}).map(o => o.staticImportsLoadPromise));
            await new Promise(r => setTimeout(r, 1)); // just to be sure that the sync part of scripts after static imports are executed
            
            runCapturedWindowLoadHandlers();
            
            // readyState is 'complete', so window.onload has already been executed, but in case it ran before this script tag, or before our dummy one (and not the user one - which may have been set slightly too late), we run the user one:
            if(windowOnLoadAlreadyFiredBeforeUserCode || (dummyOnloadRan && window.onload !== dummyOnload)) {
              runWindowOnLoad();
            }

            window.addEventListener = originalWindowAddEventListener;
          })();
        } else {
          window.addEventListener = originalWindowAddEventListener; // must come *before* the below call
          window.addEventListener('load', function() {
            runCapturedWindowLoadHandlers();
            // no need to call runWindowOnLoad here because browser will do it.
          });
        }

        if(PERCH.isFirstUpdate) {
          // emulate url hash/anchor scroll (it happens *after* scripts are executed - in Chrome at least):
          try {
            const hash = window.location.hash.slice(1);
            if(hash) {
              const element = document.getElementById(hash);
              if(element) element.scrollIntoView({behavior:'auto'}); // 'auto' uses computed value of `scroll-behavior`, which is correct
            }
          } catch(e) {
            console.error(e);
          }
        }

        try {
          const favicon = document.querySelector('link[rel="icon"], link[rel="shortcut icon"]');
          if(favicon) {
            PERCH.parentWindow.postMessage({type:"changeFavicon", href:favicon.href}, "https://perchance.org");
          }
        } catch(e) {
          console.error(e);
        }

        PERCH.isFirstUpdate = false;
      }

      PERCH.executeScriptTags = async function(containerSelectorOrEl = "#output-container") {
        let container;
        if(typeof containerSelectorOrEl === 'string') container = document.querySelector(containerSelectorOrEl);
        else container = containerSelectorOrEl;

        let scriptTags = [];
        if(container.tagName.toLowerCase() === 'script') {
          scriptTags = [container];
        } else {
          scriptTags = [...container.getElementsByTagName('script')];
        }

        // filter out non-javascript scripts:
        scriptTags = scriptTags.filter(s => !s.type || s.type === "text/javascript" || s.type === "module");

        let deferredScriptTags = scriptTags.filter(s => s.defer || s.type === "module"); // note that async scripts are *not* deferred. they execute as soon as they're available, which can be immediately - e.g. if in browser cache
        let nonDeferredScriptTags = scriptTags.filter(s => !deferredScriptTags.includes(s));

        let scriptTextContentsArray = [];
        for (var i = 0; i < nonDeferredScriptTags.length ; i++) {
          await PERCH.executeScriptTag(nonDeferredScriptTags[i]);
          scriptTextContentsArray.push(nonDeferredScriptTags[i].textContent);
        }
        for (var i = 0; i < deferredScriptTags.length ; i++) {
          await PERCH.executeScriptTag(deferredScriptTags[i]);
          scriptTextContentsArray.push(deferredScriptTags[i].textContent);
        }

        return {scriptTextContentsArray};
      }
      
      PERCH.getAllMatches = function(str, regex) {
        const matches = [];
        let m;
        while(1) {
          m = regex.exec(str);
          if(m) matches.push(m);
          else break;
        }
        return matches;
      }

      // For all Safari versions before 17.4:
      PERCH.withFunctionScopeFixRequired = false;
      try {
        let obj = {a7d638p364:0};
        with(obj) {
          function fn() {
            return a7d638p364+1;
          }
          fn();
        }
      } catch(e) { 
        PERCH.withFunctionScopeFixRequired = true;
      }

      // parses arbitrary JavaScript code and collects the names of top-level declarations using `let`, `const`, `class`, and `async function`.
      // Also returns an array of any comma-separated let declarations that exist in the code.
      // Correctly deals with regex, strings, comments.
      // Unminified version here: https://perchance.org/collectnonhoistedtopleveldeclarations-tester#edit
      PERCH.collectNonHoistedTopLevelDeclarations = function(t){const n=[],e=[];let s=0,i=0;const o=t.length;let f=0,r=!1,c=null;const l=new Set(["(",",","=",":","[","!","?","{",";","return","case","throw","=>"]),u=new Set([";","}",null]);for(;i<o&&(F(),!(i>=o));){const c=t[i];if(a(c))W(c);else{if("/"===c){const t=m(i-1);if(null===t||l.has(t)){x();continue}}if("{"!==c)if("}"!==c){if(0===s){if(h("async",i)&&!d(t[i+5])){const e=m(i-1);if(u.has(e)||r){const e=i;let s=i+5;for(;s<o&&p(t[s]);)s++;if(h("function",s)&&!d(t[s+8])){for(s+=8;s<o&&p(t[s]);)s++;if("*"===t[s])for(s++;s<o&&p(t[s]);)s++;i=s,F();const f=I();if(f){b();const t=i-1;n.push({name:f,type:"async function",startIndex:e,endIndex:t})}continue}}}if(h("let",i)&&!d(t[i+3])){const t=i;i+=3,F();const s=[],o=[];f=0,k("let",s,o);const r=i-1;s.forEach((e=>{n.push({name:e.name,type:"let",startIndex:t,endIndex:r})})),o.length>1&&e.push({startIndex:t,endIndex:r,parts:o});continue}if(h("const",i)&&!d(t[i+5])){const t=i;i+=5,F();const e=[];k("const",e);const s=i-1;e.forEach((e=>{n.push({name:e.name,type:"const",startIndex:t,endIndex:s})}));continue}if(h("class",i)&&!d(t[i+5])){const t=m(i-1);if(u.has(t)||r){const t=i;i+=5,F();const e=I();if(e){b();const s=i-1;n.push({name:e,type:"class",startIndex:t,endIndex:s})}continue}}}i++}else s=Math.max(s-1,0),i++;else s++,i++}}function a(t){return"'"===t||'"'===t||"`"===t}function h(n,e){return t.startsWith(n,e)}function d(t){return/[A-Za-z0-9_$\u00C0-\uFFFF]/.test(t)}function p(t){return/\s/.test(t)}function m(n){for(;n>=0;){if(!p(t[n])){if(">"===t[n]&&n>0&&"="===t[n-1])return"=>";if(/[A-Za-z_$\u00C0-\uFFFF]/.test(t[n])){let e=n+1;for(;n>=0&&/[A-Za-z_$\u00C0-\uFFFF]/.test(t[n]);)n--;return t.slice(n+1,e)}return t[n]}n--}return null}function F(){for(c=null,r=!1;i<o;)if(t.startsWith("//",i)){for(i+=2;i<o&&"\n"!==t[i];)i++;i<o&&"\n"===t[i]&&(r=!0,c=i,i++)}else if(t.startsWith("/*",i)){for(i+=2;i<o&&!t.startsWith("*/",i);)"\n"===t[i]&&(r=!0,c=i),i++;t.startsWith("*/",i)&&(i+=2)}else{if(!p(t[i]))break;"\n"!==t[i]&&"\r"!==t[i]||(r=!0,c=i),i++}}function W(n){for(i++;i<o;){const e=t[i];if("\\"!==e)if("`"!==n||"$"!==e||"{"!==t[i+1]){if(e===n){i++;break}i++}else i+=2,$();else i+=2}}function x(){for(i++;i<o;){const n=t[i];if("\\"!==n){if("/"===n){for(i++;i<o&&/[gimuy]/.test(t[i]);)i++;break}i++}else i+=2}}function I(){const n=i;if(d(t[i])){for(i++;i<o&&/[A-Za-z0-9_$\u00C0-\uFFFF]/.test(t[i]);)i++;return t.slice(n,i)}return null}function b(){let n=0;for(;i<o;){const e=t[i];if(a(e))W(e);else if(t.startsWith("//",i)){for(i+=2;i<o&&"\n"!==t[i];)i++;i<o&&"\n"===t[i]&&(r=!0,i++)}else if(t.startsWith("/*",i)){for(i+=2;i<o&&!t.startsWith("*/",i);)"\n"===t[i]&&(r=!0),i++;t.startsWith("*/",i)&&(i+=2)}else{if("/"===e){const t=m(i-1);if(null===t||l.has(t)){x();continue}}if("{"!==e){if("}"!==e)"\n"!==e&&"\r"!==e||(r=!0),i++;else if(n--,i++,0===n)break}else n++,i++}}}function k(n,e=null,s=null){for(;i<o;){F();const o=i;if("{"===t[i]||"["===t[i])f++,y(n,e,s),f--,F(),"="===t[i]&&(i++,F(),$());else{const o=I();if(o&&e&&e.push({name:o}),F(),":"===t[i]){if(f++,i++,F(),"{"===t[i]||"["===t[i])y(n,e,s);else{const n=I();n&&e&&e.push({name:n}),F(),"="===t[i]&&(i++,F(),$())}f--}else"="===t[i]&&(i++,F(),$())}const r=i;if(s&&o<r){const n=t.slice(o,r).trim();n.length>0&&s.push(n)}if(F(),","!==t[i]||0!==f){null!==c&&(i=c);break}i++}}function y(n,e=null,s=null){const r="{"===t[i]?"}":"]";for(i++;i<o;){if(F(),t[i]===r){i++;break}if(","===t[i]){i++;continue}if("{"===t[i]||"["===t[i]){f++,y(n,e,s),f--;continue}if("."===t[i]&&"."===t[i+1]&&"."===t[i+2]){i+=3,F();const t=I();t&&e&&e.push({name:t});continue}const o=I();if(o&&":"===t[i]){if(f++,i++,F(),"{"===t[i]||"["===t[i])y(n,e,s);else{const n=I();n&&e&&e.push({name:n}),F(),"="===t[i]&&(i++,F(),$())}f--}else o&&e&&e.push({name:o}),F(),"="===t[i]&&(i++,F(),$())}}function $(){let n=0;for(;i<o;){const e=t[i];if(a(e))W(e);else if(t.startsWith("//",i)){for(i+=2;i<o&&"\n"!==t[i];)i++;i<o&&"\n"===t[i]&&(r=!0,i++)}else if(t.startsWith("/*",i)){for(i+=2;i<o&&!t.startsWith("*/",i);)"\n"===t[i]&&(r=!0),i++;t.startsWith("*/",i)&&(i+=2)}else{if("{"===e||"("===e||"["===e)n++;else if("}"===e||")"===e||"]"===e){if(!(n>0))break;n--}if("/"===e){const t=m(i-1);if(null===t||l.has(t)){x();continue}}if((","===e||";"===e||"\n"===e)&&0===n)break;"\n"!==e&&"\r"!==e||(r=!0),i++}}}return{declarations:n,commaSeparatedLetDeclarations:e}}

      PERCH.executeScriptTag = async function(oldScript) { 
        let parent = oldScript.parentElement;
        let newScript = document.createElement('script');
        
        // had to use hasAttribute instead of simple property access because firefox defaults to script.async=true for dynamically-created script tags
        newScript.async = oldScript.hasAttribute("async"); //oldScript.async; 
        
        // copy across any other attributes:
        for(let attr of Array.from(oldScript.attributes)) {
          if(attr.name === "async") continue;
          newScript.setAttribute(attr.name, attr.value);
        }

        if(oldScript.crossOrigin !== null || (oldScript.src && (oldScript.src.startsWith("https://user-uploads.perchance.org/") || oldScript.src.startsWith("https://user.uploads.dev/")))) newScript.crossOrigin = true; // we also set user uploads to crossorigin so we can access more helpful error messages in our window UncaughtError handler
        
        let loadPromise;

        let isRemoteScript = !!oldScript.src;
        if(isRemoteScript && !newScript.async) {
          // since plain old script tags are blocking, we need to simulate that:
          loadPromise = new Promise(resolve =>  {newScript.onload = resolve; newScript.onerror = resolve; });
        }

        // if(!newScript.type) {
        //   newScript.setAttribute('type','text/javascript');
        // }

        if(oldScript.src) {
          newScript.src = oldScript.src;
          parent.insertBefore(newScript, oldScript);
          try { parent.removeChild(oldScript); } catch(e) {} // try catch because script tag may have e.g. executed document.body.innerHTML='';
        } else { 
          if(newScript.type === "module") {
            newScript.textContent = oldScript.textContent; 

            // For catching and displaying syntaxErrors with PERCH.perchanceError
            // Need to use `window` instead of PERCH, because otherwise no way to cleanup (see below):
            if(!window.moduleScriptInsertDetails987934) window.moduleScriptInsertDetails987934 = {};
            let key = Math.random().toString();
            let staticImportsLoadResolver;
            let staticImportsLoadPromise = new Promise(r => { staticImportsLoadResolver = r; });
            window.moduleScriptInsertDetails987934[key] = {key, time:performance.now(), staticImportsLoaded:false, loaded:false, staticImportsLoadPromise, staticImportsLoadResolver, scriptTextContent:newScript.textContent, type:"scriptTag"};
            
            // No *synchronous* error if execution reached this line, but note that static imports are counted as 'sync' in the sense that they're pre-loaded without any use of await, but can take several seconds.
            newScript.textContent += `\n;window.moduleScriptInsertDetails987934['${key}'].loaded=true;`;
            // To track load of static imports so we can trigger window 'load' event once modules are loaded. This is needed in case of errors that occur *after* the static imports, which would otherwise hold up the 'load' event.
            // TODO: This will hold up the 'load' event if there are errors with prior static imports. Not ideal, but okay for now.
            newScript.textContent += `;import "data:text/javascript,window.moduleScriptInsertDetails987934['${key}'].staticImportsLoaded=true;window.moduleScriptInsertDetails987934['${key}'].staticImportsLoadResolver();";`;

            parent.insertBefore(newScript, oldScript);

            try { parent.removeChild(oldScript); } catch(e) {} // try catch because script tag may have e.g. executed document.body.innerHTML='';
          } else {
            let scriptText = oldScript.textContent;

            // Apply Safari `with` statement fix if needed:
            if(PERCH.withFunctionScopeFixRequired) {
              try {
                let topLevelListNamesRegex = new RegExp(window.root.getSelf.getAllKeys.join("|"));
                if(topLevelListNamesRegex.test(scriptText)) { // only if it contains a list name - to reduce chance of introducing bugs, since regex below is not full-proof.
                  scriptText = scriptText.replace(/(\n\s*|^\s*)(async |)function\s+([a-zA-Z0-9_$]+?)(\s*\(.*\)\s*\{)/g, "$1var $3 = $2function$4");
                }
              } catch(e) {
                console.error("Error while applying Safari with statement fix:", r);
              }
            }
            
            if(PERCH.withExportDebug83748) { 
              let { declarations, commaSeparatedLetDeclarations } = PERCH.collectNonHoistedTopLevelDeclarations(scriptText);
              // console.log(declarations);
              // console.log("scriptText:", scriptText);

              // The goal here is to remove 'let' from the start of 'let' declarations so we can put the `let foo;` outside the `with`.
              // We only need to remove 'let' because we'll hoist the others via variableNamesToHoist. We can't do that for `let` because the declarations could be for primitives, so we'd be copying the primitive instead of creating a reference to it in the higher scope. `const` can be a primitive too obviously, but it can't change so it's not a problem.
              
              let scriptTextArr = scriptText.split("");
              let segments = [];
              let alreadyGotStartIndices = new Set();
              for(let d of declarations) {
                if(d.type !== "let") continue; 
                if(alreadyGotStartIndices.has(d.startIndex)) continue;
                alreadyGotStartIndices.add(d.startIndex);
                segments.push({startIndex:d.startIndex, endIndex:d.endIndex});
              }
              segments.sort((a, b) => b.startIndex - a.startIndex);
              for(let {startIndex, endIndex} of segments) {
                scriptTextArr[startIndex+0] = null; // "l"
                scriptTextArr[startIndex+1] = null; // "e"
                scriptTextArr[startIndex+2] = null; // "t"
                scriptTextArr[startIndex+3] = null; // " "
                let nextNonWhiteSpaceIndex = startIndex+4
                for(let i = nextNonWhiteSpaceIndex; i < 10000; i++) {
                  if(/\s/.test(scriptTextArr[i])) continue;
                  nextNonWhiteSpaceIndex = i;
                  break;
                }
                if(scriptTextArr[nextNonWhiteSpaceIndex] === "{") {
                  // it's a destructured declaration like `let { foo } = obj` so we need to wrap in parenthese due to removing the `let`:
                  scriptTextArr[nextNonWhiteSpaceIndex] = "({";
                  if(scriptTextArr[endIndex+1] === "\n" || endIndex+1 > scriptTextArr.length-1) {
                    scriptTextArr[endIndex+1] = ");\n";
                  } else if(scriptTextArr[endIndex+1] === ";") {
                    scriptTextArr[endIndex+1] = ");";
                  } else {
                    debugger;
                    console.error("Bug in adding brackets-around-destructured for PERCH.collectNonHoistedTopLevelDeclarations stuff?");
                    scriptTextArr[endIndex+1] += ")";
                  }
                } 
              }
              let newScriptText = scriptTextArr.filter(c => c !== null).join("");
              // console.log("newScriptText:", newScriptText);

              let letDeclarations = declarations.filter(o => o.type === "let");
              let nonLetDeclarations = declarations.filter(o => o.type !== "let");
              let id = Math.random().toString(36).substr(2, 9);
              let newScriptTextContent = [
                `window.__variableNamesToHoistOutOfBlockScope_${id} = {}; ${letDeclarations.length > 0 ? `let ${letDeclarations.map(o => o.name).join(", ")};` : ""} with(window.root.___proxyTarget.obj) {`,
                `/*DEBUG_PREFIX_END_85729354682847*/${newScriptText}/*DEBUG_SUFFIX_START_85729354682847*/`,
                `;for(let name of ${JSON.stringify(nonLetDeclarations.map(o => o.name))}) { try { window.__variableNamesToHoistOutOfBlockScope_${id}[name] = eval(name); } catch(e) { console.error("Bug in PERCH.collectNonHoistedTopLevelDeclarations?", e); } }`,
                `}`,
              ].join("\n");
              
              newScript.textContent = newScriptTextContent;
              
              PERCH.scriptTagInsertDebug84du84ksfhk = {scriptTextContent:newScriptTextContent.split("/*DEBUG_SUFFIX_START_85729354682847*/")[0].split("/*DEBUG_PREFIX_END_85729354682847*/")[1], numDebugLinesAtStartOfScript:newScriptTextContent.split("/*DEBUG_PREFIX_END_85729354682847*/")[0].split("\n").length-1, numActualScriptLines:newScriptText.split("\n").length, type:"scriptTag"}; // this is for catching and displaying syntaxErrors with PERCH.perchanceError
              parent.insertBefore(newScript, oldScript);
              delete PERCH.scriptTagInsertDebug84du84ksfhk;
              try { parent.removeChild(oldScript); } catch(e) {} // try catch because script tag may have e.g. executed document.body.innerHTML='';

              // need to use a separate script tag for each declaration because we can't put them in try/catch because the block scope would trap the declaration.
              for(let { name, type } of nonLetDeclarations) {
                let script = document.createElement('script');
                let constOrLetOrVar = "var";
                if(type === "class") constOrLetOrVar = "let";
                if(type === "async function") constOrLetOrVar = "var";
                if(type === "const") constOrLetOrVar = "const";
                script.textContent = `${constOrLetOrVar} ${name} = window.__variableNamesToHoistOutOfBlockScope_${id}["${name}"];`;
                document.head.appendChild(script);
                script.remove();
              }
              delete window[`__variableNamesToHoistOutOfBlockScope_${id}`];

              newScript.textContent = oldScript.textContent; // it has already executed so now we can do this to show correct script in devtools
            } else {
              // Note: Both `var` and regular (non-async) functions are hoisted by the JS runtime already. In strict mode it's different, but the `with` statement that I'm using here precludes strict mode, so we don't need to worry about that for now.
              let potentialVariableNamesToHoist = PERCH.getAllMatches(scriptText, /[\s;](?:let|const)\s+([^\s]+?)\s*=/g).map(r => r[1]);
              potentialVariableNamesToHoist.push(...PERCH.getAllMatches(scriptText, /[\s;](?:async function)\*?\s+([^\s]+?)\s*\(/g).map(r => r[1]));
              potentialVariableNamesToHoist.push(...PERCH.getAllMatches(scriptText, /[\s;]class\s+([^\s]+?)\s*\{/g).map(r => r[1]));
              potentialVariableNamesToHoist = [...new Set(potentialVariableNamesToHoist)];
              potentialVariableNamesToHoist = potentialVariableNamesToHoist.filter(n => PERCH.isValidJavaScriptIdentifier(n));

              // notice that it checks if the variable is 'in scope' via 'eval' before 'exporting' it to the higher scope. This prevents exporting local variables.
              newScript.textContent = `
                with(window.root.___proxyTarget.obj){
                  ${scriptText};
                  for(let name of ${JSON.stringify(potentialVariableNamesToHoist)}) {
                    try { let val = eval(name); window[name] = val; } catch(e) {}
                  }
                }
              `;

              parent.insertBefore(newScript, oldScript);
              try { parent.removeChild(oldScript); } catch(e) {} // try catch because script tag may have e.g. executed document.body.innerHTML='';
            }
          }
        }
        if(loadPromise) await loadPromise;
        return newScript;
      }

      PERCH.templatedNodes = undefined; // REMEMBER: order is important for functions like .id()
      PERCH.addNodeTemplates = function(domNode) {
        var nodes = domNode.childNodes;
        for (var i = 0, m = nodes.length; i < m; i++) {
            var n = nodes[i];
            if(n.nodeType !== n.TEXT_NODE && n.nodeName !== "#comment") {
              PERCH.templatedNodes.push( ...PERCH.addAttributeTemplateToEl(n) );
            }

            if (n.nodeType == n.TEXT_NODE && n.parentNode.tagName !== "SCRIPT" && n.parentNode.nodeName !== "STYLE") {

              // we found a text node, so lets break it into an expression array
              // and wrap expressions in spans (the "template span")

              let arr = PERCH.splitTextAtAllBlocks(n.textContent);
              if(!arr) {
                PERCH.perchanceError(`Some text has caused an error with the compiler. If you can, please post a bug report with a link to your generator on <a href="https://lemmy.world/c/perchance">lemmy.world/c/perchance</a> to help me fix this bug. Thanks! Here's the text that caused this issue: ${PERCH.escapeHTMLSpecialChars(n.textContent)}`);
                return;
              }

              if(arr.length === 0) {
                if(n.textContent.trim() !== "") {
                  PERCH.perchanceError(`Something's not right. Some text has caused an error with the compiler. If you can, please post a bug report with a link to your generator on <a href="https://lemmy.world/c/perchance">lemmy.world/c/perchance</a> to help me fix this bug. A non-empty text node resulted in an empty block array. This is probably a problem with 'splitTextAtAllBlocks'. Maybe some 'continue' statements skipping over things that they shouldn't?`);
                }
                continue;
              }

              if(arr.length > 1 || arr[0][0] === "[" || arr[0][0] === "{") {
                //let exprSpan = document.createElement('span');
                // exprSpan.className = "__perchance_textnode_expression";
                // exprSpan.dataset.perchanceExpression = arr.join("");
                //exprSpan.innerText = arr.join("");

                //n.parentNode.insertBefore(exprSpan, n);
                //n.parentNode.removeChild(n);

                PERCH.templatedNodes.push({oldNodes:[n], parentNode:n.parentNode, previousSibling:n.previousSibling, nextSibling:n.nextSibling, type:"textNode", text:arr.join("")});

              }

              // just regular text:
              if(arr.length === 1 && arr[0][0] !== "[" && arr[0][0] !== "{") {
                n.nodeValue = PERCH.processEscapedCharacters(n.nodeValue); // non-ideal behavior, but see discussion: https://lemmy.world/post/23528017
              }

            } else {
              PERCH.addNodeTemplates(n);
            }
        }
      }

      PERCH.collectTemplatableTextChunks = function(domNode, foundChunks) {
        if(!foundChunks) foundChunks = [];
        var nodes = domNode.childNodes;
        for (var i = 0, m = nodes.length; i < m; i++) {
            var n = nodes[i];

            if(n.nodeType !== n.TEXT_NODE && n.nodeName !== "#comment") {
              for(let attribute of Array.from(n.attributes)) {
                if(PERCH.isTemplatableAttributeName(attribute.name)) {
                  // we found a templatable attribute
                  foundChunks.push(attribute.nodeValue);
                }
              }
            }

            if (n.nodeType == n.TEXT_NODE && n.parentNode.tagName !== "SCRIPT" && n.parentNode.nodeName !== "STYLE") {

              // we found a templatable text node
              foundChunks.push(n.textContent);

            } else {
              PERCH.collectTemplatableTextChunks(n, foundChunks);
            }
        }
        return foundChunks;
      }

      PERCH.domEventAttributeNames = new Set([
        ...Object.getOwnPropertyNames(document),
        ...Object.getOwnPropertyNames(Object.getPrototypeOf(Object.getPrototypeOf(document))),
        ...Object.getOwnPropertyNames(Object.getPrototypeOf(window)),
      ].filter(k => k.startsWith("on") && (document[k] == null || typeof document[k] == "function")));
      
      PERCH.isDomEventAttributeName = function(name) {
        if(PERCH.domEventAttributeNames.has(name)) return true;
        else return false;
      }

      PERCH.isTemplatableAttributeName = function(name) {

        // note that this *doesn't* mean that they're ignored in *generated* html (i.e. generated by perchance code)
        // because all of thosse strings are fully executed before being output.
        if(PERCH.isDomEventAttributeName(name)) { return false; }

        // i was previously ignoring data attributes and stuff, but I see no reason for that.
        // sure, someone may need to use special characters in their web component attirbutes or whatever
        // but they can just escape them.

        return true;

      }

      PERCH.addAttributeTemplateToEl = function(el) {

        let templatableNodes = [];
        for(let attribute of Array.from(el.attributes)) {
          if(!PERCH.isTemplatableAttributeName(attribute.name)) { continue; }
          templatableNodes.push({el, attribute, type:"attribute"});
        }

        let templatedNodes = [];
        for(let item of templatableNodes) { 
          let {attribute, el} = item;
          let exprArr = PERCH.splitTextAtAllBlocks(attribute.nodeValue);
          if(!exprArr[0]) { continue; }
          if(exprArr && (exprArr.length > 1 || exprArr[0][0] === "[" || exprArr[0][0] === "{")) {
            item.text = attribute.nodeValue;
            templatedNodes.push(item);
          } else {
            // this attribute is just plain text - no template needed. just need to remove any escaping-backslashes
            attribute.nodeValue = PERCH.processEscapedCharacters(attribute.nodeValue);
          }
        }

        return templatedNodes;

      }

      PERCH.reAttachSpecificDomElementEventWithRoot = function(el, name) {
        if(!el.___alreadyAttatchedEventWithRoot) el.___alreadyAttatchedEventWithRoot = {};
        if(el.___alreadyAttatchedEventWithRoot[name] === el.getAttribute(name)) return;

        let fn = el[name];
        if(el.getAttribute(name)) { // don't overwrite if it's empty, since fn.toString gives [native function] thing (in chrome at least)
          if(PERCH.withExportDebug83748) { 
            // don't need to remove the attribute
          } else {
            el.removeAttribute(name);
          }

          // el.addEventListener(name.substr(2), function(event) { // <-- bad because it removes ability to write e.g. el.onchange(), and also prevents *overwriting* of the handler.
          el[name] = function(event) {
            try {
              let fnStr = fn.toString();
              //fnStr = fnStr.replace("{","{ with(window.root.___proxyTarget.obj) {") + "}";
              fnStr = fnStr.replace("{","{ with(window.root || {}) {") + "}"; // need `|| {}` because error may have caused window.root to not compile, and we need to gracefully handle that
              eval(`(${fnStr}).bind(this)(event)`);
            } catch(e) {
              console.error(e);
              PERCH.perchanceError(`There was an error in the <b>${name}</b> attribute of this element in your HTML panel: <code>${this.outerHTML.replace(/<(.+?)>/g, "&lt;$1&gt;")}</code>. Here's the error: <span style='color:red'>${e}</span>`);
              throw e;
            }
          };
        }
        el.___alreadyAttatchedEventWithRoot[name] = el.getAttribute(name);
      }
      PERCH.reAttachAllDomElementEventsWithRoot = function(el) {
        for(let attr of Array.from(el.attributes)) {
          if(PERCH.isDomEventAttributeName(attr.name)) {
            PERCH.reAttachSpecificDomElementEventWithRoot(el, attr.name);
          }
        }
      }


      window.update = function(selectorOrEl) {
        // if it has been a few seconds since the error was shown, and error model isn't currently open, we can probably hide the error box so it doesn't clutter the generator UI for end-users. The dev would have clicked the error modal button before randomizing again.
        try {
          if(PERCH.lastPerchanceErrorTime && Date.now()-PERCH.lastPerchanceErrorTime > 1000*5 && (!document.querySelector("#perchance-error-container") || document.querySelector("#perchance-error-container").offsetHeight === 0)) {
            PERCH.clearPerchanceErrors();
          }
        } catch(e) { console.error(e); }
        
        // _updateOutput essentially reloads the page, whereas `update` just replaces all values of the expressions
        PERCH.updateTemplatedNodes(selectorOrEl); // goes through templatedNodes array *in order* (that's important)
      }

      PERCH.htmlToElements = function(html) {
        var template = document.createElement('template');
        template.innerHTML = html;
        return Array.from(template.content.childNodes);
      }

      PERCH.trackedNodesCreatedByTemplates = new Set();
      try { // putting this in try/catch because it's new code and I don't want it to break anything
        // if an element that was created by a square/curly block is replaced with another element *specifically using the replaceWith function*
        // then we want our tracking code to treat them as the 'same element' in terms of the PERCH.updateTemplatedNodes process.
        // we don't do that for other ways of replacing elements (e.g. setting innerHTML) because there are valid use cases for that (e.g. comments plugin uses it to avoid update() causing comments iframe to refresh)
        const originalReplaceWith = Element.prototype.replaceWith;
        Element.prototype.replaceWith = function(...args) {
          // check if this is a node that was created by a template
          if(PERCH.trackedNodesCreatedByTemplates.has(this)) {
            for(let i = 0; i < args.length; i++) { // we convert any strings/numbers/booleans since replaceWith does that automatically, but we need to get a reference to the created nodes, so we do it manually
              if(typeof args[i] === "string" || typeof args[i] === "number" || typeof args[i] === "boolean") {
                args[i] = document.createTextNode(args[i].toString());
              }
            }
            // if so, then we need to swap the new node with the old one in the oldNodes array of each PERCH.templatedNodes item:
            for(let n of PERCH.templatedNodes) {
              if(n.oldNodes.includes(this)) {
                n.oldNodes.splice(n.oldNodes.indexOf(this), 1, ...args);
              }
            }
          }
          originalReplaceWith.apply(this, args);
        };
      } catch(e) {
        console.error(e);
      }

      PERCH.updateTemplatedNodes = async function(selectorOrEl="") {
        let container;
        if(typeof selectorOrEl === 'string') {
          container = document.querySelector("#output-container "+selectorOrEl);
          if(!container) {
            PERCH.perchanceError(`It looks like you've got some code like <b>update('${selectorOrEl}')</b> but there's no element that matches the '${selectorOrEl}' selector.`);
            return;
          }
        } else {
          container = selectorOrEl;
        }

        if(container instanceof HTMLCollection) { // i.e. they have multiple elements with the same id and they referred to it using named access: https://html.spec.whatwg.org/multipage/window-object.html#named-access-on-the-window-object
          PERCH.perchanceError(`It looks like you've got multiple elements in your HTML with <b>id=${container[0].id}</b>. If you can't find any duplicates, make sure that if you've imported some HTML, the ids used in that HTML aren't the same as the ids that you're using.`);
          return;
        }

        PERCH.trackedNodesCreatedByTemplates.clear();

        // goes through attributes and text nodes in the order they were declared. (order of execution is important)
        for(let n of PERCH.templatedNodes) {
          // NOTE THAT `n` IS NOT AN ACTUAL `Node` object - it's just an obj we created with similarly names properties which "represents" the original node (which we delete and replace)
          // NOTE: we can't replace spaces with &nbsp or new lines with <br/> because they could (for example) have spaces in attributes that are generated, or (for example) in html tags that they generate. we don't want <a&nbsphref="http://...">...</a>
          if(n.type === "textNode" && (container.contains(n.parentNode) || container === n.parentNode)) {
            // remove old nodes
            for(let node of n.oldNodes) {
              try { n.parentNode.removeChild(node); } catch(e) { console.debug(e); } // we try/catch because the node may not be in the parent anymore (e.g. it may have been deleted or moved with some javascript)
            }
            // create new nodes
            let text = PERCH.processEscapedCharacters( PERCH.evaluateText(window.root, window.root, n.text, {declarationLineNumber:null}) );
            let newNodes = PERCH.htmlToElements(text);

            // These node additions will trigger our MutationObserver (that we need for monitoring "dynamically added" nodes (i.e. nodes added with "raw" javascript) to the page so we can render them)
            // so we need to mark them all as "already rendered" (because they could have originally-escaped curly/square blocks which would then be seen as unescaped ones if they were "rendered" again)
            let allNewTextNodes = newNodes.filter(n => n.nodeType === Node.TEXT_NODE);
            for(let newNode of newNodes) {
              PERCH.getAllTextNodeDescendents(newNode, allNewTextNodes); // this function adds the text nodes to the `allTextNodes` array
            }
            for(let textNode of allNewTextNodes) {
              textNode.___alreadyRenderedPerchanceCode = true;
            }

            // insert new nodes
            for(let node of newNodes) {
              // add it before the next sibling (if there is no next sibling, then it's the last one, so we just append)
              if(n.nextSibling && n.parentNode.contains(n.nextSibling)) n.parentNode.insertBefore(node, n.nextSibling);
              else n.parentNode.appendChild(node);

              PERCH.trackedNodesCreatedByTemplates.add(node);
            }
            n.oldNodes = newNodes;
            // execute script tags:
            for(let i = 0; i < newNodes.length; i++) {
              if(newNodes[i].tagName && newNodes[i].tagName.toLowerCase() === "script") {
                newNodes[i] = await PERCH.executeScriptTag(newNodes[i]);
              }
            }
          } else if(n.type === "attribute" && (container.contains(n.el) || container === n.el)) {
            let result = PERCH.processEscapedCharacters( PERCH.evaluateText(window.root, window.root, n.text, {declarationLineNumber:null}) );
            n.attribute.nodeValue = result;
            if(n.attribute.nodeName === "value") n.el.value = result; // <-- because of this: https://stackoverflow.com/a/7986111/11950764 (for input elements, `n.attribute.nodeValue` is the *default* value - so changing it doesn't update the *live* value)
            n.attribute.___alreadyRenderedPerchanceCode = true; // <-- editing attributes triggers our MutationObserver (which watches for and processes "dynamic" JavaScript DOM additions) but we don't want to run rendering twice, so we do this.
          } else {
            // this node isn't within the container/selector that was pased to the `update()` function
          }
          if(n.type !== "attribute" && n.type !== "textNode") PERCH.perchanceError(`There was an invalid node type when trying to update the HTML. If you can, please post a bug report with a link to your generator on <a href="https://lemmy.world/c/perchance">lemmy.world/c/perchance</a> to help me fix this bug. Thanks!`);
        }
      }

      window.addEventListener('message', async function (e) {
        PERCH.postMessagesRecieved++;
        let origin = e.origin || e.originalEvent.origin; // For Chrome, the origin property is in the event.originalEvent object.
        //console.debug("Change origin when you put it on a domain!");
        //console.debug(origin)
        if(/*origin !== "http://app.dev:3001" && */origin !== "https://perchance.org") {
          //console.error("invalid origin");
          return;
        }

        // if(e.data.command === "updateMetadataIfNeeded") {
        //   PERCH.updateGeneratorMetaData();
        // }

        if(e.data.command === "updateOutput") {
          PERCH.updateOutputMessageHandler(e);
          
          let colorSchemeTag = document.querySelector("#colorSchemeMetaTagToPreventWhiteFlash75847");
          if(colorSchemeTag) colorSchemeTag.remove();
        }

        if(e.data.command === "evaluateText") {
          let text, callerId = e.data.callerId;
          if(window.root === null) {
            text = "There is an error in your generator's script.";
          } else {
            text = PERCH.processEscapedCharacters( PERCH.evaluateText(window.root, window.root, e.data.text, {declarationLineNumber:null}) );
          }
          e.source.postMessage({type:"evaluateTextResponse", text, callerId}, e.origin);
        }

        if(!PERCH.alreadyAttachedSaveHandler) {
          // manually bubble up save commands out of this iframe and into editor
          document.addEventListener("keydown", (keyEvent) => {
            if (keyEvent.keyCode == 83 && (navigator.platform.match("Mac") ? keyEvent.metaKey : keyEvent.ctrlKey)) {
              keyEvent.preventDefault();
              e.source.postMessage({type:"saveKeyboardShortcut"}, e.origin);
            }
          }, false);
          document.addEventListener('keydown', function(event) {
            if(event.ctrlKey || event.metaKey) {
              if(event.key === 'r') {
                event.preventDefault();
                window.location.reload(); // reload this frame instead of the top-level window (todo: maybe send signal to parent instead so it can reload which *also* checks for dependency updates)
              }
            }
          });
          PERCH.alreadyAttachedSaveHandler = true;
        }

      });


      PERCH.updateOutputMessageHandler = async function(e) {
        if(window.PERCH === PERCH) {
          delete window.PERCH; // make PERCH inaccessible before userland code runs
          
          // Also load polyfills for old browsers if needed:
          
          try { // try/catch for e.g. JSDOM / rss feed parser etc. which have no dynamic import:
            if(!window.structuredClone || !Array.prototype.findLast) await import("https://cdn.jsdelivr.net/npm/core-js@3.40.0/actual/index.js/+esm").catch(console.error);
            if(!window.structuredClone || !Array.prototype.findLast) await import("https://esm.sh/core-js@3.40.0/actual?bundle&pin=v135").catch(console.error);
          } catch(e) {
            console.error(e);
          }

        }

        window.codeWarningsArray = [];
        PERCH.clearPerchanceErrors();
        if(document.querySelector("#perchance-dep-load-indicator")) document.querySelector("#perchance-dep-load-indicator").remove()

        try {

          let unfoundDeps = e.data.dependencies.filter(d => d.found === false);
          if(unfoundDeps.length > 0) {
            PERCH.perchanceError(`${unfoundDeps.length > 1 ? "Some dependencies" : "A dependency"} (imported generator${unfoundDeps.length > 1 ? "s" : ""}) that you tried to import into your generator could not be found: <b>${unfoundDeps.map(d => d.name).join("</b>, <b>")}</b>. You can check that whether or not they exist by going to: <i>perchance.org/NAME</i> where "NAME" should be replaced with the name of the generator that you're trying to import.`);
          }

          if(!Array.isArray(e.data.dependencies)) { 
            PERCH.perchanceError(`Something went wrong with the dependencies (imported modules): ${e.data.dependencies}. This is an unusual bug and may indicate a problem with the Perchance engine. If you could post a bug report on the forum that'd be great: <a href='https://lemmy.world/c/perchance'>lemmy.world/c/perchance<a>`);
          }
          let foundDeps = e.data.dependencies.filter(d => d.found !== false);
          for(let dep of foundDeps) {
            dep.hasImportedPreprocessor = /\n\$preprocess *= *{import:/.test("\n"+dep.modelText);
          }
          foundDeps.sort((a,b) => a.hasImportedPreprocessor ? 1 : -1); // compile generators that rely on preprocessors last so that their preprocessor has already been compiled and is thus available in the moduleSpace when we're compiling that generator
          for(let dep of foundDeps) {
            if(moduleSpace[dep.name]) continue; // Don't want to recompile things that we've already got! (only a problem if there is "recursive" dependency stuff I think)
            try {
              moduleSpace[dep.name] = PERCH.createPerchanceTree(dep.modelText, dep.name);
              moduleSpace[dep.name].$moduleSpace = moduleSpace;
            } catch(e) {
              console.error("Critical error in PERCH.createPerchanceTree:", e); // need to catch this else we can't e.g. tell parent that it failed to load (which is relevant for the saving process)
            }
          }

          // get all imports in HTML and add them to window.root.$imports
          let htmlTestDiv = document.createElement("div");
          htmlTestDiv.innerHTML = e.data.generator.outputTemplate;
          let templatableTextChunks = PERCH.collectTemplatableTextChunks(htmlTestDiv);
          let htmlImports = [];
          PERCH.ignorePerchanceErrors = true;
          for(let chunk of templatableTextChunks) {
            htmlImports.push( ...PERCH.collectImportedModuleNamesFromText(chunk) );
          }
          PERCH.ignorePerchanceErrors = false;

          try {
            window.root = PERCH.createPerchanceTree(e.data.generator.modelText, e.data.generator.name);
          } catch(e) {
            console.error("Critical error in PERCH.createPerchanceTree:", e); // need to catch this else we can't e.g. tell parent that it failed to load (which is relevant for the saving process)
          }

          if(!window.root) { 
            if(e.data.generator.modelText.startsWith("$preprocess") || e.data.generator.modelText.includes("\n$preprocess")) {
              let imports = e.data.generator.modelText.split("\n").map(l => PERCH.collectImportedModuleNamesFromText(l)).flat();
              imports.push(...new Set(htmlImports));
              imports = imports.filter(name => name !== e.data.generator.name);
              PERCH.parentWindow.postMessage({type:"importsUpdate", imports:[...new Set(imports)]}, "https://perchance.org");
            }
            PERCH.perchanceError(`Your generator's script seems to have errors in it. If you haven't recieved any other errors above this one which could indicate what went wrong, then this could be a bug in the Perchance engine. In that case, it would be great if you could post a quick bug report on the forum: <a href="https://lemmy.world/c/perchance">lemmy.world/c/perchance<a>`);
            
            PERCH.parentWindow.postMessage({type:"failedToLoadDueToGeneratorErrors"}, "https://perchance.org");
            return;
          }

          window.root.$imports.push(...new Set(htmlImports));

          // remove import of THIS module (most likely mistake by user)
          window.root.$imports = window.root.$imports.filter(name => name !== e.data.generator.name);

          moduleSpace[e.data.generator.name] = window.root;
          window.root.$moduleSpace = moduleSpace;

          // Note: We tie all direct import assignments to the actual module's root node in a dynamic/lazy/live manner within the node value getter - see MARKER:odj29hfi3j0d2kj0hx24f

          let currentDepNames = e.data.dependencies.map(d => d.name);
          let newDepNames = window.root.$imports.filter(name => !currentDepNames.includes(name));

          // // only send import updates if there are new imports
          if(newDepNames.length > 0) {

            // NOTE: see note below about race condition - we're always sending importsUpdate now
            //e.source.postMessage({type:"importsUpdate", imports:window.root.$imports}, e.origin);

            if(document.querySelector("#perchance-dep-load-indicator")) document.querySelector("#perchance-dep-load-indicator").remove();
            let div = document.createElement("div");
            div.innerHTML = `<div id="perchance-dep-load-indicator" style="position:fixed; bottom:8px; right:8px; background-color: #34ba22; color:white; cursor:pointer;">
              <span style="display: inline-block;padding: 0.5em;">&#xFE0E; Loading imported generators...</span>
            </div>`;
            document.body.append(div.firstElementChild);

            
            await new Promise(resolve => {
              let onMessageHandler = function(e) {
                if(e.source !== PERCH.parentWindow || e.origin !== "https://perchance.org") return;
                if(e.data.type === "ensureEditorIsLoaded75383748_response") {
                  resolve();
                  window.removeEventListener("message", onMessageHandler);
                }
              };
              window.addEventListener("message", onMessageHandler);
              PERCH.parentWindow.postMessage({type:"ensureEditorIsLoaded75383748"}, "https://perchance.org");
            });

          } else {
            let perchanceErrorIndicator = document.querySelector("#perchance-error-indicator"); // marker:85hdke9thsi
            try {
              await PERCH.updateOutput(e.data.generator.outputTemplate);
            } catch(e) {
              PERCH.perchanceError(`There was some sort of error during page load: ${e.message}\n\n${e.stack}`);
              console.error(e);
            }
            if(perchanceErrorIndicator && !document.querySelector("#perchance-error-indicator")) document.body.append(perchanceErrorIndicator); // since update would have removed it. TODO: this is very hacky. should move error modal to parent frame (can still show indicator 'over' generator frame)
          }

          // NOTE: due to issues with race conditions during saving (https://www.reddit.com/r/perchance/comments/cgyhey/when_i_try_to_open_the_generator_it_says_that_the/), I'm just going to *always* send back an importsUpdate (I check in the main thread/frame whether the update is actually needed)
              // // tell main app which imports are being *directly* used by this generator in case we
              // // can clear some no-longer-used dependencies
              // let unusedOrIndirectDeps = currentDepNames.filter(n => !window.root.$imports.includes(n));
              // if(unusedOrIndirectDeps.length > 0) {
          // EDIT: IMPORTANT: this must come before `finishedLoadingIncludingMetaData` postMessage
          PERCH.parentWindow.postMessage({type:"importsUpdate", imports:window.root.$imports}, "https://perchance.org");
              // }

          let metaDataUpdatePromise = PERCH.updateGeneratorMetaData(); // no need to `await` this

          try { // try/catch since this is new code. can remove later.
            if(e.data.generator.outputTemplate.includes(" id=")) { // <-- just an optimisation
              let topLevelVariableNames = [...window.root.getPropertyNames, ...window.root.getChildNames];
              let htmlElementIds = [...document.querySelectorAll("[id]")].map(el => el.id);
              let intersection = htmlElementIds.filter(value => topLevelVariableNames.includes(value));
              if(intersection.length > 0) {
                window.codeWarningsArray.push({lineNumber:root[intersection[0]].$declarationLineNumber, generatorName:window.generatorName, warningId:"top-level-list-name-same-as-html-element-id"});
              }
            }
          } catch(e) {
            console.error(e);
          }

          PERCH.parentWindow.postMessage({type:"codeWarningsUpdate", warnings:window.codeWarningsArray}, "https://perchance.org");

          PERCH.parentWindow.postMessage({type:"finishedLoading"}, "https://perchance.org");

          (async function() {
            await metaDataUpdatePromise;
            await new Promise(r => setTimeout(r, 5));
            // this event is used to know when we can save the generator (with correct dependencies + metadata based on current text in editor)
            PERCH.parentWindow.postMessage({type:"finishedLoadingIncludingMetaData", imports:window.root.$imports}, "https://perchance.org");
          })();

        } catch(error) {
          //debugger;
          document.querySelector("#output-container").innerHTML = e.data.generator.outputTemplate;
          PERCH.perchanceError(`There was an error while trying to compile your generator. Here's the error message: <blockquote>${PERCH.escapeHTMLSpecialChars(error.stack)}</blockquote>`);
          console.error(error);
          PERCH.parentWindow.postMessage({type:"finishedLoading"}, "https://perchance.org");
        }
      }


      PERCH.updateGeneratorMetaData = async function() {
        // get page title from first h1 that contains text:
        let h1 = [...document.querySelectorAll("h1")].filter(el => el.textContent.trim())[0];
        if(!h1) h1 = document.querySelector("h2");
        let generatorTitle = h1 && h1.textContent !== "Your Generator's Title" && h1.textContent !== "Minimal Example" ? h1.textContent : window.location.pathname.slice(1).split("-").filter(function(a){return a;}).map(function(word){return word[0].toUpperCase()+word.slice(1); }).join(" ");
        let generatorHTML = (document.querySelector("#output-container") || document.body).innerHTML;
        let generatorImage = "";
        let generatorDescription = "";
        let generatorDynamicMetaDataFunction = null;
        let tags = null;
        let header = null;
        if(root.$meta) {
          if(root.$meta.title) generatorTitle = root.$meta.title.evaluateItem;
          if(root.$meta.description) generatorDescription = root.$meta.description.evaluateItem;
          if(root.$meta.image) generatorImage = root.$meta.image.evaluateItem;
          if(root.$meta.tags) tags = root.$meta.tags.evaluateItem;
          if(root.$meta.header) {
            header = {};
            if(root.$meta.header.background) {
              let bg = root.$meta.header.background.evaluateItem;
              if(typeof bg === "string") {
                if(CSS.supports("background", bg)) {
                  header.background = bg;
                } else {
                  PERCH.perchanceError(`Your $meta header background <code>${bg}</code> is invalid. It must be a valid CSS background property like <code>blue</code> or <code>url(https://example.com/image.jpeg) center</code>.`);
                }
              }
            }
            if(root.$meta.header.mode) {
              let mode = root.$meta.header.mode.evaluateItem;
              if(typeof mode === "string" && (mode === "normal" || mode === "minimal")) {
                header.mode = mode;
              }
            }
          }
          if(root.$meta.dynamic) {
            try {
              // grab the lines that are in the 'dynamic' function.
              let lines = window.root.$meta.getRawListText.split("\n");
              let keepLines = [];
              let inFunction = false;
              let functionHeaderIndentSpaces = null;
              for(let line of lines) {
                if(line.trim().startsWith("dynamic(") || line.trim().startsWith("async dynamic(")) {
                  inFunction = true;
                  functionHeaderIndentSpaces = line.length - line.replace(/^ +/g, "").length;
                  keepLines.push(line.trim().replace("dynamic(", "function dynamic(").replace("=>", " {"));
                  continue;
                }
                if(inFunction) {
                  let indentSpaces = line.length - line.replace(/^ +/g, "").length;
                  if(line.trim() && indentSpaces <= functionHeaderIndentSpaces) {
                    break;
                  }
                  keepLines.push(line);
                }
              }
              generatorDynamicMetaDataFunction = keepLines.join("\n") + "\n}";
              if(generatorDynamicMetaDataFunction.length > 20000) {
                generatorDynamicMetaDataFunction = null;
                PERCH.perchanceError("Your $meta dynamic function is too long. It must be less than 20,000 characters - you can `fetch` a remote file that you uploaded to perchance.org/upload if needed.");  
              }
            } catch(e) {
              console.error(e);
            }

            if(generatorDynamicMetaDataFunction) {
              try {
                // this would be done server-side anyway, but we do it here so that we can dynamically update the title of the current browser tab
                let urlParams = Object.fromEntries([...new URL(window.location.href).searchParams].filter(e => !e[0].startsWith("utm_")));
                let inputs = {urlParams};
                let cacheKey = generatorDynamicMetaDataFunction + "<<<--->>>" + JSON.stringify(inputs);
                let outputs;
                if(!PERCH.dynamicMetaDataCache) PERCH.dynamicMetaDataCache = {}; // simple cache just so while they're editing we're not e.g. spamming a `fetch` that they have in their `dynamic` function
                if(PERCH.dynamicMetaDataCache[cacheKey]) {
                  outputs = PERCH.dynamicMetaDataCache[cacheKey];
                  console.debug("Used cached dynamic meta data:", outputs);
                } else {
                  outputs = await root.$meta.dynamic(inputs);
                  console.debug("Computed dynamic meta data:", outputs);
                  PERCH.dynamicMetaDataCache[cacheKey] = outputs;
                }
                if(typeof outputs.title === "string") generatorTitle = outputs.title;
                if(typeof outputs.description === "string") generatorDescription = outputs.description;
                if(typeof outputs.image === "string") generatorImage = outputs.image;
              } catch(e) {
                PERCH.perchanceError(`There was an error in your $meta dynamic function. Here's the error message: <blockquote>${PERCH.escapeHTMLSpecialChars(e.stack)}</blockquote>`);
              }
            }
          }
          
          let metaProps = new Set(root.$meta.$allKeys);
          metaProps.delete("title");
          metaProps.delete("description");
          metaProps.delete("image");
          metaProps.delete("dynamic");
          metaProps.delete("header");
          metaProps.delete("tags");
          if(metaProps.size > 0) PERCH.perchanceError("Looks like you've got some invalid properties in your $meta list? The only valid properties are 'title', 'description', 'image', 'tags', 'header', and 'dynamic'.");
        }
        if(!navigator.webdriver) { // try to avoid Google crawler title swap bug - no idea if this will fix it.
          PERCH.parentWindow.postMessage({type:"metaUpdate", title:generatorTitle, html:generatorHTML, image:generatorImage, description:generatorDescription, dynamic:generatorDynamicMetaDataFunction, header, tags, _validation:{generatorName:window.generatorName}, hasLocalStorage:localStorage.length!==0}, "https://perchance.org"); // had to use "https://perchance.org" as origin so our initial dummy update (using embedded data) works.
        }
        await new Promise(r => setTimeout(r, 5)); // ensure postMessage has actually been sent
      }

      window.addEventListener("DOMContentLoaded", function() {

        let dependencies;
        try { // adding try/catch here in case of future instances of this: https://lemmy.world/post/4913660
          dependencies = JSON.parse( decodeURI( document.querySelector("#imported-generators").textContent ) );
        } catch(e) {
          if(!location.href.includes("__generatorDependenciesCacheBust")) { // try a cache bust if we haven't already.
            let url = new URL(window.location.href);
            url.searchParams.set("__generatorDependenciesCacheBust", Math.random());
            window.location.href = url.href; 
            return;
          } else { // if we've already tried bust, don't do it again, else it'll be a refresh loop
            dependencies = [];
            let errorCode = 1;
            let importedGeneratorsTextContent = document.querySelector("#imported-generators").textContent;
            if(importedGeneratorsTextContent === "") {
              errorCode = 2;
            } else {
              errorCode = 3;
              try {
                decodeURI(importedGeneratorsTextContent);
              } catch(e) {
                errorCode = 4;
              }
            }
            console.error(e);
            console.error("Error parsing dependencies in embed.", errorCode);
          }
        }

        if(/__initWithDataFromParentWindow=[1-9]/.test(window.location.href)) {
          // this is so that the 'reload' button in the editor works without saving - i.e. we request the fresh, potentially-not-yet-saved-to-the-server data from the parent window.
          PERCH.parentWindow.postMessage({type:"requestOutputUpdate"}, "https://perchance.org");
        } else {
          let fakeMessageEvent = {};
          fakeMessageEvent.source = {};
          fakeMessageEvent.source.postMessage = function() {};
          fakeMessageEvent.data = {
            generator: JSON.parse( decodeURI( document.querySelector("#preloaded-generator-data").textContent ) ),
            dependencies,
          };
          
          // for browser automation stuff:
          if(navigator.webdriver && window.location.href.includes("allow_direct_iframe_view") && window.location.hash && window.location.hash.startsWith("#$=")) {
            try {
              let data = JSON.parse(decodeURIComponent(window.location.hash.slice(3)));
              if(data.commands) {
                for(let command of data.commands) {
                  if(command.name === "replaceModelText") fakeMessageEvent.data.generator.modelText = command.args.newModelText;
                  if(command.name === "replaceOutputTemplate") fakeMessageEvent.data.generator.outputTemplate = command.args.newOutputTemplate;
                }
              }
            } catch(e) {
              console.warn("Parsing of #$= hash failed", e);
            }
          }

          PERCH.updateOutputMessageHandler(fakeMessageEvent);

          let colorSchemeTag = document.querySelector("#colorSchemeMetaTagToPreventWhiteFlash75847");
          if(colorSchemeTag) colorSchemeTag.remove();
        }

      });

      // WARNING: This isn't needed, but also it must *not* be re-enabled because it triggers the document.title mutation observer, which sends the changePageTitle to the parent.
      // window.addEventListener("DOMContentLoaded", function() {
      //   var h1 = window.document.querySelector("h1");
      //   let title;
      //   if(h1) {
      //     title = h1.innerText ? h1.innerText : h1.textContent; // fall back to .textContent for e.g. JSDOM which doesn't support .innerText (relevant for using JSDOM to build a hacky API)
      //   }  else {
      //     title = window.location.pathname.slice(1).split("-").filter(function(a){return a;}).map(function(word){return word[0].toUpperCase()+word.slice(1); }).join(" ");
      //   }
      //   document.title = title+"  Perchance" + (title.toLowerCase().includes("gener") ? "" : " Generator");
      // });
    }</script> <style> .ldspmzjfhueifssge-ring{ display:inline-block;position:relative;width:64px;height:64px;}.ldspmzjfhueifssge-ring div{ box-sizing:border-box;display:block;position:absolute;width:51px;height:51px;margin:6px;border:6px solid #444;border-radius:50%;animation:lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;border-color:#444 transparent transparent transparent;}.ldspmzjfhueifssge-ring div:nth-child(1){ animation-delay:-0.45s;}.ldspmzjfhueifssge-ring div:nth-child(2){ animation-delay:-0.3s;}.ldspmzjfhueifssge-ring div:nth-child(3){ animation-delay:-0.15s;}@keyframes lds-ring{ 0%{ transform:rotate(0deg);}100%{ transform:rotate(360deg);}}</style> <script>{
      const PERCH = window.PERCH;
      // We need to make sure that when a user dynamically adds an element that has an inline event
      // handler (like onclick, for example) then we make sure they can directly reference their
      // top-level lists within those handlers:
      let mutationCallback = function(mutationsList, observer) {
        for(let mutation of mutationsList) {

          for(let node of (mutation.addedNodes || [])) { // mutation.addedNodes seems to not give all descendents - just the "top-level" nodes of each addition
            if(node.nodeType === 1 && (node.tagName.toLowerCase() === 'script' || node.tagName.toLowerCase() === 'style')) {
              // I'm not currently handling dynamic addition of script tags, so they won't get a `with(root) { ... }` wrapping, but I think that's fine. Might add it later if needed.
              // Oh, and wouldn't they already have executed anyway?
              continue;
            }
            let addedNodesArr = [node, ...PERCH.getAllDescendentNodesIncludingTextNodes(node)]; // <-- ignores script and style nodes
            for(let addedNode of addedNodesArr) {
              if(addedNode.nodeType === Node.ELEMENT_NODE) {
                // See below comment where I attach this handler function to learn why I commented this out.
                // for(let attr of [...addedNode.attributes]) {
                //   processAttributeMutation(attr, addedNode);
                // }
                PERCH.reAttachAllDomElementEventsWithRoot(addedNode);
              }
              // See below comment where I attach this handler function to learn why I commented this out.
              /*else if(addedNode.nodeType === Node.TEXT_NODE && PERCH.isRenderableDomNode(addedNode)) {
                renderDynamicallyAddedTextNode(addedNode);
              }*/
            }
          }

          if(mutation.attributeName) {
            if(PERCH.isDomEventAttributeName(mutation.attributeName)) {
              if(PERCH.withExportDebug83748) PERCH.reAttachSpecificDomElementEventWithRoot(mutation.target, mutation.attributeName);
            }
            // See below comment where I attach this handler function to learn why I commented this out.
            //if(mutation.target.attributes[mutation.attributeName]) processAttributeMutation(mutation.target.attributes[mutation.attributeName], mutation.target);
          }

        } 
      };
      // NOTE: I originally impemented automatic evaluation on DOM mutations, but then there's this problem: https://www.reddit.com/r/perchance/comments/bz9vcu/dev_fixed_a_bug_in_the_engine_today_thanks_to/erbcjr1
      //       Basically, the problem is that a mutation will take {<button>button1</button>|<button>button2</button>} and spread it over FIVE DOM nodes, and so we can't render it. I was originally working under that (bad) assumption that
      //       each mutation would sort of be "contained" within a single text/attribute node. In retrospect this whole idea is very silly. Instead, the generator maker should render their content with evaluateItem and THEN put that into the innerHTML of some element.
      // EDIT: Actually, we still need to PERCH.reAttachAllDomElementEventsWithRoot for the new elements! Otherwise if they dynamically add an element (e.g. by having `output.innerHTML = someHTML` within an element's onclick handler) that itself has inline event handlers,
      //       then those new element's handlers wouldn't be wrapped in `with(root) { ... }`. So we still need this (but I've commented out the "rendering" stuff). Here's an example that wouldn't work without this mutation stuff: https://perchance.org/t3c1hm87wv
      document.addEventListener("DOMContentLoaded", function() {
        new MutationObserver(mutationCallback).observe(document.querySelector("#output-container"), { childList: true, subtree: true, attributes: true });
      });

      PERCH.getAllDescendentNodesIncludingTextNodes = function(element, nodes=[]) { // but not scripts and styles...
        for(let child of element.childNodes) {
          if(child.nodeType === Node.ELEMENT_NODE && child.tagName.toLowerCase() !== 'script' && child.tagName.toLowerCase() !== 'style') {
            nodes.push(child);
            PERCH.getAllDescendentNodesIncludingTextNodes(child, nodes);
          } else if(child.nodeType === Node.TEXT_NODE) {
            nodes.push(child);
          }
        }
        return nodes;
      }
      PERCH.getAllTextNodeDescendents = function(element, nodes=[]) { // but not scripts and styles...
        for(let child of element.childNodes) {
          if(child.nodeType === Node.ELEMENT_NODE && child.tagName.toLowerCase() !== 'script' && child.tagName.toLowerCase() !== 'style') {
            PERCH.getAllDescendentNodesIncludingTextNodes(child, nodes);
          } else if(child.nodeType === Node.TEXT_NODE) {
            nodes.push(child);
          }
        }
        return nodes;
      }
      PERCH.isRenderableDomNode = function(node) {
        return node.nodeType === 3 || (node.nodeType === 1 && node.tagName.toLowerCase() !== 'script' && node.tagName.toLowerCase() !== 'style');
      }
    }</script> <style> #perchance-error-container{ display:none;position:fixed;top:0;left:0;right:0;bottom:0;font-family:monospace;z-index:1000000001;}#perchance-error-container blockquote{ background:#eee;padding:1em;}#perchance-error-container .perchance-error-outer-wrapper{ margin:auto;box-sizing:border-box;max-width:90%;}#perchance-error-container .perchance-error-background{ z-index:-1;position:fixed;top:0;left:0;width:100%;height:100%;opacity:0.2;background:#000;transition:opacity .15s linear;}#perchance-error-container .perchance-error-content-wrapper{ overflow:hidden;background:#fff;height:100%;width:100%;border-radius:3px;} #perchance-error-container button, #perchance-error-container input{ height:3em;}#perchance-error-container button{ background:#eee;color:#444;width:50%;border:none;outline:none;font-size:90%;}#perchance-error-container button:hover{ background:#e1e1e1;}#perchance-error-container button.main{ background:#444;color:white;}#perchance-error-container button.main:hover{ background:#333;}#perchance-error-container span.link{ cursor:pointer;text-decoration:underline;color:#1212ff;}#perchance-error-container code{ padding:0.1em 0.3em;background:#eee;}</style> <script>{
      const PERCH = window.PERCH;

      PERCH.perchanceErrorString = "";
      PERCH.maxPerchanceErrorCount = 20;
      PERCH.currentPerchanceErrorCount = 0;
      PERCH.lastPerchanceErrorTime = null;

      function cleanUpStackTrace(str) {
        str = str.replaceAll(`https://${window.generatorPublicId}.perchance.org/${window.generatorName}`, "");
        str = str.replace(/\(\?(__initWithDataFromParentWindow|__generatorLastEditTime)=.+?:/g, "(line: ");
        
        let lines = str.split("\n");
        // all the stuff after this is 'internal' and so not useful to the dev:
        if(lines.find(l => l.includes("PERCH.createPerchanceTree"))) lines = lines.slice(0, lines.findIndex(l => l.includes("PERCH.createPerchanceTree")));
        if(lines.find(l => l.includes("PERCH.executeScriptTag"))) lines = lines.slice(0, lines.findIndex(l => l.includes("PERCH.executeScriptTag")));
        str = lines.join("\n").trim();
        str = str.replaceAll(`<`, "&lt;");
        str = str.replaceAll(`>`, "&gt;");

        str = str.replaceAll(`\n`, "<br>");
        return str; 
      }

      function logPerchanceListsFunctionError(details, {lineNumber, error}={}) {
        let functionText = PERCH.globalPerchanceFunctionIndexToFunctionText[details.globalFunctionIndex];
        details.alreadyLogged = true; 

        let erroringLine = functionText.split("\n").slice(lineNumber, lineNumber+1).join("\n");
        let surroundingCode = functionText.split("\n").slice(Math.max(0, lineNumber-5), lineNumber+5).join("\n");

        let errorText = cleanUpStackTrace(details.error?.stack?.toString() || error?.stack?.toString() || "Internal error. Please report this as a bug on the forum.");
        if(errorText.trim().startsWith("anonymous/returnValue<@")) errorText = details.error.toString(); // firefox

        PERCH.perchanceError(`
          <p>In the function called <b>${details.functionName}</b> within your lists editor, near <b>line number ${details.declarationLineNumber + lineNumber}</b>, there's a mistake in your code that's causing this error:</p>
          <pre style="color:red;font-weight:bold;">${errorText}</pre>
          <p>Here's the line (or one near it) which seems to be the cause of the error:</p>
          <pre style="background:light-dark(#d6d6d6, black); color:light-dark(black, #e1e1e1); padding:0.25rem; border-radius:3px;">${erroringLine.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</pre>
          <p>And here's the surrounding code:</p>
          <pre style="background:light-dark(#d6d6d6, black); color:light-dark(black, #e1e1e1); padding:0.25rem; border-radius:3px;">${surroundingCode.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</pre>
          <p style="opacity:0.6;"><i>(Note that any line numbers and/or snippets given above could be inaccurate e.g. due to an unclosed bracket much earlier in your script, or something like that.)</i></p>
        `, {moduleName:details.moduleName});
      }
      document.__perchanceInternal.logPerchanceListsFunctionError = logPerchanceListsFunctionError;

      window.addEventListener('unhandledrejection', function(event) {
        let details = document.__perchanceInternal.lastPerchanceFnExecutionDetails;
        if(details && details.async && !details.alreadyLogged && Date.now()-details.time < 2000) {
          try {
            let stack = event.reason.stack.toString();
            let lineNumber = stack.match(/<anonymous>:([0-9]+):[0-9]/)?.[1];
            if(!lineNumber) lineNumber = stack.match(/> Function:([0-9]+):[0-9]/)?.[1]; // firefox
            if(lineNumber) {
              lineNumber = Number(lineNumber) - details.functionStartLineWithinWrappedFunction;
              logPerchanceListsFunctionError(details, {lineNumber, error:event.reason});
            }
          } catch(e) { console.error(e); }
          PERCH.perchanceError(`An error possibly occurred within an <b>async</b> function. It <u>may</u> be related to the function defined at line number <b>${document.__perchanceInternal.lastPerchanceFnExecutionDetails.declarationLineNumber}</b>. Here's the error: <b>Unhandled Promise Rejection: ${event.reason}</b>`, {moduleName:document.__perchanceInternal.lastPerchanceFnExecutionDetails.moduleName});
        } else {
          PERCH.perchanceError(`An unhandled promise rejection occurred: <b>${event.reason.message || event.reason}</b>${event.reason.stack ? "<br>"+event.reason.stack : ""}`);
        }
      });

      window.addEventListener('error', async (e) => { // without this, syntax errors in script tags aren't shown in the perchance error box thing
        if(e.lineno == undefined && e.error && typeof e.error.lineNumber === "number") e.lineno = e.error.lineNumber;  

        let moduleDebugDetails = Object.values(window.moduleScriptInsertDetails987934 || {}); 
        
        let lastPerchanceFnExecutionDetails = document.__perchanceInternal.lastPerchanceFnExecutionDetails;

        if(lastPerchanceFnExecutionDetails?.didThrow && !lastPerchanceFnExecutionDetails.alreadyLogged && e.lineno !== undefined && Date.now()-lastPerchanceFnExecutionDetails.time < 100) {
          let details = lastPerchanceFnExecutionDetails;
          let lineNumber = e.lineno - details.functionStartLineWithinWrappedFunction;
          logPerchanceListsFunctionError(details);
        } else if((PERCH.scriptTagInsertDebug84du84ksfhk || moduleDebugDetails.length > 0) && e.lineno !== undefined) {
          let debug = PERCH.scriptTagInsertDebug84du84ksfhk; // has precedence over module since it's synchronously added/deleted before/after script execution
          
          let isModuleScript = false;
          let nonSeenModuleDebugDetails = moduleDebugDetails.filter(o => !o.loaded && !o.alreadySeenByErrorCheck);
          if(!debug && nonSeenModuleDebugDetails.length > 0) {
            debug = nonSeenModuleDebugDetails.sort((a,b) => a.time-b.time)[0]; // get earliest one that didn't load
            if(debug) {
              window.moduleScriptInsertDetails987934[debug.key].alreadySeenByErrorCheck = true;
              isModuleScript = true;
            }
          }

          try {
            let lineno = e.lineno;

            // since syntax errors can "manifest" as error at the absolute end of the script, which is inside our debug suffix code (i.e. longer than the length of the actual user script):
            if(debug.numActualScriptLines !== undefined && lineno > debug.numActualScriptLines) lineno = debug.numActualScriptLines-1;
            
            // translate the browser error line number to an actual line number in the user's script:
            if(debug.numDebugLinesAtStartOfScript !== undefined) lineno -= debug.numDebugLinesAtStartOfScript;

            lineno--; // no idea why (see below in isExternalScriptError if changing this)

            let type = debug.type;
            let erroringLine = debug.scriptTextContent.split("\n").slice(Math.max(0, lineno), lineno+1).join("\n");
            let surroundingCode = debug.scriptTextContent.split("\n").slice(Math.max(0, lineno-5), lineno+5).join("\n");
            let perchanceErrorOpts = {};
            if(debug.type == "function") perchanceErrorOpts.moduleName = debug.moduleName;
            let errorIntro = ""; 
            if(debug.type == "scriptTag") errorIntro = "There's a script tag in your HTML editor that's throwing this error:";
            if(debug.type == "function") errorIntro = `In the function called <b>${debug.functionName}</b> within your lists editor, near line number ${debug.functionHeaderLineNumber + (e.lineno)}, there's a mistake in your code that's causing this error:`;
            let errorMessage = (e.error || e.message).toString();
            
            let isExternalScriptError = false;
            let filename = (e.filename || "").split(" ")[0]; // in firefox there's stuff after the URL
            if(filename && filename.startsWith("https://") && !filename.startsWith(`https://${window.generatorPublicId}.perchance.org/${window.generatorName}`)) {
              isExternalScriptError = true;
            }

            let scriptTagLineNumber = lineno-1;

            let externalScriptText = "";
            if(isExternalScriptError) {
              let url = `https://fetch-plugin.perchance.org/proxy1/${encodeURIComponent(new URL(filename).href)}?origin=${encodeURIComponent(`https://${window.generatorPublicId}.perchance.org`)}`;
              if(filename.startsWith("https://user-uploads.perchance.org/") || filename.startsWith("https://user.uploads.dev/")) url = filename;
              externalScriptText = await fetch(url).then(r => r.text());
              lineno++; // no idea why (see above lineno-- if changing this)
              erroringLine = externalScriptText.split("\n").slice(lineno-1, lineno).join("\n");
              surroundingCode = externalScriptText.split("\n").slice(Math.max(0, lineno-6), lineno+4).join("\n");
              scriptTagLineNumber = lineno-1;
            }

            // in case of e.g. huge minified lines
            erroringLine = erroringLine.slice(0, 5000);
            surroundingCode = surroundingCode.slice(0, 5000);

            // ignore the part of the error that's about the insertion fo the dev's script tag:
            if(errorMessage.startsWith(`SyntaxError: Failed to execute 'insertBefore' on 'Node': `)) {
              errorMessage = errorMessage.replace(`SyntaxError: Failed to execute 'insertBefore' on 'Node': `, "");
            }
            if(errorMessage.startsWith(`SyntaxError: Failed to execute 'append' on 'Element': `)) {
              errorMessage = errorMessage.replace(`SyntaxError: Failed to execute 'append' on 'Element': `, "");
            }

            PERCH.perchanceError(`
              <p>${errorIntro} <b style="color:red;">${errorMessage}</b>.${errorMessage.slice(0, -1) === "Script error" ? ` <b><u>Note:</u> For this particular error, the details below could be incorrect or misleading. You may need to open your browser console to see the full error message. The keyboard shortcut is Ctrl+Shift+J or Cmd+Option+J if using the Chrome browser, and you should see a red error message if you scroll down. Then <a style="color:blue;" href="https://user.uploads.dev/file/f13e4867d37496bcbe0153de8da1ec35.png" target="_blank">follow this screenshot</a>.</b>` : ""}${isExternalScriptError ? ` The error occurred in this external script: <b>${e.filename}</b>` : ""} Here's the line of code (or one <b>near</b> it) that seems to be causing the error:</p>
              <pre style="background:light-dark(#d6d6d6, black); color:light-dark(black, #e1e1e1); padding:0.25rem; border-radius:3px;">${erroringLine.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</pre>
              <p>And here's the surrounding code:</p>
              <pre style="background:light-dark(#d6d6d6, black); color:light-dark(black, #e1e1e1); padding:0.25rem; border-radius:3px;">${surroundingCode.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</pre>
              ${debug.type === "scriptTag" ? `<p>The error <u>may</u> be near <b>line number ${scriptTagLineNumber}</b> of that script tag.</p>` : ""}
              <p style="opacity:0.6;"><i>(Note that any line numbers and/or snippets given above could be inaccurate e.g. due to an unclosed bracket much earlier in your script, or something like that.)</i></p>
            `, perchanceErrorOpts);
          } catch(err) { console.error(e); console.error(err); }
        }
        
        // General fallback in case above fails (will get logged beneath the one above if the one above succeeds).
        let str;
        try {
          str = (e.error || e.message).toString() + (e.lineno !== undefined ? `. The error occurred on line ${e.lineno}.` : "");
          str = (e.error?.stack || e.message).toString();
          str = cleanUpStackTrace(str);
        } catch(e) { console.error(e); } 
        
        
        // Strange - it's as if we're getting the error event too early, so we get a very unhelpful "Script error." message:
        if(!e.error && e.message && e.message.slice(0, -1) === "Script error") {
          str = `Script error. Possibly in an imported external script. Please open your browser console to see the full error message. The keyboard shortcut is Ctrl+Shift+J or Cmd+Option+J if using the Chrome browser, and you should see a red error message if you scroll down. Then <a style="color:blue;" href="https://user.uploads.dev/file/f13e4867d37496bcbe0153de8da1ec35.png" target="_blank">follow this screenshot</a>.`;
        } else {
          // bold and red the first line:
          let lines = str.split(/<br>|\n/);
          str = `<b style="color:red;">${lines[0]}</b><br>${lines.slice(1).join("<br>")}`;

          if(!e.error || (e.error?.stack || "").split("\n").length <= 2) {
            let openConsoleMsg = `<div style="margin-bottom:0.5rem;"><b><u>Note</u>: You may need to open your browser console to see the full error message</b>. The keyboard shortcut is Ctrl+Shift+J or Cmd+Option+J if using the Chrome browser, and you should see a red error message if you scroll down. Then <a style="color:blue;" href="https://user.uploads.dev/file/f13e4867d37496bcbe0153de8da1ec35.png" target="_blank">follow this screenshot</a>.</div>`;
            str = openConsoleMsg + str;
          }
        }
        
        PERCH.perchanceError(str); 
      });

      PERCH.perchanceError = function(message, ctx={}) {
        // PERCH.evaluateCurlyBlock, PERCH.getTextOddsDetails, PERCH.oddsTextToNumber
        PERCH.lastPerchanceErrorTime = Date.now();
        PERCH.currentPerchanceErrorCount++;
        if(PERCH.currentPerchanceErrorCount > PERCH.maxPerchanceErrorCount) return;
        message = message.replace(/#<Object>/g,"#&lt;Object&gt;");
        if(PERCH.ignorePerchanceErrors) { return; } // needed to ignore errors in "secondary parses" (like the one to extract html imports)

        if(!document.querySelector("#perchance-error-indicator")) {
          let div = document.createElement("div");
          let clearButtonClass = "a"+Math.random().toString().replace(".", "");
          let showButtonClass = "a"+Math.random().toString().replace(".", "");
          div.innerHTML = `<div id="perchance-error-indicator" style="position:fixed; bottom:8px; right:8px; z-index:1000000000; user-select:none;">
            <span class="${clearButtonClass}" style="font-size:80%;padding: 0.3rem 0.5rem;border-radius: 4px;background:#565656; color:white; cursor:pointer;"> clear</span>
            <span class="${showButtonClass}" style="display: inline-block;padding: 0.3rem 0.5rem;border-radius: 4px;font-size:80%;background-color: #fc5b5b;color:white;cursor:pointer;">This page has errors (click here)</span>
          </div>`;
          let indicatorEl = div.firstElementChild;
          indicatorEl.querySelector(`.${clearButtonClass}`).onclick = PERCH.clearPerchanceErrors;
          indicatorEl.querySelector(`.${showButtonClass}`).onclick = PERCH.showPerchanceErrorBox;
          document.body.append(indicatorEl);
        }
        
        let intro; 

        if(ctx.declarationLineNumber) {
          let isInClone = false;
          let declarationLineNumber = ctx.declarationLineNumber;
          if(ctx.node) { 
            try {
              // this only works if the node itself was cloned, or the node's parent, or the node's parent's parent. no deeper than that. it probably catches 90% of cases, I'd guess.
              if(PERCH.clonedNodeToOriginalNodeWeakMap.has(ctx.node)) {
                let originalNode = PERCH.clonedNodeToOriginalNodeWeakMap.get(ctx.node);
                declarationLineNumber = originalNode.$declarationLineNumber;
                isInClone = true;
              } else if(ctx.node.$parent && PERCH.clonedNodeToOriginalNodeWeakMap.has(ctx.node.$parent)) {
                let originalNodeParent = PERCH.clonedNodeToOriginalNodeWeakMap.get(ctx.node.$parent);
                let originalNode = originalNodeParent[ctx.node.$key];
                if(originalNode) {
                  declarationLineNumber = originalNode.$declarationLineNumber;
                  isInClone = true;
                } else {
                  console.error("Couldn't find original node in cloned parent?");
                }
              } else if(ctx.node.$parent.$parent && PERCH.clonedNodeToOriginalNodeWeakMap.has(ctx.node.$parent.$parent)) {
                let originalNodeParentParent = PERCH.clonedNodeToOriginalNodeWeakMap.get(ctx.node.$parent.$parent);
                let originalNodeParent = originalNodeParentParent[ctx.node.$parent.$key];
                if(originalNodeParent) {
                  let originalNode = originalNodeParent[ctx.node.$key];
                  if(originalNode) {
                    declarationLineNumber = originalNode.$declarationLineNumber;
                    isInClone = true;
                  } else {
                    console.error("Couldn't find original node in cloned parent?");
                  }
                } else {
                  console.error("Couldn't find original node in cloned parent?");
                }
              }
            } catch(e) {
              console.error(e);
            }
          }
          intro = `<span style="opacity:0.7;">${ctx.moduleName && ctx.moduleName !== window.generatorName ? `There is a problem with the '<a style="color:blue; font-family:inherit; font-weight:bold;" href="https://perchance.org/${ctx.moduleName}#edit" target="_blank">${ctx.moduleName}</a>' generator. ` : ""}An error has occurred${isInClone ? ` in a <b>clone</b> of an item` : ""} near <b style='color:red;'>line number ${declarationLineNumber}</b>:</span>`;
        } else {
          intro = `<span style="opacity:0.7;">${ctx.moduleName && ctx.moduleName !== window.generatorName ? `There is a problem with the '<a style="color:blue; font-family:inherit; font-weight:bold;" href="https://perchance.org/${ctx.moduleName}#edit" target="_blank">${ctx.moduleName}</a>' generator. ` : ""}An error has occurred somewhere in your code (in lists or HTML):</span>`;
        }
        PERCH.perchanceErrorString += `<div>${intro} ${message}</div><hr style="border: 1px solid #e1e1e1;"/>`;
        
        {
          // for browser runner / automation stuff
          let div = document.createElement("div");
          div.style.cssText = "white-space:pre";
          div.innerHTML = PERCH.perchanceErrorString;
          document.__perchanceInternal.perchanceErrorString = div.textContent;
        }

        // The following line is a hack to make it so "pause on caught errors" works for perchance errors in devtools.
        // Click the function names in the "call stack" to go "back in time" and find more details about your error (ask for help on the forum if needed)
        try { throw new Error(""); } catch(e) {}
      }
      PERCH.clearPerchanceErrors = function() {
        if(document.querySelector("#perchance-error-container")) document.querySelector("#perchance-error-container").remove();
        if(document.querySelector("#perchance-error-indicator")) document.querySelector("#perchance-error-indicator").remove();
        PERCH.perchanceErrorString = "";
        PERCH.currentPerchanceErrorCount = 0;
        document.__perchanceInternal.perchanceErrorString = "";
      }
      window.clearPerchanceErrors = PERCH.clearPerchanceErrors; // public version
      window.__clearPerchanceErrors = PERCH.clearPerchanceErrors; // since people were relying on this in their code

      window.ignorePerchanceErrors = function(cb) {
        let orig = PERCH.ignorePerchanceErrors;
        PERCH.ignorePerchanceErrors = true;
        let result = cb();
        PERCH.ignorePerchanceErrors = orig;
        return result;
      };

      PERCH.showPerchanceErrorBox = function() {

        if(document.querySelector("#perchance-error-container")) document.querySelector("#perchance-error-container").remove();
        let div = document.createElement("div");
        div.innerHTML = `
        <div id="perchance-error-container" style="display:flex; color:rgb(25, 25, 25); font-family:monospace;">
          <div style="" class="perchance-error-background" onclick="document.querySelector('#perchance-error-container').remove();"></div>
          <div style="z-index:51;" class="perchance-error-outer-wrapper" onclick="if(document.querySelector('#perchance-error-container') && !document.querySelector('#perchance-error-container').contains(event.target)) { document.querySelector('#perchance-error-container').remove(); }">
            <div ref="contentWrapper" class="perchance-error-content-wrapper">
              <div class="perchance-error-view">
                <div class="perchance-error-modal-body" style="max-height:min(80vh, 450px); overflow-y: auto; padding: 1em; text-align: left;">
                  <div id="perchance-error-stream"></div>
                  <p style="background: #b5ffb5; padding: 1em; margin-bottom: 0;">If you need help with errors, please post a question to the <a href="https://lemmy.world/c/perchance">perchance community</a> along with a link to your generator and someone will take a look at it for you :)</p>
                </div>
                <div class="perchance-error-modal-footer">
                  <button class="perchance-error-main" style="width:100%;" onclick="document.querySelector('#perchance-error-container').remove();">close</button>
                </div>
              </div>
            </div>
          </div>
        </div>`;
        document.body.append(div.firstElementChild);
        document.querySelector("#perchance-error-stream").innerHTML = PERCH.perchanceErrorString;

        // to override user styles on the page:
        document.querySelectorAll("#perchance-error-container *").forEach(el => {
          el.style.cssText += ";font-family:inherit;";
          if(!el.style.cssText.includes("color")) el.style.cssText += ";color:inherit;";
        });
      }

      // override clicks on href="#foo" links - since otherwise due to <base> tag's target="_parent" it would cause a top-level navigation
      document.addEventListener('click', (e) => {
        let target = e.target.closest('a');
        if(target) {
          if(target.getAttribute("href") && target.getAttribute("href").startsWith("#")) {
            e.preventDefault();
            if(window.location.hash === target.getAttribute("href")) { // if it's already set to that, browsers still trigger the scroll. we need to do that manually
              const element = document.getElementById(window.location.hash.slice(1));
              if(element) element.scrollIntoView({behavior:'auto'});
            } else {
              window.location.hash = target.getAttribute("href"); // scroll is triggered automatically
            }
          }
        }
      });
    }</script> <script>(async function() {
      if((window.location.host === "null.perchance.org" || window.location.host === `${window.generatorPublicId}.perchance.org`) && !navigator["\u0077\u0065\u0062\u0064\u0072\u0069\u0076\u0065\u0072"]) {
        await new Promise(r => setTimeout(r, 1000*10));
        while(1) {
          await new Promise(r => { ["mouseenter", "mousemove", "touchstart"].forEach(n => document.addEventListener(n, e=>{ if(e.isTrusted){r()} }, { once: true })); });
          while(document.visibilityState !== "visible" || !document.hasFocus()) await new Promise(r => setTimeout(r, 1000));
          await new Promise(r => setTimeout(r, 1000*90));
          fetch(`https://perchance.org/api/cv?generatorName=${window.location.pathname.slice(1)}&isFromEmbed=1&__cacheBust=${Math.random()}`, {mode:"no-cors"}).catch(e => console.error(e));
          await new Promise(r => setTimeout(r, 1000*60*60*6));
        }
      }
    })();</script> <script>(function() {
      const PERCH = window.PERCH;

      if(window.location.host !== "null.perchance.org" && window.location.host !== `${window.generatorPublicId}.perchance.org`) return;
      
      let alreadySentSignal = false; // just to be sure
      let interval;

      let messageType = "usingAdPoweredPlugin";

      // for embeds within embeds, we pass the message up the chain:
      window.addEventListener("message", function(e) {
        if(e.data.type === messageType) {
          PERCH.parentWindow.postMessage({type:messageType}, "*"); // must use wildcard origin because could be embed within embed
        }
      });
      
      function detectAdPoweredPlugin() {
        if(!alreadySentSignal) {
          if(window.root && window.root.$moduleSpace && (window.root.$moduleSpace["text-to-image-plugin"] || window.root.$moduleSpace["ai-text-plugin"])) {
            PERCH.parentWindow.postMessage({type:messageType}, "*"); // must use wildcard origin because could be embed within embed
            // initFocusBugFix();
            clearInterval(interval);
            alreadySentSignal = true;
            return;
          }
          if([...document.querySelectorAll("iframe")].filter(el => el.src.startsWith("https://image-generation.perchance.org/embed") || el.src.startsWith("https://text-generation.perchance.org/embed")).length > 0) {
            PERCH.parentWindow.postMessage({type:messageType}, "*"); // must use wildcard origin because could be embed within embed
            // initFocusBugFix();
            clearInterval(interval);
            alreadySentSignal = true;
            return;
          }
        }
      }
      
      interval = setInterval(detectAdPoweredPlugin, 1000);
      setTimeout(() => {
        clearInterval(interval);
        if(!alreadySentSignal) {
          interval = setInterval(detectAdPoweredPlugin, 10000);
          setTimeout(() => clearInterval(interval), 2*60*1000);
        }
      }, 10000);
    })();</script> <script>// CAUTION: This cache bustint stuff is still needed for when user is embedding with null.perchance.org - since in that case there's no __generatorLastEditTime, and hence no way to know if it's the latest version. 
    (async function() {
      // CAUTION: we can't rely on __generatorLastEditTime because a *dependency* could have been updated.
      // if(window.location.href.includes("__generatorLastEditTime=")) return;

      // Here we tell the server to update the cache if needed, and if it did, then we temporarily bust the cache using a query string.
      if(window.location.host === "null.perchance.org" || window.location.host === `${window.generatorPublicId}.perchance.org`) { // only if this HTML file is hosted at null.perchance.org / <publidId>.perchance.org
        if(navigator.webdriver) return; // just in case this is what's confusing the Google crawler - RE the title bug
        if(window.location.href.includes("__cacheBust")) return; // no need to run this check if cache is already busted
        if(/__initWithDataFromParentWindow=[1-9]/.test(window.location.href)) return; // data is being loaded from parent

        let imports = JSON.parse(decodeURI(document.querySelector("#imported-generator-names").textContent));
        let clientHtmlServerRenderTime = Number(document.querySelector("#this-html-server-render-time").textContent);

        let transferSize = 1;
        try { transferSize = performance.getEntriesByType("navigation")[0].transferSize; } catch(e) {}
        if(isNaN(transferSize)) transferSize = 1;
        console.debug("Embed transfer size:", window.location.pathname, transferSize);
        // transferSize will be zero if it was loaded from browser cache, assuming the user's browser supports the API

        let checkStartTime = Date.now();
        let weHaveAnOldVersionOfThisGen = await fetch(`https://perchance.org/api/clearCacheIfGeneratorOrImportsHaveBeenUpdated?generatorName=${window.location.pathname.slice(1)}&importedGeneratorNames=${imports.join(",")}&clientHtmlServerRenderTime=${clientHtmlServerRenderTime}&transferSize=${transferSize}&queryParamString=${encodeURIComponent(window.location.search)}&__cacheBust=${Math.random()}`).then(r => r.json()).catch(e => { console.error(e); return false; });
        if(weHaveAnOldVersionOfThisGen) { 
          console.debug("This is an old version of this generator.");
          if(Date.now()-checkStartTime < 10000) {
            console.debug("Doing cache bust reload in embed now...");
            let url = new URL(window.location.href);
            url.searchParams.set("__cacheBust", Math.random());
            window.location.href = url.href;
          } else {
            console.debug("Too late to do cache bust in embed.");
          }
        }
      }
    })();
    if(location.href.includes("__cacheBust")) {
      let url = new URL(window.location.href);
      url.searchParams.delete("__cacheBust");
      PERCH.originalHistoryReplaceState({}, "", url.href);
    }</script> <script>document.addEventListener("DOMContentLoaded", function() {
      if(!window.location.href.startsWith("file:") || window.location.hash !== "#edit") return;

      let originalHtmlText = document.documentElement.outerHTML; // for editing + saving later

      let preloadedGeneratorDataEl = document.querySelector("#preloaded-generator-data");
      let preloadedGeneratorData = JSON.parse(decodeURI(preloadedGeneratorDataEl.textContent));
      
      let importedGeneratorsEl = document.querySelector("#imported-generators");
      let importedGenerators = JSON.parse(decodeURI(importedGeneratorsEl.textContent));
      
      let importedGeneratorNamesEl = document.querySelector("#imported-generator-names");
      let importedGeneratorNames = JSON.parse(decodeURI(importedGeneratorNamesEl.textContent));

      function saveTextFile(text, name) {
        let el = document.createElement("a");
        let extension = name.split(".").pop();
        let type = extension === "txt" ? "plain" : extension;
        let file = new Blob([text], {type:"text/"+extension});
        let url = URL.createObjectURL(file);
        el.href = url;
        el.download = name;
        el.style.display = 'none';
        document.body.appendChild(el);
        el.click();
        document.body.removeChild(el);
        setTimeout(() => URL.revokeObjectURL(url), 10000);
      }

      function makeElementDraggable(el) { // This function expects `el` to contain an element with the `drag-handle` class.
        let endX = 0, endY = 0, startX = 0, startY = 0;
        let dragHandleEl = el.querySelector(".drag-handle");
        dragHandleEl.addEventListener("mousedown", dragMouseDown);

        function dragMouseDown(e) {
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          startX = e.clientX;
          startY = e.clientY;
          document.addEventListener("mouseup", closeDragElement);
          document.addEventListener("mousemove", elementDrag);
        }

        function elementDrag(e) {
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          endX = startX - e.clientX;
          endY = startY - e.clientY;
          startX = e.clientX;
          startY = e.clientY;
          // set the element's new position:
          el.style.top = (el.offsetTop - endY) + "px";
          el.style.left = (el.offsetLeft - endX) + "px";
        }

        function closeDragElement() {
          // stop moving when mouse button is released:
          document.removeEventListener("mouseup", closeDragElement);
          document.removeEventListener("mousemove", elementDrag);
        }
      }
      

      let editorCtn = document.createElement("div");
      editorCtn.style.cssText = "width:700px; height:500px; position:fixed; display: flex; flex-direction: column;";
      editorCtn.innerHTML = `
        <div class="header" style="display:flex; overflow:auto;"> 
          <!-- <div class="drag-handle" style=" display: flex; background: #e8e8e8; padding: 1rem;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 2rem;"><path d="M278.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8h32v96H128V192c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9  34.9 6.9s19.8-16.6 19.8-29.6V288h96v96H192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8H288V288h96v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6v32H288V128h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64z"></path></svg></div> -->
          <button class="drag-handle">drag</button>
          <button class="save-button">save</button>
          <div style="">
            <div class="tabs" style="display:flex; width:max-content;">
              <!-- tabs get inserted here -->
            </div>
          </div>
        </div>
        <div class="body" style="flex-grow:1;"> 
          <!-- text editors get inserted here -->
        </div>
      `;

      makeElementDraggable(editorCtn);

      let editors = [];
      editors.push({
        name: preloadedGeneratorData.name,
        content: preloadedGeneratorData.modelText,
        main: true,
        type: "lists",
        visible: true,
      });
      editors.push({
        name: preloadedGeneratorData.name,
        content: preloadedGeneratorData.outputTemplate,
        main: true,
        type: "html",
        visible: false,
      });
      for(let gen of importedGenerators) {
        editors.push({
          name: gen.name,
          content: gen.modelText,
          visible: false,
        });
      }

      function saveGenerator() {
        let preloadedGeneratorData_new = JSON.parse(JSON.stringify(preloadedGeneratorData));
        preloadedGeneratorData_new.modelText = editors.filter(e => e.main && e.type=="lists")[0].textArea.value;
        preloadedGeneratorData_new.outputTemplate = editors.filter(e => e.main && e.type=="html")[0].textArea.value;

        let importedGenerators_new = JSON.parse(JSON.stringify(importedGenerators));
        for(let editor of editors) {
          if(editor.main) continue;
          importedGenerators_new.filter(e => e.name===editor.name)[0].modelText = editor.textArea.value;
        }
        let text = originalHtmlText;
        text = text.replace(/(<script id="preloaded-generator-data"[^>]*>)(.+?)(<\/script>)/, `$1${encodeURI(JSON.stringify(preloadedGeneratorData_new))}$3`);
        text = text.replace(/(<script id="imported-generators"[^>]*>)(.+?)(<\/script>)/, `$1${encodeURI(JSON.stringify(importedGenerators_new))}$3`);
        // TODO: Add `imported-generator-names` when you've added the ability to add more generators.
        saveTextFile(text, preloadedGeneratorData_new.name+".html");
      };
      editorCtn.querySelector(".save-button").onclick = saveGenerator;
      document.addEventListener("keydown", function(e) {
        if(e.key === 's' && (navigator.platform.match("Mac") ? e.metaKey : e.ctrlKey)) {
          e.preventDefault();
          saveGenerator();
        }
      }, false);

      for(let editor of editors) {
        let textArea = document.createElement("textarea");
        textArea.style.cssText = `width:100%; height:100%; display:${editor.visible ? "block" : "none"}; white-space:pre; font-family:monospace; tab-size:2;`;
        textArea.value = editor.content;
        editorCtn.querySelector(".body").appendChild(textArea);
        editor.textArea = textArea;

        // TODO: Handle resizing of the editor properly:
        // new ResizeObserver(resizeHandler).observe(textArea)

        let tabButton = document.createElement("button");
        tabButton.innerHTML = `${editor.name}${editor.type=="html" ? " (html)" : ""}`;
        tabButton.style.cssText = `width:max-content; ${editor.main ? "font-weight:bold;" : ""} ${editor.visible ? "color:green;" : ""}`;
        tabButton.onclick = () => {
          editors.forEach(e => e.textArea.style.display="none");
          editors.forEach(e => e.tabButton.style.color="");
          textArea.style.display = "block";
          tabButton.style.color = "green";
        };
        editorCtn.querySelector(".tabs").appendChild(tabButton);
        editor.tabButton = tabButton;
      }

      document.body.appendChild(editorCtn);

    });</script> </head> <body id="output-container"> </body> </html> 